const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdfWorker-CeDIboJ0.js","./ai-services-C7T4cFUa.js","./react-vendor-SE0pM8Ra.js","./ui-components-ByoYm48K.js","./data-fetching-De8LKKym.js","./vendor-CrSvAuNw.js","./ocr-worker-Ehk6BbiK.js","./pdf-worker-CdhgQTyu.js","./react-vendor-BxwK8EBg.css","./supabase-Cfql4b7O.js","./utilities-CJeqyZZO.js","./forms-Mu2Tem6y.js","./ai-services-B6zMJYRV.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{r as t,bR as a,j as n,aR as i,F as r,q as c,b5 as l,X as d,aU as o,cl as m,Z as x,cm as h,N as u,b0 as p,m as g,ce as j,w as f,c0 as y,v as N,Y as w,W as v,y as b,aE as S,aL as k,H as C,cf as D,cg as _,ca as z,o as T,cn as U,bN as A,b2 as F,ch as E,a4 as I,a5 as P,bO as O,aK as R,aO as M,bV as $,bH as q,bT as L,bS as B,bU as V,bE as Q,bG as K,ar as W,a6 as H,co as G,aQ as Y,u as J,_ as X,aI as Z}from"./react-vendor-SE0pM8Ra.js";import{_ as ee,w as se,x as te,y as ae,F as ne,C as ie,u as re,v as ce,z as le,o as de,B as oe,A as me,E as xe,G as he,H as ue,J as pe,K as ge,P as je,L as fe,M as ye,N as Ne,I as we,O as ve,h as be,D as Se,a as ke,b as Ce,d as De,q as _e,r as ze,s as Te,t as Ue,Q as Ae,R as Fe,S as Ee,U as Ie,V as Pe,W as Oe,X as Re,Y as Me,Z as $e,$ as qe,p as Le,j as Be,a0 as Ve,a1 as Qe,a2 as Ke,a3 as We,a4 as He,a5 as Ge,a6 as Ye,a7 as Je,a8 as Xe,a9 as Ze}from"./ai-services-C7T4cFUa.js";import{supabase as es}from"./supabase-Cfql4b7O.js";import{J as ss}from"./vendor-CrSvAuNw.js";import{f as ts,l as as}from"./utilities-CJeqyZZO.js";import{b as ns}from"./useAnnotations-DlCzKY2M.js";import{o as is,s as rs,e as cs,n as ls,b as ds,t as os}from"./forms-Mu2Tem6y.js";import{c as ms,t as xs,s as hs}from"./search-C03hkH2s.js";import"./ui-components-ByoYm48K.js";import"./data-fetching-De8LKKym.js";import"./ocr-worker-Ehk6BbiK.js";import"./pdf-worker-CdhgQTyu.js";async function us(e,s){const t=e.type.toLowerCase(),a=e.name.toLowerCase();if("application/pdf"===t||a.endsWith(".pdf"))return async function(e,s){const t=Date.now();try{s?.({status:"initializing",progress:0,message:"Loading PDF..."});const{getPdfJs:a}=await ee(async()=>{const{getPdfJs:e}=await import("./pdfWorker-CeDIboJ0.js");return{getPdfJs:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url),n=await a();if(!n)throw new Error("PDF.js failed to load");const i=await e.arrayBuffer(),r=await n.getDocument({data:i}).promise,c=r.numPages,l=[];let d="";for(let e=1;e<=c;e++){s?.({status:"processing",progress:(e-1)/c*100,currentPage:e,totalPages:c,message:`Processing page ${e} of ${c}...`});const t=await r.getPage(e),a=(await t.getTextContent()).items.map(e=>e.str).join(" ").trim();l.push({pageNumber:e,text:a,confidence:.95}),d+=a+"\n"}const o=Date.now()-t;return s?.({status:"completed",progress:100,message:"PDF processing completed"}),{text:d.trim(),confidence:.95,pages:l,metadata:{processingTime:o,fileSize:e.size,pageCount:c}}}catch(a){throw s?.({status:"error",progress:0,message:"Failed to process PDF"}),new Error("Failed to extract text from PDF")}}(e,s);if(t.startsWith("image/")||a.endsWith(".jpg")||a.endsWith(".jpeg")||a.endsWith(".png")||a.endsWith(".gif")||a.endsWith(".bmp")||a.endsWith(".tiff"))return async function(e,s){const t=Date.now();try{s?.({status:"initializing",progress:0,message:"Initializing OCR..."});const a=await ee(()=>import("./ocr-worker-Ehk6BbiK.js").then(e=>e.i),__vite__mapDeps([6,5,2,3,4,7,1,9,10,11,12,8]),import.meta.url),n=await a.recognize(e,"eng",{logger:e=>{"recognizing text"===e.status&&s?.({status:"processing",progress:100*e.progress,message:`OCR processing: ${Math.round(100*e.progress)}%`})}}),i=Date.now()-t;return s?.({status:"completed",progress:100,message:"OCR processing completed"}),{text:n.data.text,confidence:n.data.confidence/100,pages:[{pageNumber:1,text:n.data.text,confidence:n.data.confidence/100}],metadata:{processingTime:i,fileSize:e.size,pageCount:1}}}catch(a){throw s?.({status:"error",progress:0,message:"OCR processing failed"}),new Error("Failed to perform OCR on image")}}(e,s);if("text/plain"===t||a.endsWith(".txt")){const t=Date.now();s?.({status:"processing",progress:50,message:"Reading text file..."});const a=await e.text(),n=Date.now()-t;return s?.({status:"completed",progress:100,message:"Text file processed"}),{text:a,confidence:1,pages:[{pageNumber:1,text:a,confidence:1}],metadata:{processingTime:n,fileSize:e.size,pageCount:1}}}throw new Error(`Unsupported file type: ${t}`)}function ps(e){const{text:s,confidence:t}=e,a=[];t<.7&&a.push("Low confidence detected. Consider rescanning with higher resolution.");const n=[/[0O]{3,}/,/[1Il]{3,}/,/\s{5,}/,/[^\w\s.,;:!?()-]{3,}/].some(e=>e.test(s));n&&a.push("Potential OCR errors detected. Review the extracted text carefully."),s.length<50&&a.push("Very little text extracted. Ensure the document contains readable text.");let i=t;return n&&(i-=.2),s.length<50&&(i-=.3),i=Math.max(0,Math.min(1,i)),{isGoodQuality:i>=.7,suggestions:a,qualityScore:i}}function gs(e){return e.replace(/\s+/g," ").replace(/[^\w\s.,;:!?()"-]/g,"").replace(/0/g,"O").replace(/1/g,"I").replace(/\n+/g,"\n").trim()}async function js(e,s,t){try{const{usageTrackingService:n}=await ee(async()=>{const{usageTrackingService:e}=await import("./ai-services-C7T4cFUa.js").then(e=>e.al);return{usageTrackingService:e}},__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url),i=await n.checkUsageLimit("ai_query");if(!i.allowed)throw new Error(`AI processing limit exceeded. You have used ${i.current}/${i.limit} AI queries this month. Please upgrade your plan to continue.`);t?.({stage:"ocr",progress:0,message:"Starting text extraction..."});const r=await us(e,e=>{t?.({stage:"ocr",progress:.4*e.progress,message:e.message||"Extracting text..."})}),c=ps(r),l=gs(r.text),{error:d}=await es.from("uploaded_documents").update({ocr_text:l,ocr_quality_score:c.qualityScore,processing_status:"processing",updated_at:(new Date).toISOString()}).eq("id",s);if(d)throw new Error(`Failed to update OCR results: ${d.message}`);t?.({stage:"analysis",progress:40,message:"Analyzing document content..."});const o=await se(l);await n.incrementUsage("ai_query",s,{operation:"document_analysis",text_length:l.length,document_type:e.type});const{error:m}=await es.from("uploaded_documents").update({document_structure:{analysis:o,ocrQuality:c,metadata:r.metadata},updated_at:(new Date).toISOString()}).eq("id",s);if(m)throw new Error(`Failed to update analysis results: ${m.message}`);let x;if(t?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),l.length>50)try{const e=function(e,s=1e3){const t=[],a=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let n="";for(const i of a){const e=i.trim();n.length+e.length+1<=s?n+=(n?". ":"")+e:(n&&t.push(n+"."),n=e)}n&&t.push(n+".");if(0===t.length){const a=e.split(/\s+/);let n="";for(const e of a)n.length+e.length+1<=s?n+=(n?" ":"")+e:(n&&t.push(n),n=e);n&&t.push(n)}return t.filter(e=>e.trim().length>0)}(l,1e3);for(let a=0;a<e.length;a++){const n=e[a],i=await te(n),{data:r,error:c}=await es.from("document_embeddings").insert({document_id:s,chunk_text:n,chunk_index:a,embedding:i.embedding,metadata:{usage:i.usage,chunkLength:n.length,totalChunks:e.length}}).select("id").single();c||0===a&&(x=r.id);const l=70+(a+1)/e.length*20;t?.({stage:"embedding",progress:l,message:`Processing chunk ${a+1} of ${e.length}...`})}}catch(a){}t?.({stage:"completed",progress:95,message:"Finalizing document processing..."});const{data:h,error:u}=await es.from("uploaded_documents").update({processing_status:"completed",updated_at:(new Date).toISOString()}).eq("id",s).select().single();if(u)throw new Error(`Failed to finalize document: ${u.message}`);return t?.({stage:"completed",progress:100,message:"Document processing completed successfully!"}),{document:h,ocrResult:r,analysis:o,embeddingId:x}}catch(n){throw await es.from("uploaded_documents").update({processing_status:"failed",updated_at:(new Date).toISOString()}).eq("id",s),t?.({stage:"error",progress:0,message:"Document processing failed",error:n instanceof Error?n.message:"Unknown error"}),n}}new class{constructor(){s(this,"ws",null),s(this,"reconnectAttempts",0),s(this,"maxReconnectAttempts",5),s(this,"reconnectDelay",1e3),s(this,"handlers",new Map),s(this,"isConnecting",!1),s(this,"userId",null)}setupAuthListener(){es.auth.onAuthStateChange((e,s)=>{"SIGNED_IN"===e&&s?.user?(this.userId=s.user.id,this.connect()):"SIGNED_OUT"===e&&(this.userId=null,this.disconnect())})}async connect(){}getWebSocketUrl(){return"https://kvlaydeyqidlfpfutbmp.supabase.co".replace("https://","wss://")+"/realtime/v1/websocket"}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts);this.reconnectAttempts++,setTimeout(()=>{this.connect()},e)}disconnect(){this.ws&&(this.ws.close(1e3,"User disconnected"),this.ws=null),this.isConnecting=!1,this.reconnectAttempts=0}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}handleMessage(e){(this.handlers.get(e.type)||[]).forEach(s=>{try{s(e)}catch(t){}});(this.handlers.get("all")||[]).forEach(s=>{try{s(e)}catch(t){}})}subscribe(e,s){return this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(s),()=>{const t=this.handlers.get(e);if(t){const e=t.indexOf(s);e>-1&&t.splice(e,1)}}}sendDocumentProcessingUpdate(e){this.send({type:"document_processing",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0,documentId:e.documentId})}sendAIQueryUpdate(e){this.send({type:"ai_query",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}sendSystemNotification(e){this.send({type:"system_notification",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}get isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}get connectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"unknown"}}};const fs=new class{async connect(){}disconnect(){}subscribe(e,s){return()=>{}}sendDocumentProcessingUpdate(e){}sendAIQueryUpdate(e){}sendSystemNotification(e){}get isConnected(){return!1}get connectionState(){return"disabled"}};const ys=({onUploadComplete:e,maxFiles:s=5})=>{const[h,u]=t.useState([]),[p,g]=t.useState(!1),[j,f]=t.useState(!1),{profile:y,loading:N}=ae(),{simulateDocumentProcessing:w}={simulateDocumentProcessing:t.useCallback(e=>{},[]),simulateAIQuery:t.useCallback(e=>{},[]),simulateSystemNotification:t.useCallback(e=>{fs.sendSystemNotification({id:`notification_${Date.now()}`,...e})},[])},v=t.useCallback(e=>{y||N||ss.warning("Profile not fully loaded. Upload will proceed with default settings."),f(!0);(async()=>{try{if(y){const{usageTrackingService:e}=await ee(async()=>{const{usageTrackingService:e}=await import("./ai-services-C7T4cFUa.js").then(e=>e.al);return{usageTrackingService:e}},__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url),s=e.checkUsageLimit("document_upload"),t=new Promise((e,s)=>setTimeout(()=>s(new Error("Usage check timeout")),5e3)),a=await Promise.race([s,t]);if(!a.allowed)return ss.error(`Upload limit reached. You have used ${a.current}/${a.limit} document uploads this month. Please upgrade your plan to continue.`),void f(!1);a.percentage>=80&&ss.warning(`You have used ${a.current}/${a.limit} document uploads this month (${Math.round(a.percentage)}%).`)}else ss.warning("Profile not loaded. Upload will proceed with default free tier limits.")}catch(s){ss.warning("Unable to verify upload limits. Upload will proceed but may be subject to restrictions.")}f(!1),b(e)})()},[y]),b=t.useCallback(e=>{const t=y?.subscription_tier?ne.maxSize[y.subscription_tier]:ne.maxSize.free,a=e.filter(e=>!(e.size>t)||(ss.error(`File ${e.name} is too large. Maximum size is ${Math.round(t/1024/1024)}MB`),!1)).map(e=>({file:e,id:crypto.randomUUID(),progress:0,status:"pending"}));u(e=>[...e,...a].slice(0,s))},[y,s]),{getRootProps:S,getInputProps:k,isDragActive:C}=a({onDrop:v,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:s,disabled:p||j||N}),D=h.some(e=>"pending"===e.status&&e.documentType);return n.jsxs(ie,{className:"w-full",children:[n.jsxs(re,{children:[n.jsx(ce,{children:"Upload Documents"}),n.jsx(le,{children:"Upload your legal documents for AI-powered analysis and processing"})]}),n.jsxs(de,{className:"space-y-4",children:[n.jsxs("div",{...S(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${C?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${p||j||N||!y?"opacity-50 cursor-not-allowed":""}`,children:[n.jsx("input",{...k()}),n.jsx(i,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),N?n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-600 mb-2",children:"Loading user profile..."}),n.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):j?n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-600 mb-2",children:"Checking upload limits..."}),n.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):C?n.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop files here, or click to select files"}),n.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((y?.subscription_tier?ne.maxSize[y.subscription_tier]:ne.maxSize.free)/1024/1024),"MB"]})]})]}),h.length>0&&n.jsx("div",{className:"space-y-3",children:h.map(e=>n.jsxs("div",{className:"border rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(r,{className:"h-4 w-4 text-gray-500"}),n.jsx("span",{className:"text-sm font-medium",children:e.file.name}),n.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(e.file.size/1024)," KB)"]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:["completed"===e.status&&n.jsx(c,{className:"h-4 w-4 text-green-500"}),"error"===e.status&&n.jsx(l,{className:"h-4 w-4 text-red-500"}),"pending"===e.status&&n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void u(e=>e.filter(e=>e.id!==s));var s},children:n.jsx(d,{className:"h-4 w-4"})})]})]}),"pending"===e.status&&n.jsx("div",{className:"mb-2",children:n.jsxs(me,{value:e.documentType||"",onValueChange:s=>{return t=e.id,a=s,void u(e=>e.map(e=>e.id===t?{...e,documentType:a}:e));var t,a},children:[n.jsx(xe,{className:"w-full",children:n.jsx(he,{placeholder:"Select document type"})}),n.jsx(ue,{children:Object.entries(pe).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))})]})}),("uploading"===e.status||"processing"===e.status)&&n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{children:e.processingMessage||"Processing..."}),n.jsxs("span",{children:[Math.round(e.progress),"%"]})]}),n.jsx(je,{value:e.progress,className:"w-full"}),e.processingStage&&n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:["ocr"===e.processingStage&&n.jsx(o,{className:"h-3 w-3"}),"analysis"===e.processingStage&&n.jsx(m,{className:"h-3 w-3"}),"embedding"===e.processingStage&&n.jsx(x,{className:"h-3 w-3"}),n.jsxs("span",{className:"capitalize",children:[e.processingStage," processing"]})]})]}),"error"===e.status&&e.error&&n.jsx(fe,{variant:"destructive",children:n.jsx(ye,{children:e.error})})]},e.id))}),h.length>0&&n.jsx(oe,{onClick:async()=>{if(0!==h.length){g(!0);for(const a of h)if("pending"===a.status&&a.documentType)try{u(e=>e.map(e=>e.id===a.id?{...e,status:"uploading",progress:0,processingMessage:"Uploading file..."}:e));const t=await Ne.uploadDocument(a.file,a.documentType);try{const{usageTrackingService:e}=await ee(async()=>{const{usageTrackingService:e}=await import("./ai-services-C7T4cFUa.js").then(e=>e.al);return{usageTrackingService:e}},__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url);await e.incrementUsage("document_upload",t.id,{filename:a.file.name,file_size:a.file.size,document_type:a.documentType})}catch(s){}u(e=>e.map(e=>e.id===a.id?{...e,status:"processing",progress:20,documentId:t.id,processingMessage:"Starting AI processing..."}:e)),fs.sendDocumentProcessingUpdate({documentId:t.id,status:"processing",progress:20,message:"Starting AI processing..."}),await js(a.file,t.id,e=>{u(s=>s.map(s=>s.id===a.id?{...s,progress:20+.8*e.progress,processingStage:e.stage,processingMessage:e.message}:s)),fs.sendDocumentProcessingUpdate({documentId:t.id,status:"processing",progress:20+.8*e.progress,message:e.message,stage:e.stage})}),u(e=>e.map(e=>e.id===a.id?{...e,status:"completed",progress:100,processingMessage:"Processing completed!"}:e)),fs.sendDocumentProcessingUpdate({documentId:t.id,status:"completed",progress:100,message:"Document processing completed successfully!"}),ss.success(`${a.file.name} uploaded and processed successfully`),e&&e(t.id)}catch(t){u(e=>e.map(e=>e.id===a.id?{...e,status:"error",error:t.message??"Upload or processing failed",processingMessage:"Failed"}:e));const e=h.find(e=>e.id===a.id);e?.documentId&&fs.sendDocumentProcessingUpdate({documentId:e.documentId,status:"failed",progress:0,message:"Document processing failed",error:t.message??"Upload or processing failed"}),ss.error(`Failed to process ${a.file.name}: ${t.message}`)}g(!1)}},disabled:!D||p,className:"w-full",children:p?"Uploading...":`Upload ${h.filter(e=>"pending"===e.status).length} Files`})]})]})},Ns=({onUploadComplete:e,maxFiles:s=5})=>{const[a,c]=t.useState([]),[d,o]=t.useState(!1);return n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"flex items-center",children:[n.jsx(i,{className:"h-5 w-5 mr-2"}),"Document Upload (Fallback Mode)"]}),n.jsx(le,{children:"Basic file upload functionality"})]}),n.jsxs(de,{className:"space-y-4",children:[n.jsxs(fe,{children:[n.jsx(l,{className:"h-4 w-4"}),n.jsx(ye,{children:"Advanced upload features are temporarily unavailable. Using basic upload mode."})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{htmlFor:"file-input",className:"block text-sm font-medium",children:"Select Files"}),n.jsx("input",{id:"file-input",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt",onChange:e=>{const t=Array.from(e.target.files||[]).filter(e=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(e.type)?!(e.size>10485760)||(ss.error(`${e.name} is too large (max 10MB)`),!1):(ss.error(`${e.name} is not a supported file type`),!1));c(e=>[...e,...t].slice(0,s))},disabled:d,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Supports PDF, DOC, DOCX, TXT files up to 10MB each"})]}),a.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("h4",{className:"text-sm font-medium",children:"Selected Files:"}),a.map((e,s)=>n.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(r,{className:"h-4 w-4 text-gray-500"}),n.jsx("span",{className:"text-sm",children:e.name}),n.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(e.size/1024)," KB)"]})]}),n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>(e=>{c(s=>s.filter((s,t)=>t!==e))})(s),disabled:d,children:"Remove"})]},s))]}),n.jsx(oe,{onClick:async()=>{if(0!==a.length){o(!0);try{for(const s of a)await new Promise(e=>setTimeout(e,1e3)),e&&e(`mock-id-${Date.now()}`);ss.success(`Successfully uploaded ${a.length} file(s)`),c([])}catch(s){ss.error("Upload failed. Please try again.")}finally{o(!1)}}else ss.error("Please select files to upload")},disabled:0===a.length||d,className:"w-full",children:d?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Uploading..."]}):n.jsxs(n.Fragment,{children:[n.jsx(i,{className:"h-4 w-4 mr-2"}),"Upload ",a.length," File(s)"]})})]})]})},ws=()=>n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"flex items-center",children:[n.jsx(i,{className:"h-5 w-5 mr-2"}),"Document Upload"]}),n.jsx(le,{children:"Loading upload interface..."})]}),n.jsx(de,{className:"flex items-center justify-center py-8",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Initializing upload component..."})]})})]}),vs=({error:e,resetErrorBoundary:s})=>n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"flex items-center text-red-600",children:[n.jsx(l,{className:"h-5 w-5 mr-2"}),"Upload Error"]}),n.jsx(le,{children:"The upload component encountered an error"})]}),n.jsxs(de,{className:"space-y-4",children:[n.jsxs(fe,{variant:"destructive",children:[n.jsx(l,{className:"h-4 w-4"}),n.jsx(ye,{children:e.message||"An unexpected error occurred while loading the upload component."})]}),n.jsx("div",{className:"flex space-x-2",children:n.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Try Again"})}),n.jsxs("details",{className:"text-xs text-gray-500",children:[n.jsx("summary",{className:"cursor-pointer",children:"Technical Details"}),n.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto",children:e.stack})]})]})]}),bs=e=>n.jsx(h,{FallbackComponent:vs,onError:(e,s)=>{"undefined"!=typeof window&&window.gtag&&window.gtag("event","exception",{description:e.message,fatal:!1})},onReset:()=>{},children:n.jsx(t.Suspense,{fallback:n.jsx(ws,{}),children:n.jsx(Ss,{...e})})}),Ss=e=>{const[s,t]=u.useState(!0),[a,i]=u.useState(!1);return u.useEffect(()=>{i(!1)},[e]),a||!s?n.jsx(Ns,{...e}):n.jsx(h,{FallbackComponent:()=>(i(!0),n.jsx(Ns,{...e})),onError:e=>{t(!1),i(!0)},children:n.jsx(ys,{...e})})},ks=({onDocumentSelect:e,refreshTrigger:s})=>{const[a,i]=t.useState([]),[d,m]=t.useState(!0),[x,h]=t.useState(""),[u,w]=t.useState("all"),[v,b]=t.useState("all");t.useEffect(()=>{S()},[s]);const S=async()=>{try{m(!0);const e=await Ne.getDocuments();i(e)}catch(e){ss.error("Failed to load documents")}finally{m(!1)}},k=async()=>{if(x.trim())try{m(!0);const e=await Ne.searchDocuments(x);i(e)}catch(e){ss.error("Failed to search documents")}finally{m(!1)}else S()},C=e=>{switch(e){case"pending":return n.jsx(N,{className:"h-4 w-4 text-yellow-500"});case"processing":return n.jsx(p,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return n.jsx(c,{className:"h-4 w-4 text-green-500"});case"failed":return n.jsx(l,{className:"h-4 w-4 text-red-500"});default:return n.jsx(r,{className:"h-4 w-4 text-gray-500"})}},D=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},_=a.filter(e=>{const s="all"===u||e.processing_status===u,t="all"===v||e.document_type===v;return s&&t});return d&&0===a.length?n.jsx(ie,{children:n.jsx(de,{className:"flex items-center justify-center py-8",children:n.jsx(p,{className:"h-8 w-8 animate-spin"})})}):n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsx(ce,{children:"Documents"}),n.jsx(le,{children:"Manage and view your uploaded documents"})]}),n.jsxs(de,{className:"space-y-4",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[n.jsxs("div",{className:"flex-1 flex gap-2",children:[n.jsx(we,{placeholder:"Search documents...",value:x,onChange:e=>h(e.target.value),onKeyPress:e=>"Enter"===e.key&&k()}),n.jsx(oe,{onClick:k,variant:"outline",children:n.jsx(g,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(me,{value:u,onValueChange:w,children:[n.jsx(xe,{className:"w-32",children:n.jsx(he,{})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"all",children:"All Status"}),Object.entries(ve).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))]})]}),n.jsxs(me,{value:v,onValueChange:b,children:[n.jsx(xe,{className:"w-32",children:n.jsx(he,{})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"all",children:"All Types"}),Object.entries(pe).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))]})]})]})]}),0===_.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(r,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents found"}),n.jsx("p",{className:"text-gray-500",children:0===a.length?"Upload your first document to get started":"Try adjusting your search or filters"})]}):n.jsx("div",{className:"space-y-3",children:_.map(s=>n.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[n.jsx(r,{className:"h-8 w-8 text-gray-400"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:s.filename}),n.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[n.jsx("span",{className:"text-xs text-gray-500",children:pe[s.document_type]}),n.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(s.file_size/1024)," KB"]}),n.jsx("span",{className:"text-xs text-gray-500",children:ts(new Date(s.created_at),{addSuffix:!0})})]})]})]}),n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[C(s.processing_status),n.jsx(be,{className:D(s.processing_status),children:ve[s.processing_status]})]}),n.jsxs(Se,{children:[n.jsx(ke,{asChild:!0,children:n.jsx(oe,{variant:"ghost",size:"sm",children:n.jsx(j,{className:"h-4 w-4"})})}),n.jsxs(Ce,{align:"end",children:[n.jsxs(De,{onClick:()=>e?.(s),children:[n.jsx(o,{className:"mr-2 h-4 w-4"}),"View"]}),n.jsxs(De,{onClick:()=>window.open(s.file_url,"_blank"),children:[n.jsx(f,{className:"mr-2 h-4 w-4"}),"Download"]}),n.jsxs(De,{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this document?"))try{await Ne.deleteDocument(e),i(s=>s.filter(s=>s.id!==e)),ss.success("Document deleted successfully")}catch(s){ss.error("Failed to delete document")}})(s.id),className:"text-red-600",children:[n.jsx(y,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})},s.id))})]})]})},Cs=({document:e,className:s=""})=>{const[a,i]=t.useState(null),[l,d]=t.useState(""),[o,x]=t.useState(null),[h,u]=t.useState(!1),[g,j]=t.useState(0),[y,N]=t.useState("overview");t.useEffect(()=>{if(e.document_structure&&"object"==typeof e.document_structure){const s=e.document_structure.analysis;s&&i(s)}},[e]);const D=async()=>{if(e.ocr_text){u(!0),j(0);try{j(20);const s=await se(e.ocr_text);i(s),j(50);const t=await Ae(e.ocr_text,800);d(t),j(80);const a=await Fe(e.ocr_text);x(a),j(100),ss.success("Document analysis completed successfully")}catch(s){ss.error("Failed to analyze document: "+s.message)}finally{u(!1)}}else ss.error("No text content available for analysis")};return n.jsxs(ie,{className:s,children:[n.jsx(re,{children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs(ce,{className:"flex items-center space-x-2",children:[n.jsx(m,{className:"h-5 w-5 text-purple-600"}),n.jsx("span",{children:"AI Document Analysis"})]}),n.jsxs(le,{children:["AI-powered analysis of ",e.filename]})]}),n.jsxs("div",{className:"flex space-x-2",children:[(a||l||o)&&n.jsxs(oe,{variant:"outline",size:"sm",onClick:()=>{const s={document:{filename:e.filename,type:e.document_type,uploadDate:e.created_at},analysis:a,summary:l,entities:o,generatedAt:(new Date).toISOString()},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),i=e.createElement("a");i.href=n,i.download=`${e.filename}_analysis.json`,e.body.appendChild(i),i.click(),e.body.removeChild(i),URL.revokeObjectURL(n)},children:[n.jsx(f,{className:"h-4 w-4 mr-2"}),"Export"]}),n.jsx(oe,{onClick:D,disabled:h||!e.ocr_text,size:"sm",children:h?n.jsxs(n.Fragment,{children:[n.jsx(p,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):n.jsxs(n.Fragment,{children:[n.jsx(w,{className:"h-4 w-4 mr-2"}),a?"Re-analyze":"Analyze"]})})]})]})}),n.jsxs(de,{className:"space-y-4",children:[!e.ocr_text&&n.jsxs(fe,{children:[n.jsx(v,{className:"h-4 w-4"}),n.jsx(ye,{children:"No text content available. Please ensure the document has been processed with OCR."})]}),h&&n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{children:"Analyzing document..."}),n.jsxs("span",{children:[g,"%"]})]}),n.jsx(je,{value:g,className:"w-full"})]}),(a||l||o)&&n.jsxs(_e,{value:y,onValueChange:N,children:[n.jsxs(ze,{className:"grid w-full grid-cols-4",children:[n.jsx(Te,{value:"overview",children:"Overview"}),n.jsx(Te,{value:"summary",children:"Summary"}),n.jsx(Te,{value:"entities",children:"Entities"}),n.jsx(Te,{value:"insights",children:"Insights"})]}),n.jsxs(Ue,{value:"overview",className:"space-y-4",children:[a&&n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsx(ce,{className:"text-sm",children:"Document Classification"})}),n.jsx(de,{children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx(be,{variant:"secondary",children:a.documentType}),n.jsxs("div",{className:"text-sm "+(_=a.confidence,_>=.8?"text-green-600":_>=.6?"text-yellow-600":"text-red-600"),children:[(e=>e>=.8?"High":e>=.6?"Medium":"Low")(a.confidence)," confidence"]})]})})]}),n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsx(ce,{className:"text-sm",children:"Key Entities"})}),n.jsx(de,{children:n.jsx("div",{className:"text-sm text-gray-600",children:a.keyEntities.length>0?n.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.keyEntities.slice(0,3).map((e,s)=>n.jsx(be,{variant:"outline",className:"text-xs",children:e},s)),a.keyEntities.length>3&&n.jsxs(be,{variant:"outline",className:"text-xs",children:["+",a.keyEntities.length-3," more"]})]}):"No key entities identified"})})]})]}),a&&n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsx(ce,{className:"text-sm",children:"Executive Summary"})}),n.jsx(de,{children:n.jsx("p",{className:"text-sm text-gray-700",children:a.summary})})]})]}),n.jsx(Ue,{value:"summary",className:"space-y-4",children:l?n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsx(ce,{className:"text-sm",children:"Document Summary"})}),n.jsx(de,{children:n.jsx("div",{className:"prose prose-sm max-w-none",children:n.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:l})})})]}):n.jsxs("div",{className:"text-center text-gray-500 py-8",children:[n.jsx(r,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),n.jsx("p",{children:'No summary available. Click "Analyze" to generate one.'})]})}),n.jsx(Ue,{value:"entities",className:"space-y-4",children:o?n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsxs(ce,{className:"text-sm flex items-center space-x-2",children:[n.jsx(b,{className:"h-4 w-4"}),n.jsx("span",{children:"People"})]})}),n.jsx(de,{children:o.people.length>0?n.jsx("div",{className:"space-y-1",children:o.people.map((e,s)=>n.jsx(be,{variant:"outline",className:"text-xs",children:e},s))}):n.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsxs(ce,{className:"text-sm flex items-center space-x-2",children:[n.jsx(r,{className:"h-4 w-4"}),n.jsx("span",{children:"Organizations"})]})}),n.jsx(de,{children:o.organizations.length>0?n.jsx("div",{className:"space-y-1",children:o.organizations.map((e,s)=>n.jsx(be,{variant:"outline",className:"text-xs",children:e},s))}):n.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsxs(ce,{className:"text-sm flex items-center space-x-2",children:[n.jsx(S,{className:"h-4 w-4"}),n.jsx("span",{children:"Dates"})]})}),n.jsx(de,{children:o.dates.length>0?n.jsx("div",{className:"space-y-1",children:o.dates.map((e,s)=>n.jsx(be,{variant:"outline",className:"text-xs",children:e},s))}):n.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsxs(ce,{className:"text-sm flex items-center space-x-2",children:[n.jsx(k,{className:"h-4 w-4"}),n.jsx("span",{children:"Amounts"})]})}),n.jsx(de,{children:o.amounts.length>0?n.jsx("div",{className:"space-y-1",children:o.amounts.map((e,s)=>n.jsx(be,{variant:"outline",className:"text-xs",children:e},s))}):n.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsxs(ce,{className:"text-sm flex items-center space-x-2",children:[n.jsx(C,{className:"h-4 w-4"}),n.jsx("span",{children:"Locations"})]})}),n.jsx(de,{children:o.locations.length>0?n.jsx("div",{className:"space-y-1",children:o.locations.map((e,s)=>n.jsx(be,{variant:"outline",className:"text-xs",children:e},s))}):n.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]})]}):n.jsxs("div",{className:"text-center text-gray-500 py-8",children:[n.jsx(b,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),n.jsx("p",{children:'No entities extracted. Click "Analyze" to extract entities.'})]})}),n.jsx(Ue,{value:"insights",className:"space-y-4",children:a&&n.jsxs(n.Fragment,{children:[n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsx(ce,{className:"text-sm",children:"Legal Implications"})}),n.jsx(de,{children:a.legalImplications.length>0?n.jsx("ul",{className:"space-y-2",children:a.legalImplications.map((e,s)=>n.jsxs("li",{className:"flex items-start space-x-2",children:[n.jsx(v,{className:"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"}),n.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))}):n.jsx("p",{className:"text-sm text-gray-500",children:"No legal implications identified"})})]}),n.jsxs(ie,{children:[n.jsx(re,{className:"pb-3",children:n.jsx(ce,{className:"text-sm",children:"Recommended Actions"})}),n.jsx(de,{children:a.recommendedActions.length>0?n.jsx("ul",{className:"space-y-2",children:a.recommendedActions.map((e,s)=>n.jsxs("li",{className:"flex items-start space-x-2",children:[n.jsx(c,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),n.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))}):n.jsx("p",{className:"text-sm text-gray-500",children:"No specific actions recommended"})})]})]})})]}),!a&&!l&&!o&&!h&&e.ocr_text&&n.jsxs("div",{className:"text-center text-gray-500 py-8",children:[n.jsx(m,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),n.jsx("p",{className:"mb-4",children:"Ready to analyze this document with AI"}),n.jsxs(oe,{onClick:D,children:[n.jsx(m,{className:"h-4 w-4 mr-2"}),"Start Analysis"]})]})]})]});var _},Ds=[{name:"Yellow",value:"#FFEB3B",bg:"rgba(255, 235, 59, 0.3)"},{name:"Green",value:"#4CAF50",bg:"rgba(76, 175, 80, 0.3)"},{name:"Blue",value:"#2196F3",bg:"rgba(33, 150, 243, 0.3)"},{name:"Red",value:"#F44336",bg:"rgba(244, 67, 54, 0.3)"},{name:"Purple",value:"#9C27B0",bg:"rgba(156, 39, 176, 0.3)"},{name:"Orange",value:"#FF9800",bg:"rgba(255, 152, 0, 0.3)"}],_s=({documentUrl:e,documentId:s,className:a="",onAnnotationChange:i})=>{const[r,c]=t.useState(100),[l,d]=t.useState(0),[m,x]=t.useState(!1),[h,u]=t.useState("select"),[p,g]=t.useState(Ds[0]),[j,f]=t.useState(!0),[N,w]=t.useState(!1),[v,b]=t.useState(null),[S,k]=t.useState(null),[C,R]=t.useState(null),[M,$]=t.useState(""),q=t.useRef(null),L=t.useRef(null),{annotations:B,isLoading:V,createAnnotation:Q,updateAnnotation:K,deleteAnnotation:W}=ns(s),{user:H}=ae();t.useEffect(()=>{i?.(B)},[B,i]);const G=t.useCallback(e=>{if("select"===h)return;const s=q.current?.getBoundingClientRect();if(!s)return;const t=e.clientX-s.left,a=e.clientY-s.top;"highlight"===h?(w(!0),b({x:t,y:a}),k({x:t,y:a,width:0,height:0})):"note"!==h&&"sticky"!==h||X(t,a)},[h]),Y=t.useCallback(e=>{if(!N||!v||"highlight"!==h)return;const s=q.current?.getBoundingClientRect();if(!s)return;const t=e.clientX-s.left,a=e.clientY-s.top;k({x:Math.min(v.x,t),y:Math.min(v.y,a),width:Math.abs(t-v.x),height:Math.abs(a-v.y)})},[N,v,h]),J=t.useCallback(()=>{N&&S&&"highlight"===h&&S.width>10&&S.height>10&&Z(S),w(!1),b(null),k(null)},[N,S,h]),X=async(e,s)=>{if(!H)return void ss.error("Please log in to create annotations");const t=await Q({type:h,page_number:1,position:{x:e,y:s},content:"",color:p.value});t&&(R(t.id),$(""))},Z=async e=>{H?await Q({type:"highlight",page_number:1,position:e,content:"Highlighted text",color:p.value}):ss.error("Please log in to create highlights")},ee=m?"fixed inset-0 z-50 bg-white":a;return n.jsxs(ie,{className:ee,children:[n.jsx("div",{className:"border-b p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs("div",{className:"flex items-center space-x-1 border rounded-md",children:[n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>{c(e=>Math.max(e-25,25))},children:n.jsx(D,{className:"h-4 w-4"})}),n.jsxs("span",{className:"px-2 text-sm font-medium",children:[r,"%"]}),n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>{c(e=>Math.min(e+25,300))},children:n.jsx(_,{className:"h-4 w-4"})})]}),n.jsx(Ee,{orientation:"vertical",className:"h-6"}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(oe,{variant:"select"===h?"default":"ghost",size:"sm",onClick:()=>u("select"),children:"Select"}),n.jsx(oe,{variant:"highlight"===h?"default":"ghost",size:"sm",onClick:()=>u("highlight"),children:n.jsx(z,{className:"h-4 w-4"})}),n.jsx(oe,{variant:"note"===h?"default":"ghost",size:"sm",onClick:()=>u("note"),children:n.jsx(T,{className:"h-4 w-4"})}),n.jsx(oe,{variant:"sticky"===h?"default":"ghost",size:"sm",onClick:()=>u("sticky"),children:n.jsx(U,{className:"h-4 w-4"})})]}),n.jsx(Ee,{orientation:"vertical",className:"h-6"}),n.jsxs(Ie,{children:[n.jsx(Pe,{asChild:!0,children:n.jsxs(oe,{variant:"ghost",size:"sm",children:[n.jsx(A,{className:"h-4 w-4 mr-2"}),n.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:p.value}})]})}),n.jsx(Oe,{className:"w-48",children:n.jsx("div",{className:"grid grid-cols-3 gap-2",children:Ds.map(e=>n.jsx(oe,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",style:{backgroundColor:e.value},onClick:()=>g(e)},e.value))})})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>f(!j),children:j?n.jsx(o,{className:"h-4 w-4"}):n.jsx(F,{className:"h-4 w-4"})}),n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>{d(e=>(e+90)%360)},children:n.jsx(E,{className:"h-4 w-4"})}),n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>{x(e=>!e)},children:m?n.jsx(I,{className:"h-4 w-4"}):n.jsx(P,{className:"h-4 w-4"})}),n.jsx(Re,{documentId:s,showUserPresence:!0,className:"ml-auto"})]})]})}),n.jsx(de,{className:"p-0 relative",children:n.jsx("div",{ref:q,className:"relative overflow-auto",style:{height:m?"calc(100vh - 120px)":"600px"},onMouseDown:G,onMouseMove:Y,onMouseUp:J,children:n.jsxs("div",{className:"relative",style:{transform:`scale(${r/100}) rotate(${l}deg)`,transformOrigin:"top left",cursor:"select"===h?"default":"crosshair"},children:[n.jsx("iframe",{ref:L,src:`${e}#toolbar=0&navpanes=0&scrollbar=0`,className:"w-full h-[800px] border-0",title:"PDF Document"}),j&&n.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[B.map(e=>n.jsx("div",{className:"absolute pointer-events-auto",style:{left:e.position.x,top:e.position.y,width:e.position.width,height:e.position.height,backgroundColor:"highlight"===e.type?Ds.find(s=>s.value===e.color)?.bg:"transparent"},children:"highlight"!==e.type&&n.jsxs(Ie,{children:[n.jsx(Pe,{asChild:!0,children:n.jsx(oe,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-full",style:{backgroundColor:e.color},children:"note"===e.type?n.jsx(T,{className:"h-3 w-3"}):n.jsx(U,{className:"h-3 w-3"})})}),n.jsx(Oe,{className:"w-80",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(Me,{className:"h-6 w-6",children:[n.jsx($e,{src:e.user?.avatar_url}),n.jsxs(qe,{className:"text-xs",children:[e.user?.first_name?.[0],e.user?.last_name?.[0]]})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("span",{className:"text-sm font-medium",children:[e.user?.first_name," ",e.user?.last_name]}),n.jsx("span",{className:"text-xs text-gray-500",children:ts(new Date(e.created_at),{addSuffix:!0})})]})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(be,{variant:"outline",className:"text-xs",children:e.type}),n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>(async e=>{await W(e)})(e.id),children:n.jsx(y,{className:"h-4 w-4"})})]})]}),C===e.id?n.jsxs("div",{className:"space-y-2",children:[n.jsx(Le,{value:M,onChange:e=>$(e.target.value),placeholder:"Enter annotation content...",className:"min-h-[80px]"}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsxs(oe,{size:"sm",onClick:()=>(async(e,s)=>{await K(e,{content:s})&&(R(null),$(""))})(e.id,M),children:[n.jsx(O,{className:"h-4 w-4 mr-1"}),"Save"]}),n.jsx(oe,{variant:"outline",size:"sm",onClick:()=>R(null),children:"Cancel"})]})]}):n.jsxs("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-sm",children:e.content||"No content"}),n.jsx(oe,{variant:"outline",size:"sm",onClick:()=>{R(e.id),$(e.content)},children:"Edit"})]})]})})]})},e.id)),S&&N&&n.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-200 bg-opacity-30 pointer-events-none",style:{left:S.x,top:S.y,width:S.width,height:S.height}})]})]})})})]})},zs=({documentId:e,onClose:s,className:a=""})=>{const[i,c]=t.useState(null),[x,h]=t.useState(!0),[u,g]=t.useState(null),[j,y]=t.useState(!1),[N,w]=t.useState("viewer");t.useEffect(()=>{v()},[e]);const v=async()=>{try{h(!0),g(null);const s=await Ne.getDocument(e);c(s)}catch(s){g(s.message||"Failed to load document"),ss.error("Failed to load document")}finally{h(!1)}},b=()=>{i&&window.open(i.file_url,"_blank")};if(x)return n.jsx(ie,{className:a,children:n.jsx(de,{className:"flex items-center justify-center py-8",children:n.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[n.jsx(p,{className:"h-8 w-8 animate-spin"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Loading document..."})]})})});if(u||!i)return n.jsx(ie,{className:a,children:n.jsx(de,{className:"flex items-center justify-center py-8",children:n.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[n.jsx(l,{className:"h-8 w-8 text-red-500"}),n.jsx("p",{className:"text-sm text-red-600",children:u||"Document not found"}),n.jsx(oe,{onClick:v,variant:"outline",size:"sm",children:"Try Again"})]})})});const S=j?"fixed inset-0 z-50 bg-white":`${a}`;return n.jsxs(ie,{className:S,children:[n.jsx(re,{className:"pb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx(ce,{className:"text-lg font-semibold truncate",children:i.filename}),n.jsxs(le,{className:"flex items-center space-x-4 mt-1",children:[n.jsx("span",{children:pe[i.document_type]}),n.jsxs("span",{children:[Math.round(i.file_size/1024)," KB"]}),n.jsx("span",{children:ts(new Date(i.created_at),{addSuffix:!0})})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e){case"processing":return n.jsx(p,{className:"h-4 w-4 animate-spin"});case"failed":return n.jsx(l,{className:"h-4 w-4"});default:return n.jsx(r,{className:"h-4 w-4"})}})(i.processing_status),n.jsx(be,{className:(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(i.processing_status),children:ve[i.processing_status]})]}),s&&n.jsx(oe,{onClick:s,variant:"ghost",size:"sm",children:n.jsx(d,{className:"h-4 w-4"})})]})]})}),n.jsx(Ee,{}),n.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(oe,{onClick:()=>{setZoom(e=>Math.max(e-25,50))},variant:"outline",size:"sm",children:n.jsx(ZoomOut,{className:"h-4 w-4"})}),n.jsxs("span",{className:"text-sm font-medium min-w-[60px] text-center",children:[zoom,"%"]}),n.jsx(oe,{onClick:()=>{setZoom(e=>Math.min(e+25,200))},variant:"outline",size:"sm",children:n.jsx(ZoomIn,{className:"h-4 w-4"})}),n.jsx(oe,{onClick:()=>{setRotation(e=>(e+90)%360)},variant:"outline",size:"sm",children:n.jsx(RotateCw,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(oe,{onClick:b,variant:"outline",size:"sm",children:[n.jsx(f,{className:"h-4 w-4 mr-2"}),"Download"]}),n.jsxs(oe,{onClick:async()=>{if(i)try{await navigator.share({title:i.filename,url:i.file_url})}catch(e){await navigator.clipboard.writeText(i.file_url),ss.success("Document URL copied to clipboard")}},variant:"outline",size:"sm",children:[n.jsx(R,{className:"h-4 w-4 mr-2"}),"Share"]}),n.jsx(oe,{onClick:()=>{y(!j)},variant:"outline",size:"sm",children:n.jsx(P,{className:"h-4 w-4"})})]})]}),n.jsx(de,{className:"p-0 flex-1",children:n.jsxs(_e,{value:N,onValueChange:w,children:[n.jsx("div",{className:"border-b px-4",children:n.jsxs(ze,{className:"grid w-full grid-cols-3",children:[n.jsxs(Te,{value:"viewer",className:"flex items-center space-x-2",children:[n.jsx(o,{className:"h-4 w-4"}),n.jsx("span",{children:"Document"})]}),n.jsxs(Te,{value:"text",className:"flex items-center space-x-2",children:[n.jsx(r,{className:"h-4 w-4"}),n.jsx("span",{children:"Text"})]}),n.jsxs(Te,{value:"analysis",className:"flex items-center space-x-2",children:[n.jsx(m,{className:"h-4 w-4"}),n.jsx("span",{children:"AI Analysis"})]})]})}),n.jsx(Ue,{value:"viewer",className:"mt-0",children:n.jsx("div",{className:"p-4",children:i.file_url.toLowerCase().endsWith(".pdf")?n.jsx(_s,{documentUrl:i.file_url,documentId:i.id,className:"w-full",onAnnotationChange:e=>{}}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(r,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Preview not available"}),n.jsx("p",{className:"text-gray-500 mb-4",children:"This file type cannot be previewed in the browser."}),n.jsxs(oe,{onClick:b,children:[n.jsx(f,{className:"mr-2 h-4 w-4"}),"Download to view"]})]})})}),n.jsx(Ue,{value:"text",className:"mt-0",children:n.jsx(Be,{className:j?"h-[calc(100vh-250px)]":"h-[550px]",children:n.jsx("div",{className:"p-4",children:i.ocr_text?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Extracted Text"}),i.ocr_quality_score&&n.jsxs(be,{variant:"outline",children:["Quality: ",Math.round(100*i.ocr_quality_score),"%"]})]}),n.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:n.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:i.ocr_text})})]}):n.jsxs("div",{className:"text-center py-8",children:[n.jsx(r,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No text extracted"}),n.jsx("p",{className:"text-gray-500",children:"Text extraction may still be in progress or the document may not contain readable text."})]})})})}),n.jsx(Ue,{value:"analysis",className:"mt-0",children:n.jsx(Be,{className:j?"h-[calc(100vh-250px)]":"h-[550px]",children:n.jsx("div",{className:"p-4",children:n.jsx(Cs,{document:i})})})})]})})]})},Ts=is({query:rs().optional(),searchType:cs(["combined","semantic","text"]).default("combined"),documentType:rs().optional(),status:rs().optional(),dateFrom:rs().optional(),dateTo:rs().optional(),minSize:ls().optional(),maxSize:ls().optional(),hasOcr:ds().optional()}),Us=({onResults:e,onLoading:s,className:a=""})=>{const[i,r]=t.useState(!1),[c,l]=t.useState(!1),[o,m]=t.useState([]),[x,h]=t.useState([]),{user:u}=ae(),{register:j,handleSubmit:f,watch:y,setValue:N,reset:w,formState:{errors:v}}=M({resolver:os(Ts),defaultValues:{hasOcr:!1}}),b=y("query"),S=t.useCallback(as.debounce(async t=>{if(t.query?.trim()||k(t))await C(t);else try{l(!0),s?.(!0);const t=await Ne.getDocuments();e(t)}catch(a){ss.error("Failed to load documents")}finally{l(!1),s?.(!1)}},500),[e,s]);t.useEffect(()=>{const e=y(e=>{S(e)});return()=>e.unsubscribe()},[y,S]);const k=e=>!!(e.documentType||e.status||e.dateFrom||e.dateTo||e.minSize||e.maxSize||e.hasOcr),C=async t=>{if(u)try{l(!0),s?.(!0);let a=[];if(t.query?.trim()){const e=[t.query,...x.filter(e=>e!==t.query)].slice(0,5);h(e),localStorage.setItem("documentSearchHistory",JSON.stringify(e));switch(t.searchType||"combined"){case"semantic":a=(await hs({query:t.query,userId:u.id,maxResults:20})).map(e=>e.document).filter(Boolean);break;case"text":a=await xs({query:t.query,userId:u.id,documentType:t.documentType,dateRange:t.dateFrom&&t.dateTo?{start:new Date(t.dateFrom),end:new Date(t.dateTo)}:void 0});break;default:a=(await ms(t.query,u.id,{documentType:t.documentType,dateRange:t.dateFrom&&t.dateTo?{start:new Date(t.dateFrom),end:new Date(t.dateTo)}:void 0,maxResults:20})).textResults}}else a=await Ne.getDocuments();a=D(a,t),e(a),_(t)}catch(a){ss.error("Search failed. Please try again.")}finally{l(!1),s?.(!1)}else ss.error("Please log in to search documents")},D=(e,s)=>e.filter(e=>{if(s.documentType&&e.document_type!==s.documentType)return!1;if(s.status&&e.processing_status!==s.status)return!1;if(s.dateFrom){if(new Date(e.created_at)<new Date(s.dateFrom))return!1}if(s.dateTo){const t=new Date(e.created_at),a=new Date(s.dateTo);if(a.setHours(23,59,59,999),t>a)return!1}const t=e.file_size/1024;return!(s.minSize&&t<s.minSize)&&(!(s.maxSize&&t>s.maxSize)&&!(s.hasOcr&&!e.ocr_text))}),_=e=>{const s=[];e.documentType&&s.push(`Type: ${pe[e.documentType]}`),e.status&&s.push(`Status: ${ve[e.status]}`),e.dateFrom&&s.push(`From: ${new Date(e.dateFrom).toLocaleDateString()}`),e.dateTo&&s.push(`To: ${new Date(e.dateTo).toLocaleDateString()}`),e.minSize&&s.push(`Min: ${e.minSize}KB`),e.maxSize&&s.push(`Max: ${e.maxSize}KB`),e.hasOcr&&s.push("Has OCR text"),m(s)},z=()=>{w(),m([]),r(!1)};return t.useEffect(()=>{const e=localStorage.getItem("documentSearchHistory");if(e)try{h(JSON.parse(e))}catch(s){}},[]),n.jsxs(ie,{className:a,children:[n.jsx(re,{className:"pb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(ce,{className:"text-lg",children:"Search Documents"}),n.jsx(le,{children:"Find documents by name, content, or metadata"})]}),n.jsxs(oe,{variant:"outline",size:"sm",onClick:()=>r(!i),children:[n.jsx($,{className:"h-4 w-4 mr-2"}),"Filters"]})]})}),n.jsxs(de,{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"relative",children:[n.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(we,{...j("query"),placeholder:"Search by filename or content...",className:"pl-10 pr-10"}),c&&n.jsx(p,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ve,{className:"text-xs text-gray-500",children:"Search type:"}),n.jsxs(me,{onValueChange:e=>N("searchType",e),children:[n.jsx(xe,{className:"w-32 h-8",children:n.jsx(he,{placeholder:"Combined"})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"combined",children:"Combined"}),n.jsx(ge,{value:"semantic",children:"AI Semantic"}),n.jsx(ge,{value:"text",children:"Text Only"})]})]})]})]}),x.length>0&&!b&&n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("span",{className:"text-xs text-gray-500",children:"Recent:"}),x.map((e,s)=>n.jsx(oe,{variant:"outline",size:"sm",className:"h-6 text-xs",onClick:()=>N("query",e),children:e},s))]}),o.length>0&&n.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[n.jsx("span",{className:"text-xs text-gray-500",children:"Active filters:"}),o.map((e,s)=>n.jsxs(be,{variant:"secondary",className:"text-xs",children:[e,n.jsx(oe,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1",onClick:()=>{z()},children:n.jsx(d,{className:"h-3 w-3"})})]},s)),n.jsx(oe,{variant:"ghost",size:"sm",className:"text-xs",onClick:z,children:"Clear all"})]}),i&&n.jsxs(n.Fragment,{children:[n.jsx(Ee,{}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(Ve,{htmlFor:"documentType",children:"Document Type"}),n.jsxs(me,{onValueChange:e=>N("documentType",e),children:[n.jsx(xe,{children:n.jsx(he,{placeholder:"Any type"})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"",children:"Any type"}),Object.entries(pe).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Ve,{htmlFor:"status",children:"Processing Status"}),n.jsxs(me,{onValueChange:e=>N("status",e),children:[n.jsx(xe,{children:n.jsx(he,{placeholder:"Any status"})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"",children:"Any status"}),Object.entries(ve).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Ve,{htmlFor:"dateFrom",children:"Date From"}),n.jsx(we,{...j("dateFrom"),type:"date",className:"w-full"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Ve,{htmlFor:"dateTo",children:"Date To"}),n.jsx(we,{...j("dateTo"),type:"date",className:"w-full"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Ve,{children:"File Size (KB)"}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsx(we,{...j("minSize",{valueAsNumber:!0}),type:"number",placeholder:"Min",className:"w-full"}),n.jsx(we,{...j("maxSize",{valueAsNumber:!0}),type:"number",placeholder:"Max",className:"w-full"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Ve,{children:"Content Options"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Qe,{...j("hasOcr"),onCheckedChange:e=>N("hasOcr",!!e)}),n.jsx(Ve,{className:"text-sm",children:"Has extracted text"})]})]})]})]})]})]})},As=({onDocumentSelect:e,refreshTrigger:s,className:a=""})=>{const[i,d]=t.useState([]),[m,x]=t.useState({total:0,pending:0,processing:0,completed:0,failed:0}),[h,u]=t.useState(!0),[g,j]=t.useState(!0);t.useEffect(()=>{f()},[s]),t.useEffect(()=>{let e;return g&&(e=setInterval(()=>{(m.processing>0||m.pending>0)&&f()},3e4)),()=>{e&&clearInterval(e)}},[g,m.processing,m.pending]);const f=async()=>{try{u(!0);const{data:{user:e},error:s}=await es.auth.getUser();if(s)throw new Error("Authentication failed");if(!e)throw new Error("User not authenticated");const t=(await Ne.getDocuments()).sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime());d(t),y(t)}catch(e){ss.error(`Failed to load document status: ${e.message}`)}finally{u(!1)}},y=e=>{const s=e.reduce((e,s)=>{switch(e.total++,s.processing_status){case"pending":e.pending++;break;case"processing":e.processing++;break;case"completed":e.completed++;break;case"failed":e.failed++}return e},{total:0,pending:0,processing:0,completed:0,failed:0});x(s)},v=e=>{switch(e){case"pending":return n.jsx(N,{className:"h-4 w-4 text-yellow-500"});case"processing":return n.jsx(p,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return n.jsx(c,{className:"h-4 w-4 text-green-500"});case"failed":return n.jsx(l,{className:"h-4 w-4 text-red-500"});default:return n.jsx(r,{className:"h-4 w-4 text-gray-500"})}},b=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},S=()=>i.filter(e=>"pending"===e.processing_status||"processing"===e.processing_status).slice(0,5),k=()=>i.filter(e=>"completed"===e.processing_status).slice(0,3),C=()=>i.filter(e=>"failed"===e.processing_status);return h&&0===i.length?n.jsx(ie,{className:a,children:n.jsx(de,{className:"flex items-center justify-center py-8",children:n.jsx(p,{className:"h-8 w-8 animate-spin"})})}):n.jsxs(ie,{className:a,children:[n.jsx(re,{className:"pb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(ce,{className:"text-lg",children:"Processing Status"}),n.jsx(le,{children:"Real-time document processing status and progress"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(oe,{variant:"outline",size:"sm",onClick:()=>j(!g),className:g?"bg-green-50":"",children:[n.jsx(w,{className:"h-4 w-4 mr-2 "+(g?"animate-spin":"")}),"Auto-refresh"]}),n.jsx(oe,{onClick:f,variant:"outline",size:"sm",children:n.jsx(w,{className:"h-4 w-4"})})]})]})}),n.jsxs(de,{className:"space-y-6",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h4",{className:"text-sm font-medium",children:"Overall Progress"}),n.jsxs("span",{className:"text-sm text-gray-500",children:[m.completed," of ",m.total," completed"]})]}),n.jsx(je,{value:0===m.total?0:Math.round(m.completed/m.total*100),className:"w-full"}),n.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:m.pending}),n.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m.processing}),n.jsx("div",{className:"text-xs text-gray-500",children:"Processing"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-2xl font-bold text-green-600",children:m.completed}),n.jsx("div",{className:"text-xs text-gray-500",children:"Completed"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"text-2xl font-bold text-red-600",children:m.failed}),n.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]})]})]}),S().length>0&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[n.jsx(q,{className:"h-4 w-4 mr-2"}),"Currently Processing"]}),n.jsx("div",{className:"space-y-2",children:S().map(s=>n.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[v(s.processing_status),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),n.jsx("p",{className:"text-xs text-gray-500",children:ts(new Date(s.created_at),{addSuffix:!0})})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(be,{className:b(s.processing_status),children:ve[s.processing_status]}),e&&n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>e(s),children:n.jsx(o,{className:"h-4 w-4"})})]})]},s.id))})]}),k().length>0&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[n.jsx(c,{className:"h-4 w-4 mr-2 text-green-500"}),"Recently Completed"]}),n.jsx("div",{className:"space-y-2",children:k().map(s=>n.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-green-50",children:[n.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[n.jsx(c,{className:"h-4 w-4 text-green-500"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Completed ",ts(new Date(s.updated_at),{addSuffix:!0})]})]})]}),e&&n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>e(s),children:n.jsx(o,{className:"h-4 w-4"})})]},s.id))})]}),C().length>0&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("h4",{className:"text-sm font-medium flex items-center text-red-600",children:[n.jsx(l,{className:"h-4 w-4 mr-2"}),"Failed Processing (",C().length,")"]}),n.jsx("div",{className:"space-y-2",children:C().slice(0,3).map(s=>n.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-red-50",children:[n.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[n.jsx(l,{className:"h-4 w-4 text-red-500"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),n.jsx("p",{className:"text-xs text-red-600",children:"Processing failed"})]})]}),e&&n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>e(s),children:n.jsx(o,{className:"h-4 w-4"})})]},s.id))})]}),0===m.total&&n.jsxs("div",{className:"text-center py-8",children:[n.jsx(r,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents yet"}),n.jsx("p",{className:"text-gray-500",children:"Upload your first document to start tracking processing status"})]})]})]})};const Fs=new class{constructor(){s(this,"retryAttempts",3),s(this,"retryDelay",1e3)}async processDocument(e,s,t={},a){const n=Date.now();try{let i,r;a?.({stage:"initializing",progress:0,message:"Initializing document processing..."}),await this.checkUsageLimits(),await this.updateDocumentStatus(s,"processing");let c=[];t.skipOCR||(i=await this.performOCR(e,a)),!t.skipAnalysis&&i&&(r=await this.performAnalysis(i.text,s,t.customAnalysisPrompt,a)),!t.skipEmbedding&&i&&(c=await this.generateEmbeddings(i.text,s,t.chunkSize,a)),a?.({stage:"finalizing",progress:95,message:"Finalizing document processing..."});const l=await this.finalizeProcessing(s,i,r,c),d=Date.now()-n;return a?.({stage:"completed",progress:100,message:"Document processing completed successfully!",details:{processingTime:d,ocrQuality:i?.qualityScore||0,textLength:i?.text.length||0,embeddingChunks:c.length}}),{document:l,ocrResult:i,analysis:r,embeddingIds:c,processingTime:d,qualityMetrics:{ocrQuality:i?.qualityScore||0,textLength:i?.text.length||0,embeddingChunks:c.length}}}catch(i){const e=Date.now()-n;throw await this.updateDocumentStatus(s,"failed"),a?.({stage:"error",progress:0,message:"Document processing failed",error:i instanceof Error?i.message:"Unknown error",details:{processingTime:e}}),i}}async checkUsageLimits(){const e=await Ke.checkUsageLimit("ai_query");if(!e.allowed)throw new Error(`AI processing limit exceeded. You have used ${e.current}/${e.limit} AI queries this month. Please upgrade your plan to continue.`)}async performOCR(e,s){return s?.({stage:"ocr",progress:10,message:"Extracting text from document..."}),await this.withRetry(async()=>{const t=await us(e,e=>{s?.({stage:"ocr",progress:10+.3*e.progress,message:e.message||"Extracting text..."})}),a=ps(t),n=gs(t.text);return{...t,text:n,qualityScore:a.qualityScore}},"OCR processing")}async performAnalysis(e,s,t,a){return a?.({stage:"analysis",progress:40,message:"Analyzing document content with AI..."}),await this.withRetry(async()=>{const a=await se(e);return await Ke.incrementUsage("ai_query",s,{operation:"document_analysis",text_length:e.length,custom_prompt:!!t}),a},"AI analysis")}async generateEmbeddings(e,s,t=1e3,a){return a?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),await this.withRetry(async()=>{const n=this.splitTextIntoChunks(e,t),i=[];for(let e=0;e<n.length;e++){const t=n[e],r=await te(t),{data:c,error:l}=await es.from("document_embeddings").insert({document_id:s,chunk_text:t,chunk_index:e,embedding:r,metadata:{chunk_size:t.length,total_chunks:n.length}}).select("id").single();if(l)throw l;i.push(c.id);const d=70+(e+1)/n.length*20;a?.({stage:"embedding",progress:d,message:`Generated embedding ${e+1}/${n.length}...`})}return i},"Embedding generation")}async finalizeProcessing(e,s,t,a){const{data:n,error:i}=await es.from("uploaded_documents").update({processing_status:"completed",ocr_text:s?.text,ocr_quality_score:s?.qualityScore,document_structure:{analysis:t,ocrQuality:s?.qualityScore,embeddingCount:a?.length||0,processedAt:(new Date).toISOString()},updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(i)throw i;return n}async updateDocumentStatus(e,s){const{error:t}=await es.from("uploaded_documents").update({processing_status:s,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}async withRetry(e,s){let t;for(let n=1;n<=this.retryAttempts;n++)try{return await e()}catch(a){if(t=a instanceof Error?a:new Error("Unknown error"),n===this.retryAttempts)throw new Error(`${s} failed after ${this.retryAttempts} attempts: ${t.message}`);await new Promise(e=>setTimeout(e,this.retryDelay*n))}throw t}splitTextIntoChunks(e,s=1e3){const t=[],a=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let n="";for(const i of a){const e=i.trim();n.length+e.length+1<=s?n+=(n?". ":"")+e:(n&&t.push(n+"."),n=e)}return n&&t.push(n+"."),t}};function Es(e){return L({queryKey:["usage-limit",e],queryFn:()=>Ke.checkUsageLimit(e),staleTime:6e4,refetchOnWindowFocus:!1})}const Is=({onUploadComplete:e,maxFiles:s=5,allowedTypes:h=["pdf","doc","docx","txt"]})=>{const{profile:u}=ae(),{uploadAndProcessDocument:p,uploadState:g,resetUploadState:j,isActive:f}=function(){const[e,s]=t.useState({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null}),a=B(),{toast:n}=We();return{uploadAndProcessDocument:t.useCallback(async(e,t,i={})=>{try{s({isUploading:!0,isProcessing:!1,progress:0,status:null,error:null});const r=await Ne.uploadDocument(e,t);s(e=>({...e,isUploading:!1,isProcessing:!0,progress:10}));const c=await Fs.processDocument(e,r.id,i,e=>{s(s=>({...s,progress:e.progress,status:e,error:e.error||null}))});return s(e=>({...e,isProcessing:!1,progress:100,error:null})),a.invalidateQueries({queryKey:["documents"]}),a.invalidateQueries({queryKey:["document",r.id]}),n({title:"Document Processed",description:`${e.name} has been successfully uploaded and processed.`}),c}catch(r){const e=r instanceof Error?r.message:"Upload failed";throw s(s=>({...s,isUploading:!1,isProcessing:!1,error:e})),n({title:"Upload Failed",description:e,variant:"destructive"}),r}},[a,n]),uploadState:e,resetUploadState:t.useCallback(()=>{s({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null})},[]),isActive:e.isUploading||e.isProcessing}}(),{canUploadDocuments:y,canUseAI:w,documentUsage:v}=function(){const{data:e}=Es("ai_query"),{data:s}=Es("document_upload"),{data:t}=Es("custom_document");return{canUseAI:e?.allowed??!1,canUploadDocuments:s?.allowed??!1,canDownloadCustomDocuments:t?.allowed??!1,aiUsage:e,documentUsage:s,customDocUsage:t,getUsagePercentage:e=>e&&-1!==e.limit&&e.limit>0?e.current/e.limit*100:0,isNearLimit:(e,s=80)=>!(!e||-1===e.limit)&&(e.limit>0?e.current/e.limit*100:0)>=s}}(),[b,S]=t.useState([]),[k,C]=t.useState(!1),[D,_]=t.useState({skipOCR:!1,skipAnalysis:!1,skipEmbedding:!1,chunkSize:1e3,retryAttempts:3}),z=t.useCallback(async e=>{if(!y)return void toast.warning("Upload not available. Please check your subscription or try again later.");const t=u?.subscription_tier?ne.maxSize[u.subscription_tier]:ne.maxSize.free,a=e.filter(e=>!(e.size>t)).map(e=>({file:e,id:crypto.randomUUID(),documentType:"other",options:{...D}}));S(e=>[...e,...a].slice(0,s))},[u,s,y,D]),{getRootProps:T,getInputProps:U,isDragActive:A}=a({onDrop:z,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:s,disabled:f||!y});return n.jsxs(ie,{className:"w-full",children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"flex items-center justify-between",children:[n.jsx("span",{children:"Enhanced Document Upload"}),n.jsxs(oe,{variant:"ghost",size:"sm",onClick:()=>C(!k),children:[n.jsx(Q,{className:"h-4 w-4 mr-2"}),"Advanced"]})]}),n.jsx(le,{children:"Upload and process your legal documents with AI-powered analysis"}),v&&n.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[n.jsxs("span",{children:["Usage: ",v.current,"/",-1===v.limit?"∞":v.limit," uploads"]}),v.limit>0&&n.jsx(je,{value:v.percentage,className:"w-24 h-2"})]})]}),n.jsxs(de,{className:"space-y-6",children:[k&&n.jsxs(ie,{children:[n.jsx(re,{children:n.jsx(ce,{className:"text-lg",children:"Processing Options"})}),n.jsxs(de,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(He,{id:"skip-ocr",checked:!D.skipOCR,onCheckedChange:e=>_(s=>({...s,skipOCR:!e}))}),n.jsx(Ve,{htmlFor:"skip-ocr",children:"Text Extraction"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(He,{id:"skip-analysis",checked:!D.skipAnalysis,onCheckedChange:e=>_(s=>({...s,skipAnalysis:!e})),disabled:!w}),n.jsx(Ve,{htmlFor:"skip-analysis",children:"AI Analysis"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(He,{id:"skip-embedding",checked:!D.skipEmbedding,onCheckedChange:e=>_(s=>({...s,skipEmbedding:!e})),disabled:!w}),n.jsx(Ve,{htmlFor:"skip-embedding",children:"Search Indexing"})]})]}),void 0!==D.customAnalysisPrompt&&n.jsxs("div",{children:[n.jsx(Ve,{htmlFor:"custom-prompt",children:"Custom Analysis Prompt"}),n.jsx(Le,{id:"custom-prompt",placeholder:"Enter custom instructions for AI analysis...",value:D.customAnalysisPrompt||"",onChange:e=>_(s=>({...s,customAnalysisPrompt:e.target.value}))})]})]})]}),n.jsxs("div",{...T(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${A?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${f||!y?"opacity-50 cursor-not-allowed":""}`,children:[n.jsx("input",{...U()}),n.jsx(i,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),A?n.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):n.jsxs("div",{children:[n.jsx("p",{className:"text-gray-600 mb-2",children:y?"Drag & drop files here, or click to select":"Upload limit reached for your subscription tier"}),n.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((u?.subscription_tier?ne.maxSize[u.subscription_tier]:ne.maxSize.free)/1024/1024),"MB"]})]})]}),b.length>0&&n.jsxs("div",{className:"space-y-3",children:[n.jsx("h4",{className:"font-medium",children:"Files to Upload"}),b.map(e=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[n.jsx(r,{className:"h-5 w-5 text-gray-400"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:e.file.name}),n.jsxs("p",{className:"text-xs text-gray-500",children:[(e.file.size/1024/1024).toFixed(2)," MB"]})]}),n.jsxs(me,{value:e.documentType,onValueChange:s=>{return t=e.id,a=s,void S(e=>e.map(e=>e.id===t?{...e,documentType:a}:e));var t,a},children:[n.jsx(xe,{className:"w-32",children:n.jsx(he,{})}),n.jsx(ue,{children:Object.entries(pe).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))})]}),n.jsx(oe,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void S(e=>e.filter(e=>e.id!==s));var s},disabled:f,children:n.jsx(d,{className:"h-4 w-4"})})]},e.id))]}),f&&g.status&&n.jsx(ie,{children:n.jsx(de,{className:"pt-6",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:(e=>{switch(e){case"completed":return"text-green-600";case"error":return"text-red-600";case"analysis":return"text-blue-600";case"embedding":return"text-purple-600";default:return"text-gray-600"}})(g.status.stage),children:(e=>{switch(e){case"ocr":return n.jsx(o,{className:"h-4 w-4"});case"analysis":return n.jsx(m,{className:"h-4 w-4"});case"embedding":return n.jsx(x,{className:"h-4 w-4"});case"completed":return n.jsx(c,{className:"h-4 w-4"});case"error":return n.jsx(l,{className:"h-4 w-4"});default:return n.jsx(N,{className:"h-4 w-4"})}})(g.status.stage)}),n.jsx("span",{className:"font-medium capitalize",children:g.status.stage.replace("_"," ")})]}),n.jsxs(be,{variant:"outline",children:[Math.round(g.progress),"%"]})]}),n.jsx(je,{value:g.progress,className:"w-full"}),n.jsx("p",{className:"text-sm text-gray-600",children:g.status.message}),g.status.details&&n.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[g.status.details.ocrQuality&&n.jsxs("p",{children:["OCR Quality: ",Math.round(100*g.status.details.ocrQuality),"%"]}),g.status.details.textLength&&n.jsxs("p",{children:["Text Length: ",g.status.details.textLength.toLocaleString()," characters"]}),g.status.details.embeddingChunks&&n.jsxs("p",{children:["Embedding Chunks: ",g.status.details.embeddingChunks]})]}),g.error&&n.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:g.error})]})})}),b.length>0&&!f&&n.jsxs(oe,{onClick:async()=>{for(const t of b)try{const s=await p(t.file,t.documentType,t.options);e&&e(s.document.id)}catch(s){}S([]),j()},className:"w-full",disabled:!y,children:[n.jsx(i,{className:"h-4 w-4 mr-2"}),"Upload and Process ",b.length," File",b.length>1?"s":""]})]})]})},Ps=()=>{const[e,s]=t.useState("grid"),[a,d]=t.useState(new Set),[o,m]=t.useState("created_at"),[x,h]=t.useState("desc"),[p,j]=t.useState({status:"all",type:"all",dateRange:"all"}),[f,w]=t.useState(!1),{data:v=[],isLoading:b,error:S}=L({queryKey:["documents"],queryFn:()=>Ne.getDocuments(),staleTime:3e5}),{searchQuery:k,setSearchQuery:C,searchResults:D,isSearching:_}=function(){const[e,s]=t.useState(""),a=L({queryKey:["documents","search",e],queryFn:async()=>{if(!e||e.length<3)return[];try{return await Ne.searchDocuments(e)}catch(S){return[]}},enabled:e.length>2,staleTime:12e4});return{searchQuery:e,setSearchQuery:s,searchResults:a.data||[],isSearching:a.isLoading,searchError:a.error}}(),z=function(){const e=B(),{toast:s}=We();return V({mutationFn:e=>Ne.deleteDocument(e),onSuccess:(t,a)=>{e.removeQueries({queryKey:["document",a]}),e.invalidateQueries({queryKey:["documents"]}),s({title:"Document Deleted",description:"The document has been successfully deleted."})},onError:e=>{s({title:"Deletion Failed",description:e instanceof Error?e.message:"Failed to delete document",variant:"destructive"})}})}(),T=function(){const{toast:e}=We();return V({mutationFn:({documentId:e,trackUsage:s=!0})=>Ne.downloadDocument(e,s),onSuccess:s=>{const t=URL.createObjectURL(s.data),a=document.createElement("a");a.href=t,a.download=s.filename,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),e({title:"Download Started",description:`Downloading ${s.filename}...`})},onError:s=>{e({title:"Download Failed",description:s instanceof Error?s.message:"Failed to download document",variant:"destructive"})}})}(),{bulkDelete:U,isBulkDeleting:A}=function(){const e=B(),{toast:s}=We(),t=V({mutationFn:async e=>{const s=await Promise.allSettled(e.map(e=>Ne.deleteDocument(e))),t=s.filter(e=>"rejected"===e.status).length;return{succeeded:s.filter(e=>"fulfilled"===e.status).length,failed:t,total:e.length}},onSuccess:t=>{e.invalidateQueries({queryKey:["documents"]}),t.failed>0?s({title:"Bulk Delete Completed",description:`${t.succeeded} documents deleted, ${t.failed} failed.`,variant:"destructive"}):s({title:"Bulk Delete Completed",description:`Successfully deleted ${t.succeeded} documents.`})},onError:e=>{s({title:"Bulk Delete Failed",description:e instanceof Error?e.message:"Failed to delete documents",variant:"destructive"})}});return{bulkDelete:t,isBulkDeleting:t.isPending}}(),{data:F,error:E}=L({queryKey:["documents","stats"],queryFn:async()=>{try{const e=await Ne.getDocuments(),s=await Ne.getDocumentUsage();return{total:e.length,byStatus:e.reduce((e,s)=>(e[s.processing_status]=(e[s.processing_status]||0)+1,e),{}),byType:e.reduce((e,s)=>(e[s.document_type]=(e[s.document_type]||0)+1,e),{}),totalSize:e.reduce((e,s)=>e+s.file_size,0),usage:s}}catch(S){return{total:0,byStatus:{},byType:{},totalSize:0,usage:null}}},staleTime:6e5});u.useEffect(()=>{},[S,E]);const I=t.useMemo(()=>{try{let e=k.length>2?D:v;if(!Array.isArray(e))return[];if("all"!==p.status&&(e=e.filter(e=>e?.processing_status===p.status)),"all"!==p.type&&(e=e.filter(e=>e?.document_type===p.type)),"all"!==p.dateRange){const s=new Date,t=new Date;switch(p.dateRange){case"today":t.setHours(0,0,0,0);break;case"week":t.setDate(s.getDate()-7);break;case"month":t.setMonth(s.getMonth()-1)}e=e.filter(e=>e?.created_at&&new Date(e.created_at)>=t)}return e.sort((e,s)=>{if(!e||!s)return 0;let t=e[o],a=s[o];return"created_at"===o?(t=new Date(t).getTime(),a=new Date(a).getTime()):"file_size"===o?(t=Number(t)||0,a=Number(a)||0):(t=String(t||"").toLowerCase(),a=String(a||"").toLowerCase()),"asc"===x?t<a?-1:t>a?1:0:t>a?-1:t<a?1:0}),e}catch(e){return[]}},[v,D,k,p,o,x]),P=e=>{switch(e){case"completed":return n.jsx(c,{className:"h-4 w-4 text-green-500"});case"processing":return n.jsx(N,{className:"h-4 w-4 text-blue-500"});case"failed":return n.jsx(l,{className:"h-4 w-4 text-red-500"});default:return n.jsx(N,{className:"h-4 w-4 text-gray-500"})}},O=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return f?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold",children:"Upload Documents"}),n.jsx(oe,{variant:"outline",onClick:()=>w(!1),children:"Back to Dashboard"})]}),n.jsx(Is,{onUploadComplete:()=>w(!1)})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl font-bold",children:"Document Management"}),n.jsx("p",{className:"text-gray-600",children:"Manage and organize your legal documents"})]}),n.jsxs(oe,{onClick:()=>w(!0),children:[n.jsx(i,{className:"h-4 w-4 mr-2"}),"Upload Documents"]})]}),F&&n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx(ie,{children:n.jsx(de,{className:"p-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(r,{className:"h-5 w-5 text-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Total Documents"}),n.jsx("p",{className:"text-2xl font-bold",children:F.total})]})]})})}),n.jsx(ie,{children:n.jsx(de,{className:"p-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(c,{className:"h-5 w-5 text-green-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Processed"}),n.jsx("p",{className:"text-2xl font-bold",children:F.byStatus.completed||0})]})]})})}),n.jsx(ie,{children:n.jsx(de,{className:"p-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(N,{className:"h-5 w-5 text-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Processing"}),n.jsx("p",{className:"text-2xl font-bold",children:F.byStatus.processing||0})]})]})})}),n.jsx(ie,{children:n.jsx(de,{className:"p-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(K,{className:"h-5 w-5 text-purple-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Total Size"}),n.jsxs("p",{className:"text-2xl font-bold",children:[(F.totalSize/1024/1024).toFixed(1),"MB"]})]})]})})})]}),n.jsx(ie,{children:n.jsx(de,{className:"p-4",children:n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"relative",children:[n.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),n.jsx(we,{placeholder:"Search documents...",value:k,onChange:e=>C(e.target.value),className:"pl-10"})]})}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(me,{value:p.status,onValueChange:e=>j(s=>({...s,status:e})),children:[n.jsx(xe,{className:"w-32",children:n.jsx(he,{placeholder:"Status"})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"all",children:"All Status"}),Object.entries(ve).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))]})]}),n.jsxs(me,{value:p.type,onValueChange:e=>j(s=>({...s,type:e})),children:[n.jsx(xe,{className:"w-32",children:n.jsx(he,{placeholder:"Type"})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"all",children:"All Types"}),Object.entries(pe).map(([e,s])=>n.jsx(ge,{value:e,children:s},e))]})]}),n.jsxs(me,{value:o,onValueChange:e=>m(e),children:[n.jsx(xe,{className:"w-32",children:n.jsx(he,{placeholder:"Sort by"})}),n.jsxs(ue,{children:[n.jsx(ge,{value:"created_at",children:"Date"}),n.jsx(ge,{value:"filename",children:"Name"}),n.jsx(ge,{value:"file_size",children:"Size"}),n.jsx(ge,{value:"processing_status",children:"Status"})]})]}),n.jsx(oe,{variant:"outline",size:"sm",onClick:()=>h("asc"===x?"desc":"asc"),children:"asc"===x?"↑":"↓"})]}),n.jsxs("div",{className:"flex border rounded-md",children:[n.jsx(oe,{variant:"grid"===e?"default":"ghost",size:"sm",onClick:()=>s("grid"),children:n.jsx(W,{className:"h-4 w-4"})}),n.jsx(oe,{variant:"list"===e?"default":"ghost",size:"sm",onClick:()=>s("list"),children:n.jsx(H,{className:"h-4 w-4"})})]})]})})}),a.size>0&&n.jsx(ie,{children:n.jsx(de,{className:"p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("span",{className:"text-sm text-gray-600",children:[a.size," document",a.size>1?"s":""," selected"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(oe,{variant:"destructive",size:"sm",onClick:async()=>{0!==a.size&&(await U.mutateAsync(Array.from(a)),d(new Set))},disabled:A,children:[n.jsx(y,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),n.jsx(oe,{variant:"outline",size:"sm",onClick:()=>d(new Set),children:"Clear Selection"})]})]})})}),b?n.jsx("div",{className:"text-center py-8",children:n.jsx("p",{children:"Loading documents..."})}):S?n.jsx("div",{className:"text-center py-8 text-red-600",children:n.jsxs("p",{children:["Error loading documents: ",S.message]})}):0===I.length?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(r,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-600",children:k?"No documents found matching your search.":"No documents uploaded yet."}),!k&&n.jsx(oe,{className:"mt-4",onClick:()=>w(!0),children:"Upload Your First Document"})]}):n.jsxs("div",{className:"grid"===e?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-2",children:["list"===e&&n.jsxs("div",{className:"flex items-center space-x-3 p-3 border-b",children:[n.jsx(Qe,{checked:a.size===I.length,onCheckedChange:()=>{a.size===I.length?d(new Set):d(new Set(I.map(e=>e.id)))}}),n.jsx("span",{className:"text-sm font-medium",children:"Select All"})]}),I.map(s=>s&&s.id?n.jsx(Os,{document:s,viewMode:e,isSelected:a.has(s.id),onToggleSelection:()=>(e=>{const s=new Set(a);s.has(e)?s.delete(e):s.add(e),d(s)})(s.id),onDownload:()=>{return e=s.id,void T.mutate({documentId:e});var e},onDelete:()=>{return e=s.id,void z.mutate(e);var e},getStatusIcon:P,getStatusColor:O},s.id):null).filter(Boolean)]})]})},Os=({document:e,viewMode:s,isSelected:t,onToggleSelection:a,onDownload:i,onDelete:c,getStatusIcon:l,getStatusColor:d})=>{if(!e)return null;const o={id:e.id||"",filename:e.filename||"Unknown File",document_type:e.document_type||"other",file_size:e.file_size||0,created_at:e.created_at||(new Date).toISOString(),processing_status:e.processing_status||"pending"};return"list"===s?n.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50",children:[n.jsx(Qe,{checked:t,onCheckedChange:a}),n.jsx(r,{className:"h-5 w-5 text-gray-400"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"font-medium truncate",children:o.filename}),n.jsxs("p",{className:"text-sm text-gray-500",children:[pe[o.document_type]||"Unknown"," •",(o.file_size/1024/1024).toFixed(2)," MB •",ts(new Date(o.created_at),{addSuffix:!0})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(be,{className:d(o.processing_status),children:[l(o.processing_status),n.jsx("span",{className:"ml-1",children:ve[o.processing_status]||"Unknown"})]}),n.jsxs(Se,{children:[n.jsx(ke,{asChild:!0,children:n.jsx(oe,{variant:"ghost",size:"sm",children:n.jsx(G,{className:"h-4 w-4"})})}),n.jsxs(Ce,{children:[n.jsxs(De,{onClick:i,children:[n.jsx(f,{className:"h-4 w-4 mr-2"}),"Download"]}),n.jsx(Ge,{}),n.jsxs(De,{onClick:c,className:"text-red-600",children:[n.jsx(y,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}):n.jsx(ie,{className:"cursor-pointer transition-colors "+(t?"ring-2 ring-blue-500":""),children:n.jsxs(de,{className:"p-4",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsx(Qe,{checked:t,onCheckedChange:a}),n.jsxs(Se,{children:[n.jsx(ke,{asChild:!0,children:n.jsx(oe,{variant:"ghost",size:"sm",children:n.jsx(G,{className:"h-4 w-4"})})}),n.jsxs(Ce,{children:[n.jsxs(De,{onClick:i,children:[n.jsx(f,{className:"h-4 w-4 mr-2"}),"Download"]}),n.jsx(Ge,{}),n.jsxs(De,{onClick:c,className:"text-red-600",children:[n.jsx(y,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),n.jsxs("div",{className:"text-center mb-4",children:[n.jsx(r,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),n.jsx("h3",{className:"font-medium truncate",title:o.filename,children:o.filename})]}),n.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Type:"}),n.jsx("span",{children:pe[o.document_type]||"Unknown"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Size:"}),n.jsxs("span",{children:[(o.file_size/1024/1024).toFixed(2)," MB"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Uploaded:"}),n.jsx("span",{children:ts(new Date(o.created_at),{addSuffix:!0})})]})]}),n.jsx("div",{className:"mt-3",children:n.jsxs(be,{className:`w-full justify-center ${d(o.processing_status)}`,children:[l(o.processing_status),n.jsx("span",{className:"ml-1",children:ve[o.processing_status]||"Unknown"})]})})]})})},Rs=()=>{const[e,s]=t.useState([]),[a,i]=t.useState(!1),r=async()=>{i(!0);const e=[];try{const{data:s,error:t}=await es.from("profiles").select("count").limit(1);e.push({name:"Supabase Connection",status:t?"error":"success",message:t?t.message:"Connected successfully",details:{data:s,error:t}})}catch(n){e.push({name:"Supabase Connection",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:s,error:t}=await es.from("uploaded_documents").select("id, filename, processing_status").limit(5);e.push({name:"uploaded_documents Table",status:t?"error":"success",message:t?t.message:`Found ${s?.length||0} documents`,details:{data:s,error:t}})}catch(n){e.push({name:"uploaded_documents Table",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:{user:s},error:t}=await es.auth.getUser();e.push({name:"Authentication",status:t?"error":"success",message:t?t.message:s?`Logged in as ${s.email}`:"Not logged in",details:{user:s,error:t}})}catch(n){e.push({name:"Authentication",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:s,error:t}=await es.storage.listBuckets(),a=s?.find(e=>"documents"===e.name);e.push({name:"Storage Bucket",status:t?"error":a?"success":"error",message:t?t.message:a?"Documents bucket exists":"Documents bucket not found",details:{buckets:s,error:t}})}catch(n){e.push({name:"Storage Bucket",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}const t={VITE_SUPABASE_URL:"https://kvlaydeyqidlfpfutbmp.supabase.co",VITE_SUPABASE_ANON_KEY:"***",VITE_APP_URL:"https://craftchatbot.com"},a=Object.entries(t).filter(([e,s])=>!s);e.push({name:"Environment Variables",status:a.length>0?"error":"success",message:a.length>0?`Missing: ${a.map(([e])=>e).join(", ")}`:"All required variables present",details:t}),s(e),i(!1)};t.useEffect(()=>{r()},[]);const d=e=>{switch(e){case"success":return n.jsx(c,{className:"h-5 w-5 text-green-500"});case"error":return n.jsx(Y,{className:"h-5 w-5 text-red-500"});case"pending":return n.jsx(l,{className:"h-5 w-5 text-yellow-500"})}};return n.jsxs(ie,{className:"max-w-4xl mx-auto",children:[n.jsx(re,{children:n.jsxs(ce,{className:"flex items-center justify-between",children:["Database Connection Test",n.jsxs(oe,{onClick:r,disabled:a,size:"sm",children:[n.jsx(w,{className:"h-4 w-4 mr-2 "+(a?"animate-spin":"")}),a?"Running...":"Run Tests"]})]})}),n.jsx(de,{children:n.jsx("div",{className:"space-y-4",children:e.map((e,s)=>n.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[d(e.status),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-medium",children:e.name}),n.jsx("p",{className:"text-sm text-gray-600",children:e.message}),!1]})]},s))})})]})},Ms=()=>{const{profile:e,forceRefreshProfile:s}=ae(),a=J(),[c,o]=t.useState(null),[m,x]=t.useState([]),[h,u]=t.useState(!1),[p,j]=t.useState(0),[f,y]=t.useState("overview"),N=t.useCallback(e=>{o(e)},[]),w=t.useCallback(()=>{o(null)},[]),v=t.useCallback(e=>{j(e=>e+1)},[]),b=t.useCallback(e=>{x(e)},[]),S=t.useCallback(e=>{u(e)},[]);return n.jsx(Ye,{children:n.jsx(Je,{children:n.jsxs("div",{className:"min-h-screen bg-gray-50",children:[n.jsx("header",{className:"bg-white shadow",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"flex justify-between items-center py-6",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(oe,{variant:"outline",size:"sm",onClick:()=>a("/"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Go to Homepage",children:[n.jsx(X,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Home"})]}),n.jsxs(oe,{variant:"outline",size:"sm",onClick:()=>a("/dashboard"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Back to Dashboard",children:[n.jsx(Z,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})]}),n.jsxs("div",{className:"hidden md:block",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Document Management"}),n.jsx("p",{className:"text-gray-600",children:"Upload, process, and manage your legal documents with AI"})]}),n.jsx("div",{className:"md:hidden",children:n.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Documents"})})]}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-sm text-gray-500",children:"Subscription"}),n.jsx("p",{className:"font-medium capitalize",children:e?.subscription_tier||"Free"}),n.jsxs("p",{className:"text-xs text-gray-400",children:["Debug: ",JSON.stringify({tier:e?.subscription_tier,email:e?.email})]})]}),n.jsxs(oe,{variant:"outline",size:"sm",onClick:async()=>{try{await s()}catch(e){}},className:"flex items-center space-x-1",title:"Refresh subscription status",children:[n.jsx(q,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]})})}),n.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:n.jsx("div",{className:"px-4 py-6 sm:px-0",children:c?n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs(oe,{onClick:w,variant:"outline",size:"sm",children:[n.jsx(d,{className:"h-4 w-4 mr-2"}),"Close Viewer"]}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold",children:"Document Viewer"}),n.jsxs("p",{className:"text-gray-600",children:["Viewing: ",c.filename]})]})]})}),n.jsx(zs,{documentId:c.id,onClose:w,className:"w-full"})]}):n.jsxs(_e,{value:f,onValueChange:y,className:"space-y-6",children:[n.jsxs(ze,{className:"grid w-full grid-cols-6",children:[n.jsxs(Te,{value:"overview",className:"flex items-center space-x-2",children:[n.jsx(K,{className:"h-4 w-4"}),n.jsx("span",{children:"Overview"})]}),n.jsxs(Te,{value:"upload",className:"flex items-center space-x-2",children:[n.jsx(i,{className:"h-4 w-4"}),n.jsx("span",{children:"Upload"})]}),n.jsxs(Te,{value:"search",className:"flex items-center space-x-2",children:[n.jsx(g,{className:"h-4 w-4"}),n.jsx("span",{children:"Search"})]}),n.jsxs(Te,{value:"manage",className:"flex items-center space-x-2",children:[n.jsx(H,{className:"h-4 w-4"}),n.jsx("span",{children:"Manage"})]}),n.jsxs(Te,{value:"enhanced",className:"flex items-center space-x-2",children:[n.jsx(q,{className:"h-4 w-4"}),n.jsx("span",{children:"Enhanced"})]}),n.jsxs(Te,{value:"debug",className:"flex items-center space-x-2",children:[n.jsx(l,{className:"h-4 w-4"}),n.jsx("span",{children:"Debug"})]})]}),n.jsxs(Ue,{value:"overview",className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsx(As,{onDocumentSelect:N,refreshTrigger:p})}),n.jsx("div",{children:n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"text-lg flex items-center",children:[n.jsx(i,{className:"h-5 w-5 mr-2"}),"Quick Upload"]}),n.jsx(le,{children:"Upload documents for AI processing"})]}),n.jsx(de,{children:n.jsx(bs,{onUploadComplete:v,maxFiles:3})})]})})]}),n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"text-lg flex items-center",children:[n.jsx(r,{className:"h-5 w-5 mr-2"}),"Recent Documents"]}),n.jsx(le,{children:"Your most recently uploaded documents"})]}),n.jsx(de,{children:n.jsx(ks,{onDocumentSelect:N,refreshTrigger:p})})]})]}),n.jsx(Ue,{value:"upload",className:"space-y-6",children:n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsx(bs,{onUploadComplete:v,maxFiles:10})}),n.jsx("div",{children:n.jsx(As,{onDocumentSelect:N,refreshTrigger:p})})]})}),n.jsx(Ue,{value:"search",className:"space-y-6",children:n.jsxs("div",{className:"space-y-6",children:[n.jsx(Us,{onResults:b,onLoading:S}),n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"text-lg flex items-center",children:[n.jsx(g,{className:"h-5 w-5 mr-2"}),"Search Results",h&&n.jsx("div",{className:"ml-2 h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"})]}),n.jsx(le,{children:m.length>0?`Found ${m.length} document${1===m.length?"":"s"}`:"Enter search criteria to find documents"})]}),n.jsx(de,{children:n.jsx(ks,{onDocumentSelect:N,refreshTrigger:p})})]})]})}),n.jsx(Ue,{value:"manage",className:"space-y-6",children:n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[n.jsx("div",{className:"lg:col-span-3",children:n.jsxs(ie,{children:[n.jsxs(re,{children:[n.jsxs(ce,{className:"text-lg flex items-center",children:[n.jsx(H,{className:"h-5 w-5 mr-2"}),"All Documents"]}),n.jsx(le,{children:"Manage all your uploaded documents"})]}),n.jsx(de,{children:n.jsx(ks,{onDocumentSelect:N,refreshTrigger:p})})]})}),n.jsx("div",{children:n.jsx(As,{onDocumentSelect:N,refreshTrigger:p})})]})}),n.jsx(Ue,{value:"enhanced",className:"space-y-6",children:n.jsx(Je,{children:n.jsx(Ps,{})})}),n.jsx(Ue,{value:"debug",className:"space-y-6",children:n.jsxs("div",{className:"space-y-6",children:[n.jsx(UploadDiagnostics,{}),n.jsx(Xe,{}),n.jsx(Ze,{}),n.jsx(Rs,{})]})})]})})})]})})})};export{Ms as default};
