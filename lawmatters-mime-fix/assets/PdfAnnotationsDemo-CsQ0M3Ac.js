import{r as e,j as s,ab as a,bN as t,ca as l,o as n,cb as i,cc as r,cd as c,m as o,a8 as d,aG as x,ce as m,aK as h,c0 as j,U as u,aE as p,aF as g,cf as N,cg as f,ch as b,a5 as v,ci as y,cj as w,ck as C,v as k,w as A,bB as S,aU as D,F,bE as T,bC as P,aR as M,b5 as z,q as U}from"./react-vendor-SE0pM8Ra.js";import{c as L,T as O,D as E,a as I,B as R,b as B,d as $,e as G,f as V,h as W,i as H,S as Y,I as q,j as K,k as X,l as Q,m as J,n as Z,C as _,o as ee,p as se,q as ae,r as te,s as le,t as ne,u as ie,v as re}from"./ai-services-C7T4cFUa.js";import{u as ce,a as oe,b as de,c as xe}from"./useAnnotations-DlCzKY2M.js";import{f as me,a as he}from"./utilities-CJeqyZZO.js";import{getPdfJs as je}from"./pdfWorker-CeDIboJ0.js";import"./ui-components-ByoYm48K.js";import"./data-fetching-De8LKKym.js";import"./vendor-CrSvAuNw.js";import"./ocr-worker-Ehk6BbiK.js";import"./pdf-worker-CdhgQTyu.js";import"./supabase-Cfql4b7O.js";import"./forms-Mu2Tem6y.js";function ue({annotations:a,scale:t,rotation:l,activeTool:n,selectedAnnotation:i,drawingState:r,readOnly:c=!1,onAnnotationCreate:o,onAnnotationSelect:d,onAnnotationUpdate:x,onAnnotationDelete:m,onDrawingStart:h,onDrawingUpdate:j,onDrawingEnd:u}){const p=e.useRef(null),[g,N]=e.useState(!1),[f,b]=e.useState(null),[v,y]=e.useState(null),w={yellow:"rgba(255, 255, 0, 0.3)",red:"rgba(255, 0, 0, 0.3)",blue:"rgba(0, 0, 255, 0.3)",green:"rgba(0, 255, 0, 0.3)",purple:"rgba(128, 0, 128, 0.3)",orange:"rgba(255, 165, 0, 0.3)",pink:"rgba(255, 192, 203, 0.3)",gray:"rgba(128, 128, 128, 0.3)"},C={yellow:"#FFD700",red:"#FF0000",blue:"#0000FF",green:"#00FF00",purple:"#800080",orange:"#FFA500",pink:"#FFC0CB",gray:"#808080"},k=e.useCallback((e,s)=>{if(!p.current)return{x:0,y:0};const a=p.current.getBoundingClientRect();return{x:(e-a.left)/t,y:(s-a.top)/t}},[t]),A=e.useCallback(e=>{if(c||!n.isActive)return;e.preventDefault();const s=k(e.clientX,e.clientY);"drawing"===n.type?(h(n.color),j(`M ${s.x} ${s.y}`)):(N(!0),b(s),y({x:s.x,y:s.y,width:0,height:0}))},[c,n,k,h,j]),S=e.useCallback(e=>{if(c||!n.isActive)return;const s=k(e.clientX,e.clientY);r.isDrawing?j(`${r.currentPath} L ${s.x} ${s.y}`):g&&f&&y({x:Math.min(f.x,s.x),y:Math.min(f.y,s.y),width:Math.abs(s.x-f.x),height:Math.abs(s.y-f.y)})},[c,n,r,g,f,k,j]),D=e.useCallback(e=>{!c&&n.isActive&&(r.isDrawing?(o({annotationType:"drawing",color:r.color,x:0,y:0,width:100,height:100,properties:{pathData:r.currentPath,strokeWidth:r.strokeWidth}}),u()):g&&v&&v.width>5&&v.height>5&&o({annotationType:n.type,color:n.color,x:v.x,y:v.y,width:v.width,height:v.height,content:"note"===n.type?"New note":void 0}),N(!1),b(null),y(null))},[c,n,r,g,v,o,u]),F=e.useCallback((e,s)=>{s.stopPropagation(),d(e,!1)},[d]),T=e.useCallback((e,s)=>{s.stopPropagation(),c||d(e,!0)},[c,d]),P=e.useCallback(e=>{const a=i.annotation?.id===e.id,n=w[e.color],r=C[e.color],o={position:"absolute",left:e.x*t,top:e.y*t,width:e.width*t,height:e.height*t,backgroundColor:n,border:`2px ${a?"solid":"dashed"} ${r}`,cursor:c?"default":"pointer",zIndex:a?10:1,transform:`rotate(${l}deg)`};return"drawing"===e.annotationType&&e.properties.pathData?s.jsx("svg",{style:o,onClick:s=>F(e,s),onDoubleClick:s=>T(e,s),children:s.jsx("path",{d:e.properties.pathData,stroke:r,strokeWidth:e.properties.strokeWidth||2,fill:"none"})},e.id):s.jsxs("div",{style:o,onClick:s=>F(e,s),onDoubleClick:s=>T(e,s),className:L("annotation-element",a&&"ring-2 ring-blue-500 ring-offset-2"),children:["note"===e.annotationType&&s.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-yellow-400 rounded-full border border-yellow-600 flex items-center justify-center text-xs",children:"📝"}),"stamp"===e.annotationType&&s.jsx("div",{className:"flex items-center justify-center h-full text-xs font-bold text-red-600",children:e.properties.stampType?.toUpperCase()||"STAMP"}),e.content&&a&&s.jsxs("div",{className:"absolute top-full left-0 mt-2 p-2 bg-white border rounded shadow-lg max-w-xs z-20",children:[s.jsx("p",{className:"text-sm",children:e.content}),e.user&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["by ",e.user.firstName," ",e.user.lastName]})]})]},e.id)},[t,l,i,c,w,C,F,T]),M=e.useCallback(()=>{if(!v||!n.isActive)return null;const e=w[n.color],a=C[n.color];return s.jsx("div",{style:{position:"absolute",left:v.x*t,top:v.y*t,width:v.width*t,height:v.height*t,backgroundColor:e,border:`2px dashed ${a}`,pointerEvents:"none",zIndex:100}})},[v,n,t,w,C]),z=e.useCallback(()=>{if(!r.isDrawing||!r.currentPath)return null;const e=C[r.color];return s.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:100},children:s.jsx("path",{d:r.currentPath,stroke:e,strokeWidth:r.strokeWidth,fill:"none"})})},[r,C]);return s.jsxs("div",{ref:p,className:"absolute inset-0 w-full h-full",style:{cursor:n.isActive&&!c?"crosshair":"default"},onMouseDown:A,onMouseMove:S,onMouseUp:D,children:[a.map(P),M(),z()]})}const pe=[{type:"highlight",icon:l,label:"Highlight",description:"Highlight text or areas"},{type:"note",icon:n,label:"Note",description:"Add sticky notes"},{type:"text",icon:i,label:"Text",description:"Add text annotations"},{type:"drawing",icon:r,label:"Draw",description:"Draw freehand annotations"},{type:"stamp",icon:c,label:"Stamp",description:"Add stamps and signatures"}],ge=[{color:"yellow",label:"Yellow",value:"#FFFF00"},{color:"red",label:"Red",value:"#FF0000"},{color:"blue",label:"Blue",value:"#0000FF"},{color:"green",label:"Green",value:"#00FF00"},{color:"purple",label:"Purple",value:"#800080"},{color:"orange",label:"Orange",value:"#FFA500"},{color:"pink",label:"Pink",value:"#FFC0CB"},{color:"gray",label:"Gray",value:"#808080"}],Ne=[{type:"approved",label:"Approved",emoji:"✅"},{type:"rejected",label:"Rejected",emoji:"❌"},{type:"reviewed",label:"Reviewed",emoji:"👁️"},{type:"confidential",label:"Confidential",emoji:"🔒"},{type:"draft",label:"Draft",emoji:"📝"}];function fe({activeTool:l,onToolSelect:n,onToolDeselect:i,className:r}){const[c,o]=e.useState("yellow");return s.jsx(O,{children:s.jsxs("div",{className:L("flex items-center space-x-1",r),children:[pe.map(e=>{const t=e.icon,r=l.isActive&&l.type===e.type;return"stamp"===e.type?s.jsxs(E,{children:[s.jsx(I,{asChild:!0,children:s.jsxs(R,{variant:r?"default":"outline",size:"sm",className:L("relative",r&&"bg-blue-600 text-white"),children:[s.jsx(t,{className:"h-4 w-4"}),s.jsx(a,{className:"h-3 w-3 ml-1"})]})}),s.jsx(B,{align:"start",children:Ne.map(e=>s.jsxs($,{onClick:()=>(e.type,void n("stamp",c)),className:"flex items-center space-x-2",children:[s.jsx("span",{children:e.emoji}),s.jsx("span",{children:e.label})]},e.type))})]},e.type):s.jsxs(G,{children:[s.jsx(V,{asChild:!0,children:s.jsxs(R,{variant:r?"default":"outline",size:"sm",onClick:()=>{return s=e.type,void(l.isActive&&l.type===s?i():n(s,c));var s},className:L("relative",r&&"bg-blue-600 text-white"),children:[s.jsx(t,{className:"h-4 w-4"}),r&&s.jsx(W,{variant:"secondary",className:"absolute -top-2 -right-2 h-4 w-4 p-0 flex items-center justify-center text-xs",style:{backgroundColor:ge.find(e=>e.color===l.color)?.value},children:"●"})]})}),s.jsxs(H,{children:[s.jsx("p",{className:"font-medium",children:e.label}),s.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]},e.type)}),s.jsx(Y,{orientation:"vertical",className:"h-6"}),s.jsxs(E,{children:[s.jsx(I,{asChild:!0,children:s.jsxs(R,{variant:"outline",size:"sm",className:"flex items-center space-x-1",children:[s.jsx(t,{className:"h-4 w-4"}),s.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:ge.find(e=>e.color===c)?.value}}),s.jsx(a,{className:"h-3 w-3"})]})}),s.jsx(B,{align:"start",children:s.jsx("div",{className:"grid grid-cols-4 gap-2 p-2",children:ge.map(e=>s.jsx("button",{onClick:()=>(e=>{o(e),l.isActive&&n(l.type,e)})(e.color),className:L("w-8 h-8 rounded-full border-2 hover:scale-110 transition-transform",c===e.color?"border-gray-800":"border-gray-300"),style:{backgroundColor:e.value},title:e.label},e.color))})})]}),l.isActive&&s.jsxs(s.Fragment,{children:[s.jsx(Y,{orientation:"vertical",className:"h-6"}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[s.jsxs(W,{variant:"outline",className:"flex items-center space-x-1",children:[s.jsx("span",{children:pe.find(e=>e.type===l.type)?.label}),s.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:ge.find(e=>e.color===l.color)?.value}})]}),s.jsx(R,{variant:"ghost",size:"sm",onClick:i,className:"h-6 px-2 text-xs",children:"Deselect"})]})]})]})})}const be={highlight:"Highlight",note:"Note",text:"Text",drawing:"Drawing",stamp:"Stamp"},ve={yellow:"Yellow",red:"Red",blue:"Blue",green:"Green",purple:"Purple",orange:"Orange",pink:"Pink",gray:"Gray"};function ye({annotations:a,currentPage:t,selectedAnnotation:l,onAnnotationSelect:i,onAnnotationUpdate:c,onAnnotationDelete:g,onPageChange:N,readOnly:f=!1,className:b}){const[v,y]=e.useState(""),[w,C]=e.useState("all"),[k,A]=e.useState("all"),[S,D]=e.useState(null),[F,T]=e.useState(""),[P,M]=e.useState(!1),[z,U]=e.useState("");ce(l.annotation?.id||"");const{shareAnnotation:O}=oe(),G=e.useMemo(()=>a.filter(e=>{if(v){const s=v.toLowerCase(),a=e.content?.toLowerCase().includes(s),t=e.selectedText?.toLowerCase().includes(s),l=e.user?.email?.toLowerCase().includes(s);if(!a&&!t&&!l)return!1}return("all"===w||e.annotationType===w)&&("all"===k||e.color===k)}),[a,v,w,k]),V=e.useMemo(()=>{const e={};return G.forEach(s=>{e[s.pageNumber]||(e[s.pageNumber]=[]),e[s.pageNumber].push(s)}),e},[G]),H=()=>{D(null),T("")},Y=e=>{const a=l.annotation?.id===e.id,t=S===e.id;return s.jsx(_,{className:L("mb-3 cursor-pointer transition-all",a&&"ring-2 ring-blue-500"),onClick:()=>i(e),children:s.jsxs(ee,{className:"p-3",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(W,{variant:"outline",className:"text-xs",children:be[e.annotationType]}),s.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:e.color},title:ve[e.color]})]}),!f&&s.jsxs(E,{children:[s.jsx(I,{asChild:!0,children:s.jsx(R,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:s.jsx(m,{className:"h-3 w-3"})})}),s.jsxs(B,{align:"end",children:[s.jsxs($,{onClick:()=>(e=>{D(e.id),T(e.content||"")})(e),children:[s.jsx(r,{className:"h-4 w-4 mr-2"}),"Edit"]}),s.jsxs($,{onClick:()=>M(!0),children:[s.jsx(h,{className:"h-4 w-4 mr-2"}),"Share"]}),s.jsxs($,{onClick:()=>g(e.id),className:"text-red-600",children:[s.jsx(j,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),e.selectedText&&s.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded text-sm italic",children:['"',e.selectedText,'"']}),t?s.jsxs("div",{className:"space-y-2",children:[s.jsx(se,{value:F,onChange:e=>T(e.target.value),placeholder:"Add your note...",className:"min-h-[60px]"}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(R,{size:"sm",onClick:()=>(async e=>{await c(e,{content:F}),D(null),T("")})(e.id),children:"Save"}),s.jsx(R,{size:"sm",variant:"outline",onClick:H,children:"Cancel"})]})]}):e.content&&s.jsx("p",{className:"text-sm text-gray-700 mb-2",children:e.content}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(u,{className:"h-3 w-3"}),s.jsxs("span",{children:[e.user?.firstName," ",e.user?.lastName]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(p,{className:"h-3 w-3"}),s.jsx("span",{children:me(new Date(e.createdAt),{addSuffix:!0})})]})]}),e.comments&&e.comments.length>0&&s.jsxs("div",{className:"mt-2 pt-2 border-t",children:[s.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mb-1",children:[s.jsx(n,{className:"h-3 w-3"}),s.jsxs("span",{children:[e.comments.length," comment(s)"]})]}),e.comments.slice(0,2).map(e=>s.jsxs("div",{className:"text-xs bg-gray-50 p-2 rounded mb-1",children:[s.jsx("p",{children:e.content}),s.jsxs("span",{className:"text-gray-400",children:["by ",e.user?.firstName," ",e.user?.lastName]})]},e.id))]})]})},e.id)};return s.jsxs("div",{className:L("w-80 bg-white border-l flex flex-col",b),children:[s.jsxs("div",{className:"p-4 border-b",children:[s.jsxs("h3",{className:"font-semibold mb-3",children:["Annotations (",G.length,")"]}),s.jsxs("div",{className:"relative mb-3",children:[s.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),s.jsx(q,{placeholder:"Search annotations...",value:v,onChange:e=>y(e.target.value),className:"pl-9"})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(E,{children:[s.jsx(I,{asChild:!0,children:s.jsxs(R,{variant:"outline",size:"sm",className:"flex-1",children:[s.jsx(d,{className:"h-4 w-4 mr-1"}),"all"===w?"All Types":be[w]]})}),s.jsxs(B,{children:[s.jsx($,{onClick:()=>C("all"),children:"All Types"}),Object.entries(be).map(([e,a])=>s.jsx($,{onClick:()=>C(e),children:a},e))]})]}),s.jsxs(E,{children:[s.jsx(I,{asChild:!0,children:s.jsx(R,{variant:"outline",size:"sm",className:"flex-1",children:s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:"all"===k?"transparent":k}}),s.jsx("span",{children:"all"===k?"All Colors":ve[k]})]})})}),s.jsxs(B,{children:[s.jsx($,{onClick:()=>A("all"),children:"All Colors"}),Object.entries(ve).map(([e,a])=>s.jsx($,{onClick:()=>A(e),children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:e}}),s.jsx("span",{children:a})]})},e))]})]})]})]}),s.jsx(K,{className:"flex-1 p-4",children:0===Object.keys(V).length?s.jsxs("div",{className:"text-center text-gray-500 py-8",children:[s.jsx(n,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),s.jsx("p",{children:"No annotations found"}),s.jsx("p",{className:"text-sm",children:"Start by selecting an annotation tool"})]}):Object.entries(V).sort(([e],[s])=>parseInt(e)-parseInt(s)).map(([e,a])=>s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h4",{className:"font-medium text-sm text-gray-700",children:["Page ",e," (",a.length,")"]}),parseInt(e)!==t&&s.jsxs(R,{variant:"ghost",size:"sm",onClick:()=>N(parseInt(e)),className:"h-6 px-2 text-xs",children:["Go to page",s.jsx(x,{className:"h-3 w-3 ml-1"})]})]}),a.map(Y)]},e))}),s.jsx(X,{open:P,onOpenChange:M,children:s.jsxs(Q,{children:[s.jsx(J,{children:s.jsx(Z,{children:"Share Annotation"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(q,{placeholder:"Enter email address",value:z,onChange:e=>U(e.target.value)}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(R,{onClick:()=>l.annotation&&(async e=>{if(z)try{await O({annotationId:e.id,userEmail:z,permissionLevel:"view"}),M(!1),U("")}catch(s){}})(l.annotation),disabled:!z,children:"Share"}),s.jsx(R,{variant:"outline",onClick:()=>M(!1),children:"Cancel"})]})]})]})})]})}function we({documentId:a,fileUrl:t,className:l,showAnnotations:n=!0,readOnly:i=!1,onAnnotationCreate:r,onAnnotationUpdate:c,onAnnotationDelete:o}){const[d,m]=e.useState(0),[h,j]=e.useState(1),[u,p]=e.useState(1),[C,k]=e.useState(0),[A,S]=e.useState(!0),[D,F]=e.useState(null),[T,P]=e.useState(!0),[M,z]=e.useState(!1),U=e.useRef(null),O=e.useRef(null),{annotations:E,isLoading:I,createAnnotation:B,updateAnnotation:$,deleteAnnotation:G}=de(a),{selectedAnnotation:V,activeTool:W,drawingState:H,selectAnnotation:q,activateTool:K,deactivateTool:X,startDrawing:Q,updateDrawingPath:J,stopDrawing:Z}=xe(),ee=e.useCallback(({numPages:e})=>{m(e),S(!1),F(null)},[]),se=e.useCallback(e=>{F(`Failed to load PDF: ${e.message}`),S(!1)},[]),ae=e.useCallback(()=>{j(e=>Math.max(1,e-1))},[]),te=e.useCallback(()=>{j(e=>Math.min(d,e+1))},[d]),le=e.useCallback(e=>{j(Math.max(1,Math.min(d,e)))},[d]),ne=e.useCallback(()=>{p(e=>Math.min(3,e+.25))},[]),ie=e.useCallback(()=>{p(e=>Math.max(.5,e-.25))},[]);e.useCallback(()=>{p(1)},[]);const re=e.useCallback(()=>{k(e=>(e+90)%360)},[]),ce=e.useCallback(()=>{document.fullscreenElement?(document.exitFullscreen(),z(!1)):(U.current?.requestFullscreen(),z(!0))},[]);e.useEffect(()=>{const e=()=>{z(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),e.useEffect(()=>{(async()=>{try{await je()}catch(e){}})()},[]);const oe=e.useCallback(async e=>{try{const s=await B({documentId:a,pageNumber:h,...e});r?.(s)}catch(s){}},[B,a,h,r]),me=e.useCallback(async(e,s)=>{try{const a=await $(e,s);c?.(a)}catch(a){}},[$,c]),he=e.useCallback(async e=>{try{await G(e),o?.(e)}catch(s){}},[G,o]),pe=E.filter(e=>e.pageNumber===h);return D?s.jsxs(_,{className:"p-8 text-center",children:[s.jsx("p",{className:"text-red-600 mb-4",children:D}),s.jsx(R,{onClick:()=>window.location.reload(),children:"Retry"})]}):s.jsxs("div",{ref:U,className:L("flex h-full bg-gray-50",M&&"fixed inset-0 z-50 bg-black",l),children:[s.jsxs("div",{className:"flex-1 flex flex-col",children:[s.jsxs("div",{className:"bg-white border-b p-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(R,{variant:"outline",size:"sm",onClick:ae,disabled:h<=1,children:s.jsx(g,{className:"h-4 w-4"})}),s.jsxs("span",{className:"text-sm font-medium",children:["Page ",h," of ",d]}),s.jsx(R,{variant:"outline",size:"sm",onClick:te,disabled:h>=d,children:s.jsx(x,{className:"h-4 w-4"})}),s.jsx(Y,{orientation:"vertical",className:"h-6"}),s.jsx(R,{variant:"outline",size:"sm",onClick:ie,children:s.jsx(N,{className:"h-4 w-4"})}),s.jsxs("span",{className:"text-sm font-medium min-w-[60px] text-center",children:[Math.round(100*u),"%"]}),s.jsx(R,{variant:"outline",size:"sm",onClick:ne,children:s.jsx(f,{className:"h-4 w-4"})}),s.jsx(R,{variant:"outline",size:"sm",onClick:re,children:s.jsx(b,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[n&&!i&&s.jsx(fe,{activeTool:W,onToolSelect:K,onToolDeselect:X}),s.jsx(Y,{orientation:"vertical",className:"h-6"}),s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>P(!T),children:["Annotations (",pe.length,")"]}),s.jsx(R,{variant:"outline",size:"sm",onClick:ce,children:s.jsx(v,{className:"h-4 w-4"})})]})]}),s.jsx("div",{className:"flex-1 overflow-auto bg-gray-100 p-4",children:s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{ref:O,className:"relative bg-white shadow-lg",style:{transform:`rotate(${C}deg)`},children:s.jsxs(y,{file:t,onLoadSuccess:ee,onLoadError:se,loading:s.jsx("div",{className:"flex items-center justify-center h-96",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:[s.jsx(w,{pageNumber:h,scale:u,renderTextLayer:!1,renderAnnotationLayer:!1}),n&&s.jsx(ue,{annotations:pe,scale:u,rotation:C,activeTool:W,selectedAnnotation:V,drawingState:H,readOnly:i,onAnnotationCreate:oe,onAnnotationSelect:q,onAnnotationUpdate:me,onAnnotationDelete:he,onDrawingStart:Q,onDrawingUpdate:J,onDrawingEnd:Z})]})})})})]}),n&&T&&s.jsx(ye,{annotations:E,currentPage:h,selectedAnnotation:V,onAnnotationSelect:q,onAnnotationUpdate:me,onAnnotationDelete:he,onPageChange:le,readOnly:i})]})}function Ce({document:a,className:t,readOnly:i=!1,showMetadata:r=!0,showAnnotations:c=!0,onDocumentUpdate:o}){const[d,x]=e.useState("viewer"),[m,j]=e.useState(!1),{annotations:p,isLoading:g}=de(a.id),N="application/pdf"===a.fileType||a.fileName.toLowerCase().endsWith(".pdf"),f=e=>{},b=e=>{},v=e=>{},y=()=>{if(a.fileUrl){const e=a.createElement("a");e.href=a.fileUrl,e.download=a.fileName,e.click()}},w=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},P=e=>e.includes("pdf")?"📄":e.includes("image")?"🖼️":e.includes("text")?"📝":e.includes("word")?"📘":e.includes("excel")?"📊":e.includes("powerpoint")?"📈":"📁";return s.jsxs("div",{className:L("h-full flex flex-col",t),children:[s.jsxs("div",{className:"bg-white border-b p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"text-2xl",children:P(a.fileType)}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-semibold",children:a.fileName}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[s.jsxs("span",{className:"flex items-center space-x-1",children:[s.jsx(C,{className:"h-4 w-4"}),s.jsx("span",{children:w(a.fileSize)})]}),s.jsxs("span",{className:"flex items-center space-x-1",children:[s.jsx(k,{className:"h-4 w-4"}),s.jsx("span",{children:me(new Date(a.uploadedAt),{addSuffix:!0})})]}),c&&p.length>0&&s.jsxs("span",{className:"flex items-center space-x-1",children:[s.jsx(n,{className:"h-4 w-4"}),s.jsxs("span",{children:[p.length," annotation(s)"]})]})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(R,{variant:"outline",size:"sm",onClick:y,children:[s.jsx(A,{className:"h-4 w-4 mr-2"}),"Download"]}),s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{navigator.share?navigator.share({title:a.fileName,text:`Check out this document: ${a.fileName}`,url:a.fileUrl}):navigator.clipboard.writeText(a.fileUrl||"")},children:[s.jsx(h,{className:"h-4 w-4 mr-2"}),"Share"]}),N&&s.jsxs(R,{variant:"outline",size:"sm",onClick:()=>j(!0),children:[s.jsx(S,{className:"h-4 w-4 mr-2"}),"Fullscreen"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-4 mt-3",children:[s.jsx(W,{variant:"completed"===a.processingStatus?"default":"secondary",children:a.processingStatus}),a.ocrText&&s.jsxs(W,{variant:"outline",children:[s.jsx(D,{className:"h-3 w-3 mr-1"}),"OCR Processed"]}),a.embeddings&&s.jsxs(W,{variant:"outline",children:[s.jsx(l,{className:"h-3 w-3 mr-1"}),"Searchable"]})]})]}),s.jsx("div",{className:"flex-1 overflow-hidden",children:s.jsxs(ae,{value:d,onValueChange:x,className:"h-full flex flex-col",children:[s.jsxs(te,{className:"grid w-full grid-cols-3",children:[s.jsxs(le,{value:"viewer",children:[s.jsx(F,{className:"h-4 w-4 mr-2"}),"Viewer"]}),r&&s.jsxs(le,{value:"metadata",children:[s.jsx(T,{className:"h-4 w-4 mr-2"}),"Metadata"]}),c&&s.jsxs(le,{value:"annotations",children:[s.jsx(n,{className:"h-4 w-4 mr-2"}),"Annotations (",p.length,")"]})]}),s.jsx(ne,{value:"viewer",className:"flex-1 overflow-hidden",children:N?s.jsx(we,{documentId:a.id,fileUrl:a.fileUrl,showAnnotations:c,readOnly:i,onAnnotationCreate:f,onAnnotationUpdate:b,onAnnotationDelete:v,className:"h-full"}):s.jsx("div",{className:"h-full flex items-center justify-center bg-gray-50",children:s.jsx(_,{className:"max-w-md",children:s.jsxs(ee,{className:"p-6 text-center",children:[s.jsx("div",{className:"text-4xl mb-4",children:P(a.fileType)}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:a.fileName}),s.jsx("p",{className:"text-gray-600 mb-4",children:"This file type doesn't support inline viewing with annotations."}),s.jsxs(R,{onClick:y,children:[s.jsx(A,{className:"h-4 w-4 mr-2"}),"Download to View"]})]})})})}),r&&s.jsx(ne,{value:"metadata",className:"flex-1 overflow-auto p-4",children:s.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[s.jsxs(_,{children:[s.jsx(ie,{children:s.jsx(re,{children:"File Information"})}),s.jsx(ee,{className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"File Name"}),s.jsx("p",{className:"text-sm",children:a.fileName})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"File Type"}),s.jsx("p",{className:"text-sm",children:a.fileType})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"File Size"}),s.jsx("p",{className:"text-sm",children:w(a.fileSize)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Uploaded"}),s.jsx("p",{className:"text-sm",children:he(new Date(a.uploadedAt),"PPP")})]})]})})]}),s.jsxs(_,{children:[s.jsx(ie,{children:s.jsx(re,{children:"Processing Status"})}),s.jsx(ee,{className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Status"}),s.jsx(W,{variant:"completed"===a.processingStatus?"default":"secondary",children:a.processingStatus})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"OCR Processed"}),s.jsx("p",{className:"text-sm",children:a.ocrText?"Yes":"No"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Searchable"}),s.jsx("p",{className:"text-sm",children:a.embeddings?"Yes":"No"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Annotations"}),s.jsxs("p",{className:"text-sm",children:[p.length," annotation(s)"]})]})]})})]}),a.ocrText&&s.jsxs(_,{children:[s.jsx(ie,{children:s.jsx(re,{children:"Extracted Text (OCR)"})}),s.jsx(ee,{children:s.jsx("div",{className:"max-h-64 overflow-auto bg-gray-50 p-4 rounded text-sm",children:a.ocrText})})]})]})}),c&&s.jsx(ne,{value:"annotations",className:"flex-1 overflow-auto p-4",children:s.jsx("div",{className:"max-w-2xl mx-auto",children:g?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading annotations..."})]}):0===p.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(n,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No annotations yet"}),s.jsx("p",{className:"text-gray-500",children:N?"Switch to the viewer tab to start adding annotations to this PDF.":"Annotations are only available for PDF documents."})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-lg font-semibold",children:["All Annotations (",p.length,")"]}),p.map(e=>s.jsx(_,{children:s.jsxs(ee,{className:"p-4",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(W,{variant:"outline",children:e.annotationType}),s.jsxs(W,{variant:"outline",children:["Page ",e.pageNumber]})]}),s.jsx("span",{className:"text-xs text-gray-500",children:me(new Date(e.createdAt),{addSuffix:!0})})]}),e.selectedText&&s.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded text-sm italic",children:['"',e.selectedText,'"']}),e.content&&s.jsx("p",{className:"text-sm text-gray-700 mb-2",children:e.content}),s.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[s.jsx(u,{className:"h-3 w-3"}),s.jsxs("span",{children:[e.user?.firstName," ",e.user?.lastName]}),e.comments&&e.comments.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(Y,{orientation:"vertical",className:"h-3"}),s.jsx(n,{className:"h-3 w-3"}),s.jsxs("span",{children:[e.comments.length," comment(s)"]})]})]})]})},e.id))]})})})]})}),s.jsx(X,{open:m,onOpenChange:j,children:s.jsxs(Q,{className:"max-w-[95vw] max-h-[95vh] w-full h-full",children:[s.jsx(J,{children:s.jsx(Z,{children:a.fileName})}),N&&s.jsx(we,{documentId:a.id,fileUrl:a.fileUrl,showAnnotations:c,readOnly:i,onAnnotationCreate:f,onAnnotationUpdate:b,onAnnotationDelete:v,className:"h-full"})]})})]})}const ke={id:"demo-pdf-1",fileName:"Sample Legal Document.pdf",fileType:"application/pdf",fileSize:2048576,fileUrl:"/sample-legal-document.pdf",uploadedAt:(new Date).toISOString(),processingStatus:"completed",ocrText:"This is a sample legal document with extracted text content...",embeddings:!0,userId:"demo-user",isPublic:!1,tags:["legal","contract","sample"],metadata:{title:"Sample Legal Document",author:"LawMattersSG",subject:"PDF Annotations Demo"}},Ae=[{icon:l,title:"Text Highlighting",description:"Highlight important text passages with customizable colors",status:"implemented"},{icon:n,title:"Sticky Notes",description:"Add contextual notes and comments to specific areas",status:"implemented"},{icon:r,title:"Freehand Drawing",description:"Draw annotations directly on the PDF with various tools",status:"implemented"},{icon:c,title:"Digital Stamps",description:"Add approval stamps, signatures, and status markers",status:"implemented"},{icon:h,title:"Collaborative Annotations",description:"Share annotations with team members and clients",status:"implemented"},{icon:A,title:"Export Annotations",description:"Export annotated PDFs with all markups preserved",status:"planned"}];function Se(){const[a,t]=e.useState("demo"),[i,r]=e.useState(!1);return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex items-center justify-between h-16",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(F,{className:"h-8 w-8 text-blue-600"}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"PDF Annotations"})]}),s.jsx(W,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✅ Fully Implemented"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(R,{variant:"outline",onClick:()=>r(!0),children:[s.jsx(P,{className:"h-4 w-4 mr-2"}),"Features"]}),s.jsxs(R,{children:[s.jsx(M,{className:"h-4 w-4 mr-2"}),"Upload PDF"]})]})]})})}),s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs(ae,{value:a,onValueChange:t,className:"space-y-6",children:[s.jsxs(te,{className:"grid w-full grid-cols-3",children:[s.jsxs(le,{value:"demo",children:[s.jsx(F,{className:"h-4 w-4 mr-2"}),"Live Demo"]}),s.jsxs(le,{value:"features",children:[s.jsx(T,{className:"h-4 w-4 mr-2"}),"Features"]}),s.jsxs(le,{value:"integration",children:[s.jsx(n,{className:"h-4 w-4 mr-2"}),"Integration"]})]}),s.jsx(ne,{value:"demo",className:"space-y-6",children:s.jsxs(_,{children:[s.jsxs(ie,{children:[s.jsxs(re,{className:"flex items-center space-x-2",children:[s.jsx(l,{className:"h-5 w-5"}),s.jsx("span",{children:"Interactive PDF Viewer with Annotations"})]}),s.jsx("p",{className:"text-gray-600",children:"Try out the complete PDF annotations system. Use the toolbar to highlight text, add notes, draw annotations, and collaborate with others."})]}),s.jsxs(ee,{children:[s.jsx("div",{className:"bg-gray-100 rounded-lg p-4 mb-4",children:s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-2",children:[s.jsx(z,{className:"h-4 w-4"}),s.jsx("span",{children:"Demo Note: This uses a sample PDF. In production, users can upload their own documents."})]})}),s.jsx("div",{className:"h-[600px] border rounded-lg overflow-hidden",children:s.jsx(Ce,{document:ke,showAnnotations:!0,showMetadata:!0,readOnly:!1})})]})]})}),s.jsxs(ne,{value:"features",className:"space-y-6",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ae.map((e,a)=>{const t=e.icon;return s.jsx(_,{children:s.jsxs(ee,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(t,{className:"h-6 w-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",children:e.title}),s.jsxs(W,{variant:"implemented"===e.status?"default":"secondary",className:"mt-1",children:["implemented"===e.status?s.jsx(U,{className:"h-3 w-3 mr-1"}):s.jsx(z,{className:"h-3 w-3 mr-1"}),e.status]})]})]}),s.jsx("p",{className:"text-gray-600 text-sm",children:e.description})]})},a)})}),s.jsxs(_,{children:[s.jsx(ie,{children:s.jsx(re,{children:"Technical Implementation"})}),s.jsx(ee,{className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Frontend Components"}),s.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[s.jsx("li",{children:"• PdfViewer - Main PDF display component"}),s.jsx("li",{children:"• AnnotationLayer - Handles annotation rendering"}),s.jsx("li",{children:"• AnnotationToolbar - Tool selection interface"}),s.jsx("li",{children:"• AnnotationSidebar - Annotation management"}),s.jsx("li",{children:"• EnhancedDocumentViewer - Complete document interface"})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Backend Features"}),s.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[s.jsx("li",{children:"• PostgreSQL database with RLS policies"}),s.jsx("li",{children:"• Real-time collaboration support"}),s.jsx("li",{children:"• Annotation sharing and permissions"}),s.jsx("li",{children:"• Comment threading system"}),s.jsx("li",{children:"• Export and import capabilities"})]})]})]})})]})]}),s.jsx(ne,{value:"integration",className:"space-y-6",children:s.jsxs(_,{children:[s.jsx(ie,{children:s.jsx(re,{children:"Integration with LawMattersSG"})}),s.jsxs(ee,{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Document Management"}),s.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Seamless integration with document upload system"})]}),s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"OCR text extraction for searchable annotations"})]}),s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Version control and document history"})]}),s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Secure file storage with Supabase"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3",children:"User Experience"}),s.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Intuitive annotation tools and interface"})]}),s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Real-time collaboration features"})]}),s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Mobile-responsive design"})]}),s.jsxs("li",{className:"flex items-center space-x-2",children:[s.jsx(U,{className:"h-4 w-4 text-green-500"}),s.jsx("span",{children:"Keyboard shortcuts and accessibility"})]})]})]})]}),s.jsx(Y,{}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Usage Scenarios"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs(_,{className:"p-4",children:[s.jsx("h5",{className:"font-medium mb-2",children:"Legal Document Review"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Lawyers can annotate contracts, highlight key clauses, and add review comments."})]}),s.jsxs(_,{className:"p-4",children:[s.jsx("h5",{className:"font-medium mb-2",children:"Client Collaboration"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Share annotated documents with clients for feedback and approval."})]}),s.jsxs(_,{className:"p-4",children:[s.jsx("h5",{className:"font-medium mb-2",children:"Case Preparation"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Organize evidence, mark important sections, and prepare case materials."})]})]})]})]})]})})]})}),s.jsx(X,{open:i,onOpenChange:r,children:s.jsxs(Q,{className:"max-w-2xl",children:[s.jsx(J,{children:s.jsx(Z,{children:"PDF Annotations Features"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-gray-600",children:"Our PDF annotations system provides a complete set of tools for document markup and collaboration."}),s.jsx("div",{className:"space-y-3",children:Ae.map((e,a)=>{const t=e.icon;return s.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[s.jsx(t,{className:"h-5 w-5 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx("h4",{className:"font-medium",children:e.title}),s.jsx(W,{variant:"implemented"===e.status?"default":"secondary",className:"text-xs",children:e.status})]}),s.jsx("p",{className:"text-sm text-gray-600",children:e.description})]})]},a)})})]})]})})]})}export{Se as default};
