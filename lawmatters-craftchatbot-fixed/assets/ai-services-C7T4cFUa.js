const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./supabase-Cfql4b7O.js","./ocr-worker-Ehk6BbiK.js","./vendor-CrSvAuNw.js","./react-vendor-SE0pM8Ra.js","./ui-components-ByoYm48K.js","./data-fetching-De8LKKym.js","./pdf-worker-CdhgQTyu.js","./react-vendor-BxwK8EBg.css","./utilities-CJeqyZZO.js","./forms-Mu2Tem6y.js","./PdfAnnotationsDemo-CsQ0M3Ac.js","./useAnnotations-DlCzKY2M.js","./pdfWorker-CeDIboJ0.js","./Documents-Bd5Cz1lW.js","./search-C03hkH2s.js","./AIAssistant-nwzJ4eaX.js","./Templates-BK6dpfEN.js","./TemplateGenerator-XiJTXv2a.js","./TemplateCustomize-Dj5YpMAt.js","./TemplateVersionManagement-BcWS2HVW.js","./TemplateAnalytics-DMVBGNnM.js","./usePermissions-DsXjDr-p.js","./Admin-cT6jFs62.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{r as t,j as a,V as r,R as n,A as i,C as l,X as c,T as o,D as d,P as m,a as u,b as h,c as x,d as p,S as g,O as f,e as y,f as j,g as w,h as b,i as v,k as N,l as _,u as S,L as k,m as A,M as C,U as E,F as T,n as I,B as D,o as P,Z as R,p as F,q as L,s as $,t as U,v as q,w as O,x as z,y as M,z as B,Q as V,E as W,G,H,I as Y,J as Q,K as J,N as K,W as X,Y as Z,_ as ee,$ as se,a0 as te,a1 as ae,a2 as re,a3 as ne,a4 as ie,a5 as le,a6 as ce,a7 as oe,a8 as de,a9 as me,aa as ue,ab as he,ac as xe,ad as pe,ae as ge,af as fe,ag as ye,ah as je,ai as we,aj as be,ak as ve,al as Ne,am as _e,an as Se,ao as ke,ap as Ae,aq as Ce,ar as Ee,as as Te,at as Ie,au as De,av as Pe,aw as Re,ax as Fe,ay as Le,az as $e,aA as Ue,aB as qe,aC as Oe,aD as ze,aE as Me,aF as Be,aG as Ve,aH as We,aI as Ge,aJ as He,aK as Ye,aL as Qe,aM as Je,aN as Ke,aO as Xe,aP as Ze,aQ as es,aR as ss,aS as ts,aT as as,aU as rs,aV as ns,aW as is,aX as ls,aY as cs,aZ as os,a_ as ds,a$ as ms,b0 as us,b1 as hs,b2 as xs,b3 as ps,b4 as gs,b5 as fs,b6 as ys,b7 as js,b8 as ws,b9 as bs,ba as vs,bb as Ns,bc as _s,bd as Ss,be as ks,bf as As,bg as Cs,bh as Es,bi as Ts,bj as Is,bk as Ds,bl as Ps,bm as Rs,bn as Fs,bo as Ls,bp as $s,bq as Us,br as qs,bs as Os,bt as zs,bu as Ms,bv as Bs,bw as Vs,bx as Ws,by as Gs,bz as Hs,bA as Ys,bB as Qs,bC as Js,bD as Ks,bE as Xs,bF as Zs,bG as et,bH as st,bI as tt,bJ as at,bK as rt,bL as nt,bM as it,bN as lt,bO as ct,bP as ot,bQ as dt,bR as mt,bS as ut,bT as ht,bU as xt,bV as pt,bW as gt,bX as ft,bY as yt,bZ as jt,b_ as wt,b$ as bt,c0 as vt,c1 as Nt,c2 as _t,c3 as St,c4 as kt,c5 as At}from"./react-vendor-SE0pM8Ra.js";import{supabase as Ct}from"./supabase-Cfql4b7O.js";import{c as Et,a as Tt,b as It,T as Dt,J as Pt,d as Rt,l as Ft}from"./vendor-CrSvAuNw.js";import{Q as Lt}from"./data-fetching-De8LKKym.js";import{f as $t}from"./utilities-CJeqyZZO.js";import{o as Ut,n as qt,s as Ot,t as zt}from"./forms-Mu2Tem6y.js";const Mt={},Bt=function(e,s,t){let a=Promise.resolve();if(s&&s.length>0){const e=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),n=r?.nonce||r?.getAttribute("nonce");a=Promise.allSettled(s.map(s=>{if(s=function(e,s){return new URL(e,s).href}(s,t),s in Mt)return;Mt[s]=!0;const a=s.endsWith(".css"),r=a?'[rel="stylesheet"]':"";if(!!t)for(let t=e.length-1;t>=0;t--){const r=e[t];if(r.href===s&&(!a||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${s}"]${r}`))return;const i=document.createElement("link");return i.rel=a?"stylesheet":"modulepreload",a||(i.as="script"),i.crossOrigin="",i.href=s,n&&i.setAttribute("nonce",n),document.head.appendChild(i),a?new Promise((e,t)=>{i.addEventListener("load",e),i.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${s}`)))}):void 0}))}function r(e){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=e,window.dispatchEvent(s),!s.defaultPrevented)throw e}return a.then(s=>{for(const e of s||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};let Vt=0;const Wt=new Map,Gt=e=>{if(Wt.has(e))return;const s=setTimeout(()=>{Wt.delete(e),Jt({type:"REMOVE_TOAST",toastId:e})},1e6);Wt.set(e,s)},Ht=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?Gt(t):e.toasts.forEach(e=>{Gt(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===s.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},Yt=[];let Qt={toasts:[]};function Jt(e){Qt=Ht(Qt,e),Yt.forEach(e=>{e(Qt)})}function Kt({...e}){const s=(Vt=(Vt+1)%Number.MAX_SAFE_INTEGER,Vt.toString()),t=()=>Jt({type:"DISMISS_TOAST",toastId:s});return Jt({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:e=>{e||t()}}}),{id:s,dismiss:t,update:e=>Jt({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function Xt(){const[e,s]=t.useState(Qt);return t.useEffect(()=>(Yt.push(s),()=>{const e=Yt.indexOf(s);e>-1&&Yt.splice(e,1)}),[e]),{...e,toast:Kt,dismiss:e=>Jt({type:"DISMISS_TOAST",toastId:e})}}const Zt=e=>{const s=aa(e),{conflictingClassGroups:t,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:e=>{const t=e.split("-");return""===t[0]&&1!==t.length&&t.shift(),ea(t,s)||ta(e)},getConflictingClassGroupIds:(e,s)=>{const r=t[e]||[];return s&&a[e]?[...r,...a[e]]:r}}},ea=(e,s)=>{if(0===e.length)return s.classGroupId;const t=e[0],a=s.nextPart.get(t),r=a?ea(e.slice(1),a):void 0;if(r)return r;if(0===s.validators.length)return;const n=e.join("-");return s.validators.find(({validator:e})=>e(n))?.classGroupId},sa=/^\[(.+)\]$/,ta=e=>{if(sa.test(e)){const s=sa.exec(e)[1],t=s?.substring(0,s.indexOf(":"));if(t)return"arbitrary.."+t}},aa=e=>{const{theme:s,prefix:t}=e,a={nextPart:new Map,validators:[]};return la(Object.entries(e.classGroups),t).forEach(([e,t])=>{ra(t,a,e,s)}),a},ra=(e,s,t,a)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?s:na(s,e)).classGroupId=t)}if("function"==typeof e)return ia(e)?void ra(e(a),s,t,a):void s.validators.push({validator:e,classGroupId:t});Object.entries(e).forEach(([e,r])=>{ra(r,na(s,e),t,a)})})},na=(e,s)=>{let t=e;return s.split("-").forEach(e=>{t.nextPart.has(e)||t.nextPart.set(e,{nextPart:new Map,validators:[]}),t=t.nextPart.get(e)}),t},ia=e=>e.isThemeGetter,la=(e,s)=>s?e.map(([e,t])=>[e,t.map(e=>"string"==typeof e?s+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,t])=>[s+e,t])):e)]):e,ca=e=>{if(e<1)return{get:()=>{},set:()=>{}};let s=0,t=new Map,a=new Map;const r=(r,n)=>{t.set(r,n),s++,s>e&&(s=0,a=t,t=new Map)};return{get(e){let s=t.get(e);return void 0!==s?s:void 0!==(s=a.get(e))?(r(e,s),s):void 0},set(e,s){t.has(e)?t.set(e,s):r(e,s)}}},oa=e=>{const{separator:s,experimentalParseClassName:t}=e,a=1===s.length,r=s[0],n=s.length,i=e=>{const t=[];let i,l=0,c=0;for(let m=0;m<e.length;m++){let o=e[m];if(0===l){if(o===r&&(a||e.slice(m,m+n)===s)){t.push(e.slice(c,m)),c=m+n;continue}if("/"===o){i=m;continue}}"["===o?l++:"]"===o&&l--}const o=0===t.length?e:e.substring(c),d=o.startsWith("!");return{modifiers:t,hasImportantModifier:d,baseClassName:d?o.substring(1):o,maybePostfixModifierPosition:i&&i>c?i-c:void 0}};return t?e=>t({className:e,parseClassName:i}):i},da=e=>{if(e.length<=1)return e;const s=[];let t=[];return e.forEach(e=>{"["===e[0]?(s.push(...t.sort(),e),t=[]):t.push(e)}),s.push(...t.sort()),s},ma=/\s+/;function ua(){let e,s,t=0,a="";for(;t<arguments.length;)(e=arguments[t++])&&(s=ha(e))&&(a&&(a+=" "),a+=s);return a}const ha=e=>{if("string"==typeof e)return e;let s,t="";for(let a=0;a<e.length;a++)e[a]&&(s=ha(e[a]))&&(t&&(t+=" "),t+=s);return t};function xa(e,...s){let t,a,r,n=function(l){const c=s.reduce((e,s)=>s(e),e());return t=(e=>({cache:ca(e.cacheSize),parseClassName:oa(e),...Zt(e)}))(c),a=t.cache.get,r=t.cache.set,n=i,i(l)};function i(e){const s=a(e);if(s)return s;const n=((e,s)=>{const{parseClassName:t,getClassGroupId:a,getConflictingClassGroupIds:r}=s,n=[],i=e.trim().split(ma);let l="";for(let c=i.length-1;c>=0;c-=1){const e=i[c],{modifiers:s,hasImportantModifier:o,baseClassName:d,maybePostfixModifierPosition:m}=t(e);let u=Boolean(m),h=a(u?d.substring(0,m):d);if(!h){if(!u){l=e+(l.length>0?" "+l:l);continue}if(h=a(d),!h){l=e+(l.length>0?" "+l:l);continue}u=!1}const x=da(s).join(":"),p=o?x+"!":x,g=p+h;if(n.includes(g))continue;n.push(g);const f=r(h,u);for(let t=0;t<f.length;++t){const e=f[t];n.push(p+e)}l=e+(l.length>0?" "+l:l)}return l})(e,t);return r(e,n),n}return function(){return n(ua.apply(null,arguments))}}const pa=e=>{const s=s=>s[e]||[];return s.isThemeGetter=!0,s},ga=/^\[(?:([a-z-]+):)?(.+)\]$/i,fa=/^\d+\/\d+$/,ya=new Set(["px","full","screen"]),ja=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,wa=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ba=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,va=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Na=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,_a=e=>ka(e)||ya.has(e)||fa.test(e),Sa=e=>qa(e,"length",Oa),ka=e=>Boolean(e)&&!Number.isNaN(Number(e)),Aa=e=>qa(e,"number",ka),Ca=e=>Boolean(e)&&Number.isInteger(Number(e)),Ea=e=>e.endsWith("%")&&ka(e.slice(0,-1)),Ta=e=>ga.test(e),Ia=e=>ja.test(e),Da=new Set(["length","size","percentage"]),Pa=e=>qa(e,Da,za),Ra=e=>qa(e,"position",za),Fa=new Set(["image","url"]),La=e=>qa(e,Fa,Ba),$a=e=>qa(e,"",Ma),Ua=()=>!0,qa=(e,s,t)=>{const a=ga.exec(e);return!!a&&(a[1]?"string"==typeof s?a[1]===s:s.has(a[1]):t(a[2]))},Oa=e=>wa.test(e)&&!ba.test(e),za=()=>!1,Ma=e=>va.test(e),Ba=e=>Na.test(e),Va=xa(()=>{const e=pa("colors"),s=pa("spacing"),t=pa("blur"),a=pa("brightness"),r=pa("borderColor"),n=pa("borderRadius"),i=pa("borderSpacing"),l=pa("borderWidth"),c=pa("contrast"),o=pa("grayscale"),d=pa("hueRotate"),m=pa("invert"),u=pa("gap"),h=pa("gradientColorStops"),x=pa("gradientColorStopPositions"),p=pa("inset"),g=pa("margin"),f=pa("opacity"),y=pa("padding"),j=pa("saturate"),w=pa("scale"),b=pa("sepia"),v=pa("skew"),N=pa("space"),_=pa("translate"),S=()=>["auto",Ta,s],k=()=>[Ta,s],A=()=>["",_a,Sa],C=()=>["auto",ka,Ta],E=()=>["","0",Ta],T=()=>[ka,Ta];return{cacheSize:500,separator:":",theme:{colors:[Ua],spacing:[_a,Sa],blur:["none","",Ia,Ta],brightness:T(),borderColor:[e],borderRadius:["none","","full",Ia,Ta],borderSpacing:k(),borderWidth:A(),contrast:T(),grayscale:E(),hueRotate:T(),invert:E(),gap:k(),gradientColorStops:[e],gradientColorStopPositions:[Ea,Sa],inset:S(),margin:S(),opacity:T(),padding:k(),saturate:T(),scale:T(),sepia:E(),skew:T(),space:k(),translate:k()},classGroups:{aspect:[{aspect:["auto","square","video",Ta]}],container:["container"],columns:[{columns:[Ia]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Ta]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[p]}],"inset-x":[{"inset-x":[p]}],"inset-y":[{"inset-y":[p]}],start:[{start:[p]}],end:[{end:[p]}],top:[{top:[p]}],right:[{right:[p]}],bottom:[{bottom:[p]}],left:[{left:[p]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ca,Ta]}],basis:[{basis:S()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ta]}],grow:[{grow:E()}],shrink:[{shrink:E()}],order:[{order:["first","last","none",Ca,Ta]}],"grid-cols":[{"grid-cols":[Ua]}],"col-start-end":[{col:["auto",{span:["full",Ca,Ta]},Ta]}],"col-start":[{"col-start":C()}],"col-end":[{"col-end":C()}],"grid-rows":[{"grid-rows":[Ua]}],"row-start-end":[{row:["auto",{span:[Ca,Ta]},Ta]}],"row-start":[{"row-start":C()}],"row-end":[{"row-end":C()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ta]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ta]}],gap:[{gap:[u]}],"gap-x":[{"gap-x":[u]}],"gap-y":[{"gap-y":[u]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[N]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[N]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ta,s]}],"min-w":[{"min-w":[Ta,s,"min","max","fit"]}],"max-w":[{"max-w":[Ta,s,"none","full","min","max","fit","prose",{screen:[Ia]},Ia]}],h:[{h:[Ta,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ta,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ta,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ta,s,"auto","min","max","fit"]}],"font-size":[{text:["base",Ia,Sa]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Aa]}],"font-family":[{font:[Ua]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ta]}],"line-clamp":[{"line-clamp":["none",ka,Aa]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",_a,Ta]}],"list-image":[{"list-image":["none",Ta]}],"list-style-type":[{list:["none","disc","decimal",Ta]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[f]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[f]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",_a,Sa]}],"underline-offset":[{"underline-offset":["auto",_a,Ta]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ta]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ta]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[f]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Ra]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Pa]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},La]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[h]}],"gradient-via":[{via:[h]}],"gradient-to":[{to:[h]}],rounded:[{rounded:[n]}],"rounded-s":[{"rounded-s":[n]}],"rounded-e":[{"rounded-e":[n]}],"rounded-t":[{"rounded-t":[n]}],"rounded-r":[{"rounded-r":[n]}],"rounded-b":[{"rounded-b":[n]}],"rounded-l":[{"rounded-l":[n]}],"rounded-ss":[{"rounded-ss":[n]}],"rounded-se":[{"rounded-se":[n]}],"rounded-ee":[{"rounded-ee":[n]}],"rounded-es":[{"rounded-es":[n]}],"rounded-tl":[{"rounded-tl":[n]}],"rounded-tr":[{"rounded-tr":[n]}],"rounded-br":[{"rounded-br":[n]}],"rounded-bl":[{"rounded-bl":[n]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[f]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[f]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[_a,Ta]}],"outline-w":[{outline:[_a,Sa]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:A()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[f]}],"ring-offset-w":[{"ring-offset":[_a,Sa]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Ia,$a]}],"shadow-color":[{shadow:[Ua]}],opacity:[{opacity:[f]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[a]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Ia,Ta]}],grayscale:[{grayscale:[o]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[m]}],saturate:[{saturate:[j]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[o]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[m]}],"backdrop-opacity":[{"backdrop-opacity":[f]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ta]}],duration:[{duration:T()}],ease:[{ease:["linear","in","out","in-out",Ta]}],delay:[{delay:T()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ta]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Ca,Ta]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[v]}],"skew-y":[{"skew-y":[v]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ta]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ta]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ta]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[_a,Sa,Aa]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function Wa(...e){return Va(Et(e))}const Ga=m,Ha=t.forwardRef(({className:e,...s},t)=>a.jsx(r,{ref:t,className:Wa("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s}));Ha.displayName=r.displayName;const Ya=Tt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Qa=t.forwardRef(({className:e,variant:s,...t},r)=>a.jsx(n,{ref:r,className:Wa(Ya({variant:s}),e),...t}));Qa.displayName=n.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(i,{ref:t,className:Wa("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...s})).displayName=i.displayName;const Ja=t.forwardRef(({className:e,...s},t)=>a.jsx(l,{ref:t,className:Wa("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:a.jsx(c,{className:"h-4 w-4"})}));Ja.displayName=l.displayName;const Ka=t.forwardRef(({className:e,...s},t)=>a.jsx(o,{ref:t,className:Wa("text-sm font-semibold",e),...s}));Ka.displayName=o.displayName;const Xa=t.forwardRef(({className:e,...s},t)=>a.jsx(d,{ref:t,className:Wa("text-sm opacity-90",e),...s}));function Za(){const{toasts:e}=Xt();return a.jsxs(Ga,{children:[e.map(function({id:e,title:s,description:t,action:r,...n}){return a.jsxs(Qa,{...n,children:[a.jsxs("div",{className:"grid gap-1",children:[s&&a.jsx(Ka,{children:s}),t&&a.jsx(Xa,{children:t})]}),r,a.jsx(Ja,{})]},e)}),a.jsx(Ha,{})]})}Xa.displayName=d.displayName;const er=({...e})=>{const{theme:s="system"}=It();return a.jsx(Dt,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},sr=h,tr=x,ar=p,rr=t.forwardRef(({className:e,sideOffset:s=4,...t},r)=>a.jsx(u,{ref:r,sideOffset:s,className:Wa("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));function nr(){return[...new Set(["https://craftchatbot.com"])]}function ir(e){try{const s=nr(),t=new URL(e);return s.some(e=>new URL(e).origin===t.origin)}catch{return!1}}function lr(){return"https://craftchatbot.com"}rr.displayName=u.displayName,nr();const cr=e=>({redirectTo:e&&ir(e)?e:"https://craftchatbot.com/dashboard"}),or=e=>({redirectTo:e&&ir(e)?e:"https://craftchatbot.com/dashboard"}),dr=e=>({redirectTo:e&&ir(e)?e:"https://craftchatbot.com/auth/reset-password"}),mr={async getCurrentProfile(){const{data:{user:e},error:s}=await Ct.auth.getUser();if(s)throw s;if(!e)throw new Error("User not authenticated");const{data:t,error:a}=await Ct.from("profiles").select("*").eq("id",e.id).single();if(a)throw a;return t},async updateProfile(e){const{data:s,error:t}=await Ct.from("profiles").update(e).select().single();if(t)throw t;return s},async getUserUsage(){const{data:{user:e},error:s}=await Ct.auth.getUser();if(s)throw s;if(!e)throw new Error("User not authenticated");const{data:t,error:a}=await Ct.from("user_usage").select("*").eq("user_id",e.id).single();if(a)throw a;return t},async checkUsageLimit(e){const s=await Ct.auth.getUser();if(!s.data.user)throw new Error("User not authenticated");const{data:t,error:a}=await Ct.rpc("check_usage_limits",{user_id:s.data.user.id,operation_type:e});if(a)throw a;return t},async incrementUsage(e){const s=await Ct.auth.getUser();if(!s.data.user)throw new Error("User not authenticated");const{error:t}=await Ct.rpc("increment_usage",{user_id:s.data.user.id,operation_type:e});if(t)throw t}},ur=t.createContext(void 0),hr=()=>{const e=t.useContext(ur);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},xr=()=>{const e=t.useContext(ur);return void 0===e?{user:null,profile:null,session:null,loading:!1,requiresTwoFactor:!1,signIn:async()=>{throw new Error("Authentication not available")},signUp:async()=>{throw new Error("Authentication not available")},signOut:async()=>{throw new Error("Authentication not available")},resetPassword:async()=>{throw new Error("Authentication not available")},updatePassword:async()=>{throw new Error("Authentication not available")},refreshProfile:async()=>{throw new Error("Authentication not available")},forceRefreshProfile:async()=>{throw new Error("Authentication not available")},verifyTwoFactor:async()=>{throw new Error("Authentication not available")},isTwoFactorEnabled:()=>!1}:e},pr=({children:e})=>{const[s,r]=t.useState(null),[n,i]=t.useState(null),[l,c]=t.useState(null),[o,d]=t.useState(!0),[m,u]=t.useState(!1);t.useEffect(()=>{const e=setTimeout(()=>{o&&d(!1)},5e3);return()=>clearTimeout(e)},[o]),t.useEffect(()=>{(async()=>{try{const t="https://kvlaydeyqidlfpfutbmp.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2bGF5ZGV5cWlkbGZwZnV0Ym1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyODgzNzAsImV4cCI6MjA2NTg2NDM3MH0.XVSO5W_0v6wW-MYlM7i0MTNKprOWp_O4ON-5LqqVnzw";if(!t||!a||t.includes("placeholder")||a.includes("placeholder"))return c(null),r(null),i(null),void d(!1);if(localStorage.getItem("skipSessionRestore"))return localStorage.removeItem("skipSessionRestore"),await Ct.auth.signOut(),c(null),r(null),i(null),void d(!1);const{data:{session:n},error:l}=await Ct.auth.getSession();if(l)return c(null),r(null),i(null),void d(!1);if(n){const s=Date.now()-new Date(n.expires_at||0).getTime();if(s>864e5)await Ct.auth.signOut(),c(null),r(null),i(null);else try{const{data:{user:e},error:s}=await Ct.auth.getUser();s||!e?(await Ct.auth.signOut(),c(null),r(null),i(null)):(c(n),r(e))}catch(e){await Ct.auth.signOut(),c(null),r(null),i(null)}}else c(null),r(null),i(null);if(n?.user)try{await h()}catch(s){}else i(null)}catch(t){c(null),r(null),i(null)}finally{d(!1)}})();let e=null;try{const s="https://kvlaydeyqidlfpfutbmp.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2bGF5ZGV5cWlkbGZwZnV0Ym1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyODgzNzAsImV4cCI6MjA2NTg2NDM3MH0.XVSO5W_0v6wW-MYlM7i0MTNKprOWp_O4ON-5LqqVnzw";if(s&&t&&!s.includes("placeholder")&&!t.includes("placeholder")){const{data:{subscription:s}}=Ct.auth.onAuthStateChange(async(e,s)=>{if(c(s),r(s?.user??null),s?.user)try{await h()}catch(t){}else i(null);d(!1)});e=s}}catch(s){d(!1)}return()=>{e&&e.unsubscribe()}},[]);const h=async(e=0)=>{try{const e=await mr.getCurrentProfile();i(e)}catch(s){if(e<2){const s=1e3*Math.pow(2,e);setTimeout(()=>h(e+1),s)}else i(null)}},x=async(e,s)=>{try{const{data:t,error:a}=await Ct.auth.signInWithPassword({email:e,password:s});if(a)throw a;return{}}catch(t){throw t}},p=async(e,s,t)=>{const{error:a}=await Ct.auth.signUp({email:e,password:s,options:{data:t,...or()}});if(a)throw a},g=async()=>{try{const{error:e}=await Ct.auth.signOut();if(e)throw e;c(null),r(null),i(null),u(!1),localStorage.clear(),sessionStorage.clear(),window.location.href="/"}catch(e){throw e}},f=async e=>{const{error:s}=await Ct.auth.resetPasswordForEmail(e,dr());if(s)throw s},y=async e=>{try{const{error:s}=await Ct.auth.updateUser({password:e});if(s)throw s}catch(s){throw s}},j=async()=>{s&&await h()},w=async(e,s)=>{if(!(s?/^\d{8}$/.test(s):/^\d{6}$/.test(e)))throw new Error("Invalid verification code");u(!1)},b=()=>!1,v=async()=>{try{const e=await mr.getCurrentProfile();return i(e),e}catch(e){throw e}},N=t.useMemo(()=>({user:s,profile:n,session:l,loading:o,requiresTwoFactor:m,signIn:x,signUp:p,signOut:g,resetPassword:f,updatePassword:y,refreshProfile:j,forceRefreshProfile:v,verifyTwoFactor:w,isTwoFactorEnabled:b}),[s,n,l,o,m,x,p,g,f,y,j,v,w,b]);return a.jsx(ur.Provider,{value:N,children:e})},gr=Tt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),fr=t.forwardRef(({className:e,variant:s,size:t,asChild:r=!1,...n},i)=>{const l=r?g:"button";return a.jsx(l,{className:Wa(gr({variant:s,size:t,className:e})),ref:i,...n})});fr.displayName="Button";const yr=t.forwardRef(({className:e,type:s,...t},r)=>a.jsx("input",{type:s,className:Wa("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...t}));yr.displayName="Input";const jr=N,wr=_,br=v,vr=t.forwardRef(({className:e,...s},t)=>a.jsx(f,{className:Wa("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:t}));vr.displayName=f.displayName;const Nr=Tt("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),_r=t.forwardRef(({side:e="right",className:s,children:t,...r},n)=>a.jsxs(br,{children:[a.jsx(vr,{}),a.jsxs(y,{ref:n,className:Wa(Nr({side:e}),s),...r,children:[t,a.jsxs(j,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_r.displayName=y.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(w,{ref:t,className:Wa("text-lg font-semibold text-foreground",e),...s})).displayName=w.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(b,{ref:t,className:Wa("text-sm text-muted-foreground",e),...s})).displayName=b.displayName;const Sr=()=>{const[e,s]=t.useState(!1),[r,n]=t.useState(""),[i,l]=t.useState(!1),c=S(),{user:o,loading:d,signOut:m}=xr(),u=e=>{e.preventDefault(),r.trim()&&(c(`/legal-qa?q=${encodeURIComponent(r)}`),n(""),l(!1))},h=[{name:"Home",href:"/"},{name:"Free Analysis",href:"/analyze",icon:T,highlight:!0},{name:"Templates",href:"/templates",icon:I},{name:"Law Firms",href:"/law-firms",icon:D},{name:"Documents",href:"/documents",icon:T},{name:"Legal Q&A",href:"/legal-qa",icon:P},{name:"Pricing",href:"/pricing"}];return a.jsx("nav",{className:"bg-white shadow-lg fixed w-full top-0 z-50",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(k,{to:"/",className:"text-2xl font-bold text-blue-900 hover:text-blue-800 transition-colors",children:"LegalHelpSG"})}),a.jsxs("div",{className:"hidden lg:flex items-center space-x-4 flex-1",children:[a.jsx("div",{className:"flex items-baseline space-x-3 ml-8",children:h.map(e=>a.jsxs(k,{to:e.href,className:"px-2 py-2 rounded-md text-sm font-medium transition-colors flex items-center space-x-1 "+(e.highlight?"bg-blue-600 text-white hover:bg-blue-700":"text-gray-700 hover:text-blue-600"),children:[e.icon&&a.jsx(e.icon,{className:"h-4 w-4"}),a.jsx("span",{children:e.name})]},e.name))}),a.jsx("div",{className:"relative hidden xl:block",children:i?a.jsxs("form",{onSubmit:u,className:"flex items-center",children:[a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx(yr,{type:"text",placeholder:"Search legal topics...",value:r,onChange:e=>n(e.target.value),className:"pl-10 pr-4 py-2 w-48 border-gray-300 focus:border-blue-500 focus:ring-blue-500",autoFocus:!0,onBlur:()=>{r.trim()||l(!1)}})]}),a.jsx(fr,{type:"submit",size:"sm",className:"ml-2 bg-blue-600 hover:bg-blue-700",children:"Search"})]}):a.jsxs(fr,{variant:"outline",size:"sm",onClick:()=>l(!0),className:"flex items-center space-x-2",children:[a.jsx(A,{className:"h-4 w-4"}),a.jsx("span",{children:"Search"})]})})]}),a.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0 ml-4",children:[a.jsx(fr,{variant:"outline",size:"sm",onClick:()=>c("/auth/login"),className:"px-4 py-2 text-sm font-medium whitespace-nowrap border-gray-300 hover:border-blue-600 hover:text-blue-600",children:"Sign In"}),a.jsx(fr,{size:"sm",onClick:()=>c("/auth/register"),className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 text-sm font-medium whitespace-nowrap",children:"Get Started"})]}),a.jsx("div",{className:"lg:hidden ml-2",children:a.jsxs(jr,{open:e,onOpenChange:s,children:[a.jsx(wr,{asChild:!0,children:a.jsx(fr,{variant:"ghost",size:"icon",className:"p-2",children:a.jsx(C,{className:"h-5 w-5"})})}),a.jsx(_r,{side:"right",className:"w-[300px] sm:w-[400px]",children:a.jsxs("div",{className:"flex flex-col space-y-4 mt-8",children:[a.jsxs("form",{onSubmit:u,className:"mb-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx(yr,{type:"text",placeholder:"Search legal topics...",value:r,onChange:e=>n(e.target.value),className:"pl-10 pr-4 py-2 w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),a.jsx(fr,{type:"submit",className:"w-full mt-2 bg-blue-600 hover:bg-blue-700",children:"Search"})]}),h.map(e=>a.jsxs(k,{to:e.href,className:"px-3 py-2 rounded-md text-lg font-medium transition-colors flex items-center space-x-2 "+(e.highlight?"bg-blue-600 text-white hover:bg-blue-700":"text-gray-700 hover:text-blue-600"),onClick:()=>s(!1),children:[e.icon&&a.jsx(e.icon,{className:"h-5 w-5"}),a.jsx("span",{children:e.name})]},e.name)),a.jsx("div",{className:"border-t pt-4 mt-4",children:o?a.jsxs(fr,{onClick:()=>{c("/dashboard"),s(!1)},className:"w-full mt-4 bg-blue-600 hover:bg-blue-700",children:[a.jsx(E,{className:"h-4 w-4 mr-2"}),"Dashboard"]}):a.jsxs("div",{className:"space-y-2 mt-4",children:[a.jsx(fr,{variant:"outline",onClick:()=>{c("/auth/login"),s(!1)},className:"w-full",disabled:d,children:d?"Loading...":"Sign In"}),a.jsx(fr,{onClick:()=>{c("/auth/register"),s(!1)},className:"w-full bg-blue-600 hover:bg-blue-700",disabled:d,children:d?"Loading...":"Get Started"})]})})]})})]})})]})})})},kr={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ALLOWED_FILE_TYPES:"pdf,doc,docx,txt",VITE_API_URL:"https://craftchatbot.com/api",VITE_APP_NAME:"LawMattersSG",VITE_APP_URL:"https://craftchatbot.com",VITE_DEBUG_MODE:"false",VITE_ENABLE_2FA:"true",VITE_ENABLE_AI_CHAT:"true",VITE_ENABLE_DOCUMENT_ANALYSIS:"true",VITE_ENABLE_LAW_FIRM_DIRECTORY:"true",VITE_ENABLE_LAZY_LOADING:"true",VITE_ENABLE_OFFLINE_MODE:"false",VITE_ENABLE_SERVICE_WORKER:"true",VITE_ENABLE_TEMPLATE_GENERATION:"true",VITE_ENVIRONMENT:"production",VITE_LOG_LEVEL:"error",VITE_MAX_FILE_SIZE_MB:"10",VITE_MAX_FILE_SIZE_PREMIUM_MB:"50",VITE_MAX_LOGIN_ATTEMPTS:"5",VITE_POSTHOG_HOST:"https://app.posthog.com",VITE_POSTHOG_KEY:"your-posthog-key",VITE_RATE_LIMIT_REQUESTS_PER_HOUR:"2000",VITE_RATE_LIMIT_REQUESTS_PER_MINUTE:"100",VITE_SESSION_TIMEOUT:"3600",VITE_STRIPE_PUBLISHABLE_KEY:"your-stripe-publishable-key",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2bGF5ZGV5cWlkbGZwZnV0Ym1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyODgzNzAsImV4cCI6MjA2NTg2NDM3MH0.XVSO5W_0v6wW-MYlM7i0MTNKprOWp_O4ON-5LqqVnzw",VITE_SUPABASE_URL:"https://kvlaydeyqidlfpfutbmp.supabase.co"};function Ar(e,s){const t=kr[e];if(void 0===t&&void 0===s)throw new Error(`Environment variable ${e} is required but not set`);return t??s??""}function Cr(e,s=!1){return"true"===Ar(e,s.toString()).toLowerCase()}function Er(e,s){const t=Ar(e,s.toString()),a=parseInt(t,10);if(isNaN(a))throw new Error(`Environment variable ${e} must be a valid number`);return a}const Tr={supabase:{url:Ar("VITE_SUPABASE_URL","https://placeholder.supabase.co"),anonKey:Ar("VITE_SUPABASE_ANON_KEY","placeholder-key"),serviceRoleKey:Ar("SUPABASE_SERVICE_ROLE_KEY","")},openai:{apiKey:Ar("OPENAI_API_KEY",""),model:Ar("OPENAI_MODEL","gpt-4-turbo"),maxTokens:Er("OPENAI_MAX_TOKENS",4e3),temperature:Er("OPENAI_TEMPERATURE",.1)},stripe:{publishableKey:Ar("VITE_STRIPE_PUBLISHABLE_KEY",""),secretKey:Ar("STRIPE_SECRET_KEY",""),webhookSecret:Ar("STRIPE_WEBHOOK_SECRET","")},email:{sendgridApiKey:Ar("SENDGRID_API_KEY",""),resendApiKey:Ar("RESEND_API_KEY",""),fromEmail:Ar("SENDGRID_FROM_EMAIL","noreply@lawmatterssg.com")},app:{name:Ar("VITE_APP_NAME","LawMattersSG"),url:Ar("VITE_APP_URL","http://localhost:8082"),apiUrl:Ar("VITE_API_URL","http://localhost:8082/api"),environment:Ar("VITE_ENVIRONMENT","development")},analytics:{posthogKey:Ar("VITE_POSTHOG_KEY",""),posthogHost:Ar("VITE_POSTHOG_HOST","https://app.posthog.com"),sentryDsn:Ar("SENTRY_DSN","")},fileUpload:{maxFileSizeMB:Er("VITE_MAX_FILE_SIZE_MB",10),maxFileSizePremiumMB:Er("VITE_MAX_FILE_SIZE_PREMIUM_MB",50),allowedFileTypes:function(e,s=[]){return Ar(e,s.join(",")).split(",").map(e=>e.trim()).filter(Boolean)}("VITE_ALLOWED_FILE_TYPES",["pdf","doc","docx","txt"])},rateLimit:{requestsPerMinute:Er("VITE_RATE_LIMIT_REQUESTS_PER_MINUTE",60),requestsPerHour:Er("VITE_RATE_LIMIT_REQUESTS_PER_HOUR",1e3)},features:{aiChat:Cr("VITE_ENABLE_AI_CHAT",!0),documentAnalysis:Cr("VITE_ENABLE_DOCUMENT_ANALYSIS",!0),templateGeneration:Cr("VITE_ENABLE_TEMPLATE_GENERATION",!1),lawFirmDirectory:Cr("VITE_ENABLE_LAW_FIRM_DIRECTORY",!1)},debug:{enabled:Cr("VITE_DEBUG_MODE",!1),logLevel:Ar("VITE_LOG_LEVEL","info")}};!function(){const e=["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"].filter(e=>{const s=kr[e];return!s||""===s.trim()});if(e.length>0)throw new Error(`Missing required environment variables: ${e.join(", ")}\nPlease check your .env file and ensure all required variables are set.`)}();const Ir={free:{name:"Free",price:0,period:"forever",limits:{dailyAiRequests:10,monthlyAiRequests:10,dailyDocumentUploads:1,monthlyDocumentUploads:1,customDocumentDownloads:0,maxFileSize:10485760,maxDocuments:50},features:["Law firm directory access (basic)","10 AI queries per month","1 document download per month","Save bookmarks","Premium contract templates","Document analysis with AI","Priority support"]},premium:{name:"Premium",price:19,period:"month",popular:!0,limits:{dailyAiRequests:50,monthlyAiRequests:50,dailyDocumentUploads:10,monthlyDocumentUploads:10,customDocumentDownloads:3,maxFileSize:52428800,maxDocuments:500},features:["All features from Free plan","50 AI queries per month","10 document downloads per month","Access to all premium templates","Advanced document analysis with AI","Priority dashboard and analytics","Priority support"]},pro:{name:"Pro",price:159,period:"month",limits:{dailyAiRequests:500,monthlyAiRequests:500,dailyDocumentUploads:50,monthlyDocumentUploads:20,customDocumentDownloads:20,maxFileSize:104857600,maxDocuments:2e3},features:["Everything in Premium plan","500 AI queries per month","20 customized legal document downloads","Unlimited AI queries","Unlimited document downloads","Custom document templates","API access for integrations","Dedicated account manager"]},enterprise:{name:"Enterprise",price:null,period:"custom",limits:{dailyAiRequests:-1,monthlyAiRequests:-1,dailyDocumentUploads:-1,monthlyDocumentUploads:-1,customDocumentDownloads:-1,maxFileSize:524288e3,maxDocuments:-1},features:["All features from Premium plan","Unlimited AI queries","Unlimited document downloads","Custom document templates","API access for integrations","Document extraction and bulk uploads","Dedicated account manager"]}},Dr={contract:"Contract",legal_brief:"Legal Brief",court_filing:"Court Filing",agreement:"Agreement",other:"Other"},Pr={pending:"Pending",processing:"Processing",completed:"Completed",failed:"Failed"},Rr={maxSize:{free:10485760,premium:52428800,pro:104857600,enterprise:524288e3},allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"],allowedExtensions:Tr.fileUpload.allowedFileTypes.map(e=>`.${e}`)},Fr={premium:{monthly:"price_premium_monthly",yearly:"price_premium_yearly"},pro:{monthly:"price_pro_monthly",yearly:"price_pro_yearly"}},Lr={home:"/",login:"/auth/login",register:"/auth/register",forgotPassword:"/auth/forgot-password",resetPassword:"/auth/reset-password",dashboard:"/dashboard",documents:"/dashboard/documents",templates:"/dashboard/templates",aiChat:"/dashboard/ai-chat",profile:"/dashboard/profile",subscription:"/dashboard/subscription",security:"/dashboard/security",lawFirms:"/law-firms",pricing:"/pricing",subscribe:"/subscribe",paymentSuccess:"/payment/success",paymentFailure:"/payment/failure",admin:"/admin",adminUsers:"/admin/users",adminAnalytics:"/admin/analytics",publicAnalysis:"/analyze",publicAnalysisResult:"/analyze/result",templateMarketplace:"/templates",templateBrowser:"/templates/browse",templatePreview:"/templates/preview",templateCustomize:"/templates/customize",templateGenerate:"/templates/generate",templateDownload:"/templates/download"},$r={rateLimits:{documentsPerHour:3,documentsPerDay:10,maxFileSize:10485760,allowedFileTypes:["application/pdf","image/jpeg","image/png","image/webp"],sessionDuration:36e5},features:{basicOCR:!0,textExtraction:!0,documentSummary:!0,keywordExtraction:!0,documentClassification:!1,legalInsights:!1,entityExtraction:!1,complianceCheck:!1},storage:{bucket:"public-documents",retentionHours:24,maxStoragePerSession:52428800},conversionPrompts:{showAfterAnalysis:!0,showAdvancedFeatures:!0,highlightPremiumBenefits:!0}},Ur={categories:[{id:"employment",name:"Employment",description:"Employment contracts, agreements, and HR documents",icon:"briefcase",subcategories:["contracts","policies","termination","benefits"]},{id:"business",name:"Business",description:"Business formation, partnerships, and commercial agreements",icon:"building",subcategories:["incorporation","partnerships","commercial","licensing"]},{id:"property",name:"Property",description:"Real estate, leases, and property-related documents",icon:"home",subcategories:["purchase","lease","rental","development"]},{id:"family",name:"Family",description:"Family law, wills, and personal legal documents",icon:"users",subcategories:["wills","divorce","custody","adoption"]},{id:"intellectual-property",name:"Intellectual Property",description:"Patents, trademarks, and IP protection documents",icon:"lightbulb",subcategories:["patents","trademarks","copyright","licensing"]},{id:"compliance",name:"Compliance",description:"Regulatory compliance and legal compliance documents",icon:"shield",subcategories:["gdpr","financial","healthcare","environmental"]}],accessLevels:{public:{name:"Public",description:"Free templates available to all users",features:["basic_customization","pdf_download","preview"],limitations:["watermark","basic_fields_only"]},premium:{name:"Premium",description:"Advanced templates for premium subscribers",features:["advanced_customization","multiple_formats","legal_review","version_history"],limitations:[]},enterprise:{name:"Enterprise",description:"Custom templates for enterprise clients",features:["custom_branding","api_access","bulk_generation","priority_support"],limitations:[]}},generation:{maxCustomFields:50,supportedFormats:["pdf","docx","html"],aiModels:["gpt-4","claude-3"],maxGenerationTime:3e4,retryAttempts:3},singapore:{jurisdiction:"Singapore",language:"English",currency:"SGD",legalSystem:"Common Law",regulatoryBodies:["ACRA","MAS","MOM","URA","IRAS","AGC"],complianceStandards:["Companies Act","Employment Act","Personal Data Protection Act","Securities and Futures Act"]},validation:{requiredFields:["title","description","category","jurisdiction"],maxTitleLength:100,maxDescriptionLength:500,minPreviewLength:100,allowedFileTypes:["pdf","docx","txt"],maxFileSize:5242880},pricing:{free:{templatesPerMonth:3,customizationLevel:"basic",downloadFormats:["pdf"],support:"community"},premium:{templatesPerMonth:50,customizationLevel:"advanced",downloadFormats:["pdf","docx","html"],support:"email"},enterprise:{templatesPerMonth:"unlimited",customizationLevel:"full",downloadFormats:["pdf","docx","html","xml"],support:"priority"}}};const qr=new class{constructor(){s(this,"cache",null),s(this,"cacheExpiry",0),s(this,"CACHE_DURATION",3e5)}async getStats(){if(this.cache&&Date.now()<this.cacheExpiry)return this.cache;try{const{data:e,error:s}=await Ct.rpc("get_platform_statistics");if(!s&&e){const s={legalProfessionals:e.legalProfessionals,documentsProcessed:e.documentsProcessed,questionsAnswered:e.questionsAnswered,templatesDownloaded:e.templatesDownloaded,activeLawFirms:e.activeLawFirms,totalUsers:e.totalUsers};return this.cache=s,this.cacheExpiry=Date.now()+this.CACHE_DURATION,s}const[t,a,r,n,i,l]=await Promise.all([this.getLegalProfessionalsCount(),this.getDocumentsProcessedCount(),this.getQuestionsAnsweredCount(),this.getTemplatesDownloadedCount(),this.getActiveLawFirmsCount(),this.getTotalUsersCount()]),c={legalProfessionals:t,documentsProcessed:a,questionsAnswered:r,templatesDownloaded:n,activeLawFirms:i,totalUsers:l};return this.cache=c,this.cacheExpiry=Date.now()+this.CACHE_DURATION,c}catch(e){return this.getFallbackStats()}}async getLegalProfessionalsCount(){try{let t=0,a=0;try{t=(await Ct.from("legal_experts").select("*",{count:"exact",head:!0}).eq("verification_status","verified")).count||0}catch(e){}try{a=(await Ct.from("law_firm_team_members").select("*",{count:"exact",head:!0}).eq("is_active",!0)).count||0}catch(s){}const r=t+a;return r>0?r:500}catch(t){return 500}}async getDocumentsProcessedCount(){return await this.safeQuery(()=>Ct.from("uploaded_documents").select("*",{count:"exact",head:!0}),5e3,"Uploaded documents count")+await this.safeQuery(()=>Ct.from("public_document_analyses").select("*",{count:"exact",head:!0}),5e3,"Public document analyses count")}async getQuestionsAnsweredCount(){try{let e=await Ct.from("legal_questions").select("*",{count:"exact",head:!0}).eq("moderation_status","approved").gt("answer_count",0);return e.error&&(e=await Ct.from("legal_questions").select("*",{count:"exact",head:!0}).gt("answer_count",0)),e.error&&(e=await Ct.from("legal_questions").select("*",{count:"exact",head:!0}).eq("status","answered")),e.count||15e3}catch(e){return 15e3}}async getTemplatesDownloadedCount(){return await this.safeQuery(()=>Ct.from("template_downloads").select("*",{count:"exact",head:!0}),5e3,"Template downloads count")}async getActiveLawFirmsCount(){try{let e=await Ct.from("law_firms").select("*",{count:"exact",head:!0}).eq("verified",!0).eq("is_active",!0);return e.error&&(e=await Ct.from("law_firms").select("*",{count:"exact",head:!0}).eq("verified",!0)),e.count||150}catch(e){return 150}}async getTotalUsersCount(){return await this.safeQuery(()=>Ct.from("profiles").select("*",{count:"exact",head:!0}),25e3,"Total users count")}getFallbackStats(){return{legalProfessionals:500,documentsProcessed:1e4,questionsAnswered:15e3,templatesDownloaded:5e3,activeLawFirms:150,totalUsers:25e3}}async safeQuery(e,s,t){try{const t=await e();return t.error?s:t.count??s}catch(a){return s}}formatStatNumber(e){return e>=1e6?Math.floor(e/1e5)/10+"M+":e>=1e3?Math.floor(e/100)/10+"K+":`${e}+`}clearCache(){this.cache=null,this.cacheExpiry=0}},Or=()=>{const[e,s]=t.useState(""),[r,n]=t.useState({legalProfessionals:500,documentsProcessed:1e4,questionsAnswered:15e3}),[i,l]=t.useState(!0),c=S();t.useEffect(()=>{(async()=>{try{const e=await qr.getStats();n({legalProfessionals:e.legalProfessionals,documentsProcessed:e.documentsProcessed,questionsAnswered:e.questionsAnswered})}catch(e){}finally{l(!1)}})()},[]);return a.jsxs("section",{id:"home",className:"relative bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900 pt-16",children:[a.jsx("div",{className:"absolute inset-0 bg-black opacity-10"}),a.jsx("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 lg:py-32",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[a.jsxs("div",{className:"text-white",children:[a.jsxs("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-6",children:["AI-Powered Legal Solutions for"," ",a.jsx("span",{className:"text-yellow-300 block",children:"Singapore"})]}),a.jsx("p",{className:"text-xl text-blue-100 mb-8 leading-relaxed",children:"Find the right law firm, get instant legal answers, and access legal document analysis - all in one place."}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-8",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx(yr,{type:"text",placeholder:"I need help understanding Singapore's Employment Act...",value:e,onChange:e=>s(e.target.value),className:"pl-10 py-3 text-gray-900 bg-white border-0 focus:ring-2 focus:ring-yellow-400"})]}),a.jsx(fr,{size:"lg",onClick:()=>{e.trim()&&c(`/legal-qa?q=${encodeURIComponent(e)}`)},className:"bg-yellow-500 hover:bg-yellow-600 text-blue-900 font-semibold px-8",children:"Search"})]}),a.jsxs("div",{className:"mb-8",children:[a.jsx("p",{className:"text-sm text-blue-200 mb-2",children:"Popular:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:["Tenant Rights","Company Incorporation","Employment Act","Divorce Proceedings"].map(e=>a.jsx("button",{onClick:()=>s(e),className:"px-3 py-1 bg-blue-700 hover:bg-blue-600 rounded-full text-sm text-blue-100 transition-colors",children:e},e))})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-8",children:[a.jsxs(fr,{size:"lg",onClick:()=>c(Lr.publicAnalysis),className:"bg-yellow-500 hover:bg-yellow-600 text-blue-900 font-semibold",children:[a.jsx(R,{className:"mr-2 h-5 w-5"}),"Free Document Analysis"]}),a.jsxs(fr,{size:"lg",onClick:()=>c("/legal-qa"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:["Ask Legal Question",a.jsx(P,{className:"ml-2 h-5 w-5"})]}),a.jsxs(fr,{size:"lg",variant:"outline",onClick:()=>c("/law-firms"),className:"border-white text-white hover:bg-white hover:text-blue-900",children:["Find Law Firms",a.jsx(D,{className:"ml-2 h-5 w-5"})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-8 pt-8 border-t border-blue-700",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center mb-2",children:a.jsx(D,{className:"h-8 w-8 text-yellow-300"})}),a.jsx("div",{className:"text-2xl font-bold",children:i?a.jsx("div",{className:"animate-pulse bg-blue-600 h-8 w-16 mx-auto rounded"}):qr.formatStatNumber(r.legalProfessionals)}),a.jsx("div",{className:"text-sm text-blue-200",children:"Legal Professionals"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center mb-2",children:a.jsx(T,{className:"h-8 w-8 text-yellow-300"})}),a.jsx("div",{className:"text-2xl font-bold",children:i?a.jsx("div",{className:"animate-pulse bg-blue-600 h-8 w-16 mx-auto rounded"}):qr.formatStatNumber(r.documentsProcessed)}),a.jsx("div",{className:"text-sm text-blue-200",children:"Documents Simplified"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center mb-2",children:a.jsx(P,{className:"h-8 w-8 text-yellow-300"})}),a.jsx("div",{className:"text-2xl font-bold",children:i?a.jsx("div",{className:"animate-pulse bg-blue-600 h-8 w-16 mx-auto rounded"}):qr.formatStatNumber(r.questionsAnswered)}),a.jsx("div",{className:"text-sm text-blue-200",children:"Questions Answered"})]})]})]}),a.jsx("div",{className:"hidden lg:block",children:a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 transform rotate-2 hover:rotate-0 transition-transform duration-300",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"How can I help you today?"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"I need help understanding Singapore's Employment Act..."}),a.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[a.jsx(A,{className:"h-3 w-3 mr-1"}),a.jsx("span",{children:"Popular: Tenant Rights  Company Incorporation"})]})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"The Employment Act is Singapore's main labor law that provides basic terms and working conditions for employees. The Act was last amended in April 2019 to extend coverage to all employees regardless of salary level, with exceptions for public servants, domestic workers, and seafarers. Key provisions include..."}),a.jsx(fr,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Try the AI Legal Assistant "})]})]})]})})})]})})]})},zr=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Wa("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));zr.displayName="Card";const Mr=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Wa("flex flex-col space-y-1.5 p-6",e),...s}));Mr.displayName="CardHeader";const Br=t.forwardRef(({className:e,...s},t)=>a.jsx("h3",{ref:t,className:Wa("text-2xl font-semibold leading-none tracking-tight",e),...s}));Br.displayName="CardTitle";const Vr=t.forwardRef(({className:e,...s},t)=>a.jsx("p",{ref:t,className:Wa("text-sm text-muted-foreground",e),...s}));Vr.displayName="CardDescription";const Wr=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Wa("p-6 pt-0",e),...s}));Wr.displayName="CardContent";const Gr=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Wa("flex items-center p-6 pt-0",e),...s}));Gr.displayName="CardFooter";const Hr=Tt("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Yr({className:e,variant:s,...t}){return a.jsx("div",{className:Wa(Hr({variant:s}),e),...t})}const Qr=()=>{const e=S(),s=[{icon:R,title:"Instant Analysis",description:"Get document insights in seconds with AI-powered analysis"},{icon:U,title:"Secure & Private",description:"Your documents are automatically deleted after 24 hours"},{icon:q,title:"No Registration",description:"Start analyzing immediately without creating an account"},{icon:T,title:"Multiple Formats",description:"Support for PDF, JPEG, PNG, and WebP files up to 10MB"}];return a.jsx("section",{className:"py-20 bg-gradient-to-br from-blue-50 to-indigo-100",children:a.jsxs("div",{className:"container mx-auto px-4",children:[a.jsxs("div",{className:"text-center mb-16",children:[a.jsx(Yr,{className:"mb-4 bg-yellow-100 text-yellow-800 border-yellow-300",children:" Free Tool Available"}),a.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Try Our Free Document Analysis"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-8",children:"Get instant insights from your legal documents with our AI-powered analysis tool. No registration required, completely free to try."}),a.jsxs(fr,{size:"lg",onClick:()=>e(Lr.publicAnalysis),className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 text-lg",children:[a.jsx(R,{className:"mr-2 h-5 w-5"}),"Analyze Document Now",a.jsx(F,{className:"ml-2 h-5 w-5"})]})]}),a.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16",children:s.map(e=>a.jsx(zr,{className:"text-center border-0 shadow-lg hover:shadow-xl transition-shadow",children:a.jsxs(Wr,{className:"p-6",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:a.jsx(e.icon,{className:"h-6 w-6 text-blue-600"})})}),a.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600",children:e.description})]})},e.title))}),a.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center mb-16",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"What You Get with Free Analysis"}),a.jsx("div",{className:"space-y-3",children:["Extract text from PDFs and images","Generate document summaries","Identify key terms and concepts","Basic document classification","No credit card required","Try before you subscribe"].map(e=>a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(L,{className:"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0"}),a.jsx("span",{className:"text-gray-700",children:e})]},e))}),a.jsx("div",{className:"mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx($,{className:"h-5 w-5 text-yellow-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Want More?"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upgrade to get advanced legal insights, unlimited analysis, and permanent storage."}),a.jsx(fr,{variant:"link",className:"p-0 h-auto text-blue-600 hover:text-blue-700",onClick:()=>e(Lr.pricing),children:"View Pricing Plans "})]})]})})]}),a.jsx("div",{className:"relative",children:a.jsx(zr,{className:"shadow-2xl",children:a.jsxs(Wr,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(T,{className:"h-5 w-5 text-blue-600"}),a.jsx("span",{className:"font-medium text-gray-900",children:"Sample Analysis Result"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:"Document Type"}),a.jsx(Yr,{variant:"secondary",children:"Employment Contract"})]}),a.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Key Terms Found"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:["salary","probation","termination","benefits"].map(e=>a.jsx(Yr,{variant:"outline",className:"text-xs",children:e},e))})]}),a.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:"Summary"}),a.jsx("p",{className:"text-xs text-gray-600",children:"This employment contract outlines the terms and conditions of employment including salary, benefits, and termination clauses..."})]})]}),a.jsx(fr,{className:"w-full mt-4 bg-blue-600 hover:bg-blue-700",onClick:()=>e(Lr.publicAnalysis),children:"Try With Your Document"})]})})})]}),a.jsxs("div",{className:"text-center mb-12",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-8",children:"What Users Are Saying"}),a.jsx("div",{className:"grid md:grid-cols-2 gap-6 max-w-4xl mx-auto",children:[{name:"Sarah Chen",role:"Small Business Owner",content:"The free analysis helped me understand my lease agreement before signing. Very helpful!",rating:5},{name:"Michael Tan",role:"Freelancer",content:"Quick and easy way to get insights from legal documents. Saved me time and money.",rating:5}].map(e=>a.jsx(zr,{className:"border-0 shadow-lg",children:a.jsxs(Wr,{className:"p-6",children:[a.jsx("div",{className:"flex justify-center mb-3",children:[...Array(e.rating)].map((e,s)=>a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"},s))}),a.jsxs("p",{className:"text-gray-700 mb-4 italic",children:['"',e.content,'"']}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"font-medium text-gray-900",children:e.name}),a.jsx("div",{className:"text-sm text-gray-600",children:e.role})]})]})},e.name))})]}),a.jsx("div",{className:"text-center",children:a.jsxs("div",{className:"grid grid-cols-3 gap-8 max-w-2xl mx-auto",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:"1,000+"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Documents Analyzed"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:"95%"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Accuracy Rate"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:"30s"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Average Analysis Time"})]})]})})]})})},Jr=[{icon:D,title:"Law Firm Directory",description:"Find the perfect law firm with our comprehensive directory. Filter by practice area, location, and ratings.",features:["Advanced Search Filters","Verified Reviews & Ratings","Direct Contact Information","Specialization Matching"],action:"Browse Directory",link:"/law-firms"},{icon:T,title:"Legal Document Analysis",description:"Upload your documents for instant AI-powered analysis, summary, and interpretation.",features:["AI Document Summary","Legal Risk Assessment","Key Terms Extraction","Compliance Checking"],action:"Analyze Documents",link:"/dashboard/documents"},{icon:P,title:"Legal Q&A",description:"Get instant answers to your legal questions from our AI assistant trained on Singapore law.",features:["24/7 AI Legal Assistant","Singapore Law Expertise","Case Law References","Personalized Advice"],action:"Ask a Question",link:"/dashboard/ai-assistant"},{icon:O,title:"Document Templates",description:"Access a library of legal document templates specific to Singapore's legal system.",features:["Singapore-Specific Templates","Customizable Forms","Legal Compliance Validation","Instant Download"],action:"Browse Templates",link:"/dashboard/templates"},{icon:A,title:"Case Summaries",description:"Explore our database of court case summaries, without lengthy and easy to understand.",features:["Simplified Case Summaries","Search by Legal Topic","Recent Court Decisions","Legal Precedents"],action:"Explore Cases",link:"/case-summaries"},{icon:z,title:"Singapore-Specific Resources",description:"All resources are tailored specifically to Singapore's legal system and requirements.",features:["Local Legal Updates","Regulatory Changes","Government Resources","Legal Glossary"],action:"Learn More",link:"/resources"}],Kr=()=>{const e=S();return a.jsx("section",{id:"features",className:"py-20 bg-gray-50",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-16",children:[a.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Everything You Need In One Place"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"LegalHelpSG combines AI technology with comprehensive legal resources to give you the most efficient legal help experience."})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:Jr.map(s=>a.jsxs(zr,{className:"group hover:shadow-xl transition-all duration-300 hover:-translate-y-2",children:[a.jsxs(Mr,{children:[a.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-blue-100 rounded-lg mb-4 group-hover:bg-blue-600 transition-colors",children:a.jsx(s.icon,{className:"h-6 w-6 text-blue-600 group-hover:text-white transition-colors"})}),a.jsx(Br,{className:"text-xl font-bold text-gray-900 group-hover:text-blue-600 transition-colors",children:s.title}),a.jsx(Vr,{className:"text-gray-600",children:s.description})]}),a.jsxs(Wr,{children:[a.jsx("ul",{className:"space-y-2 mb-6",children:s.features.map(e=>a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("div",{className:"h-1.5 w-1.5 bg-blue-600 rounded-full mr-3"}),e]},e))}),a.jsx(fr,{variant:"outline",className:"w-full group-hover:bg-blue-600 group-hover:text-white group-hover:border-blue-600 transition-colors",onClick:()=>e(s.link),children:s.action})]})]},s.title))}),a.jsx("div",{className:"text-center mt-12",children:a.jsx(fr,{size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:"Get Started"})})]})})},Xr=[{step:"Step 1",icon:A,title:"Identify Your Legal Need",description:"Browse our legal topics, use our search function, or start with a question to identify your specific legal need.",features:["Search by legal topic or question","Browse categories and case types","Get instant topic suggestions","Access legal glossary"],color:"blue"},{step:"Step 2",icon:M,title:"Access Resources or Find Experts",description:"Use our AI-powered tools to get information, download templates, or find the right legal professional.",features:["AI legal assistant for instant answers","Download customizable legal templates","Find qualified lawyers by specialty","Access case summaries and precedents"],color:"green"},{step:"Step 3",icon:L,title:"Take Informed Action",description:"With clear information and the right resources, you can make confident decisions about your legal matters.",features:["Make informed legal decisions","Connect with verified professionals","Download completed documents","Track your legal progress"],color:"purple"}],Zr=()=>a.jsx("section",{id:"how-it-works",className:"py-20 bg-white",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-16",children:[a.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-4",children:"How It Works"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"LegalLinkSG makes accessing legal information and services easy for everyone"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12",children:Xr.map((e,s)=>a.jsxs("div",{className:"relative",children:[a.jsxs(zr,{className:"h-full hover:shadow-lg transition-shadow duration-300",children:[a.jsxs(Mr,{className:"text-center",children:[a.jsx("div",{className:`flex items-center justify-center w-16 h-16 bg-${e.color}-100 rounded-full mx-auto mb-4`,children:a.jsx(e.icon,{className:`h-8 w-8 text-${e.color}-600`})}),a.jsx("div",{className:`text-sm font-semibold text-${e.color}-600 mb-2`,children:e.step}),a.jsx(Br,{className:"text-xl font-bold text-gray-900",children:e.title}),a.jsx(Vr,{className:"text-gray-600",children:e.description})]}),a.jsx(Wr,{children:a.jsx("ul",{className:"space-y-2",children:e.features.map(s=>a.jsxs("li",{className:"flex items-start text-sm text-gray-700",children:[a.jsx("div",{className:`h-1.5 w-1.5 bg-${e.color}-600 rounded-full mt-2 mr-3 flex-shrink-0`}),s]},s))})})]}),s<Xr.length-1&&a.jsx("div",{className:"hidden md:block absolute top-1/2 -right-4 transform -translate-y-1/2 z-10",children:a.jsx(F,{className:"h-8 w-8 text-gray-400"})})]},e.title))}),a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Ready to get started?"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"Join thousands of Singaporeans who are already using LegalLinkSG to navigate their legal matters."}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[a.jsx(fr,{size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:"Get Started Free"}),a.jsx(fr,{size:"lg",variant:"outline",children:"Browse Law Firms"})]})]})]})}),en=()=>a.jsx("section",{id:"about",className:"py-20 bg-white",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-6",children:"Trusted Legal Partners Since 1998"}),a.jsx("p",{className:"text-lg text-gray-600 mb-8 leading-relaxed",children:"LawMatters has been Singapore's premier legal firm for over two decades. We've built our reputation on delivering exceptional legal services with integrity, expertise, and unwavering commitment to our clients' success."}),a.jsxs("div",{className:"space-y-4 mb-8",children:[a.jsxs("div",{className:"flex items-start",children:[a.jsx(L,{className:"h-6 w-6 text-green-500 mt-1 mr-3 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:"Client-Focused Approach"}),a.jsx("p",{className:"text-gray-600",children:"We prioritize understanding your unique needs and objectives."})]})]}),a.jsxs("div",{className:"flex items-start",children:[a.jsx(L,{className:"h-6 w-6 text-green-500 mt-1 mr-3 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:"Proven Track Record"}),a.jsx("p",{className:"text-gray-600",children:"Over 500 successful cases with a 95% client satisfaction rate."})]})]}),a.jsxs("div",{className:"flex items-start",children:[a.jsx(L,{className:"h-6 w-6 text-green-500 mt-1 mr-3 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:"Expert Legal Team"}),a.jsx("p",{className:"text-gray-600",children:"Qualified lawyers with specialized expertise across multiple practice areas."})]})]})]}),a.jsx(fr,{size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:"Meet Our Team"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg text-center",children:[a.jsx(B,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"25+"}),a.jsx("p",{className:"text-gray-600",children:"Years of Excellence"})]}),a.jsxs("div",{className:"bg-green-50 p-6 rounded-lg text-center",children:[a.jsx(M,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"1000+"}),a.jsx("p",{className:"text-gray-600",children:"Satisfied Clients"})]}),a.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg text-center",children:[a.jsx(L,{className:"h-12 w-12 text-purple-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"500+"}),a.jsx("p",{className:"text-gray-600",children:"Cases Won"})]}),a.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg text-center",children:[a.jsx(q,{className:"h-12 w-12 text-orange-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"24/7"}),a.jsx("p",{className:"text-gray-600",children:"Client Support"})]})]})]})})}),sn=[{name:"Sarah Chen",role:"CEO, TechStart Singapore",content:"LawMatters provided exceptional guidance during our company's acquisition. Their expertise in corporate law and attention to detail made the complex process seamless.",rating:5,image:"/placeholder.svg"},{name:"Michael Tan",role:"Property Developer",content:"The real estate legal team at LawMatters helped us navigate multiple property transactions with professionalism and efficiency. Highly recommended!",rating:5,image:"/placeholder.svg"},{name:"Lisa Wong",role:"Small Business Owner",content:"When I needed employment law advice, LawMatters provided clear, actionable guidance that protected my business. Their team is knowledgeable and responsive.",rating:5,image:"/placeholder.svg"}],tn=()=>a.jsx("section",{id:"testimonials",className:"py-20 bg-gray-50",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-16",children:[a.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-4",children:"What Our Clients Say"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Don't just take our word for it. Here's what our satisfied clients have to say about our legal services and expertise."})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:sn.map((e,s)=>a.jsx(zr,{className:"hover:shadow-lg transition-shadow duration-300",children:a.jsxs(Wr,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(V,{className:"h-8 w-8 text-blue-600 opacity-50"}),a.jsx("div",{className:"flex ml-auto",children:[...Array(e.rating)].map((e,s)=>a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"},s))})]}),a.jsxs("p",{className:"text-gray-700 mb-6 leading-relaxed",children:['"',e.content,'"']}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white font-bold mr-4",children:e.name.charAt(0)}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-900",children:e.name}),a.jsx("p",{className:"text-sm text-gray-600",children:e.role})]})]})]})},s))}),a.jsxs("div",{className:"text-center mt-12",children:[a.jsx("p",{className:"text-gray-600 mb-4",children:"Join hundreds of satisfied clients"}),a.jsxs("div",{className:"flex justify-center items-center space-x-1",children:[[...Array(5)].map((e,s)=>a.jsx($,{className:"h-6 w-6 text-yellow-400 fill-current"},s)),a.jsx("span",{className:"ml-2 text-gray-900 font-semibold",children:"4.9/5 Client Rating"})]})]})]})}),an=t.forwardRef(({className:e,...s},t)=>a.jsx("textarea",{className:Wa("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:t,...s}));an.displayName="Textarea";const rn=()=>{const[e,s]=t.useState({name:"",email:"",phone:"",subject:"",message:""}),{toast:r}=Xt(),n=e=>{s(s=>({...s,[e.target.name]:e.target.value}))};return a.jsx("section",{id:"contact",className:"py-20 bg-white",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-16",children:[a.jsx("h2",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Get In Touch"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Ready to discuss your legal needs? Contact us today for a free consultation and let us help you navigate your legal challenges."})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Send Us a Message"})}),a.jsx(Wr,{children:a.jsxs("form",{onSubmit:e=>{e.preventDefault(),r({title:"Message Sent!",description:"We'll get back to you within 24 hours."}),s({name:"",email:"",phone:"",subject:"",message:""})},className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),a.jsx(yr,{id:"name",name:"name",type:"text",required:!0,value:e.name,onChange:n,placeholder:"Enter your full name"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),a.jsx(yr,{id:"email",name:"email",type:"email",required:!0,value:e.email,onChange:n,placeholder:"Enter your email"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),a.jsx(yr,{id:"phone",name:"phone",type:"tel",value:e.phone,onChange:n,placeholder:"Enter your phone number"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject *"}),a.jsx(yr,{id:"subject",name:"subject",type:"text",required:!0,value:e.subject,onChange:n,placeholder:"Legal matter subject"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Message *"}),a.jsx(an,{id:"message",name:"message",required:!0,value:e.message,onChange:n,placeholder:"Please describe your legal matter...",className:"min-h-[120px]"})]}),a.jsx(fr,{type:"submit",size:"lg",className:"w-full bg-blue-600 hover:bg-blue-700",children:"Send Message"})]})})]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:a.jsx(W,{className:"h-6 w-6 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Phone"}),a.jsx("p",{className:"text-gray-600",children:"+65 6123 4567"}),a.jsx("p",{className:"text-gray-600",children:"+65 6765 4321"})]})]})})}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:a.jsx(G,{className:"h-6 w-6 text-green-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Email"}),a.jsx("p",{className:"text-gray-600",children:"info@lawmatters.sg"}),a.jsx("p",{className:"text-gray-600",children:"consultation@lawmatters.sg"})]})]})})}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:a.jsx(H,{className:"h-6 w-6 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Address"}),a.jsxs("p",{className:"text-gray-600",children:["123 Raffles Place",a.jsx("br",{}),"#45-67 Tower One",a.jsx("br",{}),"Singapore 048624"]})]})]})})}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:a.jsx(q,{className:"h-6 w-6 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Office Hours"}),a.jsxs("p",{className:"text-gray-600",children:["Mon - Fri: 9:00 AM - 6:00 PM",a.jsx("br",{}),"Sat: 9:00 AM - 1:00 PM",a.jsx("br",{}),"Sun: Closed"]})]})]})})})]})]})]})})},nn=()=>a.jsx("footer",{className:"bg-gray-900 text-white",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[a.jsxs("div",{className:"lg:col-span-1",children:[a.jsx("h3",{className:"text-2xl font-bold mb-4",children:"LawMatters"}),a.jsx("p",{className:"text-gray-300 mb-6",children:"Singapore's trusted legal partner for over 25 years. We provide expert legal solutions with integrity and excellence."}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsx("a",{href:"#",className:"text-gray-300 hover:text-blue-400 transition-colors",children:a.jsx(Y,{className:"h-6 w-6"})}),a.jsx("a",{href:"#",className:"text-gray-300 hover:text-blue-400 transition-colors",children:a.jsx(Q,{className:"h-6 w-6"})}),a.jsx("a",{href:"#",className:"text-gray-300 hover:text-blue-400 transition-colors",children:a.jsx(J,{className:"h-6 w-6"})})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Practice Areas"}),a.jsxs("ul",{className:"space-y-2 text-gray-300",children:[a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Corporate Law"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Employment Law"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Real Estate Law"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Family Law"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Criminal Defense"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Commercial Litigation"})})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),a.jsxs("ul",{className:"space-y-2 text-gray-300",children:[a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"About Us"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Our Team"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Case Studies"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Legal Resources"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Privacy Policy"})}),a.jsx("li",{children:a.jsx("a",{href:"#",className:"hover:text-blue-400 transition-colors",children:"Terms of Service"})})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Contact Info"}),a.jsxs("div",{className:"space-y-3 text-gray-300",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(W,{className:"h-5 w-5 mr-3 text-blue-400"}),a.jsx("span",{children:"+65 6123 4567"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(G,{className:"h-5 w-5 mr-3 text-blue-400"}),a.jsx("span",{children:"info@lawmatters.sg"})]}),a.jsxs("div",{className:"flex items-start",children:[a.jsx(H,{className:"h-5 w-5 mr-3 mt-1 text-blue-400"}),a.jsxs("span",{children:["123 Raffles Place",a.jsx("br",{}),"#45-67 Tower One",a.jsx("br",{}),"Singapore 048624"]})]})]})]})]}),a.jsx("div",{className:"border-t border-gray-700 mt-8 pt-8 text-center text-gray-300",children:a.jsx("p",{children:" 2024 LawMatters Singapore. All rights reserved."})})]})}),ln=()=>{const{user:e,profile:s,session:t,loading:r,signOut:n}=xr(),i=async()=>{try{await Ct.auth.signOut(),window.location.reload()}catch(e){}};return a.jsxs(zr,{className:"fixed bottom-4 right-4 w-80 z-50 bg-white border-2 border-blue-500",children:[a.jsx(Mr,{children:a.jsx(Br,{className:"text-sm",children:"Auth Debug Info"})}),a.jsxs(Wr,{className:"text-xs space-y-2",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Loading:"})," ",r?"true":"false"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"User:"})," ",e?e.email:"null"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Session:"})," ",t?"exists":"null"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Profile:"})," ",s?`${s.first_name} ${s.last_name}`:"null"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"User ID:"})," ",e?.id||"null"]}),a.jsxs("div",{className:"mt-2 space-x-2",children:[a.jsx(fr,{onClick:i,size:"sm",variant:"outline",children:"Clear Session"}),e&&a.jsx(fr,{onClick:async()=>{try{await n()}catch(e){await i()}},size:"sm",variant:"outline",children:"Sign Out"})]})]})]})},cn=Tt("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),on=t.forwardRef(({className:e,variant:s,...t},r)=>a.jsx("div",{ref:r,role:"alert",className:Wa(cn({variant:s}),e),...t}));on.displayName="Alert";t.forwardRef(({className:e,...s},t)=>a.jsx("h5",{ref:t,className:Wa("mb-1 font-medium leading-none tracking-tight",e),...s})).displayName="AlertTitle";const dn=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Wa("text-sm [&_p]:leading-relaxed",e),...s}));dn.displayName="AlertDescription";class mn extends K.Component{constructor(e){super(e),s(this,"maxRetries",3),s(this,"resetError",()=>{this.state.retryCount<this.maxRetries?this.setState({hasError:!1,error:void 0,errorInfo:void 0,retryCount:this.state.retryCount+1}):window.location.href="/"}),s(this,"getErrorMessage",()=>{const{error:e}=this.state,{level:s}=this.props;return"auth"===s&&e?.message?.includes("useAuth")?{title:"Authentication Service Unavailable",description:"The authentication system is temporarily unavailable. You can still browse the site as a guest.",suggestion:"Try refreshing the page or continue without signing in."}:e?.message?.includes("createContext")?{title:"Component Loading Error",description:"A component failed to load properly. This might be a temporary issue.",suggestion:"Please try refreshing the page."}:{title:"Something went wrong",description:"We encountered an unexpected error. Please try refreshing the page or go back to the homepage.",suggestion:"If the problem persists, please contact support."}}),this.state={hasError:!1,retryCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e,retryCount:0}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s}),this.props.onError&&this.props.onError(e,s);try{"undefined"!=typeof window&&window.__errorTracker&&window.__errorTracker.logError({type:"error",message:`React Error Boundary (${this.props.level||"unknown"}): ${e.message}`,stack:e.stack,componentStack:s.componentStack,level:this.props.level||"component"})}catch(t){}}render(){if(this.state.hasError){const e=this.getErrorMessage();if(this.props.fallback){const e=this.props.fallback;return a.jsx(e,{error:this.state.error||new Error("Unknown error"),resetError:this.resetError})}return"component"===this.props.level?a.jsxs(on,{className:"my-4",children:[a.jsx(X,{className:"h-4 w-4"}),a.jsxs(dn,{children:[e.description,a.jsxs(fr,{onClick:this.resetError,variant:"outline",size:"sm",className:"ml-2",disabled:this.state.retryCount>=this.maxRetries,children:[a.jsx(Z,{className:"h-3 w-3 mr-1"}),this.state.retryCount>=this.maxRetries?"Max retries reached":"Retry"]})]})]}):"auth"===this.props.level?a.jsx("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 my-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(U,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),a.jsxs("div",{className:"ml-3 flex-1",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:e.title}),a.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:e.description}),a.jsxs("div",{className:"mt-3 flex space-x-2",children:[a.jsxs(fr,{onClick:this.resetError,variant:"outline",size:"sm",disabled:this.state.retryCount>=this.maxRetries,children:[a.jsx(Z,{className:"h-3 w-3 mr-1"}),this.state.retryCount>=this.maxRetries?"Max retries":"Retry"]}),a.jsx(fr,{onClick:()=>window.location.reload(),variant:"outline",size:"sm",children:"Continue as Guest"})]})]})]})}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"text-center",children:[a.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:a.jsx(X,{className:"h-6 w-6 text-red-600"})}),a.jsx(Br,{className:"text-xl font-semibold text-gray-900",children:e.title}),a.jsx(Vr,{className:"text-gray-600",children:e.description})]}),a.jsxs(Wr,{className:"space-y-4",children:[!!this.props.showDetails&&this.state.error&&a.jsxs("div",{className:"rounded-md bg-red-50 p-4",children:[a.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"Error Details:"}),a.jsx("p",{className:"text-xs text-red-700 font-mono break-all",children:this.state.error.message}),this.state.error.stack&&a.jsxs("details",{className:"mt-2",children:[a.jsx("summary",{className:"text-xs text-red-700 cursor-pointer",children:"Stack Trace"}),a.jsx("pre",{className:"text-xs text-red-700 mt-1 whitespace-pre-wrap break-all",children:this.state.error.stack})]})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs(fr,{onClick:this.resetError,className:"flex-1",variant:"outline",disabled:this.state.retryCount>=this.maxRetries,children:[a.jsx(Z,{className:"h-4 w-4 mr-2"}),this.state.retryCount>=this.maxRetries?"Max Retries":`Try Again (${this.maxRetries-this.state.retryCount} left)`]}),a.jsxs(fr,{onClick:()=>window.location.href="/",className:"flex-1",children:[a.jsx(ee,{className:"h-4 w-4 mr-2"}),"Go Home"]})]}),a.jsx("p",{className:"text-xs text-gray-500 text-center",children:e.suggestion})]})]})})}return this.props.children}}const un=({children:e})=>a.jsx(mn,{level:"auth",onError:(e,s)=>{e.message.includes("useAuth must be used within an AuthProvider")},children:e}),hn=()=>{const{user:e,loading:s}=xr();return a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsx(Or,{}),a.jsx(Qr,{}),a.jsx(Kr,{}),a.jsx(Zr,{}),a.jsx(en,{}),a.jsx(tn,{}),a.jsx(rn,{}),a.jsx(nn,{}),a.jsx(un,{children:a.jsx(ln,{})})]})},xn=t.forwardRef(({className:e,...s},t)=>a.jsx(se,{className:Wa("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...s,ref:t,children:a.jsx(te,{className:Wa("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));xn.displayName=se.displayName;const pn=()=>{const[e,s]=t.useState(!1),{user:r}=hr(),n=S(),i=s=>{if(null===s.price)return"Custom";if(0===s.price)return"Free";return`$${e?10*s.price:s.price}`},l=s=>null===s.price||0===s.price?"":e?"/year":"/month",c=[{key:"free",...Ir.free,icon:$,color:"text-gray-600",bgColor:"bg-gray-50",borderColor:"border-gray-200"},{key:"premium",...Ir.premium,icon:R,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",popular:!0},{key:"pro",...Ir.pro,icon:re,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200"},{key:"enterprise",...Ir.enterprise,icon:D,color:"text-gray-800",bgColor:"bg-gray-100",borderColor:"border-gray-300"}];return a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsx("section",{className:"py-20 bg-gradient-to-br from-blue-50 to-indigo-100",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[a.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Simple, Transparent Pricing"}),a.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:"Choose the plan that works best for your legal needs, with no hidden fees or long-term commitments."}),a.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-12",children:[a.jsx("span",{className:"text-sm font-medium "+(e?"text-gray-500":"text-gray-900"),children:"Monthly"}),a.jsx(xn,{checked:e,onCheckedChange:s,className:"data-[state=checked]:bg-blue-600"}),a.jsx("span",{className:"text-sm font-medium "+(e?"text-gray-900":"text-gray-500"),children:"Annual"}),a.jsx(Yr,{variant:"secondary",className:"ml-2 bg-green-100 text-green-800",children:"Save 20%"})]})]})}),a.jsx("section",{className:"py-20 -mt-10",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:c.map(s=>{const t=s.icon,c=(s=>null===s.price||0===s.price?null:e?"Save 20%":null)(s);return a.jsxs(zr,{className:`relative ${s.borderColor} ${s.popular?"ring-2 ring-blue-500 shadow-xl scale-105":"shadow-lg"} transition-all duration-300 hover:shadow-xl hover:-translate-y-1`,children:[s.popular&&a.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:a.jsx(Yr,{className:"bg-blue-600 text-white px-4 py-1",children:"Most Popular"})}),a.jsxs(Mr,{className:`text-center ${s.bgColor} rounded-t-lg`,children:[a.jsx("div",{className:`inline-flex items-center justify-center w-12 h-12 ${s.color} mb-4 mx-auto`,children:a.jsx(t,{className:"h-8 w-8"})}),a.jsx(Br,{className:"text-2xl font-bold text-gray-900",children:s.name}),a.jsxs("div",{className:"mt-4",children:[a.jsx("span",{className:"text-4xl font-bold text-gray-900",children:i(s)}),a.jsx("span",{className:"text-gray-600 ml-1",children:l(s)}),c&&a.jsx("div",{className:"mt-1",children:a.jsx(Yr,{variant:"secondary",className:"bg-green-100 text-green-800 text-xs",children:c})})]})]}),a.jsxs(Wr,{className:"p-6",children:[a.jsx("ul",{className:"space-y-3 mb-8",children:s.features.map((e,s)=>a.jsxs("li",{className:"flex items-start",children:[a.jsx(ae,{className:"h-5 w-5 text-green-500 mr-3 mt-0.5 flex-shrink-0"}),a.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))}),a.jsx(fr,{onClick:()=>(s=>{r?"free"!==s?"enterprise"!==s?n(`/subscribe/${s}${e?"?billing=yearly":""}`):window.location.href="mailto:sales@lawmatterssg.com?subject=Enterprise Plan Inquiry":n("/dashboard"):n("/auth/login")})(s.key),className:"w-full "+(s.popular?"bg-blue-600 hover:bg-blue-700 text-white":"free"===s.key?"bg-gray-100 hover:bg-gray-200 text-gray-900":"bg-gray-900 hover:bg-gray-800 text-white"),size:"lg",children:"free"===s.key?"Sign Up Free":"enterprise"===s.key?"Contact Sales":r?"Subscribe Now":"Get Started"})]})]},s.key)})})})}),a.jsx("section",{className:"py-20 bg-gray-50",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-16",children:[a.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Compare All Features"}),a.jsx("p",{className:"text-lg text-gray-600",children:"See exactly what's included in each plan"})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full bg-white rounded-lg shadow-lg",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-gray-200",children:[a.jsx("th",{className:"text-left py-4 px-6 font-semibold text-gray-900",children:"Features"}),a.jsx("th",{className:"text-center py-4 px-6 font-semibold text-gray-900",children:"Free"}),a.jsx("th",{className:"text-center py-4 px-6 font-semibold text-blue-600",children:"Premium"}),a.jsx("th",{className:"text-center py-4 px-6 font-semibold text-purple-600",children:"Pro"}),a.jsx("th",{className:"text-center py-4 px-6 font-semibold text-gray-900",children:"Enterprise"})]})}),a.jsxs("tbody",{className:"divide-y divide-gray-200",children:[a.jsxs("tr",{children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"AI Queries"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-600",children:"10/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-blue-600",children:"50/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-purple-600",children:"500/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-900",children:"Unlimited"})]}),a.jsxs("tr",{className:"bg-gray-50",children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"Document Downloads"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-600",children:"1/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-blue-600",children:"10/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-purple-600",children:"20/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-900",children:"Unlimited"})]}),a.jsxs("tr",{children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"Custom Legal Document Downloads"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-blue-600",children:"3/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-purple-600",children:"20/month"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-900",children:"Unlimited"})]}),a.jsxs("tr",{className:"bg-gray-50",children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"Premium Templates"}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""})]}),a.jsxs("tr",{children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"Document Analysis"}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""})]}),a.jsxs("tr",{className:"bg-gray-50",children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"API Access"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""})]}),a.jsxs("tr",{children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"Priority Support"}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""})]}),a.jsxs("tr",{className:"bg-gray-50",children:[a.jsx("td",{className:"py-4 px-6 font-medium text-gray-900",children:"Dedicated Account Manager"}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-gray-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""}),a.jsx("td",{className:"py-4 px-6 text-center text-green-600",children:""})]})]})]})})]})}),a.jsx("section",{className:"py-20",children:a.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsx("div",{className:"text-center mb-16",children:a.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Frequently Asked Questions"})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Can I change plans later?"}),a.jsx("p",{className:"text-gray-600",children:"Yes, you can upgrade, downgrade, or cancel your plan at any time. Changes to your subscription take effect immediately."})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"How do the monthly limits work?"}),a.jsx("p",{className:"text-gray-600",children:"Usage limits reset on the first day of each billing cycle. Unused queries or downloads don't roll over to the next month."})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Is my payment information secure?"}),a.jsx("p",{className:"text-gray-600",children:"Yes, we use Stripe for all payment processing. Your payment information is never stored on our servers and is protected by bank-level security."})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"What's your refund policy?"}),a.jsx("p",{className:"text-gray-600",children:"If you're not satisfied, contact us within 14 days of your purchase for a full refund. No questions asked."})]})]})]})}),a.jsx(nn,{})]})},gn=({lawFirms:e,selectedFirm:s,onFirmSelect:r,className:n=""})=>{const[i,l]=t.useState(!1),[c,o]=t.useState({lat:1.3521,lng:103.8198}),[d,m]=t.useState(null);t.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const{latitude:s,longitude:t}=e.coords;m({lat:s,lng:t}),o({lat:s,lng:t})},e=>{})},[]);return a.jsx("div",{className:`${n} ${i?"fixed inset-0 z-50 bg-white":""}`,children:a.jsxs(zr,{className:"h-full "+(i?"rounded-none border-0":""),children:[a.jsx(Mr,{className:"pb-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Br,{className:"text-lg font-semibold",children:"Law Firms Near You"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[d&&a.jsxs(Yr,{variant:"outline",className:"text-xs",children:[a.jsx(ne,{className:"h-3 w-3 mr-1"}),"Location enabled"]}),a.jsx(fr,{size:"sm",variant:"outline",onClick:()=>l(!i),children:i?a.jsx(ie,{className:"h-4 w-4"}):a.jsx(le,{className:"h-4 w-4"})})]})]})}),a.jsxs(Wr,{className:"p-0 flex-1",children:[a.jsx("div",{className:(i?"h-screen":"h-96")+" relative",children:a.jsxs("div",{className:"relative w-full h-full bg-gray-100 rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50 to-green-50",children:[a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(H,{className:"h-16 w-16 text-blue-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Interactive Map"}),a.jsxs("p",{className:"text-gray-500 text-sm",children:[e.length," law firms in Singapore"]})]})}),e.map((e,t)=>a.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 cursor-pointer transition-all duration-200 "+(s?.id===e.id?"scale-125 z-20":"hover:scale-110 z-10"),style:{left:20+15*t%60+"%",top:30+10*t%40+"%"},onClick:()=>r(e),children:a.jsxs("div",{className:"relative "+(s?.id===e.id?"text-red-600":"text-blue-600 hover:text-red-600"),children:[a.jsx(H,{className:"h-8 w-8 fill-current"}),a.jsx("div",{className:"absolute -top-1 left-1/2 transform -translate-x-1/2 bg-white text-xs font-bold rounded-full w-4 h-4 flex items-center justify-center border-2 border-current",children:e.id})]})},e.id)),d&&a.jsx("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 z-30",style:{left:"50%",top:"50%"},children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full border-2 border-white shadow-lg"}),a.jsx("div",{className:"absolute inset-0 w-4 h-4 bg-blue-500 rounded-full animate-ping opacity-75"})]})})]}),a.jsxs("div",{className:"absolute top-4 right-4 flex flex-col space-y-2",children:[a.jsx(fr,{size:"sm",variant:"outline",className:"bg-white/90 backdrop-blur-sm",onClick:()=>l(!i),children:i?a.jsx(ie,{className:"h-4 w-4"}):a.jsx(le,{className:"h-4 w-4"})}),d&&a.jsx(fr,{size:"sm",variant:"outline",className:"bg-white/90 backdrop-blur-sm",onClick:()=>o(d),children:a.jsx(ne,{className:"h-4 w-4"})})]})]})}),s&&a.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[a.jsxs("div",{className:"flex items-start justify-between mb-3",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"}),a.jsx("span",{className:"text-sm font-medium",children:s.rating}),a.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.reviews,")"]})]})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.specialties.slice(0,3).map(e=>a.jsx(Yr,{variant:"secondary",className:"text-xs",children:e},e))}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(H,{className:"h-4 w-4"}),a.jsx("span",{children:s.location})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(M,{className:"h-4 w-4"}),a.jsxs("span",{children:[s.lawyers," Lawyers"]})]}),d&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ne,{className:"h-4 w-4"}),a.jsx("span",{children:(e=>{if(!d)return"";return`${((e,s,t,a)=>{const r=(t-e)*Math.PI/180,n=(a-s)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371})(d.lat,d.lng,e.coordinates.lat,e.coordinates.lng).toFixed(1)} km away`})(s)})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(q,{className:"h-4 w-4"}),a.jsxs("span",{children:["Est. ",s.established]})]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(fr,{size:"sm",className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"View Profile"}),a.jsx(fr,{size:"sm",variant:"outline",className:"flex-1",children:"Get Directions"})]})]})]})]})})},fn=()=>{const[e,s]=t.useState(""),[r,n]=t.useState(""),[i,l]=t.useState(""),[c,o]=t.useState(null),[d,m]=t.useState("list"),u=[{id:1,name:"Singapore Legal Associates",description:"Full-service law firm specializing in corporate and commercial law",specialties:["Corporate Law","Commercial Litigation","M&A"],location:"Central Business District",address:"1 Raffles Place, #40-01, One Raffles Place, Singapore 048616",coordinates:{lat:1.2844,lng:103.851},rating:4.8,reviews:124,phone:"+65 6234 5678",email:"contact@sla.com.sg",lawyers:15,established:"1995"},{id:2,name:"Family Law Partners",description:"Dedicated family law practice with compassionate approach",specialties:["Family Law","Divorce","Child Custody"],location:"Orchard",address:"391 Orchard Road, #12-01, Ngee Ann City Tower A, Singapore 238873",coordinates:{lat:1.3048,lng:103.8318},rating:4.9,reviews:89,phone:"+65 6345 6789",email:"info@flp.com.sg",lawyers:8,established:"2001"},{id:3,name:"Employment Rights Advocates",description:"Protecting employee and employer rights across Singapore",specialties:["Employment Law","HR Compliance","Workplace Disputes"],location:"Raffles Place",address:"6 Battery Road, #25-01, Singapore 049909",coordinates:{lat:1.2858,lng:103.8518},rating:4.7,reviews:156,phone:"+65 6456 7890",email:"help@era.com.sg",lawyers:12,established:"2008"}];return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(Sr,{}),a.jsx("section",{className:"bg-blue-900 text-white pt-24 pb-16",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Find Legal Professionals"}),a.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-3xl mx-auto",children:"Search our directory of qualified Singaporean lawyers and law firms. Filter by practice area, location, and ratings."}),a.jsx("div",{className:"max-w-4xl mx-auto",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white p-4 rounded-lg",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx(yr,{type:"text",placeholder:"Search by firm name, lawyer, or legal topic...",value:e,onChange:e=>s(e.target.value),className:"pl-10 border-0 focus:ring-2 focus:ring-blue-500"})]}),a.jsx("select",{value:r,onChange:e=>n(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:["All Locations","Central Business District","Orchard","Raffles Place","Marina Bay"].map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx("select",{value:i,onChange:e=>l(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:["All Specialties","Corporate Law","Family Law","Employment Law","Real Estate Law","Criminal Defense"].map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx(fr,{className:"bg-blue-600 hover:bg-blue-700 px-8",children:"Search"})]})})]})})}),a.jsx("section",{className:"py-16",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-8",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[u.length," Law Firms Found"]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fr,{variant:"list"===d?"default":"outline",size:"sm",onClick:()=>m("list"),className:"flex items-center space-x-2",children:[a.jsx(ce,{className:"h-4 w-4"}),a.jsx("span",{children:"List"})]}),a.jsxs(fr,{variant:"map"===d?"default":"outline",size:"sm",onClick:()=>m("map"),className:"flex items-center space-x-2",children:[a.jsx(oe,{className:"h-4 w-4"}),a.jsx("span",{children:"Map"})]})]}),a.jsxs(fr,{variant:"outline",className:"flex items-center space-x-2",children:[a.jsx(de,{className:"h-4 w-4"}),a.jsx("span",{children:"More Filters"})]})]})]}),"list"===d&&a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:u.map(e=>a.jsxs(zr,{className:"hover:shadow-lg transition-shadow",children:[a.jsxs(Mr,{children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx(Br,{className:"text-xl font-bold text-gray-900 mb-2",children:e.name}),a.jsx(Vr,{className:"text-gray-600 mb-4",children:e.description})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"}),a.jsx("span",{className:"font-semibold",children:e.rating}),a.jsxs("span",{className:"text-gray-500",children:["(",e.reviews,")"]})]})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:e.specialties.map(e=>a.jsx(Yr,{variant:"secondary",children:e},e))})]}),a.jsxs(Wr,{children:[a.jsxs("div",{className:"space-y-3 mb-6",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[a.jsx(H,{className:"h-4 w-4"}),a.jsx("span",{children:e.location})]}),a.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[a.jsx(M,{className:"h-4 w-4"}),a.jsxs("span",{children:[e.lawyers," Lawyers"]})]}),a.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[a.jsx(q,{className:"h-4 w-4"}),a.jsxs("span",{children:["Established ",e.established]})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsx(fr,{className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"View Profile"}),a.jsx(fr,{variant:"outline",className:"flex-1",children:"Contact Firm"})]})]})]},e.id))}),"map"===d&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-1 space-y-4 max-h-[600px] overflow-y-auto",children:u.map(e=>a.jsx(zr,{className:"cursor-pointer transition-all duration-200 "+(c?.id===e.id?"ring-2 ring-blue-500 shadow-lg":"hover:shadow-md"),onClick:()=>o(e),children:a.jsxs(Wr,{className:"p-4",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:e.name}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx($,{className:"h-3 w-3 text-yellow-400 fill-current"}),a.jsx("span",{className:"text-xs font-medium",children:e.rating})]})]}),a.jsx("p",{className:"text-xs text-gray-600 mb-2",children:e.description}),a.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[a.jsx(H,{className:"h-3 w-3"}),a.jsx("span",{children:e.location})]})]})},e.id))}),a.jsx("div",{className:"lg:col-span-2",children:a.jsx(gn,{lawFirms:u,selectedFirm:c,onFirmSelect:o,className:"h-[600px]"})})]}),a.jsx("div",{className:"text-center mt-12",children:a.jsx(fr,{variant:"outline",size:"lg",children:"Load More Results"})})]})}),a.jsx(nn,{})]})},yn=Se,jn=ke,wn=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(me,{ref:r,className:Wa("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[s,a.jsx(ue,{asChild:!0,children:a.jsx(he,{className:"h-4 w-4 opacity-50"})})]}));wn.displayName=me.displayName;const bn=t.forwardRef(({className:e,...s},t)=>a.jsx(xe,{ref:t,className:Wa("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx(pe,{className:"h-4 w-4"})}));bn.displayName=xe.displayName;const vn=t.forwardRef(({className:e,...s},t)=>a.jsx(ge,{ref:t,className:Wa("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx(he,{className:"h-4 w-4"})}));vn.displayName=ge.displayName;const Nn=t.forwardRef(({className:e,children:s,position:t="popper",...r},n)=>a.jsx(fe,{children:a.jsxs(ye,{ref:n,className:Wa("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...r,children:[a.jsx(bn,{}),a.jsx(je,{className:Wa("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),a.jsx(vn,{})]})}));Nn.displayName=ye.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(we,{ref:t,className:Wa("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s})).displayName=we.displayName;const _n=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(be,{ref:r,className:Wa("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(ve,{children:a.jsx(ae,{className:"h-4 w-4"})})}),a.jsx(Ne,{children:s})]}));_n.displayName=be.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(_e,{ref:t,className:Wa("-mx-1 my-1 h-px bg-muted",e),...s})).displayName=_e.displayName;const Sn=t.forwardRef(({className:e,...s},t)=>a.jsx(Ae,{ref:t,className:Wa("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:a.jsx(Ce,{className:Wa("flex items-center justify-center text-current"),children:a.jsx(ae,{className:"h-4 w-4"})})}));Sn.displayName=Ae.displayName;const kn={async getLawFirms(e={}){let s=Ct.from("law_firms").select("*").eq("verified",!0).order("rating",{ascending:!1});e.practiceAreas&&e.practiceAreas.length>0&&(s=s.overlaps("practice_areas",e.practiceAreas)),e.location&&(s=s.ilike("address",`%${e.location}%`)),e.rating&&(s=s.gte("rating",e.rating)),e.search&&(s=s.or(`name.ilike.%${e.search}%,description.ilike.%${e.search}%`));const{data:t,error:a}=await s;if(a)throw new Error("Failed to fetch law firms");return t||[]},async getLawFirm(e){const{data:s,error:t}=await Ct.from("law_firms").select("*").eq("id",e).single();if(t)throw new Error("Failed to fetch law firm");if(!s)throw new Error("Law firm not found");return s},async createLawFirm(e){const{data:s,error:t}=await Ct.from("law_firms").insert({...e,verified:!1}).select().single();if(t)throw new Error("Failed to create law firm");return s},async updateLawFirm(e,s){const{data:t,error:a}=await Ct.from("law_firms").update(s).eq("id",e).select().single();if(a)throw new Error("Failed to update law firm");return t},async verifyLawFirm(e,s=!0){const{data:t,error:a}=await Ct.from("law_firms").update({verified:s}).eq("id",e).select().single();if(a)throw new Error("Failed to verify law firm");return t},async deleteLawFirm(e){const{error:s}=await Ct.from("law_firms").delete().eq("id",e);if(s)throw new Error("Failed to delete law firm")},async getLawFirmReviews(e){const{data:s,error:t}=await Ct.from("law_firm_reviews").select("\n        *,\n        user:profiles(full_name, avatar_url)\n      ").eq("law_firm_id",e).eq("status","approved").order("created_at",{ascending:!1});if(t)throw new Error("Failed to fetch reviews");return s||[]},async createReview(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:t,error:a}=await Ct.from("law_firm_reviews").insert({...e,user_id:s.id,status:"pending"}).select().single();if(a)throw new Error("Failed to create review");return t},async updateReview(e,s){const{data:t,error:a}=await Ct.from("law_firm_reviews").update(s).eq("id",e).select().single();if(a)throw new Error("Failed to update review");return t},async deleteReview(e){const{error:s}=await Ct.from("law_firm_reviews").delete().eq("id",e);if(s)throw new Error("Failed to delete review")},async moderateReview(e,s){const{data:t,error:a}=await Ct.from("law_firm_reviews").update({status:s}).eq("id",e).select().single();if(a)throw new Error("Failed to moderate review");return t},async voteOnReview(e,s){const{data:{user:t}}=await Ct.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:a,error:r}=await Ct.from("law_firm_review_votes").upsert({review_id:e,user_id:t.id,is_helpful:s}).select().single();if(r)throw new Error("Failed to vote on review");return a},async removeVoteOnReview(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User not authenticated");const{error:t}=await Ct.from("law_firm_review_votes").delete().eq("review_id",e).eq("user_id",s.id);if(t)throw new Error("Failed to remove vote")},async getPracticeAreas(){const{data:e,error:s}=await Ct.from("law_firms").select("practice_areas").eq("verified",!0);if(s)throw new Error("Failed to fetch practice areas");const t=e?.flatMap(e=>e.practice_areas)||[];return[...new Set(t)].sort()},async searchLawFirms(e,s={}){return this.getLawFirms({...s,search:e})},async getLawFirmProfile(e){const{data:s,error:t}=await Ct.from("law_firms").select("*").eq("id",e).eq("verified",!0).single();if(t)throw new Error("Failed to fetch law firm profile");const{data:a}=await Ct.from("law_firm_team_members").select("*").eq("law_firm_id",e).eq("is_active",!0).order("order_index"),{data:r}=await Ct.from("law_firm_gallery").select("*").eq("law_firm_id",e).order("order_index"),{data:n}=await Ct.from("law_firm_reviews").select("\n        *,\n        user:profiles(full_name, avatar_url)\n      ").eq("law_firm_id",e).eq("status","approved").order("created_at",{ascending:!1}).limit(5);return{...s,team_members:a||[],gallery:r||[],recent_reviews:n||[]}},async getTeamMembers(e){const{data:s,error:t}=await Ct.from("law_firm_team_members").select("*").eq("law_firm_id",e).eq("is_active",!0).order("order_index");if(t)throw new Error("Failed to fetch team members");return s||[]},async createTeamMember(e){const{data:s,error:t}=await Ct.from("law_firm_team_members").insert(e).select().single();if(t)throw new Error("Failed to create team member");return s},async updateTeamMember(e,s){const{data:t,error:a}=await Ct.from("law_firm_team_members").update(s).eq("id",e).select().single();if(a)throw new Error("Failed to update team member");return t},async deleteTeamMember(e){const{error:s}=await Ct.from("law_firm_team_members").update({is_active:!1}).eq("id",e);if(s)throw new Error("Failed to delete team member")},async getGalleryImages(e){const{data:s,error:t}=await Ct.from("law_firm_gallery").select("*").eq("law_firm_id",e).order("order_index");if(t)throw new Error("Failed to fetch gallery images");return s||[]},async addGalleryImage(e){const{data:s,error:t}=await Ct.from("law_firm_gallery").insert(e).select().single();if(t)throw new Error("Failed to add gallery image");return s},async updateGalleryImage(e,s){const{data:t,error:a}=await Ct.from("law_firm_gallery").update(s).eq("id",e).select().single();if(a)throw new Error("Failed to update gallery image");return t},async deleteGalleryImage(e){const{error:s}=await Ct.from("law_firm_gallery").delete().eq("id",e);if(s)throw new Error("Failed to delete gallery image")},async createBooking(e){const{data:s,error:t}=await Ct.from("law_firm_bookings").insert(e).select("\n        *,\n        user:profiles(full_name, email, phone),\n        team_member:law_firm_team_members(*)\n      ").single();if(t)throw new Error("Failed to create booking");return s},async getUserBookings(e){const{data:s,error:t}=await Ct.from("law_firm_bookings").select("\n        *,\n        law_firm:law_firms(name, phone, email),\n        team_member:law_firm_team_members(name, title, email, phone)\n      ").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw new Error("Failed to fetch user bookings");return s||[]},async getLawFirmBookings(e){const{data:s,error:t}=await Ct.from("law_firm_bookings").select("\n        *,\n        user:profiles(full_name, email, phone),\n        team_member:law_firm_team_members(name, title)\n      ").eq("law_firm_id",e).order("created_at",{ascending:!1});if(t)throw new Error("Failed to fetch law firm bookings");return s||[]},async updateBookingStatus(e,s,t){const a={status:s};t&&(a.notes=t);const{data:r,error:n}=await Ct.from("law_firm_bookings").update(a).eq("id",e).select("\n        *,\n        user:profiles(full_name, email, phone),\n        team_member:law_firm_team_members(name, title)\n      ").single();if(n)throw new Error("Failed to update booking status");return r},async getTopRatedLawFirms(e=10){const{data:s,error:t}=await Ct.from("law_firms").select("*").eq("verified",!0).gte("rating",4).order("rating",{ascending:!1}).limit(e);if(t)throw new Error("Failed to fetch top-rated law firms");return s||[]},async getRecentLawFirms(e=5){const{data:s,error:t}=await Ct.from("law_firms").select("*").eq("verified",!0).order("created_at",{ascending:!1}).limit(e);if(t)throw new Error("Failed to fetch recent law firms");return s||[]}},An=["Corporate Law","Employment Law","Intellectual Property","Real Estate","Family Law","Criminal Law","Immigration Law","Tax Law","Banking & Finance","Litigation","Mergers & Acquisitions","Compliance & Regulatory"],Cn=({onFirmSelect:e,className:s=""})=>{const[r,n]=t.useState([]),[i,l]=t.useState([]),[c,o]=t.useState(!0),[d,m]=t.useState(""),[u,h]=t.useState([]),[x,p]=t.useState(0),[g,f]=t.useState(!1),[y,j]=t.useState("grid"),[w,b]=t.useState("rating"),[v,N]=t.useState(""),[_,S]=t.useState(""),[k,C]=t.useState(""),[E,T]=t.useState(""),[I,D]=t.useState(!1),[P,R]=t.useState(!1);t.useEffect(()=>{F()},[]),t.useEffect(()=>{L()},[r,d,u,x,g,w,v,_,k,E,I]);const F=async()=>{try{o(!0);const e=await kn.getLawFirms();n(e)}catch(e){Pt.error("Failed to load law firms")}finally{o(!1)}},L=()=>{let e=[...r];if(d.trim()){const s=d.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.practice_areas.some(e=>e.toLowerCase().includes(s))||e.address.toLowerCase().includes(s))}if(u.length>0&&(e=e.filter(e=>u.some(s=>e.practice_areas.includes(s)))),x>0&&(e=e.filter(e=>e.rating>=x)),g&&(e=e.filter(e=>e.verified)),v.trim()){const s=v.toLowerCase();e=e.filter(e=>e.address.toLowerCase().includes(s))}_&&(e=e.filter(e=>e.firm_size===_)),k&&(e=e.filter(e=>e.fee_structure===k)),E&&(e=e.filter(e=>e.languages?.includes(E))),I&&(e=e.filter(e=>!0===e.accepts_legal_aid)),e.sort((e,s)=>{switch(w){case"rating":return s.rating-e.rating;case"name":return e.name.localeCompare(s.name);case"newest":return new Date(s.created_at).getTime()-new Date(e.created_at).getTime();case"reviews":return(s.total_reviews||0)-(e.total_reviews||0);default:return 0}}),l(e)},U=e=>Array.from({length:5},(s,t)=>a.jsx($,{className:"h-4 w-4 "+(t<Math.floor(e)?"text-yellow-400 fill-current":"text-gray-300")},t)),q=({firm:s})=>a.jsxs(zr,{className:"h-full hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>e?.(s),children:[a.jsx(Mr,{className:"pb-3",children:a.jsx("div",{className:"flex items-start justify-between",children:a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs(Br,{className:"text-lg font-semibold truncate flex items-center space-x-2",children:[a.jsx("span",{children:s.name}),s.verified&&a.jsx(Te,{className:"h-4 w-4 text-blue-500"})]}),a.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[U(s.rating),a.jsx("span",{className:"text-sm text-gray-600 ml-2",children:s.rating.toFixed(1)})]})]})})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsx(Vr,{className:"line-clamp-2",children:s.description}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[a.jsx(H,{className:"h-4 w-4 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:s.address})]}),a.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[a.jsx(W,{className:"h-4 w-4 flex-shrink-0"}),a.jsx("span",{children:s.phone})]}),a.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[a.jsx(G,{className:"h-4 w-4 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:s.email})]}),s.website&&a.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[a.jsx(Ie,{className:"h-4 w-4 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:s.website})]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"Practice Areas:"}),a.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.practice_areas.slice(0,3).map(e=>a.jsx(Yr,{variant:"secondary",className:"text-xs",children:e},e)),s.practice_areas.length>3&&a.jsxs(Yr,{variant:"secondary",className:"text-xs",children:["+",s.practice_areas.length-3," more"]})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-500",children:[s.firm_size&&a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(M,{className:"h-3 w-3"}),a.jsx("span",{className:"capitalize",children:s.firm_size})]}),s.consultation_fee&&a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(DollarSign,{className:"h-3 w-3"}),a.jsxs("span",{children:["$",s.consultation_fee]})]}),s.accepts_legal_aid&&a.jsx(Yr,{variant:"outline",className:"text-xs",children:"Legal Aid"}),s.total_reviews&&s.total_reviews>0&&a.jsxs("span",{children:["(",s.total_reviews," reviews)"]})]})]})]}),O=({firm:s})=>a.jsx(zr,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>e?.(s),children:a.jsx(Wr,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(M,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("h3",{className:"text-sm font-medium truncate",children:s.name}),s.verified&&a.jsx(Te,{className:"h-4 w-4 text-blue-500"})]}),a.jsx("p",{className:"text-sm text-gray-500 truncate",children:s.description}),a.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-500",children:[a.jsx("span",{children:s.address}),a.jsx("span",{children:s.phone})]})]})]})}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[U(s.rating),a.jsx("span",{className:"text-sm text-gray-600 ml-1",children:s.rating.toFixed(1)})]}),a.jsx("div",{className:"flex flex-wrap gap-1",children:s.practice_areas.slice(0,2).map((e,s)=>a.jsx(Yr,{variant:"outline",className:"text-xs",children:e},s))})]})]})})});return a.jsxs("div",{className:`space-y-6 ${s}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Law Firm Directory"}),a.jsx("p",{className:"text-gray-600",children:"Find and connect with verified legal professionals in Singapore"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(fr,{variant:"grid"===y?"default":"outline",size:"sm",onClick:()=>j("grid"),children:a.jsx(Ee,{className:"h-4 w-4"})}),a.jsx(fr,{variant:"list"===y?"default":"outline",size:"sm",onClick:()=>j("list"),children:a.jsx(ce,{className:"h-4 w-4"})})]})]}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-4",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(yr,{placeholder:"Search law firms...",value:d,onChange:e=>m(e.target.value),className:"pl-10"})]})}),a.jsx("div",{className:"w-full md:w-48",children:a.jsxs(yn,{value:w,onValueChange:e=>b(e),children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Sort by"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"rating",children:"Highest Rated"}),a.jsx(_n,{value:"name",children:"Name A-Z"}),a.jsx(_n,{value:"newest",children:"Newest First"}),a.jsx(_n,{value:"reviews",children:"Most Reviews"})]})]})}),a.jsx(fr,{variant:"outline",onClick:()=>R(!P),className:"w-full md:w-auto",children:"Advanced Filters"})]}),P&&a.jsxs("div",{className:"border-t pt-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Location"}),a.jsx(yr,{placeholder:"Enter location...",value:v,onChange:e=>N(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Firm Size"}),a.jsxs(yn,{value:_,onValueChange:S,children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Any size"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"",children:"Any size"}),a.jsx(_n,{value:"solo",children:"Solo Practice"}),a.jsx(_n,{value:"small",children:"Small (2-10 lawyers)"}),a.jsx(_n,{value:"medium",children:"Medium (11-50 lawyers)"}),a.jsx(_n,{value:"large",children:"Large (50+ lawyers)"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Fee Structure"}),a.jsxs(yn,{value:k,onValueChange:C,children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Any structure"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"",children:"Any structure"}),a.jsx(_n,{value:"hourly",children:"Hourly Rate"}),a.jsx(_n,{value:"fixed",children:"Fixed Fee"}),a.jsx(_n,{value:"contingency",children:"Contingency"}),a.jsx(_n,{value:"mixed",children:"Mixed"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Language"}),a.jsxs(yn,{value:E,onValueChange:T,children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Any language"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"",children:"Any language"}),a.jsx(_n,{value:"English",children:"English"}),a.jsx(_n,{value:"Mandarin",children:"Mandarin"}),a.jsx(_n,{value:"Malay",children:"Malay"}),a.jsx(_n,{value:"Tamil",children:"Tamil"}),a.jsx(_n,{value:"Hindi",children:"Hindi"}),a.jsx(_n,{value:"Japanese",children:"Japanese"}),a.jsx(_n,{value:"Korean",children:"Korean"})]})]})]})]}),a.jsx("div",{className:"flex flex-wrap gap-4",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Sn,{id:"legal-aid",checked:I,onCheckedChange:D}),a.jsx("label",{htmlFor:"legal-aid",className:"text-sm text-gray-700",children:"Accepts Legal Aid"})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Practice Areas"}),a.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1",children:An.map(e=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Sn,{id:e,checked:u.includes(e),onCheckedChange:()=>(e=>{h(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(e)}),a.jsx("label",{htmlFor:e,className:"text-sm text-gray-600",children:e})]},e))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Minimum Rating"}),a.jsxs(yn,{value:x.toString(),onValueChange:e=>p(Number(e)),children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Any rating"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"0",children:"Any rating"}),a.jsx(_n,{value:"3",children:"3+ stars"}),a.jsx(_n,{value:"4",children:"4+ stars"}),a.jsx(_n,{value:"4.5",children:"4.5+ stars"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Other Filters"}),a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Sn,{id:"verified",checked:g,onCheckedChange:f}),a.jsx("label",{htmlFor:"verified",className:"text-sm text-gray-600",children:"Verified firms only"})]})})]})]}),(d||u.length>0||x>0||g||v||_||k||E||I)&&a.jsx("div",{className:"flex justify-end",children:a.jsx(fr,{variant:"outline",size:"sm",onClick:()=>{m(""),h([]),p(0),f(!1),N(""),S(""),C(""),T(""),D(!1)},children:"Clear All Filters"})})]})})}),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center justify-between mb-4",children:a.jsx("p",{className:"text-sm text-gray-600",children:c?"Loading...":`${i.length} law firm${1===i.length?"":"s"} found`})}),c?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,s)=>a.jsxs(zr,{className:"animate-pulse",children:[a.jsxs(Mr,{children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-3 bg-gray-200 rounded"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-5/6"})]})})]},s))}):i.length>0?"grid"===y?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(e=>a.jsx(q,{firm:e},e.id))}):a.jsx("div",{className:"space-y-3",children:i.map(e=>a.jsx(O,{firm:e},e.id))}):a.jsx(zr,{children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx(M,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No law firms found"}),a.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria or browse different practice areas."})]})})]})]})},En=Fe,Tn=t.forwardRef(({className:e,...s},t)=>a.jsx(De,{ref:t,className:Wa("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));Tn.displayName=De.displayName;const In=t.forwardRef(({className:e,...s},t)=>a.jsx(Pe,{ref:t,className:Wa("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));In.displayName=Pe.displayName;const Dn=t.forwardRef(({className:e,...s},t)=>a.jsx(Re,{ref:t,className:Wa("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));Dn.displayName=Re.displayName;const Pn=t.forwardRef(({className:e,...s},t)=>a.jsx(Le,{ref:t,className:Wa("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));Pn.displayName=Le.displayName;const Rn=t.forwardRef(({className:e,...s},t)=>a.jsx($e,{ref:t,className:Wa("aspect-square h-full w-full",e),...s}));Rn.displayName=$e.displayName;const Fn=t.forwardRef(({className:e,...s},t)=>a.jsx(Ue,{ref:t,className:Wa("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));Fn.displayName=Ue.displayName;const Ln=({lawFirmId:e,reviews:s})=>{const{user:r}=hr(),[n,i]=t.useState(s),[l,c]=t.useState(!1),[o,d]=t.useState(!1),m=e=>Array.from({length:5},(s,t)=>a.jsx($,{className:"h-4 w-4 "+(t<Math.floor(e)?"text-yellow-400 fill-current":"text-gray-300")},t));t.useEffect(()=>{i(s)},[s]);const u=(()=>{const e={5:0,4:0,3:0,2:0,1:0};return n.forEach(s=>{e[s.rating]++}),e})(),h=n.length,x=h>0?n.reduce((e,s)=>e+s.rating,0)/h:0;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between",children:[a.jsx(Br,{children:"Client Reviews"}),r&&a.jsxs(fr,{onClick:()=>d(!0),children:[a.jsx(qe,{className:"h-4 w-4 mr-2"}),"Write Review"]})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:x.toFixed(1)}),a.jsx("div",{className:"flex items-center justify-center space-x-1 mb-2",children:m(x)}),a.jsxs("p",{className:"text-gray-600",children:["Based on ",h," review",1!==h?"s":""]})]}),a.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(e=>{const s=u[e],t=h>0?s/h*100:0;return a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-sm w-8",children:e}),a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"}),a.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${t}%`}})}),a.jsx("span",{className:"text-sm text-gray-600 w-8",children:s})]},e)})})]})})]}),a.jsx("div",{className:"space-y-4",children:n.length>0?n.map(s=>{return a.jsx(zr,{children:a.jsx(Wr,{className:"p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(Pn,{children:a.jsx(Fn,{children:s.user?(t=s.user.full_name,t.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)):"U"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:s.user?.full_name||"Anonymous"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"flex items-center space-x-1",children:m(s.rating)}),a.jsx("span",{className:"text-sm text-gray-500",children:$t(new Date(s.created_at),{addSuffix:!0})}),s.verified_client&&a.jsx(Yr,{variant:"outline",className:"text-xs",children:"Verified Client"})]})]})}),a.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:s.title}),a.jsx("p",{className:"text-gray-700 mb-3",children:s.content}),a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs(fr,{variant:"ghost",size:"sm",className:"text-gray-500",onClick:()=>(async(s,t)=>{if(r)try{await kn.voteOnReview(s,t);const a=await kn.getLawFirmReviews(e);i(a),Pt.success("Thank you for your feedback!")}catch(a){Pt.error("Failed to submit vote")}else Pt.error("Please log in to vote on reviews")})(s.id,!0),disabled:!r,children:[a.jsx(Oe,{className:"h-4 w-4 mr-1"}),"Helpful (",s.helpful_count,")"]})})]})]})})},s.id);var t}):a.jsx(zr,{children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx(P,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No reviews yet"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"Be the first to review this law firm."}),r&&a.jsxs(fr,{onClick:()=>d(!0),children:[a.jsx(qe,{className:"h-4 w-4 mr-2"}),"Write First Review"]})]})})}),n.length>0&&n.length>=5&&a.jsx("div",{className:"text-center",children:a.jsx(fr,{variant:"outline",onClick:async()=>{try{c(!0);const s=await kn.getLawFirmReviews(e);i(s)}catch(s){Pt.error("Failed to load reviews")}finally{c(!1)}},disabled:l,children:l?"Loading...":"Load All Reviews"})}),o&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Write a Review"})}),a.jsxs(Wr,{children:[a.jsx("p",{className:"text-gray-600 mb-4",children:"Review form will be implemented in the next phase."}),a.jsx(fr,{onClick:()=>d(!1),className:"w-full",children:"Close"})]})]})})]})},$n=Tt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Un=t.forwardRef(({className:e,...s},t)=>a.jsx(ze,{ref:t,className:Wa($n(),e),...s}));Un.displayName=ze.displayName;const qn=({lawFirm:e,teamMembers:s,onClose:r,onBookingCreated:n})=>{const{user:i}=hr(),[l,o]=t.useState(!1),[d,m]=t.useState({consultation_type:"initial",team_member_id:"",preferred_date:"",preferred_time:"",duration_minutes:60,message:"",contact_phone:"",alternative_dates:["",""],special_requirements:"",meeting_type:"in_person"});t.useState([]),t.useState(!1);const u=(e,s)=>{m(t=>({...t,[e]:s}))};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs(zr,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between",children:[a.jsx(Br,{children:"Book Consultation"}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:r,children:a.jsx(c,{className:"h-4 w-4"})})]}),a.jsx(Wr,{children:a.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),i)try{o(!0),await kn.createBooking({law_firm_id:e.id,user_id:i.id,team_member_id:d.team_member_id||void 0,consultation_type:d.consultation_type,preferred_date:d.preferred_date,preferred_time:d.preferred_time,duration_minutes:d.duration_minutes,message:d.message||void 0,contact_phone:d.contact_phone||void 0,status:"pending"}),n()}catch(t){Pt.error("Failed to create booking. Please try again.")}finally{o(!1)}else Pt.error("Please log in to book a consultation")},className:"space-y-4",children:[a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-gray-900",children:e.name}),a.jsx("p",{className:"text-sm text-gray-600",children:e.address})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"consultation_type",children:"Consultation Type"}),a.jsxs(yn,{value:d.consultation_type,onValueChange:e=>u("consultation_type",e),children:[a.jsx(wn,{children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"initial",children:"Initial Consultation"}),a.jsx(_n,{value:"follow_up",children:"Follow-up Meeting"}),a.jsx(_n,{value:"document_review",children:"Document Review"})]})]})]}),s.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"team_member",children:"Preferred Lawyer (Optional)"}),a.jsxs(yn,{value:d.team_member_id,onValueChange:e=>u("team_member_id",e),children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Any available lawyer"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"",children:"Any available lawyer"}),s.map(e=>a.jsxs(_n,{value:e.id,children:[e.name," - ",e.title]},e.id))]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"preferred_date",children:"Preferred Date"}),a.jsx(yr,{id:"preferred_date",type:"date",value:d.preferred_date,onChange:e=>u("preferred_date",e.target.value),min:(new Date).toISOString().split("T")[0],required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"preferred_time",children:"Preferred Time"}),a.jsx(yr,{id:"preferred_time",type:"time",value:d.preferred_time,onChange:e=>u("preferred_time",e.target.value),required:!0})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"duration",children:"Duration"}),a.jsxs(yn,{value:d.duration_minutes.toString(),onValueChange:e=>u("duration_minutes",parseInt(e)),children:[a.jsx(wn,{children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"30",children:"30 minutes"}),a.jsx(_n,{value:"60",children:"1 hour"}),a.jsx(_n,{value:"90",children:"1.5 hours"}),a.jsx(_n,{value:"120",children:"2 hours"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"contact_phone",children:"Contact Phone (Optional)"}),a.jsx(yr,{id:"contact_phone",type:"tel",value:d.contact_phone,onChange:e=>u("contact_phone",e.target.value),placeholder:"Your phone number"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"meeting_type",children:"Meeting Type"}),a.jsxs(yn,{value:d.meeting_type,onValueChange:e=>u("meeting_type",e),children:[a.jsx(wn,{children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"in_person",children:"In-Person Meeting"}),a.jsx(_n,{value:"video_call",children:"Video Call"}),a.jsx(_n,{value:"phone_call",children:"Phone Call"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{children:"Alternative Dates (Optional)"}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Provide alternative dates in case your preferred time is not available"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx(yr,{type:"date",value:d.alternative_dates[0],onChange:e=>{const s=[...d.alternative_dates];s[0]=e.target.value,u("alternative_dates",s)},min:(new Date).toISOString().split("T")[0]}),a.jsx(yr,{type:"date",value:d.alternative_dates[1],onChange:e=>{const s=[...d.alternative_dates];s[1]=e.target.value,u("alternative_dates",s)},min:(new Date).toISOString().split("T")[0]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"message",children:"Message (Optional)"}),a.jsx(an,{id:"message",value:d.message,onChange:e=>u("message",e.target.value),placeholder:"Brief description of your legal matter...",rows:3})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"special_requirements",children:"Special Requirements (Optional)"}),a.jsx(an,{id:"special_requirements",value:d.special_requirements,onChange:e=>u("special_requirements",e.target.value),placeholder:"Any accessibility needs, language preferences, or other special requirements...",rows:2})]}),e.consultation_fee&&a.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Consultation Fee:"})," $",e.consultation_fee]})}),a.jsxs("div",{className:"flex space-x-3 pt-4",children:[a.jsx(fr,{type:"button",variant:"outline",onClick:r,className:"flex-1",disabled:l,children:"Cancel"}),a.jsx(fr,{type:"submit",className:"flex-1",disabled:l,children:l?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Booking..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Me,{className:"h-4 w-4 mr-2"}),"Book Consultation"]})})]})]})})]})})},On=({images:e})=>{const[s,r]=t.useState(null),n=()=>{r(null)},i=t=>{null!==s&&r("prev"===t?s>0?s-1:e.length-1:s<e.length-1?s+1:0)};return 0===e.length?a.jsx(zr,{children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",children:""}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No gallery images"}),a.jsx("p",{className:"text-gray-500",children:"Gallery images have not been added yet."})]})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map((e,s)=>a.jsxs(zr,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>(e=>{r(e)})(s),children:[a.jsx("div",{className:"aspect-video relative",children:a.jsx("img",{src:e.image_url,alt:e.alt_text||e.caption||`Gallery image ${s+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-200"})}),e.caption&&a.jsx(Wr,{className:"p-3",children:a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.caption})})]},e.id))}),null!==s&&a.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:n,onKeyDown:e=>{"Escape"===e.key?n():"ArrowLeft"===e.key?i("prev"):"ArrowRight"===e.key&&i("next")},tabIndex:0,children:[a.jsx(fr,{variant:"ghost",size:"sm",className:"absolute top-4 right-4 text-white hover:bg-white/20 z-10",onClick:n,children:a.jsx(c,{className:"h-6 w-6"})}),e.length>1&&a.jsxs(a.Fragment,{children:[a.jsx(fr,{variant:"ghost",size:"sm",className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20 z-10",onClick:e=>{e.stopPropagation(),i("prev")},children:a.jsx(Be,{className:"h-8 w-8"})}),a.jsx(fr,{variant:"ghost",size:"sm",className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:bg-white/20 z-10",onClick:e=>{e.stopPropagation(),i("next")},children:a.jsx(Ve,{className:"h-8 w-8"})})]}),a.jsxs("div",{className:"max-w-4xl max-h-[80vh] mx-4",onClick:e=>e.stopPropagation(),children:[a.jsx("img",{src:e[s].image_url,alt:e[s].alt_text||e[s].caption||`Gallery image ${s+1}`,className:"max-w-full max-h-full object-contain"}),e[s].caption&&a.jsx("div",{className:"bg-black/50 text-white p-4 mt-2 rounded",children:a.jsx("p",{className:"text-center",children:e[s].caption})})]}),e.length>1&&a.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-3 py-1 rounded",children:[s+1," / ",e.length]})]})]})},zn=({lawFirm:e,onClose:s,onMessageSent:r})=>{const{user:n}=hr(),[i,l]=t.useState(!1),[o,d]=t.useState({name:n?.user_metadata?.full_name||"",email:n?.email||"",phone:"",subject:"",message:"",inquiry_type:"general",preferred_contact_method:"email",urgent:!1,consent_to_contact:!1}),m=(e,s)=>{d(t=>({...t,[e]:s}))};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs(zr,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between",children:[a.jsxs(Br,{children:["Contact ",e.name]}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:s,children:a.jsx(c,{className:"h-4 w-4"})})]}),a.jsx(Wr,{children:a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o.consent_to_contact)try{l(!0),await new Promise(e=>setTimeout(e,1e3)),Pt.success("Message sent successfully! The law firm will contact you soon."),r()}catch(s){Pt.error("Failed to send message. Please try again.")}finally{l(!1)}else Pt.error("Please consent to being contacted")},className:"space-y-4",children:[a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:e.name}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(W,{className:"h-4 w-4"}),a.jsx("span",{children:e.phone})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(G,{className:"h-4 w-4"}),a.jsx("span",{children:e.email})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"name",children:"Full Name *"}),a.jsx(yr,{id:"name",value:o.name,onChange:e=>m("name",e.target.value),required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"email",children:"Email Address *"}),a.jsx(yr,{id:"email",type:"email",value:o.email,onChange:e=>m("email",e.target.value),required:!0})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"phone",children:"Phone Number"}),a.jsx(yr,{id:"phone",type:"tel",value:o.phone,onChange:e=>m("phone",e.target.value),placeholder:"Your phone number"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"inquiry_type",children:"Type of Inquiry"}),a.jsxs(yn,{value:o.inquiry_type,onValueChange:e=>m("inquiry_type",e),children:[a.jsx(wn,{children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"general",children:"General Inquiry"}),a.jsx(_n,{value:"consultation",children:"Consultation Request"}),a.jsx(_n,{value:"case_evaluation",children:"Case Evaluation"}),a.jsx(_n,{value:"document_review",children:"Document Review"}),a.jsx(_n,{value:"legal_advice",children:"Legal Advice"}),a.jsx(_n,{value:"representation",children:"Legal Representation"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"preferred_contact",children:"Preferred Contact Method"}),a.jsxs(yn,{value:o.preferred_contact_method,onValueChange:e=>m("preferred_contact_method",e),children:[a.jsx(wn,{children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"email",children:"Email"}),a.jsx(_n,{value:"phone",children:"Phone Call"}),a.jsx(_n,{value:"either",children:"Either"})]})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"subject",children:"Subject *"}),a.jsx(yr,{id:"subject",value:o.subject,onChange:e=>m("subject",e.target.value),placeholder:"Brief description of your legal matter",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"message",children:"Message *"}),a.jsx(an,{id:"message",value:o.message,onChange:e=>m("message",e.target.value),placeholder:"Please provide details about your legal matter, including any relevant dates, parties involved, and specific questions you have...",rows:5,required:!0})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Sn,{id:"urgent",checked:o.urgent,onCheckedChange:e=>m("urgent",e)}),a.jsx("label",{htmlFor:"urgent",className:"text-sm text-gray-700",children:"This is an urgent matter requiring immediate attention"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Sn,{id:"consent",checked:o.consent_to_contact,onCheckedChange:e=>m("consent_to_contact",e)}),a.jsxs("label",{htmlFor:"consent",className:"text-sm text-gray-700",children:["I consent to being contacted by ",e.name," regarding my inquiry *"]})]})]}),a.jsxs("div",{className:"bg-yellow-50 p-3 rounded-lg text-sm text-yellow-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"Important Notice:"}),a.jsx("p",{children:"This form is for initial inquiries only. Do not include confidential or sensitive information. An attorney-client relationship is not formed until a formal agreement is signed."})]}),a.jsxs("div",{className:"flex space-x-3 pt-4",children:[a.jsx(fr,{type:"button",variant:"outline",onClick:s,className:"flex-1",disabled:i,children:"Cancel"}),a.jsx(fr,{type:"submit",className:"flex-1",disabled:i||!o.consent_to_contact,children:i?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):a.jsxs(a.Fragment,{children:[a.jsx(G,{className:"h-4 w-4 mr-2"}),"Send Message"]})})]})]})})]})})},Mn=({firmId:e,onBack:s,className:r=""})=>{const{id:n}=We(),i=S(),l=e||n,[c,o]=t.useState(null),[d,m]=t.useState([]),[u,h]=t.useState([]),[x,p]=t.useState([]),[g,f]=t.useState(!0),[y,j]=t.useState(!1),[w,b]=t.useState(!1),[v,N]=t.useState("overview");t.useEffect(()=>{l&&_()},[l]);const _=async()=>{if(l)try{f(!0);const e=await kn.getLawFirmProfile(l);o(e),m(e.team_members||[]),h(e.gallery||[]),p(e.recent_reviews||[])}catch(e){Pt.error("Failed to load law firm profile")}finally{f(!1)}};if(g)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading law firm profile..."})]})});if(!c)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Law Firm Not Found"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"The law firm you're looking for doesn't exist or has been removed."}),a.jsxs(fr,{onClick:()=>i("/law-firms"),children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Back to Directory"]})]})});(()=>{const e={5:0,4:0,3:0,2:0,1:0};x.forEach(s=>{e[s.rating]++})})();const k=x.length;return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsxs("div",{className:"relative h-64 bg-gradient-to-r from-blue-600 to-blue-800",children:[c.cover_image_url&&a.jsx("img",{src:c.cover_image_url,alt:`${c.name} cover`,className:"w-full h-full object-cover"}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40"}),a.jsx("div",{className:"absolute top-4 left-4",children:a.jsxs(fr,{variant:"secondary",size:"sm",onClick:()=>s?s():i("/law-firms"),className:"bg-white/90 hover:bg-white",children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Back to Directory"]})}),a.jsxs("div",{className:"absolute top-4 right-4 flex space-x-2",children:[a.jsx(fr,{variant:"secondary",size:"sm",className:"bg-white/90 hover:bg-white",children:a.jsx(He,{className:"h-4 w-4"})}),a.jsx(fr,{variant:"secondary",size:"sm",className:"bg-white/90 hover:bg-white",children:a.jsx(Ye,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"relative -mt-16 mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:a.jsx(zr,{className:"bg-white shadow-lg",children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:space-x-6",children:[a.jsx("div",{className:"flex-shrink-0 mb-4 md:mb-0",children:a.jsxs(Pn,{className:"h-24 w-24 border-4 border-white shadow-lg",children:[a.jsx(Rn,{src:c.logo_url,alt:c.name}),a.jsx(Fn,{className:"text-2xl font-bold bg-blue-600 text-white",children:c.name.charAt(0)})]})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:c.name}),c.verified&&a.jsx(Te,{className:"h-6 w-6 text-blue-500"})]}),a.jsxs("div",{className:"flex items-center space-x-1 mb-3",children:[(A=c.rating,Array.from({length:5},(e,s)=>a.jsx($,{className:"h-4 w-4 "+(s<Math.floor(A)?"text-yellow-400 fill-current":"text-gray-300")},s))),a.jsx("span",{className:"text-lg font-semibold text-gray-900 ml-2",children:c.rating.toFixed(1)}),a.jsxs("span",{className:"text-gray-600",children:["(",c.total_reviews||0," reviews)"]})]}),a.jsx("p",{className:"text-gray-600 mb-4",children:c.description}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(H,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"text-gray-600",children:c.address})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(W,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"text-gray-600",children:c.phone})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(G,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"text-gray-600",children:c.email})]}),c.website&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Ie,{className:"h-4 w-4 text-gray-400"}),a.jsx("a",{href:c.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Website"})]})]})]}),a.jsxs("div",{className:"flex flex-col space-y-2 mt-4 md:mt-0",children:[a.jsxs(fr,{onClick:()=>j(!0),className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(Me,{className:"h-4 w-4 mr-2"}),"Book Consultation"]}),a.jsxs(fr,{variant:"outline",onClick:()=>b(!0),children:[a.jsx(P,{className:"h-4 w-4 mr-2"}),"Send Message"]})]})]})})})}),a.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8",children:a.jsxs(En,{value:v,onValueChange:N,children:[a.jsxs(Tn,{className:"grid w-full grid-cols-4",children:[a.jsx(In,{value:"overview",children:"Overview"}),a.jsx(In,{value:"team",children:"Team"}),a.jsx(In,{value:"gallery",children:"Gallery"}),a.jsx(In,{value:"reviews",children:"Reviews"})]}),a.jsx(Dn,{value:"overview",className:"mt-6",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsxs(Br,{children:["About ",c.name]})}),a.jsxs(Wr,{children:[a.jsx("p",{className:"text-gray-700 leading-relaxed mb-4",children:c.description}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[c.established_year&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Me,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-sm text-gray-600",children:["Established: ",c.established_year]})]}),c.firm_size&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(M,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-sm text-gray-600",children:["Firm Size: ",c.firm_size.charAt(0).toUpperCase()+c.firm_size.slice(1)]})]}),c.response_time&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(q,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-sm text-gray-600",children:["Response Time: ",c.response_time]})]}),c.consultation_fee&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Qe,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-sm text-gray-600",children:["Consultation Fee: $",c.consultation_fee]})]})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Practice Areas"})}),a.jsx(Wr,{children:a.jsx("div",{className:"flex flex-wrap gap-2",children:c.practice_areas.map(e=>a.jsx(Yr,{variant:"secondary",className:"text-sm",children:e},e))})})]}),(c.languages?.length||c.certifications?.length)&&a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Languages & Certifications"})}),a.jsxs(Wr,{className:"space-y-4",children:[c.languages?.length&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(Je,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"font-medium text-gray-900",children:"Languages"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:c.languages.map(e=>a.jsx(Yr,{variant:"outline",className:"text-sm",children:e},e))})]}),c.certifications?.length&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(B,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"font-medium text-gray-900",children:"Certifications"})]}),a.jsx("div",{className:"space-y-1",children:c.certifications.map(e=>a.jsxs("div",{className:"text-sm text-gray-600",children:[" ",e]},e))})]})]})]}),c.office_hours&&a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Office Hours"})}),a.jsx(Wr,{children:a.jsx("p",{className:"text-gray-700",children:(e=>{if(!e)return"Hours not specified";const s=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map((t,a)=>e[t]?`${s[a]}: ${e[t]}`:null).filter(Boolean).join(", ")||"Hours not specified"})(c.office_hours)})})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{className:"text-lg",children:"Quick Stats"})}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Rating"}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"}),a.jsx("span",{className:"font-medium",children:c.rating.toFixed(1)})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Reviews"}),a.jsx("span",{className:"font-medium",children:k})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Practice Areas"}),a.jsx("span",{className:"font-medium",children:c.practice_areas.length})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Verified"}),a.jsx("div",{className:"flex items-center space-x-1",children:c.verified?a.jsxs(a.Fragment,{children:[a.jsx(Te,{className:"h-4 w-4 text-blue-500"}),a.jsx("span",{className:"text-blue-600 font-medium",children:"Yes"})]}):a.jsx("span",{className:"text-gray-500",children:"No"})})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{className:"text-lg",children:"Contact"})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsxs(fr,{className:"w-full",children:[a.jsx(P,{className:"h-4 w-4 mr-2"}),"Write a Review"]}),a.jsxs(fr,{variant:"outline",className:"w-full",children:[a.jsx(W,{className:"h-4 w-4 mr-2"}),"Call Now"]}),a.jsxs(fr,{variant:"outline",className:"w-full",children:[a.jsx(G,{className:"h-4 w-4 mr-2"}),"Send Email"]})]})]})]})]})}),a.jsx(Dn,{value:"team",className:"mt-6",children:d.length>0?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(e=>a.jsx(zr,{className:"hover:shadow-lg transition-shadow",children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"text-center",children:[a.jsxs(Pn,{className:"h-20 w-20 mx-auto mb-4",children:[a.jsx(Rn,{src:e.photo_url,alt:e.name}),a.jsx(Fn,{className:"text-lg bg-blue-100 text-blue-600",children:e.name.split(" ").map(e=>e[0]).join("")})]}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),a.jsx("p",{className:"text-blue-600 font-medium mb-3",children:e.title}),e.bio&&a.jsx("p",{className:"text-gray-600 text-sm mb-4",children:e.bio}),e.practice_areas.length>0&&a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[e.practice_areas.slice(0,3).map(e=>a.jsx(Yr,{variant:"secondary",className:"text-xs",children:e},e)),e.practice_areas.length>3&&a.jsxs(Yr,{variant:"secondary",className:"text-xs",children:["+",e.practice_areas.length-3," more"]})]})}),a.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.years_experience&&a.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[a.jsx(Ke,{className:"h-4 w-4"}),a.jsxs("span",{children:[e.years_experience," years experience"]})]}),e.languages&&e.languages.length>0&&a.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[a.jsx(Je,{className:"h-4 w-4"}),a.jsx("span",{children:e.languages.join(", ")})]})]}),a.jsx("div",{className:"mt-4 space-y-2",children:e.email&&a.jsxs(fr,{variant:"outline",size:"sm",className:"w-full",children:[a.jsx(G,{className:"h-4 w-4 mr-2"}),"Contact"]})})]})})},e.id))}):a.jsx(zr,{children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx(M,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No team information available"}),a.jsx("p",{className:"text-gray-500",children:"Team member information has not been provided yet."})]})})}),a.jsx(Dn,{value:"gallery",className:"mt-6",children:a.jsx(On,{images:u})}),a.jsx(Dn,{value:"reviews",className:"mt-6",children:a.jsx(Ln,{lawFirmId:c.id,reviews:x})})]})}),y&&a.jsx(qn,{lawFirm:c,teamMembers:d,onClose:()=>j(!1),onBookingCreated:()=>{j(!1),Pt.success("Booking request submitted successfully!")}}),w&&a.jsx(zn,{lawFirm:c,onClose:()=>b(!1),onMessageSent:()=>{b(!1),Pt.success("Message sent successfully!")}})]});var A},Bn=Ut({rating:qt().min(1,"Please select a rating").max(5,"Rating must be between 1 and 5"),title:Ot().min(5,"Title must be at least 5 characters").max(100,"Title must be less than 100 characters"),content:Ot().min(20,"Review must be at least 20 characters").max(1e3,"Review must be less than 1000 characters")}),Vn=({lawFirm:e,onReviewSubmitted:s,onCancel:r,className:n=""})=>{const[i,l]=t.useState(!1),[c,o]=t.useState(0),[d,m]=t.useState(0),{user:u}=hr(),{register:h,handleSubmit:x,setValue:p,watch:g,formState:{errors:f}}=Xe({resolver:zt(Bn)}),y=g("content","");return u?a.jsxs(zr,{className:n,children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center space-x-2",children:[a.jsx(P,{className:"h-5 w-5"}),a.jsxs("span",{children:["Write a Review for ",e.name]})]}),a.jsx(Vr,{children:"Share your experience to help others make informed decisions"})]}),a.jsx(Wr,{children:a.jsxs("form",{onSubmit:x(async t=>{if(u){l(!0);try{const a={law_firm_id:e.id,rating:t.rating,title:t.title,content:t.content};await kn.createReview(a),Pt.success("Review submitted successfully! It will be published after moderation."),s?.()}catch(a){Pt.error("Failed to submit review: "+a.message)}finally{l(!1)}}else Pt.error("Please log in to submit a review")}),className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{className:"text-base font-medium",children:"Overall Rating *"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"flex",children:Array.from({length:5},(e,s)=>{const t=s+1,r=t<=(d||c);return a.jsx("button",{type:"button",className:"p-1 transition-colors "+(r?"text-yellow-400":"text-gray-300 hover:text-yellow-300"),onMouseEnter:()=>m(t),onMouseLeave:()=>m(0),onClick:()=>{return o(e=t),void p("rating",e);var e},children:a.jsx($,{className:"h-8 w-8 "+(r?"fill-current":"")})},s)})}),c>0&&a.jsx("span",{className:"text-lg font-medium text-gray-700",children:(j=c,{1:"Poor",2:"Fair",3:"Good",4:"Very Good",5:"Excellent"}[j]||"")})]}),f.rating&&a.jsx("p",{className:"text-red-500 text-sm",children:f.rating.message})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"title",className:"text-base font-medium",children:"Review Title *"}),a.jsx(yr,{id:"title",...h("title"),placeholder:"Summarize your experience in a few words",className:"w-full"}),f.title&&a.jsx("p",{className:"text-red-500 text-sm",children:f.title.message})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"content",className:"text-base font-medium",children:"Your Review *"}),a.jsx(an,{id:"content",...h("content"),placeholder:"Tell others about your experience with this law firm. What services did you use? How was the communication? Would you recommend them?",rows:6,className:"w-full resize-none"}),a.jsxs("div",{className:"flex justify-between text-sm text-gray-500",children:[a.jsx("span",{children:f.content?a.jsx("span",{className:"text-red-500",children:f.content.message}):"Minimum 20 characters"}),a.jsxs("span",{children:[y.length,"/1000"]})]})]}),a.jsxs(on,{children:[a.jsx(X,{className:"h-4 w-4"}),a.jsxs(dn,{className:"text-sm",children:[a.jsx("strong",{children:"Review Guidelines:"}),a.jsxs("ul",{className:"mt-2 space-y-1 list-disc list-inside",children:[a.jsx("li",{children:"Be honest and constructive in your feedback"}),a.jsx("li",{children:"Focus on your personal experience with the law firm"}),a.jsx("li",{children:"Avoid sharing confidential or sensitive information"}),a.jsx("li",{children:"Reviews are moderated and may take time to appear"})]})]})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx(fr,{type:"submit",disabled:i||0===c,className:"flex-1",children:i?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Submit Review"]})}),r&&a.jsx(fr,{type:"button",variant:"outline",onClick:r,disabled:i,children:"Cancel"})]}),c>0&&a.jsxs(on,{children:[a.jsx(L,{className:"h-4 w-4"}),a.jsxs(dn,{className:"text-sm",children:["Your ",c,"-star review will help other users make informed decisions about ",e.name,"."]})]})]})})]}):a.jsx(zr,{className:n,children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx(P,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sign in to write a review"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"You need to be logged in to submit a review for this law firm."}),a.jsx(fr,{onClick:()=>window.location.href="/login",children:"Sign In"})]})});var j},Wn=()=>a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(Sr,{}),a.jsx(Mn,{}),a.jsx(nn,{})]}),Gn=()=>{const[e,s]=t.useState([]),[r,n]=t.useState(!1),i=async()=>{n(!0);const e=[],t={VITE_SUPABASE_URL:"https://kvlaydeyqidlfpfutbmp.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2bGF5ZGV5cWlkbGZwZnV0Ym1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyODgzNzAsImV4cCI6MjA2NTg2NDM3MH0.XVSO5W_0v6wW-MYlM7i0MTNKprOWp_O4ON-5LqqVnzw",VITE_APP_URL:"https://craftchatbot.com",NODE_ENV:void 0,MODE:"production"},a=Object.entries(t).filter(([e,s])=>!s);e.push({category:"Environment",name:"Environment Variables",status:a.length>0?"error":"success",message:a.length>0?`Missing: ${a.map(([e])=>e).join(", ")}`:"All environment variables present",details:t,fix:a.length>0?"Check your hosting platform environment variables configuration":void 0});const r=window.location.origin,i="https://craftchatbot.com";e.push({category:"Configuration",name:"URL Configuration",status:r===i?"success":"warning",message:`Current: ${r}, Configured: ${i}`,details:{currentUrl:r,configuredUrl:i},fix:r!==i?"Update VITE_APP_URL environment variable to match production URL":void 0});try{const{supabase:s}=await Bt(async()=>{const{supabase:e}=await import("./supabase-Cfql4b7O.js");return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),{data:t,error:a}=await s.from("profiles").select("count").limit(1);e.push({category:"Database",name:"Supabase Connection",status:a?"error":"success",message:a?`Connection failed: ${a.message}`:"Connected successfully",details:{data:t,error:a},fix:a?"Check Supabase URL and API key configuration":void 0})}catch(c){e.push({category:"Database",name:"Supabase Connection",status:"error",message:`Import failed: ${c instanceof Error?c.message:"Unknown error"}`,details:c,fix:"Check if Supabase is properly configured and imported"})}try{const{supabase:s}=await Bt(async()=>{const{supabase:e}=await import("./supabase-Cfql4b7O.js");return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),{data:{user:t},error:a}=await s.auth.getUser();e.push({category:"Authentication",name:"User Session",status:a?"error":t?"success":"warning",message:a?`Auth error: ${a.message}`:t?`Logged in as ${t.email}`:"Not authenticated",details:{user:t?{id:t.id,email:t.email}:null,error:a},fix:t||a?void 0:"User needs to log in to access document features"})}catch(c){e.push({category:"Authentication",name:"User Session",status:"error",message:`Auth check failed: ${c instanceof Error?c.message:"Unknown error"}`,details:c})}try{const{documentsApi:s}=await Bt(async()=>{const{documentsApi:e}=await Promise.resolve().then(()=>Ci);return{documentsApi:e}},void 0,import.meta.url),t=await s.getDocuments();e.push({category:"API",name:"Documents API",status:"success",message:`Successfully fetched ${t.length} documents`,details:{count:t.length,sample:t.slice(0,2)}})}catch(c){e.push({category:"API",name:"Documents API",status:"error",message:`API call failed: ${c instanceof Error?c.message:"Unknown error"}`,details:c,fix:"Check database schema and RLS policies for uploaded_documents table"})}try{const{supabase:s}=await Bt(async()=>{const{supabase:e}=await import("./supabase-Cfql4b7O.js");return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),{data:t,error:a}=await s.storage.listBuckets(),r=t?.find(e=>"documents"===e.name);e.push({category:"Storage",name:"Documents Bucket",status:a?"error":r?"success":"error",message:a?`Storage error: ${a.message}`:r?"Documents bucket exists":"Documents bucket not found",details:{buckets:t?.map(e=>e.name),error:a},fix:r?void 0:"Create documents storage bucket in Supabase dashboard"})}catch(c){e.push({category:"Storage",name:"Documents Bucket",status:"error",message:`Storage check failed: ${c instanceof Error?c.message:"Unknown error"}`,details:c})}const l=window.__consoleErrors||[];e.push({category:"Runtime",name:"Console Errors",status:l.length>0?"warning":"success",message:l.length>0?`${l.length} console errors detected`:"No console errors detected",details:l.slice(0,5),fix:l.length>0?"Check browser console for detailed error messages":void 0}),s(e),n(!1)};t.useEffect(()=>{const e=console.error;return window.__consoleErrors=[],console.error=(...s)=>{window.__consoleErrors.push(s.join(" ")),e.apply(console,s)},i(),()=>{console.error=e}},[]);const l=e=>{switch(e){case"success":return a.jsx(L,{className:"h-5 w-5 text-green-500"});case"error":return a.jsx(es,{className:"h-5 w-5 text-red-500"});case"warning":return a.jsx(X,{className:"h-5 w-5 text-yellow-500"});case"pending":return a.jsx(Z,{className:"h-5 w-5 text-blue-500 animate-spin"})}},c=e=>{switch(e){case"Environment":case"Configuration":return a.jsx(Ie,{className:"h-4 w-4"});case"Database":return a.jsx(as,{className:"h-4 w-4"});case"Authentication":return a.jsx(ts,{className:"h-4 w-4"});case"Storage":return a.jsx(ss,{className:"h-4 w-4"});default:return a.jsx(X,{className:"h-4 w-4"})}},o=e.reduce((e,s)=>(e[s.category]||(e[s.category]=[]),e[s.category].push(s),e),{});return a.jsxs(zr,{className:"max-w-6xl mx-auto",children:[a.jsx(Mr,{children:a.jsxs(Br,{className:"flex items-center justify-between",children:["Production Diagnostics",a.jsxs(fr,{onClick:i,disabled:r,size:"sm",children:[a.jsx(Z,{className:"h-4 w-4 mr-2 "+(r?"animate-spin":"")}),r?"Running...":"Run Diagnostics"]})]})}),a.jsx(Wr,{children:a.jsx("div",{className:"space-y-6",children:Object.entries(o).map(([e,s])=>a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[c(e),a.jsx("span",{className:"ml-2",children:e})]}),a.jsx("div",{className:"space-y-2",children:s.map((e,s)=>a.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[l(e.status),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium",children:e.name}),a.jsx("p",{className:"text-sm text-gray-600",children:e.message}),e.fix&&a.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[a.jsx("strong",{children:"Fix:"})," ",e.fix]}),!1]})]},s))})]},e))})})]})},Hn=()=>{const[e,s]=t.useState(""),[r,n]=t.useState(!1),i=[{icon:ns,title:"AI-Powered Analysis",description:"Upload any legal document for instant AI analysis and summary"},{icon:U,title:"Singapore Law Compliant",description:"All templates are updated to comply with current Singapore regulations"},{icon:L,title:"Lawyer Reviewed",description:"Every template is reviewed and approved by qualified Singapore lawyers"}];return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(Sr,{}),a.jsx("section",{className:"bg-blue-900 text-white pt-24 pb-16",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Legal Documents & Analysis"}),a.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-3xl mx-auto",children:"Upload documents for AI-powered analysis or download customizable legal templates specific to Singapore law."}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[a.jsxs(fr,{size:"lg",className:"bg-yellow-500 hover:bg-yellow-600 text-blue-900 font-semibold",children:[a.jsx(ss,{className:"mr-2 h-5 w-5"}),"Analyze Document"]}),a.jsxs(fr,{size:"lg",variant:"outline",className:"border-white text-white hover:bg-white hover:text-blue-900",children:[a.jsx(O,{className:"mr-2 h-5 w-5"}),"Browse Templates"]})]})]})})}),a.jsx("section",{className:"py-16 bg-white",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:i.map((e,s)=>a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mx-auto mb-4",children:a.jsx(e.icon,{className:"h-8 w-8 text-blue-600"})}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:e.title}),a.jsx("p",{className:"text-gray-600",children:e.description})]},s))})})}),a.jsx("section",{className:"py-16 bg-gray-50",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"text-center mb-12",children:[a.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Document Analysis"}),a.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Upload any legal document and get instant AI-powered analysis, key terms extraction, and risk assessment."})]}),a.jsx("div",{className:"max-w-2xl mx-auto",children:a.jsx(zr,{className:"border-2 border-dashed border-gray-300 hover:border-blue-400 transition-colors",children:a.jsxs(Wr,{className:"p-12 text-center",children:[a.jsx(ss,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Upload Your Document"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Drag and drop your PDF, Word, or image file here, or click to browse"}),a.jsx(fr,{className:"bg-blue-600 hover:bg-blue-700",children:"Choose File"}),a.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Supported formats: PDF, DOC, DOCX, JPG, PNG (Max 10MB)"})]})})})]})}),a.jsx("section",{className:"py-16 bg-white",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-8",children:[a.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Document Templates"}),a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),a.jsx(yr,{type:"text",placeholder:"Search templates...",value:e,onChange:e=>s(e.target.value),className:"pl-10 w-64"})]})})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:["All","Employment","Property","Corporate","Personal","Family","Immigration"].map(e=>a.jsx(Yr,{variant:"All"===e?"default":"outline",className:"cursor-pointer hover:bg-blue-50",children:e},e))}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[{id:1,title:"Employment Contract Template",description:"Standard employment agreement template compliant with Singapore's Employment Act",category:"Employment",downloads:1250,rating:4.8,price:"Free",isPopular:!0},{id:2,title:"Tenancy Agreement",description:"Comprehensive rental agreement template for residential properties",category:"Property",downloads:980,rating:4.7,price:"$15",isPopular:!0},{id:3,title:"Non-Disclosure Agreement (NDA)",description:"Protect your confidential information with this legally binding NDA",category:"Corporate",downloads:750,rating:4.9,price:"$10",isPopular:!1},{id:4,title:"Power of Attorney",description:"Grant legal authority to act on your behalf in specific matters",category:"Personal",downloads:420,rating:4.6,price:"$20",isPopular:!1}].map(e=>a.jsxs(zr,{className:"hover:shadow-lg transition-shadow",children:[a.jsxs(Mr,{children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx(Br,{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),e.isPopular&&a.jsx(Yr,{className:"bg-yellow-100 text-yellow-800 mb-2",children:"Popular"})]}),a.jsx("div",{className:"text-right",children:a.jsx("div",{className:"text-lg font-bold text-blue-600",children:e.price})})]}),a.jsx(Vr,{className:"text-gray-600",children:e.description})]}),a.jsxs(Wr,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx(Yr,{variant:"secondary",children:e.category}),a.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[a.jsx(O,{className:"h-4 w-4"}),a.jsx("span",{children:e.downloads})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(fr,{variant:"outline",size:"sm",className:"flex-1",children:[a.jsx(rs,{className:"h-4 w-4 mr-1"}),"Preview"]}),a.jsxs(fr,{size:"sm",className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[a.jsx(O,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})]},e.id))}),a.jsx("div",{className:"text-center mt-12",children:a.jsx(fr,{variant:"outline",size:"lg",children:"View All Templates"})})]})}),r&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto",children:[a.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Debug Tools - Public Documents Page"}),a.jsx(fr,{variant:"outline",size:"sm",onClick:()=>n(!1),children:"Close"})]}),a.jsx("div",{className:"p-4",children:a.jsx(Gn,{})})]})}),a.jsx(fr,{onClick:()=>n(!0),className:"fixed bottom-4 right-4 z-[9999] bg-red-600 hover:bg-red-700 text-white shadow-lg border-2 border-white",size:"sm",children:" Debug"}),a.jsx(nn,{})]})},Yn="https://kvlaydeyqidlfpfutbmp.supabase.co"?.includes("placeholder")||!1,Qn=[{id:"1",name:"Employment Law",description:"Questions about workplace rights, contracts, and employment issues",icon:"briefcase",color:"#3B82F6",parent_id:null,order_index:1,is_active:!0,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",question_count:45},{id:"2",name:"Property Law",description:"Real estate transactions, property disputes, and housing matters",icon:"home",color:"#10B981",parent_id:null,order_index:2,is_active:!0,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",question_count:32},{id:"3",name:"Family Law",description:"Divorce, custody, marriage, and family-related legal matters",icon:"users",color:"#F59E0B",parent_id:null,order_index:3,is_active:!0,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",question_count:28},{id:"4",name:"Business Law",description:"Corporate law, contracts, and business-related legal issues",icon:"building",color:"#8B5CF6",parent_id:null,order_index:4,is_active:!0,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",question_count:38},{id:"5",name:"Criminal Law",description:"Criminal charges, court proceedings, and criminal defense",icon:"shield",color:"#EF4444",parent_id:null,order_index:5,is_active:!0,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",question_count:22}],Jn=[{id:"1",user_id:"user1",category_id:"1",title:"Can my employer terminate me without notice during probation?",content:"I am currently on a 6-month probation period at my new job in Singapore. My employer mentioned they can terminate me without notice during this period. Is this legal? What are my rights as an employee during probation?",tags:["employment","probation","termination","singapore"],urgency_level:"high",location:"Singapore",is_anonymous:!1,status:"open",view_count:156,upvote_count:12,downvote_count:1,answer_count:3,has_expert_answer:!0,has_ai_answer:!0,featured:!0,moderation_status:"approved",created_at:"2024-01-15T10:30:00Z",updated_at:"2024-01-15T10:30:00Z",user:{id:"user1",full_name:"Sarah Chen",avatar_url:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150"},category:Qn[0]},{id:"2",user_id:"user2",category_id:"2",title:"Property cooling measures - impact on first-time buyers",content:"With the recent property cooling measures announced by the government, how will this affect first-time home buyers in Singapore? Are there any exemptions or special considerations for citizens buying their first property?",tags:["property","cooling-measures","first-time-buyer","hdb"],urgency_level:"normal",location:"Singapore",is_anonymous:!1,status:"open",view_count:89,upvote_count:8,downvote_count:0,answer_count:2,has_expert_answer:!1,has_ai_answer:!0,featured:!1,moderation_status:"approved",created_at:"2024-01-14T14:20:00Z",updated_at:"2024-01-14T14:20:00Z",user:{id:"user2",full_name:"Michael Tan",avatar_url:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150"},category:Qn[1]},{id:"3",user_id:"user3",category_id:"3",title:"Divorce proceedings and child custody arrangements",content:"My spouse and I are considering divorce. We have two young children (ages 5 and 8). What factors do Singapore courts consider when determining child custody? Can we arrange for joint custody?",tags:["divorce","child-custody","family-court","joint-custody"],urgency_level:"high",location:"Singapore",is_anonymous:!0,status:"open",view_count:234,upvote_count:15,downvote_count:2,answer_count:4,has_expert_answer:!0,has_ai_answer:!1,featured:!0,moderation_status:"approved",created_at:"2024-01-13T09:15:00Z",updated_at:"2024-01-13T09:15:00Z",user:{id:"user3",full_name:"Anonymous User",avatar_url:void 0},category:Qn[2]},{id:"4",user_id:"user4",category_id:"4",title:"Setting up a private limited company in Singapore",content:"I want to incorporate a private limited company in Singapore. What are the minimum requirements, costs involved, and ongoing compliance obligations? Do I need a local director?",tags:["incorporation","private-limited","company-setup","compliance"],urgency_level:"normal",location:"Singapore",is_anonymous:!1,status:"open",view_count:67,upvote_count:6,downvote_count:0,answer_count:1,has_expert_answer:!1,has_ai_answer:!0,featured:!1,moderation_status:"approved",created_at:"2024-01-12T16:45:00Z",updated_at:"2024-01-12T16:45:00Z",user:{id:"user4",full_name:"David Lim",avatar_url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150"},category:Qn[3]},{id:"5",user_id:"user5",category_id:"5",title:"Traffic violation - what are my options?",content:"I received a traffic summons for speeding. This is my first offense. What are my options? Should I plead guilty or contest it in court? What are the potential penalties?",tags:["traffic-violation","speeding","summons","first-offense"],urgency_level:"low",location:"Singapore",is_anonymous:!1,status:"open",view_count:45,upvote_count:3,downvote_count:0,answer_count:0,has_expert_answer:!1,has_ai_answer:!1,featured:!1,moderation_status:"approved",created_at:"2024-01-11T11:30:00Z",updated_at:"2024-01-11T11:30:00Z",user:{id:"user5",full_name:"Jennifer Wong",avatar_url:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150"},category:Qn[4]}],Kn={async getCategories(){try{const{data:e,error:s}=await Ct.from("legal_qa_categories").select("*").eq("is_active",!0).order("order_index");return s?[...Qn]:e||[]}catch(e){return[...Qn]}},async getCategoryWithQuestionCount(e){const{data:s,error:t}=await Ct.from("legal_qa_categories").select("\n        *,\n        question_count:legal_questions(count)\n      ").eq("id",e).eq("is_active",!0).single();if(t)throw new Error("Failed to fetch category");return s},async getQuestions(e={}){if(Yn)return new Promise((s,t)=>{setTimeout(()=>{try{let t=[...Jn];if(e.category_id&&(t=t.filter(s=>s.category_id===e.category_id)),e.status&&(t=t.filter(s=>s.status===e.status)),e.urgency_level&&(t=t.filter(s=>s.urgency_level===e.urgency_level)),void 0!==e.has_expert_answer&&(t=t.filter(s=>s.has_expert_answer===e.has_expert_answer)),void 0!==e.has_ai_answer&&(t=t.filter(s=>s.has_ai_answer===e.has_ai_answer)),void 0!==e.featured&&(t=t.filter(s=>s.featured===e.featured)),e.search){const s=e.search.toLowerCase();t=t.filter(e=>e.title.toLowerCase().includes(s)||e.content.toLowerCase().includes(s)||e.tags.some(e=>e.toLowerCase().includes(s)))}switch(e.sort_by){case"oldest":t.sort((e,s)=>new Date(e.created_at).getTime()-new Date(s.created_at).getTime());break;case"most_votes":t.sort((e,s)=>s.upvote_count-e.upvote_count);break;case"most_answers":t.sort((e,s)=>s.answer_count-e.answer_count);break;case"most_views":t.sort((e,s)=>s.view_count-e.view_count);break;default:t.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())}const a=e.page||1,r=e.limit||20,n=(a-1)*r,i=n+r,l=t.slice(n,i);s(l)}catch(a){t(a)}},50)});let s=Ct.from("legal_questions").select("\n        *,\n        user:profiles(id, full_name, avatar_url),\n        category:legal_qa_categories(id, name, color)\n      ").eq("moderation_status","approved");switch(e.category_id&&(s=s.eq("category_id",e.category_id)),e.status&&(s=s.eq("status",e.status)),e.urgency_level&&(s=s.eq("urgency_level",e.urgency_level)),void 0!==e.has_expert_answer&&(s=s.eq("has_expert_answer",e.has_expert_answer)),void 0!==e.has_ai_answer&&(s=s.eq("has_ai_answer",e.has_ai_answer)),void 0!==e.featured&&(s=s.eq("featured",e.featured)),e.location&&(s=s.ilike("location",`%${e.location}%`)),e.search&&(s=s.or(`title.ilike.%${e.search}%,content.ilike.%${e.search}%,tags.cs.{${e.search}}`)),e.tags&&e.tags.length>0&&(s=s.overlaps("tags",e.tags)),e.sort_by){case"oldest":s=s.order("created_at",{ascending:!0});break;case"most_votes":s=s.order("upvote_count",{ascending:!1});break;case"most_answers":s=s.order("answer_count",{ascending:!1});break;case"most_views":s=s.order("view_count",{ascending:!1});break;default:s=s.order("created_at",{ascending:!1})}const t=e.limit||20,a=((e.page||1)-1)*t;s=s.range(a,a+t-1);const{data:r,error:n}=await s;if(n)throw new Error("Failed to fetch questions");return r||[]},async getQuestion(e){if(Yn)return new Promise((s,t)=>{setTimeout(()=>{const a=Jn.find(s=>s.id===e);a?(a.view_count+=1,s(a)):t(new Error("Question not found"))},300)});const{data:s,error:t}=await Ct.from("legal_questions").select("\n        *,\n        user:profiles(id, full_name, avatar_url),\n        category:legal_qa_categories(id, name, color, description)\n      ").eq("id",e).eq("moderation_status","approved").single();if(t)throw new Error("Failed to fetch question");return await Ct.from("legal_questions").update({view_count:s.view_count+1}).eq("id",e),s},async createQuestion(e){const{data:s,error:t}=await Ct.from("legal_questions").insert({...e,moderation_status:"pending"}).select("\n        *,\n        user:profiles(id, full_name, avatar_url),\n        category:legal_qa_categories(id, name, color)\n      ").single();if(t)throw new Error("Failed to create question");return s},async updateQuestion(e,s){const{data:t,error:a}=await Ct.from("legal_questions").update(s).eq("id",e).select("\n        *,\n        user:profiles(id, full_name, avatar_url),\n        category:legal_qa_categories(id, name, color)\n      ").single();if(a)throw new Error("Failed to update question");return t},async getAnswers(e={}){if(Yn)return new Promise(s=>{setTimeout(()=>{let t=[{id:"1",question_id:"1",user_id:"expert1",content:"During probation periods in Singapore, employers do have more flexibility in termination, but there are still legal requirements to follow:\n\n**Key Points:**\n1. **Notice Period**: While the Employment Act allows for shorter notice during probation, most employment contracts specify the exact terms.\n2. **Just Cause**: Employers should still have valid reasons for termination, even during probation.\n3. **Documentation**: Proper documentation of performance issues is recommended.\n\n**Your Rights:**\n- Right to receive any outstanding salary and benefits\n- Right to proper notice as per your contract\n- Protection against discriminatory termination\n\n**Recommendation**: Review your employment contract carefully for specific probation terms and consider consulting with MOM if you believe the termination was unfair.",answer_type:"expert",sources:["Employment Act (Singapore)","Ministry of Manpower Guidelines"],disclaimer:null,is_accepted:!0,expert_verified:!0,upvote_count:15,downvote_count:1,helpful_count:12,moderation_status:"approved",created_at:"2024-01-15T11:30:00Z",updated_at:"2024-01-15T11:30:00Z",user:{id:"expert1",full_name:"Sarah Lim, Employment Lawyer",avatar_url:"https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=150"}},{id:"2",question_id:"1",user_id:"ai",content:"Based on Singapore employment law, here's what you should know about probation period terminations:\n\n**Legal Framework:**\n- The Employment Act provides the basic framework for employment relationships\n- Probation periods are contractual arrangements between employer and employee\n- Different rules may apply based on your employment contract\n\n**During Probation:**\n- Employers generally have more flexibility to terminate\n- Notice periods may be shorter (often 1 day to 1 week)\n- Performance standards may be more strictly applied\n\n**Important Considerations:**\n- Check your specific employment contract terms\n- Ensure termination is not discriminatory\n- You're entitled to outstanding wages and benefits\n\n**Next Steps:**\n- Review your employment contract\n- Document any relevant communications\n- Consider seeking legal advice if you believe the termination was unfair",answer_type:"ai",sources:["Singapore Employment Act","MOM Employment Guidelines"],disclaimer:"This AI-generated response is for informational purposes only and does not constitute legal advice.",is_accepted:!1,expert_verified:!1,upvote_count:8,downvote_count:0,helpful_count:6,moderation_status:"approved",created_at:"2024-01-15T12:00:00Z",updated_at:"2024-01-15T12:00:00Z",user:{id:"ai",full_name:"AI Assistant",avatar_url:void 0}}];switch(e.question_id&&(t=t.filter(s=>s.question_id===e.question_id)),e.answer_type&&(t=t.filter(s=>s.answer_type===e.answer_type)),void 0!==e.expert_verified&&(t=t.filter(s=>s.expert_verified===e.expert_verified)),void 0!==e.is_accepted&&(t=t.filter(s=>s.is_accepted===e.is_accepted)),e.sort_by){case"oldest":t.sort((e,s)=>new Date(e.created_at).getTime()-new Date(s.created_at).getTime());break;case"most_votes":t.sort((e,s)=>s.upvote_count-e.upvote_count);break;case"most_helpful":t.sort((e,s)=>s.helpful_count-e.helpful_count);break;default:t.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())}t.sort((e,s)=>(s.is_accepted?1:0)-(e.is_accepted?1:0)),s(t)},300)});let s=Ct.from("legal_answers").select("\n        *,\n        user:profiles(id, full_name, avatar_url),\n        expert:legal_experts(\n          id,\n          specializations,\n          years_experience,\n          verification_status,\n          user:profiles(id, full_name, avatar_url),\n          law_firm:law_firms(id, name, logo_url)\n        )\n      ").eq("moderation_status","approved");switch(e.question_id&&(s=s.eq("question_id",e.question_id)),e.answer_type&&(s=s.eq("answer_type",e.answer_type)),void 0!==e.expert_verified&&(s=s.eq("expert_verified",e.expert_verified)),void 0!==e.is_accepted&&(s=s.eq("is_accepted",e.is_accepted)),e.sort_by){case"oldest":s=s.order("created_at",{ascending:!0});break;case"most_votes":s=s.order("upvote_count",{ascending:!1});break;case"most_helpful":s=s.order("helpful_count",{ascending:!1});break;default:s=s.order("created_at",{ascending:!1})}s=s.order("is_accepted",{ascending:!1});const{data:t,error:a}=await s;if(a)throw new Error("Failed to fetch answers");return t||[]},async createAnswer(e){const{data:s,error:t}=await Ct.from("legal_answers").insert({...e,moderation_status:"pending"}).select("\n        *,\n        user:profiles(id, full_name, avatar_url)\n      ").single();if(t)throw new Error("Failed to create answer");return s},async updateAnswer(e,s){const{data:t,error:a}=await Ct.from("legal_answers").update(s).eq("id",e).select("\n        *,\n        user:profiles(id, full_name, avatar_url)\n      ").single();if(a)throw new Error("Failed to update answer");return t},async generateAIAnswer(e){try{const s={content:`Based on Singapore law and the information provided, here's a general overview:\n\n${e.question_content}\n\nThis appears to be related to ${e.category||"general legal matters"}. In Singapore, such matters are typically governed by relevant statutes and case law.\n\n**Key considerations:**\n1. Legal requirements and procedures\n2. Relevant timeframes and deadlines\n3. Potential consequences and remedies\n4. Professional legal advice recommendations\n\n**Next steps:**\n- Consult with a qualified legal professional\n- Gather relevant documentation\n- Consider alternative dispute resolution if applicable`,sources:["Singapore Statutes Online","Singapore Law Reports","Legal Service Commission Guidelines"],disclaimer:"This AI-generated response is for informational purposes only and does not constitute legal advice. Please consult with a qualified legal professional for advice specific to your situation.",confidence_score:.75,suggested_experts:[]};return await this.createAnswer({question_id:e.question_id,content:s.content,answer_type:"ai",sources:s.sources,disclaimer:s.disclaimer,is_accepted:!1}),s}catch(s){throw new Error("Failed to generate AI answer")}},async voteOnQuestion(e,s){if(Yn)return new Promise(t=>{setTimeout(()=>{const a=Jn.find(s=>s.id===e);a&&("upvote"===s?a.upvote_count+=1:a.downvote_count+=1),t()},200)});await Ct.from("legal_qa_votes").delete().eq("question_id",e).eq("user_id",(await Ct.auth.getUser()).data.user?.id);const{error:t}=await Ct.from("legal_qa_votes").insert({question_id:e,vote_type:s,user_id:(await Ct.auth.getUser()).data.user?.id});if(t)throw new Error("Failed to vote on question")},async voteOnAnswer(e,s){if(Yn)return new Promise(e=>{setTimeout(()=>{e()},200)});await Ct.from("legal_qa_votes").delete().eq("answer_id",e).eq("vote_type",s).eq("user_id",(await Ct.auth.getUser()).data.user?.id);const{error:t}=await Ct.from("legal_qa_votes").insert({answer_id:e,vote_type:s,user_id:(await Ct.auth.getUser()).data.user?.id});if(t)throw new Error("Failed to vote on answer")},async getUserVote(e,s){const t=(await Ct.auth.getUser()).data.user?.id;if(!t)return null;let a=Ct.from("legal_qa_votes").select("*").eq("user_id",t);e&&(a=a.eq("question_id",e)),s&&(a=a.eq("answer_id",s));const{data:r,error:n}=await a.single();return n&&"PGRST116"!==n.code?null:r},async bookmarkQuestion(e){if(Yn)return new Promise(e=>{setTimeout(()=>{e()},200)});const{error:s}=await Ct.from("legal_qa_bookmarks").insert({question_id:e,user_id:(await Ct.auth.getUser()).data.user?.id});if(s)throw new Error("Failed to bookmark question")},async unbookmarkQuestion(e){if(Yn)return new Promise(e=>{setTimeout(()=>{e()},200)});const{error:s}=await Ct.from("legal_qa_bookmarks").delete().eq("question_id",e).eq("user_id",(await Ct.auth.getUser()).data.user?.id);if(s)throw new Error("Failed to unbookmark question")},async getUserBookmarks(){const e=(await Ct.auth.getUser()).data.user?.id;if(!e)return[];const{data:s,error:t}=await Ct.from("legal_qa_bookmarks").select("\n        question:legal_questions(\n          *,\n          user:profiles(id, full_name, avatar_url),\n          category:legal_qa_categories(id, name, color)\n        )\n      ").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw new Error("Failed to fetch bookmarks");return s?.map(e=>e.question).filter(Boolean)||[]},async getComments(e,s){let t=Ct.from("legal_qa_comments").select("\n        *,\n        user:profiles(id, full_name, avatar_url)\n      ").eq("moderation_status","approved").is("parent_id",null).order("created_at",{ascending:!0});e&&(t=t.eq("question_id",e)),s&&(t=t.eq("answer_id",s));const{data:a,error:r}=await t;if(r)throw new Error("Failed to fetch comments");return a||[]},async createComment(e){const{data:s,error:t}=await Ct.from("legal_qa_comments").insert({...e,moderation_status:"approved"}).select("\n        *,\n        user:profiles(id, full_name, avatar_url)\n      ").single();if(t)throw new Error("Failed to create comment");return s},async getExperts(e){let s=Ct.from("legal_experts").select("\n        *,\n        user:profiles(id, full_name, avatar_url, email),\n        law_firm:law_firms(id, name, logo_url)\n      ").eq("verification_status","verified").eq("is_active",!0).order("expertise_score",{ascending:!1});e&&(s=s.contains("specializations",[e]));const{data:t,error:a}=await s;if(a)throw new Error("Failed to fetch experts");return t||[]},async createExpertProfile(e){const{data:s,error:t}=await Ct.from("legal_experts").insert({...e,verification_status:"pending"}).select("\n        *,\n        user:profiles(id, full_name, avatar_url, email)\n      ").single();if(t)throw new Error("Failed to create expert profile");return s},async reportContent(e){const{error:s}=await Ct.from("legal_qa_reports").insert({...e,status:"pending"});if(s)throw new Error("Failed to report content")},async searchQuestions(e,s={}){return this.getQuestions({...s,search:e})},async getTrendingQuestions(e=10){return this.getQuestions({sort_by:"most_views",limit:e,featured:!0})},async getRecentQuestions(e=10){return this.getQuestions({sort_by:"newest",limit:e})}},Xn=[{id:"1",name:"Employment Law",description:"Questions about workplace rights, contracts, and employment disputes",icon:"",color:"#3B82F6",question_count:45,is_active:!0,order_index:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{id:"2",name:"Property Law",description:"Real estate transactions, landlord-tenant issues, and property disputes",icon:"",color:"#10B981",question_count:32,is_active:!0,order_index:2,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{id:"3",name:"Corporate Law",description:"Business formation, contracts, and corporate governance",icon:"",color:"#8B5CF6",question_count:28,is_active:!0,order_index:3,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{id:"4",name:"Family Law",description:"Divorce, custody, adoption, and family-related legal matters",icon:"",color:"#F59E0B",question_count:23,is_active:!0,order_index:4,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}],Zn=[{id:"1",title:"What are my rights if I'm terminated without notice?",content:"I was working for a company for 2 years and they suddenly terminated me without any notice period. They said it was due to restructuring but I suspect it might be because I raised concerns about workplace safety. What are my rights under Singapore employment law?",category:Xn[0],tags:["termination","notice period","employment rights"],urgency_level:"high",status:"open",view_count:156,upvote_count:12,downvote_count:1,answer_count:3,has_expert_answer:!0,has_ai_answer:!1,featured:!0,is_anonymous:!1,location:"Singapore",moderation_status:"approved",created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString(),user_id:"mock-user-1",category_id:"1",user:{id:"mock-user-1",full_name:"John Doe",avatar_url:null}},{id:"2",title:"Can my landlord increase rent during the lease period?",content:"I signed a 2-year lease agreement with my landlord 6 months ago. Now they want to increase the rent by 20% citing inflation and market rates. The lease agreement doesn't mention anything about rent increases during the lease period. Is this legal?",category:Xn[1],tags:["rental","lease agreement","rent increase"],urgency_level:"normal",status:"answered",view_count:89,upvote_count:8,downvote_count:0,answer_count:2,has_expert_answer:!1,has_ai_answer:!0,featured:!1,is_anonymous:!0,location:"Singapore",moderation_status:"approved",created_at:new Date(Date.now()-1728e5).toISOString(),updated_at:new Date(Date.now()-1728e5).toISOString(),user_id:"mock-user-2",category_id:"2",user:{id:"mock-user-2",full_name:"Anonymous User",avatar_url:null}}],ei=({onAskQuestion:e,className:s=""})=>{const{user:r}=hr(),n=S(),[i,l]=t.useState([]),[c,o]=t.useState([]),[d,m]=t.useState(!0),[u,h]=t.useState(null),[x,p]=t.useState(""),[g,f]=t.useState(""),[y,j]=t.useState("newest");t.useState(!1);const[w,b]=t.useState("all"),v=Array.isArray(i)?i:[];t.useState({page:1,limit:20});const N="https://kvlaydeyqidlfpfutbmp.supabase.co"?.includes("placeholder"),_=t.useCallback(async()=>{let e=!0;try{if(m(!0),h(null),N)return void(e&&(l(Xn),o(Zn)));const s=await Kn.getCategories();if(!e)return;Array.isArray(s)&&s.length>0?l(s):l(Xn);const t=await Kn.getQuestions({page:1,limit:20});if(!e)return;Array.isArray(t)&&t.length>0?o(t):o(Zn)}catch(s){e&&(l(Xn),o(Zn),h(null))}finally{e&&m(!1)}return()=>{e=!1}},[N]);t.useEffect(()=>{_()},[_]);const k=t.useCallback(async()=>{try{if(m(!0),N){let e=[...Zn];switch(x&&(e=e.filter(e=>e.title.toLowerCase().includes(x.toLowerCase())||e.content.toLowerCase().includes(x.toLowerCase()))),g&&(e=e.filter(e=>e.category_id===g)),w){case"trending":e=e.filter(e=>e.featured);break;case"expert":e=e.filter(e=>e.has_expert_answer);break;case"unanswered":e=e.filter(e=>"open"===e.status);break;case"ai":e=e.filter(e=>e.has_ai_answer)}return void o(e)}const e={page:1,limit:20,search:x||void 0,category_id:g||void 0,sort_by:y};switch(w){case"trending":e.sort_by="most_views",e.featured=!0;break;case"expert":e.has_expert_answer=!0;break;case"unanswered":e.status="open",e.sort_by="oldest";break;case"ai":e.has_ai_answer=!0}const s=await Kn.getQuestions(e);o(s)}catch(e){o(Zn)}finally{m(!1)}},[N,w,x,g,y]);t.useEffect(()=>{d||0===i.length||(x||g||"all"!==w)&&k()},[x,g,w,k,d,i.length,y]);const C=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"normal":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return u?a.jsx("div",{className:`space-y-6 ${s}`,children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Legal Q&A"}),a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[a.jsxs("p",{className:"text-red-800",children:["Error: ",u]}),a.jsx(fr,{onClick:()=>{h(null),m(!0),window.location.reload()},className:"mt-2",children:"Try Again"})]})]})}):a.jsxs("div",{className:`space-y-6 ${s}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Legal Q&A"}),a.jsxs("p",{className:"text-gray-600",children:["Get answers to your legal questions from the community and experts",N&&a.jsx("span",{className:"ml-2 text-sm text-blue-600",children:"(Demo Mode)"})]})]}),a.jsxs(fr,{onClick:e,className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(qe,{className:"h-4 w-4 mr-2"}),"Ask Question"]})]}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-4",children:a.jsx("form",{onSubmit:e=>{e.preventDefault(),k()},className:"space-y-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(yr,{placeholder:"Search legal questions...",value:x,onChange:e=>p(e.target.value),className:"pl-10"})]})}),a.jsx("div",{className:"w-full md:w-48",children:a.jsxs(yn,{value:g,onValueChange:f,children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"All categories"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"",children:"All categories"}),v.map(e=>e&&e.id&&e.name?a.jsx(_n,{value:e.id,children:e.name},e.id):null)]})]})}),a.jsx("div",{className:"w-full md:w-48",children:a.jsxs(yn,{value:y,onValueChange:e=>j(e),children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Sort by"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"newest",children:"Newest"}),a.jsx(_n,{value:"oldest",children:"Oldest"}),a.jsx(_n,{value:"most_votes",children:"Most Votes"}),a.jsx(_n,{value:"most_answers",children:"Most Answers"}),a.jsx(_n,{value:"most_views",children:"Most Views"})]})]})}),a.jsx(fr,{type:"submit",children:"Search"})]})})})}),a.jsxs(En,{value:w,onValueChange:b,children:[a.jsxs(Tn,{className:"grid w-full grid-cols-5",children:[a.jsx(In,{value:"all",children:"All Questions"}),a.jsx(In,{value:"trending",children:"Trending"}),a.jsx(In,{value:"expert",children:"Expert Answered"}),a.jsx(In,{value:"unanswered",children:"Unanswered"}),a.jsx(In,{value:"ai",children:"AI Answered"})]}),a.jsx(Dn,{value:w,className:"mt-6",children:a.jsx("div",{className:"space-y-4",children:d?a.jsx("div",{className:"space-y-4",children:[...Array(5)].map((e,s)=>a.jsx(zr,{className:"animate-pulse",children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"}),a.jsx("div",{className:"h-6 bg-gray-200 rounded w-20"})]})]})})},s))}):c.length>0?c.map(e=>a.jsx(zr,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>{return s=e.id,void n(`/legal-qa/${s}`);var s},children:a.jsxs(Wr,{className:"p-6",children:[a.jsx("div",{className:"flex items-start justify-between mb-3",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 hover:text-blue-600",children:e.title}),e.featured&&a.jsx($,{className:"h-4 w-4 text-yellow-500 fill-current"})]}),a.jsx("p",{className:"text-gray-600 text-sm line-clamp-2 mb-3",children:e.content}),a.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.category&&a.jsx(Yr,{variant:"secondary",className:"text-xs",style:{backgroundColor:e.category.color+"20",color:e.category.color},children:e.category.name}),a.jsx(Yr,{className:`text-xs ${C(e.urgency_level)}`,children:e.urgency_level}),e.tags.slice(0,3).map(e=>a.jsx(Yr,{variant:"outline",className:"text-xs",children:e},e))]})]})}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(P,{className:"h-4 w-4"}),a.jsx("span",{children:e.answer_count})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(rs,{className:"h-4 w-4"}),a.jsx("span",{children:e.view_count})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(Oe,{className:"h-4 w-4"}),a.jsx("span",{children:e.upvote_count})]}),e.has_expert_answer&&a.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[a.jsx(Te,{className:"h-4 w-4"}),a.jsx("span",{children:"Expert"})]}),e.has_ai_answer&&a.jsxs("div",{className:"flex items-center space-x-1 text-blue-600",children:[a.jsx(is,{className:"h-4 w-4"}),a.jsx("span",{children:"AI"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(Pn,{className:"h-6 w-6",children:[a.jsx(Rn,{src:e.user?.avatar_url}),a.jsx(Fn,{className:"text-xs",children:e.is_anonymous?"A":e.user?.full_name?.charAt(0)})]}),a.jsxs("div",{className:"text-xs text-gray-500",children:[a.jsx("span",{children:e.is_anonymous?"Anonymous":e.user?.full_name}),a.jsx("span",{className:"mx-1",children:""}),a.jsx("span",{children:$t(new Date(e.created_at),{addSuffix:!0})})]})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(fr,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),(async(e,s)=>{if(r)try{N||(await Kn.voteOnQuestion(e,s),await k()),Pt.success("Vote recorded")}catch(t){Pt.error("Failed to record vote")}else Pt.error("Please log in to vote")})(e.id,"upvote")},disabled:!r,children:a.jsx(Oe,{className:"h-4 w-4"})}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),(async e=>{if(r)try{N||await Kn.bookmarkQuestion(e),Pt.success("Question bookmarked")}catch(s){Pt.error("Failed to bookmark question")}else Pt.error("Please log in to bookmark questions")})(e.id)},disabled:!r,children:a.jsx(ls,{className:"h-4 w-4"})})]})]})]})]})},e.id)):a.jsx(zr,{children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx(P,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No questions found"}),a.jsx("p",{className:"text-gray-500 mb-4",children:x||g?"Try adjusting your search criteria or browse different categories.":"Be the first to ask a question in this category."}),e&&a.jsxs(fr,{onClick:e,children:[a.jsx(qe,{className:"h-4 w-4 mr-2"}),"Ask First Question"]})]})})})})]})]})},si=({onClose:e,onQuestionCreated:s,initialCategory:r})=>{const{user:n}=hr(),[i,l]=t.useState([]),[o,d]=t.useState(!1),[m,u]=t.useState(""),h=Array.isArray(i)?i:[],[x,p]=t.useState({title:"",content:"",category_id:r||"",tags:[],urgency_level:"normal",location:"Singapore",is_anonymous:!1});t.useEffect(()=>{g()},[]);const g=async()=>{try{const e=await Kn.getCategories();if(!Array.isArray(e))throw new Error("Categories data is not an array");l(e)}catch(e){Pt.error("Failed to load categories"),l([])}},f=(e,s)=>{p(t=>({...t,[e]:s}))},y=()=>{m.trim()&&!x.tags.includes(m.trim())&&(p(e=>({...e,tags:[...e.tags,m.trim()]})),u(""))};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs(zr,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(Br,{children:"Ask a Legal Question"}),a.jsx(Vr,{children:"Get help from the community and legal experts"})]}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:e,children:a.jsx(c,{className:"h-4 w-4"})})]}),a.jsx(Wr,{children:a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),n)if(x.title.trim()&&x.content.trim())try{d(!0);const e={...x,user_id:n.id,status:"open",view_count:0,upvote_count:0,downvote_count:0,answer_count:0,has_expert_answer:!1,has_ai_answer:!1,featured:!1},t=await Kn.createQuestion(e);Pt.success("Question submitted successfully! It will be reviewed before being published."),s(t)}catch(t){Pt.error("Failed to submit question. Please try again.")}finally{d(!1)}else Pt.error("Please fill in all required fields");else Pt.error("Please log in to ask a question")},className:"space-y-6",children:[a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(X,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"font-medium text-yellow-800 mb-1",children:"Important Legal Disclaimer"}),a.jsx("p",{className:"text-yellow-700",children:"This platform provides general information only and does not constitute legal advice. For specific legal matters, please consult with a qualified legal professional."})]})]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"title",children:"Question Title *"}),a.jsx(yr,{id:"title",value:x.title,onChange:e=>f("title",e.target.value),placeholder:"Briefly describe your legal question...",maxLength:200,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500",children:[x.title.length,"/200 characters"]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"content",children:"Question Details *"}),a.jsx(an,{id:"content",value:x.content,onChange:e=>f("content",e.target.value),placeholder:"Provide detailed information about your legal question. Include relevant facts, dates, and any specific circumstances...",rows:8,maxLength:5e3,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500",children:[x.content.length,"/5000 characters"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"category",children:"Category"}),a.jsxs(yn,{value:x.category_id,onValueChange:e=>f("category_id",e),children:[a.jsx(wn,{children:a.jsx(jn,{placeholder:"Select a category"})}),a.jsx(Nn,{children:h.map(e=>e&&e.id&&e.name?a.jsx(_n,{value:e.id,children:e.name},e.id):null)})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"urgency",children:"Urgency Level"}),a.jsxs(yn,{value:x.urgency_level,onValueChange:e=>f("urgency_level",e),children:[a.jsx(wn,{children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"low",children:"Low - General inquiry"}),a.jsx(_n,{value:"normal",children:"Normal - Standard question"}),a.jsx(_n,{value:"high",children:"High - Time-sensitive"}),a.jsx(_n,{value:"urgent",children:"Urgent - Immediate attention needed"})]})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"location",children:"Location (Optional)"}),a.jsx(yr,{id:"location",value:x.location,onChange:e=>f("location",e.target.value),placeholder:"e.g., Singapore, Orchard Road"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Specify location if relevant to your legal question"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"tags",children:"Tags (Optional)"}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:x.tags.map(e=>a.jsxs(Yr,{variant:"secondary",className:"flex items-center space-x-1",children:[a.jsx("span",{children:e}),a.jsx("button",{type:"button",onClick:()=>{return s=e,void p(e=>({...e,tags:e.tags.filter(e=>e!==s)}));var s},className:"ml-1 hover:text-red-600",children:a.jsx(c,{className:"h-3 w-3"})})]},e))}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(yr,{value:m,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),y())},placeholder:"Add tags to help categorize your question...",maxLength:30}),a.jsx(fr,{type:"button",onClick:y,variant:"outline",size:"sm",children:a.jsx(qe,{className:"h-4 w-4"})})]}),a.jsx("p",{className:"text-xs text-gray-500",children:'Add relevant tags like "contract", "employment", "property", etc.'})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Sn,{id:"anonymous",checked:x.is_anonymous,onCheckedChange:e=>f("is_anonymous",e)}),a.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:"Post anonymously"})]}),a.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Your name will not be displayed with this question"})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(cs,{className:"h-5 w-5 text-blue-600 mt-0.5"}),a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"font-medium text-blue-800 mb-2",children:"Tips for Better Answers"}),a.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs",children:[a.jsx("li",{children:" Be specific about your situation and provide relevant details"}),a.jsx("li",{children:" Include relevant dates, amounts, and parties involved"}),a.jsx("li",{children:" Mention any documents or agreements related to your question"}),a.jsx("li",{children:" Avoid sharing personal identifying information"}),a.jsx("li",{children:" Use clear, simple language to describe your situation"})]})]})]})}),a.jsxs("div",{className:"flex space-x-3 pt-4",children:[a.jsx(fr,{type:"button",variant:"outline",onClick:e,className:"flex-1",disabled:o,children:"Cancel"}),a.jsx(fr,{type:"submit",className:"flex-1",disabled:o||!x.title.trim()||!x.content.trim(),children:o?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx(os,{className:"h-4 w-4 mr-2"}),"Submit Question"]})})]})]})})]})})},ti=({questionId:e})=>{const{id:s}=We(),r=S(),{user:n}=hr(),i=e||s,[l,c]=t.useState(null),[o,d]=t.useState([]),[m,u]=t.useState(!0),[h,x]=t.useState(!1),[p,g]=t.useState(""),[f,y]=t.useState(!1),[j,w]=t.useState(!1);t.useEffect(()=>{i&&(b(),v())},[i]);const b=async()=>{if(i)try{u(!0);const e=await Kn.getQuestion(i);c(e)}catch(e){Pt.error("Failed to load question"),r("/legal-qa")}finally{u(!1)}},v=async()=>{if(i)try{x(!0);const e=await Kn.getAnswers({question_id:i});d(e)}catch(e){Pt.error("Failed to load answers")}finally{x(!1)}},N=async(e,s)=>{if(n)try{await Kn.voteOnAnswer(e,s),await v(),Pt.success("Vote recorded")}catch(t){Pt.error("Failed to record vote")}else Pt.error("Please log in to vote")},_=e=>{switch(e){case"expert":case"verified":return a.jsx(Te,{className:"h-4 w-4 text-green-600"});case"ai":return a.jsx(is,{className:"h-4 w-4 text-blue-600"});default:return a.jsx(E,{className:"h-4 w-4 text-gray-600"})}};return m?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Loading question..."})]})}):l?a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsxs("div",{className:"mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 py-8",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(fr,{variant:"outline",onClick:()=>r("/legal-qa"),className:"mb-4",children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Back to Q&A"]})}),a.jsxs(zr,{className:"mb-6",children:[a.jsx(Mr,{children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(Br,{className:"text-2xl mb-3",children:l.title}),a.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[l.category&&a.jsx(Yr,{variant:"secondary",style:{backgroundColor:l.category.color+"20",color:l.category.color},children:l.category.name}),a.jsx(Yr,{className:(e=>{switch(e){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"normal":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(l.urgency_level),children:l.urgency_level}),l.featured&&a.jsxs(Yr,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:[a.jsx($,{className:"h-3 w-3 mr-1 fill-current"}),"Featured"]}),l.tags.map(e=>a.jsx(Yr,{variant:"outline",className:"text-xs",children:e},e))]}),a.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(rs,{className:"h-4 w-4"}),a.jsxs("span",{children:[l.view_count," views"]})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(P,{className:"h-4 w-4"}),a.jsxs("span",{children:[l.answer_count," answers"]})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(q,{className:"h-4 w-4"}),a.jsxs("span",{children:["Asked ",$t(new Date(l.created_at),{addSuffix:!0})]})]}),l.location&&a.jsx("div",{className:"flex items-center space-x-1",children:a.jsxs("span",{children:[" ",l.location]})})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(fr,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(n&&l)try{await Kn.voteOnQuestion(l.id,e),await b(),Pt.success("Vote recorded")}catch(s){Pt.error("Failed to record vote")}else Pt.error("Please log in to vote")})("upvote"),disabled:!n,children:[a.jsx(Oe,{className:"h-4 w-4 mr-1"}),l.upvote_count]}),a.jsx(fr,{variant:"outline",size:"sm",onClick:async()=>{if(n&&l)try{j?(await Kn.unbookmarkQuestion(l.id),w(!1),Pt.success("Bookmark removed")):(await Kn.bookmarkQuestion(l.id),w(!0),Pt.success("Question bookmarked"))}catch(e){Pt.error("Failed to update bookmark")}else Pt.error("Please log in to bookmark questions")},disabled:!n,children:j?a.jsx(ds,{className:"h-4 w-4"}):a.jsx(ls,{className:"h-4 w-4"})}),a.jsx(fr,{variant:"outline",size:"sm",children:a.jsx(Ye,{className:"h-4 w-4"})})]})]})}),a.jsxs(Wr,{children:[a.jsx("div",{className:"prose max-w-none mb-6",children:a.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:l.content})}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs(Pn,{children:[a.jsx(Rn,{src:l.user?.avatar_url}),a.jsx(Fn,{children:l.is_anonymous?"A":l.user?.full_name?.charAt(0)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:l.is_anonymous?"Anonymous":l.user?.full_name}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Asked ",$t(new Date(l.created_at),{addSuffix:!0})]})]})]}),!l.has_ai_answer&&a.jsxs(fr,{variant:"outline",onClick:async()=>{if(l)try{Pt.info("Generating AI answer..."),await Kn.generateAIAnswer({question_id:l.id,question_title:l.title,question_content:l.content,category:l.category?.name,tags:l.tags,location:l.location}),await v(),Pt.success("AI answer generated successfully!")}catch(e){Pt.error("Failed to generate AI answer")}},className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:[a.jsx(is,{className:"h-4 w-4 mr-2"}),"Get AI Answer"]})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[l.answer_count," Answer",1!==l.answer_count?"s":""]})}),h?a.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,s)=>a.jsx(zr,{className:"animate-pulse",children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})},s))}):o.length>0?o.map(e=>a.jsx(zr,{className:e.is_accepted?"border-green-500 bg-green-50":"",children:a.jsxs(Wr,{className:"p-6",children:[a.jsx("div",{className:"flex items-start justify-between mb-4",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[_(e.answer_type),a.jsxs("span",{className:"text-sm font-medium capitalize text-gray-700",children:[e.answer_type," Answer"]}),e.is_accepted&&a.jsxs(Yr,{className:"bg-green-100 text-green-800",children:[a.jsx(L,{className:"h-3 w-3 mr-1"}),"Accepted"]}),e.expert_verified&&a.jsxs(Yr,{className:"bg-blue-100 text-blue-800",children:[a.jsx(B,{className:"h-3 w-3 mr-1"}),"Expert Verified"]})]})}),a.jsx("div",{className:"prose max-w-none mb-4",children:a.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.content})}),"ai"===e.answer_type&&e.disclaimer&&a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:a.jsx("p",{className:"text-xs text-yellow-800",children:e.disclaimer})}),e.sources&&e.sources.length>0&&a.jsxs("div",{className:"mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Sources:"}),a.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:e.sources.map((e,s)=>a.jsxs("li",{children:[" ",e]},s))})]}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs(fr,{variant:"ghost",size:"sm",onClick:()=>N(e.id,"upvote"),disabled:!n,children:[a.jsx(Oe,{className:"h-4 w-4 mr-1"}),e.upvote_count]}),a.jsxs(fr,{variant:"ghost",size:"sm",onClick:()=>N(e.id,"helpful"),disabled:!n,children:[a.jsx($,{className:"h-4 w-4 mr-1"}),e.helpful_count," Helpful"]}),a.jsxs(fr,{variant:"ghost",size:"sm",children:[a.jsx(P,{className:"h-4 w-4 mr-1"}),"Comment"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(Pn,{className:"h-6 w-6",children:[a.jsx(Rn,{src:e.user?.avatar_url}),a.jsx(Fn,{className:"text-xs",children:"ai"===e.answer_type?"AI":e.user?.full_name?.charAt(0)})]}),a.jsxs("div",{className:"text-xs text-gray-500",children:[a.jsx("span",{children:"ai"===e.answer_type?"AI Assistant":e.user?.full_name}),a.jsx("span",{className:"mx-1",children:""}),a.jsx("span",{children:$t(new Date(e.created_at),{addSuffix:!0})})]})]})]})]})},e.id)):a.jsx(zr,{children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx(P,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No answers yet"}),a.jsx("p",{className:"text-gray-500",children:"Be the first to answer this question!"})]})}),n&&a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{className:"text-lg",children:"Your Answer"}),a.jsx(Vr,{children:"Share your knowledge and help the community"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(an,{value:p,onChange:e=>g(e.target.value),placeholder:"Provide a helpful answer to this legal question...",rows:6,maxLength:5e3}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("p",{className:"text-xs text-gray-500",children:[p.length,"/5000 characters"]}),a.jsx(fr,{onClick:async()=>{if(n&&l&&p.trim())try{y(!0),await Kn.createAnswer({question_id:l.id,user_id:n.id,content:p.trim(),answer_type:"community",is_accepted:!1}),g(""),await v(),Pt.success("Answer submitted successfully!")}catch(e){Pt.error("Failed to submit answer")}finally{y(!1)}else Pt.error("Please log in and provide an answer")},disabled:!p.trim()||f,children:f?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Submit Answer"]})})]})]})})]})]})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Question Not Found"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"The question you're looking for doesn't exist or has been removed."}),a.jsxs(fr,{onClick:()=>r("/legal-qa"),children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Back to Q&A"]})]})})},ai=()=>{const[e,s]=t.useState({}),[r,n]=t.useState(!0);return t.useEffect(()=>{(async()=>{try{const e="https://kvlaydeyqidlfpfutbmp.supabase.co",t=e?.includes("placeholder"),a=await Kn.getCategories(),r=await Kn.getQuestions();s({environment:{supabaseUrl:e,isPlaceholder:t},categories:a,questions:r,success:!0})}catch(e){s({error:e.message,success:!1})}finally{n(!1)}})()},[]),r?a.jsx("div",{className:"p-4",children:"Running tests..."}):a.jsxs("div",{className:"p-4 bg-gray-50 rounded",children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"QA API Test Results"}),a.jsx("pre",{className:"bg-white p-4 rounded text-sm overflow-auto max-h-96",children:JSON.stringify(e,null,2)})]})},ri=()=>{const[e,s]=t.useState(!1);return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(Sr,{}),a.jsx("main",{className:"py-8 pt-20",children:a.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded",children:[a.jsx("p",{className:"text-blue-800",children:"Legal Q&A Page Loaded Successfully"}),a.jsxs("p",{className:"text-sm text-blue-600",children:["Environment: ","production"]}),a.jsxs("p",{className:"text-sm text-blue-600",children:["Supabase URL: ","https://kvlaydeyqidlfpfutbmp.supabase.co"]})]}),a.jsx(ai,{}),a.jsx(ei,{onAskQuestion:()=>s(!0)})]})}),a.jsx(nn,{}),e&&a.jsx(si,{onClose:()=>s(!1),onQuestionCreated:e=>{s(!1)}})]})};const ni=new class{constructor(){s(this,"MAX_LOGIN_ATTEMPTS",5),s(this,"LOCKOUT_DURATION",9e5),s(this,"SESSION_TIMEOUT",864e5),s(this,"SUSPICIOUS_ACTIVITY_THRESHOLD",10)}async trackSession(e,s){try{const t=await this.getSessionInfo(),{error:a}=await Ct.from("user_sessions").upsert({id:e,user_id:s,ip_address:t.ipAddress,user_agent:t.userAgent,device_type:t.deviceType,browser:t.browser,os:t.os,location:t.location,last_active_at:(new Date).toISOString(),expires_at:new Date(Date.now()+this.SESSION_TIMEOUT).toISOString()})}catch(t){}}async getSessionInfo(){const e=navigator.userAgent,s=await this.getUserIP();return{ipAddress:s,userAgent:e,deviceType:this.getDeviceType(e),browser:this.getBrowser(e),os:this.getOS(e),location:await this.getLocation(s)}}async getUserIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return"unknown"}}getDeviceType(e){return/Mobile|Android|iPhone|iPad/.test(e)?/iPad/.test(e)?"tablet":"mobile":"desktop"}getBrowser(e){return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Unknown"}getOS(e){return e.includes("Windows")?"Windows":e.includes("Mac")?"macOS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")?"iOS":"Unknown"}async getLocation(e){try{const s=await fetch(`https://ipapi.co/${e}/json/`),t=await s.json();return t.city&&t.country_name?`${t.city}, ${t.country_name}`:t.country_name||void 0}catch(s){return}}async logSecurityEvent(e,s){try{const{data:{user:t}}=await Ct.auth.getUser();if(!t)return;const a=await this.getSessionInfo(),{error:r}=await Ct.from("security_events").insert({user_id:t.id,event_type:e,ip_address:a.ipAddress,user_agent:a.userAgent,location:a.location,metadata:s||{}})}catch(t){}}async checkSuspiciousActivity(e,s){try{const{data:t,error:a}=await Ct.from("security_events").select("*").eq("ip_address",e).eq("event_type","failed_login").gte("created_at",new Date(Date.now()-36e5).toISOString()).order("created_at",{ascending:!1});if(a)return!1;if(t&&t.length>=this.SUSPICIOUS_ACTIVITY_THRESHOLD)return!0;if(s){const{data:e}=await Ct.from("security_events").select("location").eq("user_id",s).eq("event_type","login").gte("created_at",new Date(Date.now()-864e5).toISOString()).not("location","is",null);if(e){if(new Set(e.map(e=>e.location)).size>3)return!0}}return!1}catch(t){return!1}}async getUserSessions(e){try{const{data:s,error:t}=await Ct.from("user_sessions").select("*").eq("user_id",e).gt("expires_at",(new Date).toISOString()).order("last_active_at",{ascending:!1});if(t)return[];const a=await Ct.auth.getSession(),r=a.data.session?.access_token;return(s||[]).map(e=>({id:e.id,userId:e.user_id,ipAddress:e.ip_address,userAgent:e.user_agent,location:e.location,deviceType:e.device_type,browser:e.browser,os:e.os,isCurrentSession:e.id===r,createdAt:e.created_at,lastActiveAt:e.last_active_at,expiresAt:e.expires_at}))}catch(s){return[]}}async revokeSession(e){try{const{error:s}=await Ct.from("user_sessions").delete().eq("id",e);if(s)throw new Error("Failed to revoke session")}catch(s){throw s}}async revokeAllOtherSessions(e,s){try{const{error:t}=await Ct.from("user_sessions").delete().eq("user_id",e).neq("id",s);if(t)throw new Error("Failed to revoke other sessions");await this.logSecurityEvent("logout",{action:"revoke_all_sessions",sessions_revoked:"all_others"})}catch(t){throw t}}async getSecurityEvents(e,s=50){try{const{data:t,error:a}=await Ct.from("security_events").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(s);return a?[]:(t||[]).map(e=>({id:e.id,userId:e.user_id,eventType:e.event_type,ipAddress:e.ip_address,userAgent:e.user_agent,location:e.location,metadata:e.metadata,createdAt:e.created_at}))}catch(t){return[]}}async checkRateLimit(e){try{const{data:s,error:t}=await Ct.from("login_attempts").select("*").eq("ip_address",e).single();if(t&&"PGRST116"!==t.code)return{allowed:!0,attemptsRemaining:this.MAX_LOGIN_ATTEMPTS};if(!s)return{allowed:!0,attemptsRemaining:this.MAX_LOGIN_ATTEMPTS};const a=new Date,r=new Date(s.last_attempt),n=a.getTime()-r.getTime();if(s.blocked_until&&new Date(s.blocked_until)>a)return{allowed:!1,attemptsRemaining:0,resetTime:new Date(s.blocked_until)};if(n>this.LOCKOUT_DURATION)return await this.resetLoginAttempts(e),{allowed:!0,attemptsRemaining:this.MAX_LOGIN_ATTEMPTS};const i=Math.max(0,this.MAX_LOGIN_ATTEMPTS-s.attempts);return{allowed:i>0,attemptsRemaining:i,resetTime:0===i?new Date(r.getTime()+this.LOCKOUT_DURATION):void 0}}catch(s){return{allowed:!0,attemptsRemaining:this.MAX_LOGIN_ATTEMPTS}}}async recordFailedLogin(e){try{const{data:s}=await Ct.from("login_attempts").select("*").eq("ip_address",e).single(),t=new Date,a=s?s.attempts+1:1,r=a>=this.MAX_LOGIN_ATTEMPTS?new Date(t.getTime()+this.LOCKOUT_DURATION).toISOString():null,{error:n}=await Ct.from("login_attempts").upsert({ip_address:e,attempts:a,last_attempt:t.toISOString(),blocked_until:r})}catch(s){}}async resetLoginAttempts(e){try{const{error:s}=await Ct.from("login_attempts").delete().eq("ip_address",e)}catch(s){}}},ii=t.forwardRef(({className:e,orientation:s="horizontal",decorative:t=!0,...r},n)=>a.jsx(ms,{ref:n,decorative:t,orientation:s,className:Wa("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...r}));ii.displayName=ms.displayName;const li=N,ci=_,oi=v,di=t.forwardRef(({className:e,...s},t)=>a.jsx(f,{ref:t,className:Wa("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));di.displayName=f.displayName;const mi=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(oi,{children:[a.jsx(di,{}),a.jsxs(y,{ref:r,className:Wa("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[s,a.jsxs(j,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));mi.displayName=y.displayName;const ui=({className:e,...s})=>a.jsx("div",{className:Wa("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});ui.displayName="DialogHeader";const hi=({className:e,...s})=>a.jsx("div",{className:Wa("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});hi.displayName="DialogFooter";const xi=t.forwardRef(({className:e,...s},t)=>a.jsx(w,{ref:t,className:Wa("text-lg font-semibold leading-none tracking-tight",e),...s}));xi.displayName=w.displayName;const pi=t.forwardRef(({className:e,...s},t)=>a.jsx(b,{ref:t,className:Wa("text-sm text-muted-foreground",e),...s}));pi.displayName=b.displayName;const gi=new class{async setupTwoFactor(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");try{const{data:s,error:t}=await Ct.functions.invoke("two-factor-setup",{body:{userId:e.id}});if(t)throw new Error(t.message||"Failed to setup 2FA");const a=await Rt.toDataURL(s.qrCodeData);return{secret:s.secret,qrCodeUrl:a,backupCodes:s.backupCodes}}catch(s){throw new Error("Failed to setup two-factor authentication")}}async enableTwoFactor(e,s){const{data:{user:t}}=await Ct.auth.getUser();if(!t)throw new Error("User must be authenticated");try{const{error:a}=await Ct.functions.invoke("two-factor-enable",{body:{userId:t.id,token:e,secret:s}});if(a)throw new Error(a.message||"Invalid verification code");await Ct.auth.updateUser({data:{two_factor_enabled:!0}})}catch(a){throw new Error("Failed to enable two-factor authentication")}}async disableTwoFactor(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User must be authenticated");try{const{error:t}=await Ct.auth.signInWithPassword({email:s.email,password:e});if(t)throw new Error("Invalid password");const{error:a}=await Ct.functions.invoke("two-factor-disable",{body:{userId:s.id}});if(a)throw new Error(a.message||"Failed to disable 2FA");await Ct.auth.updateUser({data:{two_factor_enabled:!1}})}catch(t){throw new Error("Failed to disable two-factor authentication")}}async verifyTwoFactor(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User must be authenticated");try{const{data:t,error:a}=await Ct.functions.invoke("two-factor-verify",{body:{userId:s.id,token:e.token,backupCode:e.backupCode}});if(a)throw new Error(a.message||"Invalid verification code");return t.verified}catch(t){throw new Error("Failed to verify two-factor authentication")}}async getTwoFactorStatus(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");try{const{data:s,error:t}=await Ct.functions.invoke("two-factor-status",{body:{userId:e.id}});if(t)throw new Error(t.message||"Failed to get 2FA status");return{isEnabled:s.isEnabled||!1,hasBackupCodes:s.hasBackupCodes||!1,lastUsed:s.lastUsed}}catch(s){return{isEnabled:e.user_metadata?.two_factor_enabled||!1,hasBackupCodes:!1}}}async generateBackupCodes(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");try{const{data:s,error:t}=await Ct.functions.invoke("two-factor-backup-codes",{body:{userId:e.id}});if(t)throw new Error(t.message||"Failed to generate backup codes");return s.backupCodes}catch(s){throw new Error("Failed to generate backup codes")}}isTwoFactorEnabled(e){return!0===e?.user_metadata?.two_factor_enabled}mockSetup(){return{secret:"JBSWY3DPEHPK3PXP",qrCodeUrl:"",backupCodes:["12345678","87654321","11111111","22222222","33333333","44444444","55555555","66666666"]}}async setupTwoFactorDev(){return this.setupTwoFactor()}async verifyTwoFactorDev(e){return this.verifyTwoFactor({token:e})}},fi=({onVerificationSuccess:e,onBack:s,userEmail:r})=>{const[n,i]=t.useState(""),[l,c]=t.useState(""),[o,d]=t.useState(!1),[m,u]=t.useState(null),[h,x]=t.useState(!1);return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"space-y-1",children:[a.jsx("div",{className:"flex items-center justify-center mb-4",children:a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(U,{className:"h-6 w-6 text-blue-600"})})}),a.jsx(Br,{className:"text-2xl font-bold text-center",children:"Two-Factor Authentication"}),a.jsx(Vr,{className:"text-center",children:h?"Enter one of your backup codes to continue":"Enter the verification code from your authenticator app"}),r&&a.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["Signing in as ",r]})]}),a.jsxs(Wr,{className:"space-y-4",children:[m&&a.jsxs(on,{variant:"destructive",children:[a.jsx(X,{className:"h-4 w-4"}),a.jsx(dn,{children:m})]}),a.jsxs("div",{className:"space-y-4",children:[h?a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"backup-code",children:"Backup Code"}),a.jsx(yr,{id:"backup-code",type:"text",value:l,onChange:e=>(e=>{const s=e.replace(/\D/g,"").slice(0,8);c(s),u(null)})(e.target.value),placeholder:"12345678",maxLength:8,className:"text-center text-lg tracking-widest",autoComplete:"one-time-code",autoFocus:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Enter one of your 8-digit backup codes"})]}):a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"verification-code",children:"Verification Code"}),a.jsx(yr,{id:"verification-code",type:"text",value:n,onChange:e=>(e=>{const s=e.replace(/\D/g,"").slice(0,6);i(s),u(null)})(e.target.value),placeholder:"000000",maxLength:6,className:"text-center text-lg tracking-widest",autoComplete:"one-time-code",autoFocus:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Enter the 6-digit code from your authenticator app"})]}),a.jsxs(fr,{onClick:async()=>{if(n||l){d(!0),u(null);try{let s=!1;if(s=await gi.verifyTwoFactor({token:n,backupCode:h?l:void 0}),!s)throw new Error("Invalid verification code");Pt.success("Two-factor authentication verified successfully"),e()}catch(s){u(s.message||"Invalid verification code")}finally{d(!1)}}else u("Please enter a verification code")},disabled:o||!h&&6!==n.length||h&&8!==l.length,className:"w-full",children:[o?a.jsx(us,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(U,{className:"h-4 w-4 mr-2"}),"Verify and Continue"]}),a.jsx(ii,{}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(fr,{variant:"ghost",onClick:()=>{x(!h),i(""),c(""),u(null)},className:"w-full text-sm",children:h?a.jsxs(a.Fragment,{children:[a.jsx(hs,{className:"h-4 w-4 mr-2"}),"Use authenticator app instead"]}):a.jsxs(a.Fragment,{children:[a.jsx(ts,{className:"h-4 w-4 mr-2"}),"Use backup code instead"]})}),s&&a.jsxs(fr,{variant:"outline",onClick:s,className:"w-full text-sm",children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Back to login"]})]})]}),a.jsx("div",{className:"text-center",children:a.jsxs(li,{children:[a.jsx(ci,{asChild:!0,children:a.jsx(fr,{variant:"link",className:"text-sm",children:"Need help?"})}),a.jsxs(mi,{children:[a.jsxs(ui,{children:[a.jsx(xi,{children:"Two-Factor Authentication Help"}),a.jsx(pi,{children:"Having trouble with your verification code?"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Authenticator App Issues:"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:" Make sure your device's time is synchronized"}),a.jsx("li",{children:" Check that you're using the correct account in your app"}),a.jsx("li",{children:" Try refreshing the code in your authenticator app"})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Lost Access?"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:" Use one of your backup codes"}),a.jsx("li",{children:" Contact support if you've lost both your device and backup codes"})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"Backup Codes:"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:" Each backup code can only be used once"}),a.jsx("li",{children:" Generate new backup codes after using them"}),a.jsx("li",{children:" Store them in a safe place"})]})]})]})]})]})})]})]})})},yi=Ut({email:Ot().email("Please enter a valid email address"),password:Ot().min(6,"Password must be at least 6 characters")}),ji=()=>{const[e,s]=t.useState(!1),[r,n]=t.useState(!1),[i,l]=t.useState(null),[c,o]=t.useState(!1),[d,m]=t.useState(""),[u,h]=t.useState(null),{signIn:x}=hr(),p=S();t.useEffect(()=>{(async()=>{try{const e=await fetch("https://api.ipify.org?format=json");if(!e?.ok){const e=await ni.checkRateLimit("127.0.0.1");return void h({attemptsRemaining:e.attemptsRemaining,resetTime:e.resetTime,isBlocked:!e.allowed})}const s=await e.json();if(!s?.ip){const e=await ni.checkRateLimit("127.0.0.1");return void h({attemptsRemaining:e.attemptsRemaining,resetTime:e.resetTime,isBlocked:!e.allowed})}const t=await ni.checkRateLimit(s.ip);h({attemptsRemaining:t.attemptsRemaining,resetTime:t.resetTime,isBlocked:!t.allowed})}catch(e){try{const e=await ni.checkRateLimit("127.0.0.1");h({attemptsRemaining:e.attemptsRemaining,resetTime:e.resetTime,isBlocked:!e.allowed})}catch(s){h({attemptsRemaining:5,resetTime:void 0,isBlocked:!1})}}})()},[]);const{register:g,handleSubmit:f,formState:{errors:y}}=Xe({resolver:zt(yi)}),j=()=>{o(!1),p(Lr.dashboard)},w=()=>{o(!1),m("")};return c?a.jsx(fi,{onVerificationSuccess:j,onBack:w,userEmail:d}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"space-y-1",children:[a.jsx(Br,{className:"text-2xl font-bold text-center",children:"Sign in"}),a.jsx(Vr,{className:"text-center",children:"Enter your email and password to access your account"})]}),a.jsxs("form",{onSubmit:f(async e=>{n(!0),l(null);try{(await x(e.email,e.password)).requiresTwoFactor?(m(e.email),o(!0)):p(Lr.dashboard)}catch(s){l(s.message??"An error occurred during login")}finally{n(!1)}}),children:[a.jsxs(Wr,{className:"space-y-4",children:[i&&a.jsx(on,{variant:"destructive",children:a.jsx(dn,{children:i})}),u?.isBlocked&&a.jsxs(on,{variant:"destructive",children:[a.jsx(X,{className:"h-4 w-4"}),a.jsxs(dn,{children:["Too many failed login attempts. Please try again ",u.resetTime?.toLocaleTimeString(),"."]})]}),u&&!u.isBlocked&&u.attemptsRemaining<3&&a.jsxs(on,{children:[a.jsx(U,{className:"h-4 w-4"}),a.jsxs(dn,{children:[u.attemptsRemaining," login attempts remaining before temporary lockout."]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"email",children:"Email"}),a.jsx(yr,{id:"email",type:"email",placeholder:"Enter your email",...g("email"),disabled:r}),y.email&&a.jsx("p",{className:"text-sm text-red-600",children:y.email.message})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(yr,{id:"password",type:e?"text":"password",placeholder:"Enter your password",...g("password"),disabled:r}),a.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s(!e),disabled:r,children:e?a.jsx(xs,{className:"h-4 w-4"}):a.jsx(rs,{className:"h-4 w-4"})})]}),y.password&&a.jsx("p",{className:"text-sm text-red-600",children:y.password.message})]}),a.jsx("div",{className:"flex items-center justify-between",children:a.jsx(k,{to:Lr.forgotPassword,className:"text-sm text-blue-600 hover:text-blue-500",children:"Forgot your password?"})})]}),a.jsxs(Gr,{className:"flex flex-col space-y-4",children:[a.jsxs(fr,{type:"submit",className:"w-full",disabled:r||u?.isBlocked,children:[r&&a.jsx(us,{className:"mr-2 h-4 w-4 animate-spin"}),u?.isBlocked?"Account Temporarily Locked":"Sign in"]}),a.jsxs("p",{className:"text-center text-sm text-gray-600",children:["Don't have an account?"," ",a.jsx(k,{to:Lr.register,className:"text-blue-600 hover:text-blue-500 font-medium",children:"Sign up"})]})]})]})]})})},wi=({children:e,requireAuth:s=!0,redirectTo:t=Lr.login,fallbackToGuest:r=!1})=>{const{user:n,loading:i}=xr(),l=ps();return i?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[a.jsx(us,{className:"h-8 w-8 animate-spin"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Loading..."})]})}):s&&!n?r?a.jsx(un,{children:a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 text-center",children:[a.jsx("div",{className:"mb-4",children:a.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(U,{className:"w-6 h-6 text-blue-600"})})}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Authentication Required"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"This page requires you to be signed in. Please log in to continue."}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(fr,{onClick:()=>window.location.href=Lr.login,className:"w-full",children:"Sign In"}),a.jsx(fr,{onClick:()=>window.location.href=Lr.home,variant:"outline",className:"w-full",children:"Back to Home"})]})]})})}):a.jsx(gs,{to:t,state:{from:l},replace:!0}):!s&&n?a.jsx(gs,{to:Lr.dashboard,replace:!0}):a.jsx(un,{children:e})},bi=({children:e,fallbackToGuest:s=!0})=>a.jsx(wi,{requireAuth:!0,fallbackToGuest:s,children:e}),vi=({children:e})=>a.jsx(wi,{requireAuth:!1,children:e}),Ni=()=>a.jsx(vi,{children:a.jsx(ji,{})}),_i=()=>{const[e,s]=t.useState("loading"),[r,n]=t.useState(null),[i,l]=t.useState("loading"),[c,o]=t.useState("loading");t.useEffect(()=>{(async()=>{try{const{error:e}=await Ct.auth.getSession();if(e)return s("error"),void n(e.message);s("success");const{data:{user:t},error:a}=await Ct.auth.getUser();if(a)l("unauthenticated"),o("missing");else if(t){l("authenticated");const{error:e}=await Ct.from("profiles").select("*").eq("id",t.id).single();e?"PGRST116"===e.code?o("missing"):o("error"):o("exists")}else l("unauthenticated"),o("missing")}catch(e){s("error"),n(e.message),l("unauthenticated"),o("missing")}})()},[]);const d=(e,s,t,r)=>{switch(e){case"success":case"exists":case"authenticated":return a.jsxs(Yr,{variant:"default",className:"bg-green-100 text-green-800",children:[a.jsx(L,{className:"w-3 h-3 mr-1"}),s]});case"error":case"missing":return a.jsxs(Yr,{variant:"destructive",children:[a.jsx(es,{className:"w-3 h-3 mr-1"}),t]});case"unauthenticated":return a.jsxs(Yr,{variant:"secondary",children:[a.jsx(es,{className:"w-3 h-3 mr-1"}),"Not Authenticated"]});default:return a.jsxs(Yr,{variant:"outline",children:[a.jsx(us,{className:"w-3 h-3 mr-1 animate-spin"}),r]})}};return a.jsxs(zr,{className:"w-full max-w-md mx-auto",children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Supabase Connection Status"}),a.jsx(Vr,{children:"Debug information for authentication issues"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium",children:"Database Connection:"}),d(e,"Connected","Failed","Testing...")]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium",children:"Authentication:"}),d(i,"Authenticated","Error","Checking...")]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium",children:"Profile:"}),d(c,"Exists","Missing","Loading...")]}),r&&a.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:[a.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Error Details:"}),a.jsx("p",{className:"text-xs text-red-600 mt-1",children:r})]}),a.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Project:"})," kvlaydeyqidlfpfutbmp"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"URL:"})," ","https://kvlaydeyqidlfpfutbmp.supabase.co"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Environment:"})," ","production"]})]})]})]})},Si=()=>{const[e,s]=t.useState([]),[r,n]=t.useState(!1);t.useState(null);const i=async()=>{n(!0);const e=[];try{const a="https://craftchatbot.com";e.push({name:"App URL",expected:"http://localhost:8082",actual:a,status:"http://localhost:8082"===a?"pass":"fail",description:"Application base URL should match development server"});const r="https://craftchatbot.com";e.push({name:"Supabase Site URL",expected:"http://localhost:8082",actual:r,status:"http://localhost:8082"===r?"pass":"fail",description:"Supabase site URL should match app URL"});const n=nr(),i=n.includes("http://localhost:8082");e.push({name:"Auth Redirect URLs",expected:"Contains http://localhost:8082",actual:n.join(", "),status:i?"pass":"fail",description:"Redirect URLs should include the development server URL"});const l="https://craftchatbot.com";if(e.push({name:"Environment VITE_APP_URL",expected:"http://localhost:8082",actual:l||"undefined",status:"http://localhost:8082"===l?"pass":"warning",description:"Environment variable should match development server"}),"undefined"!=typeof window){const s=window.location.origin;e.push({name:"Window Origin",expected:"http://localhost:8082",actual:s,status:"http://localhost:8082"===s?"pass":"warning",description:"Browser window origin should match expected URL"})}const c=cr(),o="http://localhost:8082/dashboard";e.push({name:"Sign-in Redirect",expected:o,actual:c.redirectTo,status:c.redirectTo===o?"pass":"fail",description:"Sign-in should redirect to dashboard"});try{const{data:s,error:t}=await Ct.auth.getSession();e.push({name:"Supabase Connection",expected:"No error",actual:t?t.message:"Connected",status:t?"fail":"pass",description:"Supabase client should connect successfully"})}catch(t){e.push({name:"Supabase Connection",expected:"No error",actual:t instanceof Error?t.message:"Unknown error",status:"fail",description:"Supabase client should connect successfully"})}s(e)}catch(t){}finally{n(!1)}};t.useEffect(()=>{i()},[]);const l=e=>{switch(e){case"pass":return a.jsx(L,{className:"h-4 w-4 text-green-500"});case"fail":return a.jsx(es,{className:"h-4 w-4 text-red-500"});case"warning":return a.jsx(fs,{className:"h-4 w-4 text-yellow-500"});default:return null}};return a.jsxs(zr,{className:"w-full max-w-4xl",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:["Authentication URL Configuration Test",r&&a.jsx(Z,{className:"h-4 w-4 animate-spin"})]}),a.jsx(Vr,{children:"Verify that all URL configurations are properly set for authentication"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{onClick:i,disabled:r,size:"sm",children:r?"Running Tests...":"Run Tests"}),a.jsx(fr,{onClick:()=>{},variant:"outline",size:"sm",children:"Debug Config"})]})]}),a.jsx(Wr,{children:a.jsx("div",{className:"space-y-4",children:e.map((e,s)=>{return a.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:l(e.status)}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("h4",{className:"font-medium",children:e.name}),(t=e.status,a.jsx(Yr,{variant:{pass:"default",fail:"destructive",warning:"secondary"}[t]||"secondary",children:t.toUpperCase()}))]}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),a.jsxs("div",{className:"text-xs space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Expected:"})," ",a.jsx("code",{className:"bg-gray-100 px-1 rounded",children:e.expected})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Actual:"})," ",a.jsx("code",{className:"bg-gray-100 px-1 rounded",children:e.actual})]})]})]})]},s);var t})})})]})},ki=()=>a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsxs("div",{className:"container mx-auto px-4",children:[a.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"Debug Information"}),a.jsxs(zr,{className:"mb-6",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(L,{className:"h-5 w-5 text-green-500"}),"System Status"]}),a.jsx(Vr,{children:"Recent fixes applied to resolve loading issues"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Yr,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:" Navigation Fixed"})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Yr,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:" Auth Integration"})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Yr,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:" MCP Server Ready"})})]})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(_i,{}),a.jsx(Si,{})]})]})}),Ai={async getDocuments(){try{const{data:e,error:s}=await Ct.from("uploaded_documents").select("*").order("created_at",{ascending:!1});if(s)throw s;if(!Array.isArray(e))return[];return e.filter(e=>!(!e||"object"!=typeof e)&&(e.id&&e.filename)).map(e=>({...e,processing_status:e.processing_status||"pending",document_structure:e.document_structure||{}}))}catch(e){throw e}},async getDocument(e){const{data:s,error:t}=await Ct.from("uploaded_documents").select("*").eq("id",e).single();if(t)throw t;return s},async uploadDocument(e,s){const t=await Ct.auth.getUser();if(!t.data.user)throw new Error("User not authenticated");try{const{usageTrackingService:e}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url),s=await e.checkUsageLimit("document_upload");if(!s.allowed)throw new Error(`Upload limit exceeded. You have used ${s.current}/${s.limit} document uploads this month. Please upgrade your plan to continue.`)}catch(c){}const a=`${t.data.user.id}/${Date.now()}-${e.name}`,{error:r}=await Ct.storage.from("documents").upload(a,e);if(r)throw r;const{data:{publicUrl:n}}=Ct.storage.from("documents").getPublicUrl(a),{data:i,error:l}=await Ct.from("uploaded_documents").insert({user_id:t.data.user.id,filename:e.name,file_url:n,file_size:e.size,document_type:s,processing_status:"pending"}).select().single();if(l)throw l;return i},async updateDocument(e,s){const{data:t,error:a}=await Ct.from("uploaded_documents").update(s).eq("id",e).select().single();if(a)throw a;return t},async deleteDocument(e){const s=(await this.getDocument(e)).file_url.split("/").pop();s&&await Ct.storage.from("documents").remove([s]);const{error:t}=await Ct.from("uploaded_documents").delete().eq("id",e);if(t)throw t},async searchDocuments(e){try{if(!e||e.trim().length<2)return[];const{data:s,error:t}=await Ct.from("uploaded_documents").select("*").or(`filename.ilike.%${e}%,ocr_text.ilike.%${e}%`).order("created_at",{ascending:!1});if(t)throw t;if(!Array.isArray(s))return[];return s.filter(e=>!(!e||"object"!=typeof e)&&(e.id&&e.filename)).map(e=>({...e,processing_status:e.processing_status||"pending",document_structure:e.document_structure||{}}))}catch(s){throw s}},async getDocumentsByStatus(e){const{data:s,error:t}=await Ct.from("uploaded_documents").select("*").eq("processing_status",e).order("created_at",{ascending:!1});if(t)throw t;return s},async downloadDocument(e,s=!0){if(!(await Ct.auth.getUser()).data.user)throw new Error("User not authenticated");const t=await this.getDocument(e);if(s){const{usageTrackingService:s}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url),a=await s.checkAndIncrementUsage("document_download",e,{filename:t.filename,document_type:t.document_type,file_size:t.file_size});if(!a.allowed)throw new Error(`Download limit exceeded. You have used ${a.limit?.current}/${a.limit?.limit} document downloads this month. Please upgrade your plan to continue.`)}const a=t.file_url.split("/").pop();if(!a)throw new Error("Invalid file URL");const{data:r,error:n}=await Ct.storage.from("documents").download(a);if(n)throw n;return{data:r,filename:t.filename,contentType:`application/${t.document_type}`}},async getDocumentUsage(){const{usageTrackingService:e}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url);return await e.getUsageStats()}},Ci=Object.freeze(Object.defineProperty({__proto__:null,documentsApi:Ai},Symbol.toStringTag,{value:"Module"}));const Ei=new class{async checkUsageLimit(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User must be authenticated");const{data:t,error:a}=await Ct.rpc("check_subscription_limit",{p_user_id:s.id,p_resource_type:e});if(a)throw new Error(`Failed to check usage limit: ${a.message}`);const r=t;return{allowed:r.allowed,limit:r.limit,current:r.current_usage,remaining:r.remaining,tier:r.tier,percentage:r.limit>0?r.current_usage/r.limit*100:0}}async incrementUsage(e,s,t){const{data:{user:a}}=await Ct.auth.getUser();if(!a)throw new Error("User must be authenticated");const{error:r}=await Ct.rpc("increment_usage",{p_user_id:a.id,p_resource_type:e,p_resource_id:s||null,p_metadata:t||{}});if(r)throw new Error(`Failed to increment usage: ${r.message}`);await this.checkAndCreateUsageAlerts(a.id,e)}async getUsageStats(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");const s=(new Date).toISOString().slice(0,7),t=this.getNextMonth(s),{data:a,error:r}=await Ct.from("usage_tracking").select("resource_type, usage_count").eq("user_id",e.id).gte("usage_date",`${s}-01`).lt("usage_date",`${t}-01`);if(r)throw new Error(`Failed to fetch usage stats: ${r.message}`);const n={ai_queries:0,document_uploads:0,document_downloads:0,custom_documents:0};return a?.forEach(e=>{e.resource_type in n&&(n[e.resource_type]+=e.usage_count)}),n}async getUserLimits(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");const{data:s}=await Ct.from("profiles").select("subscription_tier").eq("id",e.id).single(),t=Ir[s?.subscription_tier||"free"];return{ai_query:t.limits.monthlyAiRequests,document_upload:t.limits.monthlyDocumentUploads,document_download:t.limits.monthlyDocumentUploads,custom_document:t.limits.customDocumentDownloads}}async checkAndCreateUsageAlerts(e,s){try{const t=await this.checkUsageLimit(s);t.percentage>=80&&t.percentage<100&&await Ct.rpc("create_billing_alert",{p_user_id:e,p_alert_type:"usage_limit_warning",p_resource_type:s,p_threshold_percentage:Math.round(t.percentage)}),t.percentage>=100&&await Ct.rpc("create_billing_alert",{p_user_id:e,p_alert_type:"usage_limit_reached",p_resource_type:s,p_threshold_percentage:100})}catch(t){}}async getBillingAlerts(e=!1){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User must be authenticated");let t=Ct.from("billing_alerts").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});e&&(t=t.eq("is_read",!1));const{data:a,error:r}=await t;if(r)throw new Error(`Failed to fetch billing alerts: ${r.message}`);return a||[]}async markAlertAsRead(e){const{error:s}=await Ct.from("billing_alerts").update({is_read:!0}).eq("id",e);if(s)throw new Error(`Failed to mark alert as read: ${s.message}`)}async checkAndIncrementUsage(e,s,t){const a=await this.checkUsageLimit(e);return a.allowed?(await this.incrementUsage(e,s,t),{allowed:!0,limit:a}):{allowed:!1,limit:a}}getNextMonth(e){const[s,t]=e.split("-").map(Number);return`${12===t?s+1:s}-${(12===t?1:t+1).toString().padStart(2,"0")}`}},Ti=Object.freeze(Object.defineProperty({__proto__:null,usageTrackingService:Ei},Symbol.toStringTag,{value:"Module"})),Ii=()=>{const{user:e,profile:s,loading:r,refreshProfile:n}=hr(),[i,l]=t.useState([]),[c,o]=t.useState(!1),d=e=>{l(s=>[...s,`${(new Date).toLocaleTimeString()}: ${e}`])};return r?a.jsx("div",{children:"Loading auth state..."}):a.jsxs(zr,{className:"w-full max-w-4xl mx-auto",children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Upload Diagnostics"})}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{onClick:async()=>{o(!0),l([]);try{if(d("Starting upload diagnostics..."),d("1. Checking authentication..."),!e)return void d(" User not authenticated");if(d(` User authenticated: ${e.email}`),d("2. Checking user profile..."),!s)return void d(" User profile not loaded");d(` Profile loaded: ${s.email}, Tier: ${s.subscription_tier||"free"}`),d("3. Testing Supabase connection...");try{const{data:e,error:s}=await Ct.from("profiles").select("id").limit(1);if(s)throw s;d(" Supabase connection working")}catch(t){return void d(` Supabase connection failed: ${t.message}`)}d("4. Checking storage buckets...");try{const{data:e,error:s}=await Ct.storage.listBuckets();if(s)throw s;if(!e.find(e=>"documents"===e.id))return void d(" Documents bucket not found");d(" Documents bucket exists")}catch(t){return void d(` Storage bucket check failed: ${t.message}`)}d("5. Testing usage tracking...");try{const e=await Ei.checkUsageLimit("document_upload");d(` Usage check successful: ${e.current}/${e.limit} used`),e.allowed||d(" Upload limit reached")}catch(t){d(` Usage tracking failed: ${t.message}`)}d("6. Testing file upload...");try{const e=new File(["test content"],"test.txt",{type:"text/plain"});if((await Ei.checkUsageLimit("document_upload")).allowed){const s=await Ai.uploadDocument(e,"other");d(` Test upload successful: ${s.id}`);try{await Ai.deleteDocument(s.id),d(" Test file cleaned up")}catch(a){d(` Cleanup failed: ${a.message}`)}}else d(" Skipping upload test - usage limit reached")}catch(t){d(` Upload test failed: ${t.message}`)}d(" Diagnostics completed!")}catch(t){d(` Diagnostics failed: ${t.message}`)}finally{o(!1)}},disabled:c||!e,children:c?"Running...":"Run Full Diagnostics"}),a.jsx(fr,{onClick:async()=>{o(!0),l([]);try{d("Testing storage permissions...");const s=new File(["test"],"test.txt",{type:"text/plain"}),t=`${e?.id}/test-${Date.now()}.txt`,{error:a}=await Ct.storage.from("documents").upload(t,s);if(a)d(` Storage upload failed: ${a.message}`);else{d(" Storage upload successful");const{error:e}=await Ct.storage.from("documents").remove([t]);d(e?` Cleanup failed: ${e.message}`:" Cleanup successful")}}catch(s){d(` Storage test failed: ${s.message}`)}finally{o(!1)}},disabled:c||!e,variant:"outline",children:"Test Storage Only"}),a.jsx(fr,{onClick:n,disabled:c||!e,variant:"outline",children:"Refresh Profile"})]}),!e&&a.jsx(on,{children:a.jsx(dn,{children:"Please log in to run upload diagnostics."})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold",children:"Current State:"}),a.jsxs("div",{className:"text-sm space-y-1",children:[a.jsxs("div",{children:["User: ",e?e.email:"Not authenticated"]}),a.jsxs("div",{children:["Profile: ",s?`${s.email} (${s.subscription_tier||"free"})`:"Not loaded"]}),a.jsxs("div",{children:["Loading: ",r?"Yes":"No"]})]})]}),i.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold",children:"Test Results:"}),a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto",children:i.map((e,s)=>a.jsx("div",{className:"text-sm font-mono",children:e},s))})]})]})]})},Di=()=>a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsxs("div",{className:"container mx-auto px-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[a.jsx(ss,{className:"h-8 w-8 text-blue-600"}),"Upload Debug & Testing"]}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Test and debug document upload functionality"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{asChild:!0,variant:"outline",children:a.jsx(k,{to:"/debug",children:" Back to Debug"})}),a.jsx(fr,{asChild:!0,variant:"outline",children:a.jsx(k,{to:"/dashboard/documents",children:"Dashboard Documents"})})]})]}),a.jsxs(zr,{className:"mb-6",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(L,{className:"h-5 w-5 text-green-500"}),"Upload System Status"]}),a.jsx(Vr,{children:"Current status of upload functionality and recent fixes"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Yr,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:" Upload Component"})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Yr,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:" File Validation"})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Yr,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:" Supabase Storage"})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx(Yr,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:" Testing Required"})})]})})]}),a.jsxs(zr,{className:"mb-6",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(ss,{className:"h-5 w-5 text-blue-500"}),"Upload Testing"]}),a.jsx(Vr,{children:"Test document upload functionality with detailed debugging"})]}),a.jsx(Wr,{children:a.jsx(Ii,{})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(X,{className:"h-5 w-5 text-orange-500"}),"System Diagnostics"]}),a.jsx(Vr,{children:"Comprehensive system health check and diagnostics"})]}),a.jsx(Wr,{children:a.jsx(Gn,{})})]})]})}),Pi=Ut({firstName:Ot().min(2,"First name must be at least 2 characters"),lastName:Ot().min(2,"Last name must be at least 2 characters"),email:Ot().email("Please enter a valid email address"),password:Ot().min(8,"Password must be at least 8 characters"),confirmPassword:Ot()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Ri=()=>{const[e,s]=t.useState(!1),[r,n]=t.useState(!1),[i,l]=t.useState(!1),[c,o]=t.useState(null),[d,m]=t.useState(!1),{signUp:u}=hr(),h=S(),{register:x,handleSubmit:p,formState:{errors:g}}=Xe({resolver:zt(Pi)});return d?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"space-y-1",children:[a.jsx(Br,{className:"text-2xl font-bold text-center text-green-600",children:"Registration Successful!"}),a.jsx(Vr,{className:"text-center",children:"Please check your email to verify your account before signing in."})]}),a.jsx(Gr,{children:a.jsx(fr,{onClick:()=>h(Lr.login),className:"w-full",children:"Go to Sign In"})})]})}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"space-y-1",children:[a.jsx(Br,{className:"text-2xl font-bold text-center",children:"Create Account"}),a.jsx(Vr,{className:"text-center",children:"Enter your information to create your account"})]}),a.jsxs("form",{onSubmit:p(async e=>{l(!0),o(null);try{await u(e.email,e.password,{first_name:e.firstName,last_name:e.lastName}),m(!0)}catch(s){o(s.message||"An error occurred during registration")}finally{l(!1)}}),children:[a.jsxs(Wr,{className:"space-y-4",children:[c&&a.jsx(on,{variant:"destructive",children:a.jsx(dn,{children:c})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"firstName",children:"First Name"}),a.jsx(yr,{id:"firstName",placeholder:"John",...x("firstName"),disabled:i}),g.firstName&&a.jsx("p",{className:"text-sm text-red-600",children:g.firstName.message})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"lastName",children:"Last Name"}),a.jsx(yr,{id:"lastName",placeholder:"Doe",...x("lastName"),disabled:i}),g.lastName&&a.jsx("p",{className:"text-sm text-red-600",children:g.lastName.message})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"email",children:"Email"}),a.jsx(yr,{id:"email",type:"email",placeholder:"john@example.com",...x("email"),disabled:i}),g.email&&a.jsx("p",{className:"text-sm text-red-600",children:g.email.message})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(yr,{id:"password",type:e?"text":"password",placeholder:"Create a password",...x("password"),disabled:i}),a.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s(!e),disabled:i,children:e?a.jsx(xs,{className:"h-4 w-4"}):a.jsx(rs,{className:"h-4 w-4"})})]}),g.password&&a.jsx("p",{className:"text-sm text-red-600",children:g.password.message})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"confirmPassword",children:"Confirm Password"}),a.jsxs("div",{className:"relative",children:[a.jsx(yr,{id:"confirmPassword",type:r?"text":"password",placeholder:"Confirm your password",...x("confirmPassword"),disabled:i}),a.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>n(!r),disabled:i,children:r?a.jsx(xs,{className:"h-4 w-4"}):a.jsx(rs,{className:"h-4 w-4"})})]}),g.confirmPassword&&a.jsx("p",{className:"text-sm text-red-600",children:g.confirmPassword.message})]})]}),a.jsxs(Gr,{className:"flex flex-col space-y-4",children:[a.jsxs(fr,{type:"submit",className:"w-full",disabled:i,children:[i&&a.jsx(us,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Account"]}),a.jsxs("p",{className:"text-center text-sm text-gray-600",children:["Already have an account?"," ",a.jsx(k,{to:Lr.login,className:"text-blue-600 hover:text-blue-500 font-medium",children:"Sign in"})]})]})]})]})})},Fi=()=>a.jsx(vi,{children:a.jsx(Ri,{})}),Li=Ut({email:Ot().email("Please enter a valid email address")}),$i=()=>{const[e,s]=t.useState(!1),[r,n]=t.useState(null),[i,l]=t.useState(!1),[c,o]=t.useState(""),{resetPassword:d}=hr(),{register:m,handleSubmit:u,formState:{errors:h}}=Xe({resolver:zt(Li)});return i?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"space-y-1",children:[a.jsx("div",{className:"flex items-center justify-center mb-4",children:a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(L,{className:"h-6 w-6 text-green-600"})})}),a.jsx(Br,{className:"text-2xl font-bold text-center",children:"Check Your Email"}),a.jsx(Vr,{className:"text-center",children:"We've sent a password reset link to your email address"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs(on,{children:[a.jsx(G,{className:"h-4 w-4"}),a.jsxs(dn,{children:["A password reset link has been sent to ",a.jsx("strong",{children:c}),". Please check your email and follow the instructions to reset your password."]})]}),a.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[a.jsx("p",{children:"Didn't receive the email?"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[a.jsx("li",{children:"Check your spam or junk folder"}),a.jsx("li",{children:"Make sure you entered the correct email address"}),a.jsx("li",{children:"Wait a few minutes for the email to arrive"})]})]})]}),a.jsxs(Gr,{className:"flex flex-col space-y-4",children:[a.jsxs(fr,{onClick:()=>{l(!1),o(""),n(null)},variant:"outline",className:"w-full",children:[a.jsx(G,{className:"mr-2 h-4 w-4"}),"Send Another Email"]}),a.jsx(k,{to:Lr.login,className:"w-full",children:a.jsxs(fr,{variant:"ghost",className:"w-full",children:[a.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Back to Sign In"]})})]})]})}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"space-y-1",children:[a.jsx("div",{className:"flex items-center justify-center mb-4",children:a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(G,{className:"h-6 w-6 text-blue-600"})})}),a.jsx(Br,{className:"text-2xl font-bold text-center",children:"Forgot Password?"}),a.jsx(Vr,{className:"text-center",children:"Enter your email address and we'll send you a link to reset your password"})]}),a.jsxs("form",{onSubmit:u(async e=>{s(!0),n(null);try{await d(e.email),l(!0),o(e.email)}catch(t){n(t.message??"An error occurred while sending the reset email")}finally{s(!1)}}),children:[a.jsxs(Wr,{className:"space-y-4",children:[r&&a.jsx(on,{variant:"destructive",children:a.jsx(dn,{children:r})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Un,{htmlFor:"email",children:"Email Address"}),a.jsx(yr,{id:"email",type:"email",placeholder:"Enter your email address",...m("email"),className:h.email?"border-red-500":"",autoComplete:"email",autoFocus:!0}),h.email&&a.jsx("p",{className:"text-sm text-red-600",children:h.email.message})]}),a.jsx("div",{className:"text-sm text-gray-600",children:a.jsx("p",{children:"We'll send you an email with instructions to reset your password. The link will be valid for 24 hours."})})]}),a.jsxs(Gr,{className:"flex flex-col space-y-4",children:[a.jsxs(fr,{type:"submit",className:"w-full",disabled:e,children:[e&&a.jsx(us,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Reset Link"]}),a.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm",children:[a.jsxs(k,{to:Lr.login,className:"text-blue-600 hover:text-blue-500 font-medium",children:[a.jsx(Ge,{className:"inline h-4 w-4 mr-1"}),"Back to Sign In"]}),a.jsx("span",{className:"text-gray-400",children:"|"}),a.jsx(k,{to:Lr.register,className:"text-blue-600 hover:text-blue-500 font-medium",children:"Create Account"})]})]})]})]})})},Ui=()=>a.jsx(vi,{children:a.jsx($i,{})}),qi=js,Oi=t.createContext({}),zi=({...e})=>a.jsx(Oi.Provider,{value:{name:e.name},children:a.jsx(ws,{...e})}),Mi=()=>{const e=t.useContext(Oi),s=t.useContext(Bi),{getFieldState:a,formState:r}=ys(),n=a(e.name,r);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:i}=s;return{id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},Bi=t.createContext({}),Vi=t.forwardRef(({className:e,...s},r)=>{const n=t.useId();return a.jsx(Bi.Provider,{value:{id:n},children:a.jsx("div",{ref:r,className:Wa("space-y-2",e),...s})})});Vi.displayName="FormItem";const Wi=t.forwardRef(({className:e,...s},t)=>{const{error:r,formItemId:n}=Mi();return a.jsx(Un,{ref:t,className:Wa(r&&"text-destructive",e),htmlFor:n,...s})});Wi.displayName="FormLabel";const Gi=t.forwardRef(({...e},s)=>{const{error:t,formItemId:r,formDescriptionId:n,formMessageId:i}=Mi();return a.jsx(g,{ref:s,id:r,"aria-describedby":t?`${n} ${i}`:`${n}`,"aria-invalid":!!t,...e})});Gi.displayName="FormControl";t.forwardRef(({className:e,...s},t)=>{const{formDescriptionId:r}=Mi();return a.jsx("p",{ref:t,id:r,className:Wa("text-sm text-muted-foreground",e),...s})}).displayName="FormDescription";const Hi=t.forwardRef(({className:e,children:s,...t},r)=>{const{error:n,formMessageId:i}=Mi(),l=n?String(n?.message):s;return l?a.jsx("p",{ref:r,id:i,className:Wa("text-sm font-medium text-destructive",e),...t,children:l}):null});Hi.displayName="FormMessage";const Yi=Ut({password:Ot().min(8,"Password must be at least 8 characters").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain at least one uppercase letter, one lowercase letter, and one number"),confirmPassword:Ot()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Qi=()=>{const e=S(),[s]=bs(),[r,n]=t.useState(!1),[i,l]=t.useState(!1),[c,o]=t.useState(!1),d=Xe({resolver:zt(Yi),defaultValues:{password:"",confirmPassword:""}});t.useEffect(()=>{const t=s.get("access_token"),a=s.get("refresh_token");if(!t||!a)return Pt.error("Invalid reset link. Please request a new password reset."),void e("/auth/forgot-password");Ct.auth.setSession({access_token:t,refresh_token:a})},[s,e]);return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:a.jsxs(zr,{className:"w-full max-w-md",children:[a.jsxs(Mr,{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>e("/auth/login"),className:"p-2",children:a.jsx(Ge,{className:"h-4 w-4"})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(vs,{className:"h-5 w-5 text-blue-600"}),a.jsx("span",{className:"font-semibold text-gray-900",children:"LawMattersSG"})]})]}),a.jsx(Br,{className:"text-2xl font-bold text-center",children:"Reset Password"}),a.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Enter your new password below"})]}),a.jsxs(Wr,{children:[a.jsx(qi,{...d,children:a.jsxs("form",{onSubmit:d.handleSubmit(async s=>{try{n(!0);const{error:t}=await Ct.auth.updateUser({password:s.password});if(t)throw t;Pt.success("Password updated successfully!"),await Ct.auth.signOut(),e("/auth/login",{state:{message:"Password updated successfully. Please log in with your new password."}})}catch(t){Pt.error(t.message||"Failed to update password. Please try again.")}finally{n(!1)}}),className:"space-y-4",children:[a.jsx(zi,{control:d.control,name:"password",render:({field:e})=>a.jsxs(Vi,{children:[a.jsx(Wi,{children:"New Password"}),a.jsx(Gi,{children:a.jsxs("div",{className:"relative",children:[a.jsx(yr,{...e,type:i?"text":"password",placeholder:"Enter your new password",disabled:r}),a.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>l(!i),disabled:r,children:i?a.jsx(xs,{className:"h-4 w-4"}):a.jsx(rs,{className:"h-4 w-4"})})]})}),a.jsx(Hi,{})]})}),a.jsx(zi,{control:d.control,name:"confirmPassword",render:({field:e})=>a.jsxs(Vi,{children:[a.jsx(Wi,{children:"Confirm New Password"}),a.jsx(Gi,{children:a.jsxs("div",{className:"relative",children:[a.jsx(yr,{...e,type:c?"text":"password",placeholder:"Confirm your new password",disabled:r}),a.jsx(fr,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>o(!c),disabled:r,children:c?a.jsx(xs,{className:"h-4 w-4"}):a.jsx(rs,{className:"h-4 w-4"})})]})}),a.jsx(Hi,{})]})}),a.jsx(fr,{type:"submit",className:"w-full",disabled:r,children:r?"Updating Password...":"Update Password"})]})}),a.jsx("div",{className:"mt-6 text-center",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Remember your password?"," ",a.jsx(fr,{variant:"link",className:"p-0 h-auto font-normal",onClick:()=>e("/auth/login"),children:"Sign in"})]})})]})]})})},Ji=()=>{const{user:e,profile:s,signOut:t,loading:r}=hr(),n=S();return a.jsx(bi,{children:a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("header",{className:"bg-white shadow",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center py-6",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs(fr,{variant:"outline",size:"sm",onClick:()=>n("/"),className:"flex items-center space-x-2",children:[a.jsx(ee,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Homepage"})]}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),a.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",s?.first_name||e?.email,"!"]})]})]}),a.jsx(fr,{onClick:async()=>{try{await t()}catch(e){window.location.href="/"}},variant:"outline",children:"Sign Out"})]})})}),a.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[a.jsxs(zr,{children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Br,{className:"text-sm font-medium",children:"Documents"}),a.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(Wr,{children:[a.jsx("div",{className:"text-2xl font-bold",children:"0"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Total uploaded documents"})]})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Br,{className:"text-sm font-medium",children:"AI Chats"}),a.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(Wr,{children:[a.jsx("div",{className:"text-2xl font-bold",children:"0"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"AI conversations this month"})]})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Br,{className:"text-sm font-medium",children:"Templates"}),a.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(Wr,{children:[a.jsx("div",{className:"text-2xl font-bold",children:"0"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Custom templates created"})]})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Br,{className:"text-sm font-medium",children:"super_admin"===s?.role||"admin"===s?.role?"Role":"Subscription"}),a.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(Wr,{children:[a.jsx("div",{className:"text-2xl font-bold capitalize",children:"super_admin"===s?.role?"Super Admin":"admin"===s?.role?"Admin":s?.subscription_tier||"Free"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"super_admin"===s?.role||"admin"===s?.role?"Administrative access":"Current plan"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Upload Documents"}),a.jsx(Vr,{children:"Upload and process your legal documents with AI"})]}),a.jsx(Wr,{children:a.jsx(k,{to:Lr.documents,children:a.jsxs(fr,{className:"w-full",children:[a.jsx(T,{className:"mr-2 h-4 w-4"}),"Upload Document"]})})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"AI Assistant"}),a.jsx(Vr,{children:"Get legal insights and answers from our AI"})]}),a.jsx(Wr,{children:a.jsx(k,{to:"/dashboard/ai-assistant",className:"block",children:a.jsxs(fr,{className:"w-full",children:[a.jsx(P,{className:"mr-2 h-4 w-4"}),"Start Chat"]})})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Browse Templates"}),a.jsx(Vr,{children:"Explore legal document templates"})]}),a.jsx(Wr,{children:a.jsx(k,{to:"/dashboard/templates",className:"block",children:a.jsxs(fr,{className:"w-full",children:[a.jsx(I,{className:"mr-2 h-4 w-4"}),"View Templates"]})})})]})]})]})})]})})},Ki=Rs,Xi=Fs;t.forwardRef(({className:e,inset:s,children:t,...r},n)=>a.jsxs(Ns,{ref:n,className:Wa("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",e),...r,children:[t,a.jsx(Ve,{className:"ml-auto h-4 w-4"})]})).displayName=Ns.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(_s,{ref:t,className:Wa("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})).displayName=_s.displayName;const Zi=t.forwardRef(({className:e,sideOffset:s=4,...t},r)=>a.jsx(Ss,{children:a.jsx(ks,{ref:r,sideOffset:s,className:Wa("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})}));Zi.displayName=ks.displayName;const el=t.forwardRef(({className:e,inset:s,...t},r)=>a.jsx(As,{ref:r,className:Wa("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",e),...t}));el.displayName=As.displayName;t.forwardRef(({className:e,children:s,checked:t,...r},n)=>a.jsxs(Cs,{ref:n,className:Wa("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:t,...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(Es,{children:a.jsx(ae,{className:"h-4 w-4"})})}),s]})).displayName=Cs.displayName;t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(Ts,{ref:r,className:Wa("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(Es,{children:a.jsx(Is,{className:"h-2 w-2 fill-current"})})}),s]})).displayName=Ts.displayName;const sl=t.forwardRef(({className:e,inset:s,...t},r)=>a.jsx(Ds,{ref:r,className:Wa("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...t}));sl.displayName=Ds.displayName;const tl=t.forwardRef(({className:e,...s},t)=>a.jsx(Ps,{ref:t,className:Wa("-mx-1 my-1 h-px bg-muted",e),...s}));tl.displayName=Ps.displayName;const al=Us,rl=qs,nl=t.forwardRef(({className:e,align:s="center",sideOffset:t=4,...r},n)=>a.jsx(Ls,{children:a.jsx($s,{ref:n,align:s,sideOffset:t,className:Wa("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));nl.displayName=$s.displayName;const il=new class{constructor(){s(this,"channels",new Map),s(this,"eventListeners",new Map),s(this,"presenceData",new Map)}subscribeToDocumentProcessing(e,s){return()=>{}}subscribeToDocumentAnnotations(e,s){return()=>{}}subscribeToUserPresence(e,s,t){return()=>{}}async updatePresence(e,s){}subscribeToSystemNotifications(e,s){return()=>{}}subscribeToCollaborationUpdates(e,s){return()=>{}}async broadcastEvent(e,s){}unsubscribe(e){}unsubscribeAll(){}getPresenceData(e){return[]}isConnected(){return!1}getConnectionStatus(){return"disabled"}},ll=({documentId:e,showUserPresence:s=!1,className:r=""})=>{const{isConnected:n,connectionStatus:i}=(()=>{const[e,s]=t.useState(!1),[a,r]=t.useState("disconnected");return t.useEffect(()=>{const e=()=>{const e=il.isConnected(),t=il.getConnectionStatus();s(e),r(t)};e();const t=setInterval(e,5e3);return()=>clearInterval(t)},[]),{isConnected:e,connectionStatus:a}})(),{presenceData:l}=(e=>{const[s,a]=t.useState([]),[r,n]=t.useState(!1),{user:i}=hr(),l=t.useRef(null);t.useEffect(()=>{if(!e||!i)return;n(!0);const s=il.subscribeToUserPresence(e,i.id,e=>{a(e)});return l.current=s,()=>{s(),n(!1)}},[e,i]);const c=t.useCallback(async s=>{e&&i&&await il.updatePresence(e,{user_id:i.id,document_id:e,...s})},[e,i]);return{presenceData:s,isConnected:r,updateCurrentPage:t.useCallback(e=>{c({current_page:e})},[c]),setStatus:t.useCallback(e=>{c({status:e,last_seen:(new Date).toISOString()})},[c]),updatePresence:c}})(e||""),c=e=>e.user_id.slice(0,2).toUpperCase(),o=l.filter(e=>"online"===e.status),d=l.filter(e=>"away"===e.status);return a.jsxs("div",{className:`flex items-center space-x-2 ${r}`,children:[a.jsxs(al,{children:[a.jsx(rl,{asChild:!0,children:a.jsxs(fr,{variant:"ghost",size:"sm",className:"h-8 px-2",children:[n?a.jsx(Os,{className:"h-4 w-4 text-green-500"}):a.jsx(zs,{className:"h-4 w-4 text-red-500"}),a.jsx(Is,{className:`h-2 w-2 ml-1 ${(e=>{switch(e){case"SUBSCRIBED":case"connected":return"bg-green-500";case"CHANNEL_ERROR":case"TIMED_OUT":return"bg-red-500";case"CONNECTING":return"bg-yellow-500";default:return"bg-gray-500"}})(i)}`})]})}),a.jsx(nl,{className:"w-64",align:"end",children:a.jsxs(zr,{className:"border-0 shadow-none",children:[a.jsx(Mr,{className:"pb-3",children:a.jsxs(Br,{className:"text-sm flex items-center space-x-2",children:[n?a.jsx(Os,{className:"h-4 w-4 text-green-500"}):a.jsx(zs,{className:"h-4 w-4 text-red-500"}),a.jsx("span",{children:"Real-time Connection"})]})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),a.jsx(Yr,{variant:n?"default":"destructive",className:"text-xs",children:(e=>{switch(e){case"SUBSCRIBED":return"Connected";case"CHANNEL_ERROR":return"Error";case"TIMED_OUT":return"Timeout";case"CONNECTING":return"Connecting";default:return"Disconnected"}})(i)})]}),!n&&a.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-yellow-50 rounded-md",children:[a.jsx(X,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),a.jsx("div",{className:"text-xs text-yellow-800",children:"Real-time features may not work properly. Check your internet connection."})]}),a.jsxs(fr,{variant:"outline",size:"sm",className:"w-full",onClick:()=>window.location.reload(),children:[a.jsx(Z,{className:"h-3 w-3 mr-2"}),"Reconnect"]})]})]})})]}),s&&e&&l.length>0&&a.jsxs(al,{children:[a.jsx(rl,{asChild:!0,children:a.jsxs(fr,{variant:"ghost",size:"sm",className:"h-8 px-2",children:[a.jsx(M,{className:"h-4 w-4"}),a.jsx("span",{className:"ml-1 text-xs",children:o.length})]})}),a.jsx(nl,{className:"w-80",align:"end",children:a.jsxs(zr,{className:"border-0 shadow-none",children:[a.jsxs(Mr,{className:"pb-3",children:[a.jsxs(Br,{className:"text-sm flex items-center space-x-2",children:[a.jsx(M,{className:"h-4 w-4"}),a.jsx("span",{children:"Active Collaborators"})]}),a.jsx(Vr,{className:"text-xs",children:"Users currently viewing this document"})]}),a.jsxs(Wr,{className:"space-y-3",children:[o.length>0&&a.jsxs("div",{children:[a.jsxs("h4",{className:"text-xs font-medium text-gray-900 mb-2",children:["Online (",o.length,")"]}),a.jsx("div",{className:"space-y-2",children:o.map(e=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Pn,{className:"h-6 w-6",children:a.jsx(Fn,{className:"text-xs",children:c(e)})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Is,{className:"h-2 w-2 text-green-500 fill-current"}),a.jsxs("span",{className:"text-xs font-medium truncate",children:["User ",e.user_id.slice(-4)]})]}),e.current_page&&a.jsxs("div",{className:"text-xs text-gray-500",children:["Page ",e.current_page]})]})]},e.user_id))})]}),d.length>0&&a.jsxs("div",{children:[a.jsxs("h4",{className:"text-xs font-medium text-gray-900 mb-2",children:["Away (",d.length,")"]}),a.jsx("div",{className:"space-y-2",children:d.map(e=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Pn,{className:"h-6 w-6",children:a.jsx(Fn,{className:"text-xs",children:c(e)})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Is,{className:"h-2 w-2 text-yellow-500 fill-current"}),a.jsxs("span",{className:"text-xs font-medium truncate",children:["User ",e.user_id.slice(-4)]})]}),a.jsxs("div",{className:"text-xs text-gray-500",children:["Last seen ",$t(new Date(e.last_seen),{addSuffix:!0})]})]})]},e.user_id))})]}),0===l.length&&a.jsxs("div",{className:"text-center py-4",children:[a.jsx(M,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-xs text-gray-500",children:"No other users online"})]})]})]})})]})]})},cl=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(Ms,{ref:r,className:Wa("relative overflow-hidden",e),...t,children:[a.jsx(Bs,{className:"h-full w-full rounded-[inherit]",children:s}),a.jsx(ol,{}),a.jsx(Vs,{})]}));cl.displayName=Ms.displayName;const ol=t.forwardRef(({className:e,orientation:s="vertical",...t},r)=>a.jsx(Ws,{ref:r,orientation:s,className:Wa("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:a.jsx(Gs,{className:"relative flex-1 rounded-full bg-border"})}));ol.displayName=Ws.displayName;const dl=({className:e=""})=>{const{notifications:s,markAsRead:r,clearAll:n}=(()=>{const[e,s]=t.useState([]),[a,r]=t.useState(!1),{user:n}=hr();return t.useEffect(()=>{if(!n)return;r(!0);const e=il.subscribeToSystemNotifications(n.id,e=>{s(s=>[...s.slice(-9),e]),Pt.info(e.message||"New notification received")});return()=>{e(),r(!1)}},[n]),{notifications:e,isConnected:a,markAsRead:t.useCallback(e=>{s(s=>s.map(s=>s.id===e?{...s,read:!0}:s))},[]),clearAll:t.useCallback(()=>{s([])},[])}})(),i=s.filter(e=>!e.read).length,l=e=>{switch(e){case"success":return a.jsx(L,{className:"h-4 w-4 text-green-500"});case"warning":return a.jsx(X,{className:"h-4 w-4 text-yellow-500"});case"error":return a.jsx(es,{className:"h-4 w-4 text-red-500"});default:return a.jsx(Js,{className:"h-4 w-4 text-blue-500"})}},c=e=>{switch(e){case"success":return"default";case"warning":return"secondary";case"error":return"destructive";default:return"outline"}};return a.jsx("div",{className:e,children:a.jsxs(al,{children:[a.jsx(rl,{asChild:!0,children:a.jsxs(fr,{variant:"ghost",size:"sm",className:"relative h-8 w-8 p-0",children:[i>0?a.jsx(Hs,{className:"h-4 w-4"}):a.jsx(Ys,{className:"h-4 w-4"}),i>0&&a.jsx(Yr,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 text-xs flex items-center justify-center",children:i>9?"9+":i})]})}),a.jsx(nl,{className:"w-96",align:"end",children:a.jsxs(zr,{className:"border-0 shadow-none",children:[a.jsx(Mr,{className:"pb-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs(Br,{className:"text-sm flex items-center space-x-2",children:[a.jsx(Ys,{className:"h-4 w-4"}),a.jsx("span",{children:"Notifications"})]}),i>0&&a.jsxs(Vr,{className:"text-xs",children:[i," unread notification",1!==i?"s":""]})]}),s.length>0&&a.jsx(fr,{variant:"ghost",size:"sm",onClick:n,className:"text-xs",children:"Clear all"})]})}),a.jsx(Wr,{className:"p-0",children:s.length>0?a.jsx(cl,{className:"h-80",children:a.jsx("div",{className:"space-y-1 p-3",children:s.map(e=>a.jsx("div",{className:"p-3 rounded-lg border transition-colors "+(e.read?"bg-gray-50 border-gray-200":"bg-white border-blue-200 shadow-sm"),children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:l(e.type)}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:e.title}),a.jsx("p",{className:"text-xs text-gray-600 mb-2",children:e.message}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Yr,{variant:c(e.type),className:"text-xs",children:e.type}),a.jsx("span",{className:"text-xs text-gray-500",children:$t(new Date(e.created_at),{addSuffix:!0})})]})]}),a.jsx("div",{className:"flex items-center space-x-1 ml-2",children:!e.read&&a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>r(e.id),className:"h-6 w-6 p-0",children:a.jsx(ae,{className:"h-3 w-3"})})})]}),e.action_url&&e.action_label&&a.jsx("div",{className:"mt-2",children:a.jsxs(fr,{variant:"outline",size:"sm",className:"text-xs h-7",onClick:()=>{window.open(e.action_url,"_blank"),r(e.id)},children:[e.action_label,a.jsx(Qs,{className:"h-3 w-3 ml-1"})]})})]})]})},e.id))})}):a.jsxs("div",{className:"text-center py-8 px-3",children:[a.jsx(Ys,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),a.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No notifications"}),a.jsx("p",{className:"text-xs text-gray-500",children:"You're all caught up! New notifications will appear here."})]})})]})})]})})},ml=[{name:"Dashboard",href:"/dashboard",icon:ee},{name:"Documents",href:"/dashboard/documents",icon:T},{name:"AI Assistant",href:"/dashboard/ai-assistant",icon:P},{name:"Templates",href:"/dashboard/templates",icon:I},{name:"Law Firms",href:"/dashboard/law-firms",icon:D},{name:"Legal Q&A",href:"/legal-qa",icon:P},{name:"Document Analysis",href:"/analyze",icon:et},{name:"Search History",href:"/dashboard/search-history",icon:A}],ul=({children:e})=>{const{user:s,profile:t,signOut:r}=hr(),n=ps();S();const i="admin"===t?.role||"super_admin"===t?.role;return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("header",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsx("div",{className:"flex items-center",children:a.jsxs(k,{to:"/dashboard",className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:a.jsx("span",{className:"text-white font-bold text-sm",children:"LM"})}),a.jsx("span",{className:"text-xl font-bold text-gray-900",children:"LawMattersSG"})]})}),a.jsx("nav",{className:"hidden md:flex space-x-8",children:ml.map(e=>{const s=e.icon,t=n.pathname===e.href;return a.jsxs(k,{to:e.href,className:Wa("flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",t?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[a.jsx(s,{className:"h-4 w-4"}),a.jsx("span",{children:e.name})]},e.name)})}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx(dl,{}),a.jsx(ll,{}),a.jsx("div",{className:"hidden sm:block",children:a.jsx(k,{to:"/dashboard/subscription",children:a.jsx(fr,{variant:"outline",size:"sm",children:"super_admin"===t?.role?a.jsxs(a.Fragment,{children:[a.jsx(U,{className:"h-4 w-4 mr-2"}),"Super Admin"]}):"admin"===t?.role?a.jsxs(a.Fragment,{children:[a.jsx(U,{className:"h-4 w-4 mr-2"}),"Admin"]}):a.jsxs(a.Fragment,{children:[a.jsx(Ks,{className:"h-4 w-4 mr-2"}),t?.subscription_tier||"Free"]})})})}),a.jsxs(Ki,{children:[a.jsx(Xi,{asChild:!0,children:a.jsx(fr,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:a.jsxs(Pn,{className:"h-8 w-8",children:[a.jsx(Rn,{src:t?.avatar_url,alt:t?.full_name||s?.email}),a.jsx(Fn,{children:t?.first_name?.[0]||s?.email?.[0]?.toUpperCase()})]})})}),a.jsxs(Zi,{className:"w-56",align:"end",forceMount:!0,children:[a.jsx(sl,{className:"font-normal",children:a.jsxs("div",{className:"flex flex-col space-y-1",children:[a.jsx("p",{className:"text-sm font-medium leading-none",children:t?.full_name||"User"}),a.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s?.email})]})}),a.jsx(tl,{}),a.jsx(el,{asChild:!0,children:a.jsxs(k,{to:"/dashboard/profile",className:"flex items-center",children:[a.jsx(E,{className:"mr-2 h-4 w-4"}),a.jsx("span",{children:"Profile"})]})}),a.jsx(el,{asChild:!0,children:a.jsxs(k,{to:"/dashboard/subscription",className:"flex items-center",children:[a.jsx(Ks,{className:"mr-2 h-4 w-4"}),a.jsx("span",{children:"Subscription"})]})}),a.jsx(el,{asChild:!0,children:a.jsxs(k,{to:"/dashboard/settings",className:"flex items-center",children:[a.jsx(Xs,{className:"mr-2 h-4 w-4"}),a.jsx("span",{children:"Settings"})]})}),i&&a.jsx(el,{asChild:!0,children:a.jsxs(k,{to:"/dashboard/admin",className:"flex items-center",children:[a.jsx(U,{className:"mr-2 h-4 w-4"}),a.jsx("span",{children:"Admin"})]})}),a.jsx(tl,{}),a.jsxs(el,{onClick:async()=>{try{await r()}catch(e){window.location.href="/"}},children:[a.jsx(Zs,{className:"mr-2 h-4 w-4"}),a.jsx("span",{children:"Log out"})]})]})]})]})]})})}),a.jsx("div",{className:"md:hidden bg-white border-b",children:a.jsx("div",{className:"px-4 py-2",children:a.jsx("nav",{className:"flex space-x-4 overflow-x-auto",children:ml.map(e=>{const s=e.icon,t=n.pathname===e.href;return a.jsxs(k,{to:e.href,className:Wa("flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors",t?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:[a.jsx(s,{className:"h-4 w-4"}),a.jsx("span",{children:e.name})]},e.name)})})})}),a.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:a.jsx("div",{className:"px-4 py-6 sm:px-0",children:e})})]})},hl=()=>{const[e,s]=t.useState("directory"),[r,n]=t.useState(null),[i,l]=t.useState([]),[c,o]=t.useState([]),[d,m]=t.useState(!0),{user:u}=hr();t.useEffect(()=>{h()},[]);const h=async()=>{try{m(!0);const[e,s]=await Promise.all([kn.getTopRatedLawFirms(6),kn.getRecentLawFirms(3)]);l(e),o(s)}catch(e){}finally{m(!1)}},x=e=>{n(e),s("profile")},p=()=>{r&&s("review")},g=()=>{s("profile")},f=()=>{s("directory"),n(null)},y=()=>{s("profile")},j=[{title:"Total Law Firms",value:"150+",description:"Verified legal professionals",icon:M,color:"text-blue-600"},{title:"Average Rating",value:"4.2",description:"Based on client reviews",icon:$,color:"text-yellow-600"},{title:"Practice Areas",value:"12+",description:"Specialized legal services",icon:st,color:"text-green-600"},{title:"Locations",value:"Singapore",description:"Nationwide coverage",icon:H,color:"text-purple-600"}];return"profile"===e&&r?a.jsxs(ul,{children:[a.jsx(Mn,{firmId:r.id,onBack:f}),a.jsx("div",{className:"fixed bottom-6 right-6",children:a.jsxs(fr,{onClick:p,size:"lg",className:"rounded-full shadow-lg",children:[a.jsx(qe,{className:"h-5 w-5 mr-2"}),"Write Review"]})})]}):"review"===e&&r?a.jsx(ul,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs(fr,{variant:"outline",onClick:y,children:[" Back to ",r.name]})}),a.jsx(Vn,{lawFirm:r,onReviewSubmitted:g,onCancel:y})]})}):a.jsx(ul,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Law Firm Directory"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Find and connect with verified legal professionals in Singapore"})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(fr,{variant:"outline",children:[a.jsx(A,{className:"h-4 w-4 mr-2"}),"Advanced Search"]}),"admin"===u?.role&&a.jsxs(fr,{children:[a.jsx(qe,{className:"h-4 w-4 mr-2"}),"Add Law Firm"]})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:j.map((e,s)=>a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:e.title}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.value}),a.jsx("p",{className:"text-xs text-gray-500",children:e.description})]}),a.jsx(e.icon,{className:`h-8 w-8 ${e.color}`})]})})},s))}),!d&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center space-x-2",children:[a.jsx($,{className:"h-5 w-5 text-yellow-500"}),a.jsx("span",{children:"Top Rated Law Firms"})]}),a.jsx(Vr,{children:"Highest rated legal professionals based on client reviews"})]}),a.jsx(Wr,{children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.slice(0,4).map(e=>a.jsxs("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow cursor-pointer",onClick:()=>x(e),children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h3",{className:"font-medium truncate flex items-center space-x-1",children:[a.jsx("span",{children:e.name}),e.verified&&a.jsx(Te,{className:"h-4 w-4 text-blue-500"})]}),a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"}),a.jsx("span",{className:"text-sm font-medium",children:e.rating.toFixed(1)})]})]}),a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-2",children:e.description}),a.jsx("div",{className:"flex flex-wrap gap-1",children:e.practice_areas.slice(0,2).map((e,s)=>a.jsx(Yr,{variant:"secondary",className:"text-xs",children:e},s))})]},e.id))})})]})}),a.jsx("div",{children:a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center space-x-2",children:[a.jsx(st,{className:"h-5 w-5 text-green-500"}),a.jsx("span",{children:"Recently Added"})]}),a.jsx(Vr,{children:"New law firms in our directory"})]}),a.jsx(Wr,{children:a.jsx("div",{className:"space-y-3",children:c.map(e=>a.jsxs("div",{className:"p-3 border rounded-lg hover:shadow-sm transition-shadow cursor-pointer",onClick:()=>x(e),children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsxs("h4",{className:"font-medium text-sm truncate flex items-center space-x-1",children:[a.jsx("span",{children:e.name}),e.verified&&a.jsx(Te,{className:"h-3 w-3 text-blue-500"})]}),a.jsx(Yr,{variant:"outline",className:"text-xs",children:"New"})]}),a.jsx("p",{className:"text-xs text-gray-600 line-clamp-1",children:e.practice_areas.slice(0,2).join(", ")})]},e.id))})})]})})]}),a.jsx(Cn,{onFirmSelect:x})]})})},xl=t.forwardRef(({className:e,value:s,...t},r)=>a.jsx(tt,{ref:r,className:Wa("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...t,children:a.jsx(at,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));let pl;xl.displayName=tt.displayName;const gl=new class{constructor(){s(this,"stripe"),this.stripe=(pl||(pl=Ft(Tr.stripe.publishableKey||"")),pl)}async createSubscription(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User must be authenticated to create subscription");const{data:t,error:a}=await Ct.functions.invoke("create-subscription",{body:{priceId:e.priceId,successUrl:e.successUrl||`${window.location.origin}/dashboard?subscription=success`,cancelUrl:e.cancelUrl||`${window.location.origin}/pricing?subscription=cancelled`,metadata:e.metadata||{}}});if(a)throw new Error(a.message||"Failed to create subscription");if(!t?.url)throw new Error("No checkout URL returned from server");window.location.href=t.url}getPriceId(e,s="monthly"){const t=Fr[e];if(!t)throw new Error(`No price configuration found for tier: ${e}`);const a="yearly"===s?t.yearly:t.monthly;if(!a)throw new Error(`No price ID found for ${e} ${s}`);return a}async subscribeTo(e,s="monthly",t){const a=this.getPriceId(e,s);await this.createSubscription({priceId:a,successUrl:t?.successUrl,cancelUrl:t?.cancelUrl,metadata:{tier:e,billing:s,...t?.metadata}})}async getCurrentSubscription(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");const{data:s,error:t}=await Ct.functions.invoke("get-subscription",{body:{userId:e.id}});if(t)throw new Error(t.message||"Failed to fetch subscription");return s?.subscription||null}async cancelSubscription(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");const{error:s}=await Ct.functions.invoke("cancel-subscription",{body:{userId:e.id}});if(s)throw new Error(s.message||"Failed to cancel subscription")}async reactivateSubscription(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");const{error:s}=await Ct.functions.invoke("reactivate-subscription",{body:{userId:e.id}});if(s)throw new Error(s.message||"Failed to reactivate subscription")}async createBillingPortalSession(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("User must be authenticated");const{data:t,error:a}=await Ct.functions.invoke("create-billing-portal",{body:{returnUrl:e?.returnUrl||`${window.location.origin}/dashboard/subscription`}});if(a)throw new Error(a.message||"Failed to create billing portal session");if(!t?.url)throw new Error("No billing portal URL returned from server");window.location.href=t.url}async updateSubscription(e,s="monthly"){const{data:{user:t}}=await Ct.auth.getUser();if(!t)throw new Error("User must be authenticated");const a=this.getPriceId(e,s),{error:r}=await Ct.functions.invoke("update-subscription",{body:{userId:t.id,newPriceId:a,metadata:{tier:e,billing:s}}});if(r)throw new Error(r.message||"Failed to update subscription")}async getUsageInfo(){const{data:{user:e}}=await Ct.auth.getUser();if(!e)throw new Error("User must be authenticated");const{data:s,error:t}=await Ct.functions.invoke("get-usage-info",{body:{userId:e.id}});if(t)throw new Error(t.message||"Failed to fetch usage information");return s}},fl=()=>{const[e,s]=t.useState(null),[r,n]=t.useState(null),[i,l]=t.useState(!0),[c,o]=t.useState(!1),{profile:d}=hr(),{toast:m}=Xt();t.useEffect(()=>{u()},[]);const u=async()=>{try{l(!0);const[e,t]=await Promise.all([gl.getCurrentSubscription(),gl.getUsageInfo()]);s(e),n(t)}catch(e){m({title:"Error",description:"Failed to load subscription information",variant:"destructive"})}finally{l(!1)}},h=async e=>{try{o(!0),await gl.subscribeTo(e)}catch(s){m({title:"Error",description:"Failed to upgrade subscription",variant:"destructive"})}finally{o(!1)}},x=(e,s)=>-1===s?0:Math.min(e/s*100,100);if(i)return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-48 bg-gray-100 rounded-lg animate-pulse"}),a.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"})]});const p=d?.subscription_tier||"free",g=Ir[p];return a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[(e=>{switch(e){case"premium":return a.jsx(R,{className:"h-5 w-5 text-blue-500"});case"pro":return a.jsx(re,{className:"h-5 w-5 text-purple-500"});default:return a.jsx($,{className:"h-5 w-5 text-gray-500"})}})(p),a.jsxs("div",{children:[a.jsx(Br,{className:"text-xl",children:"Current Plan"}),a.jsx(Vr,{children:"Manage your subscription and billing"})]})]}),e&&(e=>{switch(e){case"active":return a.jsx(L,{className:"h-5 w-5 text-green-500"});case"canceled":case"incomplete":return a.jsx(es,{className:"h-5 w-5 text-red-500"});default:return a.jsx(fs,{className:"h-5 w-5 text-yellow-500"})}})(e.status)]})}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold capitalize",children:g.name}),a.jsx("p",{className:"text-sm text-gray-600",children:0===g.price?"Free forever":null===g.price?"Custom pricing":`$${g.price}/${g.period}`})]}),a.jsx(Yr,{variant:"active"===e?.status?"default":"secondary",children:e?.status||"Free"})]}),e&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Billing Period"}),a.jsxs("span",{children:[new Date(1e3*e.current_period_start).toLocaleDateString()," - "," ",new Date(1e3*e.current_period_end).toLocaleDateString()]})]}),e.cancel_at_period_end&&a.jsxs(on,{children:[a.jsx(fs,{className:"h-4 w-4"}),a.jsx(dn,{children:"Your subscription will be cancelled at the end of the current billing period."})]})]}),a.jsx(ii,{}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:["free"===p&&a.jsxs(a.Fragment,{children:[a.jsxs(fr,{onClick:()=>h("premium"),disabled:c,children:[a.jsx(R,{className:"h-4 w-4 mr-2"}),"Upgrade to Premium"]}),a.jsxs(fr,{variant:"outline",onClick:()=>h("pro"),disabled:c,children:[a.jsx(re,{className:"h-4 w-4 mr-2"}),"Upgrade to Pro"]})]}),"premium"===p&&a.jsxs(fr,{variant:"outline",onClick:()=>h("pro"),disabled:c,children:[a.jsx(re,{className:"h-4 w-4 mr-2"}),"Upgrade to Pro"]}),e&&a.jsxs(a.Fragment,{children:[a.jsxs(fr,{variant:"outline",onClick:async()=>{try{o(!0),await gl.createBillingPortalSession()}catch(e){m({title:"Error",description:"Failed to open billing portal",variant:"destructive"})}finally{o(!1)}},disabled:c,children:[a.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Manage Billing"]}),e.cancel_at_period_end?a.jsx(fr,{variant:"outline",onClick:async()=>{try{o(!0),await gl.reactivateSubscription(),await u(),m({title:"Success",description:"Subscription reactivated successfully."})}catch(e){m({title:"Error",description:"Failed to reactivate subscription",variant:"destructive"})}finally{o(!1)}},disabled:c,children:"Reactivate Subscription"}):a.jsx(fr,{variant:"destructive",onClick:async()=>{try{o(!0),await gl.cancelSubscription(),await u(),m({title:"Success",description:"Subscription cancelled. You can continue using your plan until the end of the billing period."})}catch(e){m({title:"Error",description:"Failed to cancel subscription",variant:"destructive"})}finally{o(!1)}},disabled:c,children:"Cancel Subscription"})]})]})]})]}),r&&a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(st,{className:"h-5 w-5 mr-2"}),"Usage This Month"]}),a.jsx(Vr,{children:"Track your usage against plan limits"})]}),a.jsx(Wr,{className:"space-y-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"AI Queries"}),a.jsxs("span",{children:[r.current.aiQueries||0," / ",-1===r.limits.aiQueries?"":r.limits.aiQueries]})]}),a.jsx(xl,{value:x(r.current.aiQueries||0,r.limits.aiQueries),className:"h-2"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Document Downloads"}),a.jsxs("span",{children:[r.current.documentDownloads||0," / ",-1===r.limits.documentDownloads?"":r.limits.documentDownloads]})]}),a.jsx(xl,{value:x(r.current.documentDownloads||0,r.limits.documentDownloads),className:"h-2"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Custom Documents"}),a.jsxs("span",{children:[r.current.customDocuments||0," / ",-1===r.limits.customDocuments?"":r.limits.customDocuments||0]})]}),a.jsx(xl,{value:x(r.current.customDocuments||0,r.limits.customDocuments||0),className:"h-2"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Document Uploads"}),a.jsxs("span",{children:[r.current.documentUploads||0," / ",-1===r.limits.documentUploads?"":r.limits.documentUploads]})]}),a.jsx(xl,{value:x(r.current.documentUploads||0,r.limits.documentUploads),className:"h-2"})]})]})})]})]})},yl=()=>a.jsx(ul,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Subscription"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your subscription, billing, and usage"})]}),a.jsx(fl,{})]})}),jl=({onSetupComplete:e})=>{const{user:s,refreshProfile:r}=hr(),[n,i]=t.useState(null),[l,c]=t.useState(null),[o,d]=t.useState(!1),[m,u]=t.useState(""),[h,x]=t.useState(!1),[p,g]=t.useState(!1),[f,y]=t.useState(""),[j,w]=t.useState(!1),[b,v]=t.useState("setup");t.useEffect(()=>{N()},[]);const N=async()=>{try{const e=await gi.getTwoFactorStatus();i(e)}catch(e){Pt.error("Failed to load 2FA status")}},_=e=>{navigator.clipboard.writeText(e),Pt.success("Copied to clipboard")};return n?a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(U,{className:"h-5 w-5"}),a.jsx(Br,{children:"Two-Factor Authentication"})]}),a.jsx(Yr,{variant:n.isEnabled?"default":"secondary",children:n.isEnabled?a.jsxs(a.Fragment,{children:[a.jsx(rt,{className:"h-3 w-3 mr-1"}),"Enabled"]}):a.jsxs(a.Fragment,{children:[a.jsx(nt,{className:"h-3 w-3 mr-1"}),"Disabled"]})})]}),a.jsx(Vr,{children:"Add an extra layer of security to your account with two-factor authentication"})]}),a.jsx(Wr,{children:n.isEnabled?a.jsxs("div",{className:"space-y-4",children:[a.jsxs(on,{children:[a.jsx(L,{className:"h-4 w-4"}),a.jsxs(dn,{children:["Two-factor authentication is enabled for your account.",n.lastUsed&&` Last used: ${new Date(n.lastUsed).toLocaleString()}`]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(fr,{variant:"outline",onClick:async()=>{try{const e=await gi.generateBackupCodes();c(s=>s?{...s,backupCodes:e}:null),Pt.success("New backup codes generated")}catch(e){Pt.error(e.message||"Failed to generate backup codes")}},className:"flex-1",children:[a.jsx(ts,{className:"h-4 w-4 mr-2"}),"Generate New Backup Codes"]}),a.jsxs(li,{children:[a.jsx(ci,{asChild:!0,children:a.jsxs(fr,{variant:"destructive",children:[a.jsx(nt,{className:"h-4 w-4 mr-2"}),"Disable 2FA"]})}),a.jsxs(mi,{children:[a.jsxs(ui,{children:[a.jsx(xi,{children:"Disable Two-Factor Authentication"}),a.jsx(pi,{children:"This will remove the extra security layer from your account. Please enter your password to confirm."})]}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"disable-password",children:"Password"}),a.jsx(yr,{id:"disable-password",type:"password",value:f,onChange:e=>y(e.target.value),placeholder:"Enter your password"})]})}),a.jsx(hi,{children:a.jsxs(fr,{variant:"destructive",onClick:async()=>{if(f){w(!0);try{await gi.disableTwoFactor(f),await r(),await N(),y(""),Pt.success("Two-factor authentication disabled")}catch(e){Pt.error(e.message||"Failed to disable 2FA")}finally{w(!1)}}},disabled:!f||j,children:[j?a.jsx(us,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(nt,{className:"h-4 w-4 mr-2"}),"Disable 2FA"]})})]})]})]})]}):a.jsxs(En,{value:b,onValueChange:v,children:[a.jsxs(Tn,{className:"grid w-full grid-cols-3",children:[a.jsx(In,{value:"setup",children:"Setup"}),a.jsx(In,{value:"verify",disabled:!l,children:"Verify"}),a.jsx(In,{value:"backup",disabled:!p,children:"Backup Codes"})]}),a.jsxs(Dn,{value:"setup",className:"space-y-4",children:[a.jsxs(on,{children:[a.jsx(X,{className:"h-4 w-4"}),a.jsx(dn,{children:"Two-factor authentication is not enabled. Enable it to add an extra layer of security to your account."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"What you'll need:"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:" An authenticator app (Google Authenticator, Authy, etc.)"}),a.jsx("li",{children:" Your smartphone or tablet"}),a.jsx("li",{children:" A few minutes to complete the setup"})]})]}),a.jsxs(fr,{onClick:async()=>{d(!0);try{const e=await gi.setupTwoFactor();c(e),v("verify"),Pt.success("2FA setup initiated. Please scan the QR code with your authenticator app.")}catch(e){Pt.error(e.message||"Failed to setup 2FA")}finally{d(!1)}},disabled:o,className:"w-full",children:[o?a.jsx(us,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(hs,{className:"h-4 w-4 mr-2"}),"Setup Two-Factor Authentication"]})]})]}),a.jsx(Dn,{value:"verify",className:"space-y-4",children:l&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h4",{className:"font-medium mb-2",children:"Scan QR Code"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Scan this QR code with your authenticator app"}),a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx("img",{src:l.qrCodeUrl,alt:"2FA QR Code",className:"border rounded-lg"})}),a.jsxs("div",{className:"text-xs text-gray-500",children:[a.jsx("p",{children:"Can't scan? Enter this code manually:"}),a.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs",children:l.secret}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>_(l.secret),className:"ml-2",children:a.jsx(it,{className:"h-3 w-3"})})]})]}),a.jsx(ii,{}),a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"verification-code",children:"Verification Code"}),a.jsx(yr,{id:"verification-code",type:"text",value:m,onChange:e=>u(e.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",maxLength:6}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the 6-digit code from your authenticator app"})]}),a.jsxs(fr,{onClick:async()=>{if(l&&m){x(!0);try{await gi.enableTwoFactor(m,l.secret),await r(),await N(),g(!0),v("backup"),Pt.success("Two-factor authentication enabled successfully!"),e?.()}catch(s){Pt.error(s.message||"Invalid verification code")}finally{x(!1)}}},disabled:6!==m.length||h,className:"w-full",children:[h?a.jsx(us,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(L,{className:"h-4 w-4 mr-2"}),"Verify and Enable 2FA"]})]})}),a.jsx(Dn,{value:"backup",className:"space-y-4",children:l?.backupCodes&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs(on,{children:[a.jsx(ts,{className:"h-4 w-4"}),a.jsx(dn,{children:"Save these backup codes in a safe place. You can use them to access your account if you lose your authenticator device."})]}),a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm font-mono",children:l.backupCodes.map((e,s)=>a.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded border",children:[a.jsx("span",{children:e}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>_(e),children:a.jsx(it,{className:"h-3 w-3"})})]},s))})}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(fr,{variant:"outline",onClick:()=>{if(!l?.backupCodes)return;const e=`LawMattersSG - Two-Factor Authentication Backup Codes\n\nGenerated: ${(new Date).toLocaleString()}\nUser: ${s?.email}\n\nBackup Codes:\n${l.backupCodes.map((e,s)=>`${s+1}. ${e}`).join("\n")}\n\nImportant:\n- Store these codes in a safe place\n- Each code can only be used once\n- Use these codes if you lose access to your authenticator app`,t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`lawmatterssg-backup-codes-${Date.now()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},className:"flex-1",children:[a.jsx(O,{className:"h-4 w-4 mr-2"}),"Download Codes"]}),a.jsxs(fr,{onClick:()=>_(l.backupCodes.join("\n")),className:"flex-1",children:[a.jsx(it,{className:"h-4 w-4 mr-2"}),"Copy All"]})]})]})})]})})]}):a.jsx(zr,{children:a.jsx(Wr,{className:"flex items-center justify-center py-8",children:a.jsx(us,{className:"h-6 w-6 animate-spin"})})})},wl=()=>{const{user:e,profile:s,refreshProfile:r}=hr(),[n,i]=t.useState("profile"),[l,c]=t.useState(!1),[o,d]=t.useState({first_name:s?.first_name||"",last_name:s?.last_name||"",phone:s?.phone||"",company:s?.company||"",job_title:s?.job_title||""}),m=(e,s)=>{d(t=>({...t,[e]:s}))};return a.jsx(ul,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your account settings and preferences"})]}),a.jsxs(En,{value:n,onValueChange:i,children:[a.jsxs(Tn,{className:"grid w-full grid-cols-4",children:[a.jsxs(In,{value:"profile",className:"flex items-center space-x-2",children:[a.jsx(E,{className:"h-4 w-4"}),a.jsx("span",{children:"Profile"})]}),a.jsxs(In,{value:"security",className:"flex items-center space-x-2",children:[a.jsx(U,{className:"h-4 w-4"}),a.jsx("span",{children:"Security"})]}),a.jsxs(In,{value:"notifications",className:"flex items-center space-x-2",children:[a.jsx(Ys,{className:"h-4 w-4"}),a.jsx("span",{children:"Notifications"})]}),a.jsxs(In,{value:"preferences",className:"flex items-center space-x-2",children:[a.jsx(lt,{className:"h-4 w-4"}),a.jsx("span",{children:"Preferences"})]})]}),a.jsx(Dn,{value:"profile",className:"space-y-6",children:a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(E,{className:"h-5 w-5 mr-2"}),"Personal Information"]}),a.jsx(Vr,{children:"Update your personal details and contact information"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"first_name",children:"First Name"}),a.jsx(yr,{id:"first_name",value:o.first_name,onChange:e=>m("first_name",e.target.value),placeholder:"Enter your first name"})]}),a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"last_name",children:"Last Name"}),a.jsx(yr,{id:"last_name",value:o.last_name,onChange:e=>m("last_name",e.target.value),placeholder:"Enter your last name"})]})]}),a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"email",children:"Email Address"}),a.jsx(yr,{id:"email",type:"email",value:e?.email||"",disabled:!0,className:"bg-gray-50"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed. Contact support if you need to update your email."})]}),a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"phone",children:"Phone Number"}),a.jsx(yr,{id:"phone",type:"tel",value:o.phone,onChange:e=>m("phone",e.target.value),placeholder:"+65 1234 5678"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"company",children:"Company"}),a.jsx(yr,{id:"company",value:o.company,onChange:e=>m("company",e.target.value),placeholder:"Your company name"})]}),a.jsxs("div",{children:[a.jsx(Un,{htmlFor:"job_title",children:"Job Title"}),a.jsx(yr,{id:"job_title",value:o.job_title,onChange:e=>m("job_title",e.target.value),placeholder:"Your job title"})]})]}),a.jsxs(fr,{onClick:async()=>{c(!0);try{await mr.updateProfile(o),await r(),Pt.success("Profile updated successfully")}catch(e){Pt.error(e.message||"Failed to update profile")}finally{c(!1)}},disabled:l,children:[a.jsx(ct,{className:"h-4 w-4 mr-2"}),l?"Saving...":"Save Changes"]})]})]})}),a.jsxs(Dn,{value:"security",className:"space-y-6",children:[a.jsx(jl,{}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(vs,{className:"h-5 w-5 mr-2"}),"Password"]}),a.jsx(Vr,{children:"Change your account password"})]}),a.jsx(Wr,{children:a.jsxs(on,{children:[a.jsx(X,{className:"h-4 w-4"}),a.jsx(dn,{children:'Password changes are handled through email verification. Use the "Forgot Password" link on the login page to reset your password.'})]})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(U,{className:"h-5 w-5 mr-2"}),"Account Security"]}),a.jsx(Vr,{children:"Monitor and manage your account security"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Login Notifications"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Get notified when someone logs into your account"})]}),a.jsx(fr,{variant:"outline",size:"sm",children:"Configure"})]}),a.jsx(ii,{}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Active Sessions"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Manage devices that are currently logged in"})]}),a.jsx(fr,{variant:"outline",size:"sm",children:"View Sessions"})]})]})]})]}),a.jsx(Dn,{value:"notifications",className:"space-y-6",children:a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(Ys,{className:"h-5 w-5 mr-2"}),"Notification Preferences"]}),a.jsx(Vr,{children:"Choose how you want to be notified about important updates"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Email Notifications"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Receive updates via email"})]}),a.jsxs(yn,{defaultValue:"important",children:[a.jsx(wn,{className:"w-32",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"all",children:"All"}),a.jsx(_n,{value:"important",children:"Important"}),a.jsx(_n,{value:"none",children:"None"})]})]})]}),a.jsx(ii,{}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Document Processing"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Notifications when documents are processed"})]}),a.jsxs(yn,{defaultValue:"enabled",children:[a.jsx(wn,{className:"w-32",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"enabled",children:"Enabled"}),a.jsx(_n,{value:"disabled",children:"Disabled"})]})]})]}),a.jsx(ii,{}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Security Alerts"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Important security notifications"})]}),a.jsxs(yn,{defaultValue:"enabled",children:[a.jsx(wn,{className:"w-32",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"enabled",children:"Enabled"}),a.jsx(_n,{value:"disabled",children:"Disabled"})]})]})]})]}),a.jsxs(fr,{children:[a.jsx(ct,{className:"h-4 w-4 mr-2"}),"Save Preferences"]})]})]})}),a.jsx(Dn,{value:"preferences",className:"space-y-6",children:a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(lt,{className:"h-5 w-5 mr-2"}),"Display Preferences"]}),a.jsx(Vr,{children:"Customize your application experience"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Theme"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Choose your preferred theme"})]}),a.jsxs(yn,{defaultValue:"light",children:[a.jsx(wn,{className:"w-32",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"light",children:"Light"}),a.jsx(_n,{value:"dark",children:"Dark"}),a.jsx(_n,{value:"system",children:"System"})]})]})]}),a.jsx(ii,{}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Language"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Select your preferred language"})]}),a.jsxs(yn,{defaultValue:"en",children:[a.jsx(wn,{className:"w-32",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"en",children:"English"}),a.jsx(_n,{value:"zh",children:""}),a.jsx(_n,{value:"ms",children:"Bahasa"}),a.jsx(_n,{value:"ta",children:""})]})]})]}),a.jsx(ii,{}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:"Timezone"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Your local timezone"})]}),a.jsxs(yn,{defaultValue:"asia/singapore",children:[a.jsx(wn,{className:"w-48",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"asia/singapore",children:"Asia/Singapore"}),a.jsx(_n,{value:"asia/kuala_lumpur",children:"Asia/Kuala Lumpur"}),a.jsx(_n,{value:"asia/jakarta",children:"Asia/Jakarta"}),a.jsx(_n,{value:"utc",children:"UTC"})]})]})]}),a.jsxs(fr,{children:[a.jsx(ct,{className:"h-4 w-4 mr-2"}),"Save Preferences"]})]})]})})]})]})})},bl=()=>{const{user:e,profile:s}=hr(),[r,n]=t.useState([]),[i,l]=t.useState([]),[c,o]=t.useState(!1),[d,m]=t.useState(!0),[u,h]=t.useState(!1);t.useEffect(()=>{e&&x()},[e]);const x=async()=>{if(e)try{m(!0);const s=await ni.getUserSessions(e.id);n(s);const t=await ni.getSecurityEvents(e.id,20);l(t);const a=await gi.getTwoFactorStatus();o(a.isEnabled)}catch(s){Pt.error("Failed to load security information")}finally{m(!1)}},p=e=>{switch(e){case"mobile":return a.jsx(hs,{className:"h-4 w-4"});case"tablet":return a.jsx(dt,{className:"h-4 w-4"});default:return a.jsx(ot,{className:"h-4 w-4"})}},g=e=>{switch(e){case"login":return a.jsx(L,{className:"h-4 w-4 text-green-500"});case"logout":return a.jsx(Zs,{className:"h-4 w-4 text-blue-500"});case"failed_login":return a.jsx(es,{className:"h-4 w-4 text-red-500"});case"password_change":return a.jsx(U,{className:"h-4 w-4 text-orange-500"});case"2fa_enabled":case"2fa_disabled":return a.jsx(U,{className:"h-4 w-4 text-purple-500"});case"suspicious_activity":return a.jsx(X,{className:"h-4 w-4 text-red-500"});default:return a.jsx(U,{className:"h-4 w-4 text-gray-500"})}},f=e=>{switch(e.eventType){case"login":return"Successful login";case"logout":return"Logged out";case"failed_login":return"Failed login attempt";case"password_change":return"Password changed";case"2fa_enabled":return"Two-factor authentication enabled";case"2fa_disabled":return"Two-factor authentication disabled";case"suspicious_activity":return"Suspicious activity detected";default:return"Security event"}};if(d)return a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-4"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"h-32 bg-gray-200 rounded"}),a.jsx("div",{className:"h-32 bg-gray-200 rounded"}),a.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})]})});const y=u?i:i.slice(0,5);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Account Security"}),a.jsx("p",{className:"text-muted-foreground",children:"Manage your account security settings and monitor activity"})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(U,{className:"h-5 w-5"}),"Two-Factor Authentication"]}),a.jsx(Vr,{children:"Add an extra layer of security to your account"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center gap-2",children:c?a.jsxs(a.Fragment,{children:[a.jsx(L,{className:"h-5 w-5 text-green-500"}),a.jsx("span",{className:"text-sm font-medium",children:"Enabled"}),a.jsx(Yr,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Active"})]}):a.jsxs(a.Fragment,{children:[a.jsx(es,{className:"h-5 w-5 text-red-500"}),a.jsx("span",{className:"text-sm font-medium",children:"Disabled"}),a.jsx(Yr,{variant:"destructive",children:"Inactive"})]})}),a.jsx(fr,{variant:c?"outline":"default",size:"sm",children:c?"Manage 2FA":"Enable 2FA"})]})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Active Sessions"}),a.jsx(Vr,{children:"Devices and locations where you're currently signed in"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"space-y-4",children:[0===r.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"No active sessions found"}):r.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[p(e.deviceType),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"font-medium",children:[e.browser," on ",e.os]}),e.isCurrentSession&&a.jsx(Yr,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Current"})]}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.location&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(H,{className:"h-3 w-3"}),e.location]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(q,{className:"h-3 w-3"}),"Last active ",$t(new Date(e.lastActiveAt),{addSuffix:!0})]})]})]})]}),!e.isCurrentSession&&a.jsx(fr,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{await ni.revokeSession(e),Pt.success("Session revoked successfully"),await x()}catch(s){Pt.error("Failed to revoke session")}})(e.id),children:"Revoke"})]},e.id)),r.length>1&&a.jsxs(a.Fragment,{children:[a.jsx(ii,{}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Sign out of all other devices and locations"}),a.jsx(fr,{variant:"outline",onClick:async()=>{if(e)try{const s=r.find(e=>e.isCurrentSession);s&&(await ni.revokeAllOtherSessions(e.id,s.id),Pt.success("All other sessions revoked successfully"),await x())}catch(s){Pt.error("Failed to revoke other sessions")}},children:"Revoke All Other Sessions"})]})]})]})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Recent Security Activity"}),a.jsx(Vr,{children:"Recent security events on your account"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"space-y-4",children:[0===y.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent security activity"}):y.map(e=>a.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[g(e.eventType),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",children:f(e)}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.location&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(H,{className:"h-3 w-3"}),e.location]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(q,{className:"h-3 w-3"}),$t(new Date(e.createdAt),{addSuffix:!0})]})]})]})]},e.id)),i.length>5&&a.jsx("div",{className:"text-center",children:a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>h(!u),className:"flex items-center gap-2",children:u?a.jsxs(a.Fragment,{children:[a.jsx(xs,{className:"h-4 w-4"}),"Show Less"]}):a.jsxs(a.Fragment,{children:[a.jsx(rs,{className:"h-4 w-4"}),"Show All (",i.length," events)"]})})})]})})]}),!c&&a.jsxs(on,{children:[a.jsx(X,{className:"h-4 w-4"}),a.jsxs(dn,{children:[a.jsx("strong",{children:"Security Recommendation:"})," Enable two-factor authentication to add an extra layer of security to your account."]})]})]})},vl=()=>a.jsx(bi,{children:a.jsx(ul,{children:a.jsx("div",{className:"container mx-auto py-6",children:a.jsx(bl,{})})})}),Nl=()=>{const{tier:e}=We(),[s]=bs(),r=S(),{user:n}=hr(),{toast:i}=Xt(),[l,c]=t.useState("yearly"===s.get("billing")),[o,d]=t.useState(!1),[m,u]=t.useState(null);t.useEffect(()=>{n?e&&["premium","pro"].includes(e)||r("/pricing"):r("/auth/login")},[n,e,r]);if(!n||!e||!["premium","pro"].includes(e))return null;const h=Ir[e],x=h.price||0,p=Math.round(10*x),g=l?p:x,f=l?12*x-p:0;return a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20",children:[a.jsxs("div",{className:"text-center mb-12",children:[a.jsxs("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:["Subscribe to ",h.name]}),a.jsx("p",{className:"text-xl text-gray-600",children:"Complete your subscription to unlock premium features"})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[a.jsxs(zr,{className:"h-fit",children:[a.jsx(Mr,{children:a.jsxs("div",{className:"flex items-center space-x-3",children:[(()=>{switch(e){case"premium":return a.jsx(R,{className:"h-8 w-8 text-blue-500"});case"pro":return a.jsx(re,{className:"h-8 w-8 text-purple-500"});default:return a.jsx(Ks,{className:"h-8 w-8 text-gray-500"})}})(),a.jsxs("div",{children:[a.jsxs(Br,{className:"text-2xl",children:[h.name," Plan"]}),a.jsxs(Vr,{children:["Perfect for ","premium"===e?"individuals and small businesses":"growing businesses and teams"]})]})]})}),a.jsxs(Wr,{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("span",{className:"text-sm font-medium "+(l?"text-gray-500":"text-gray-900"),children:"Monthly"}),a.jsx(xn,{checked:l,onCheckedChange:c,className:"data-[state=checked]:bg-blue-600"}),a.jsx("span",{className:"text-sm font-medium "+(l?"text-gray-900":"text-gray-500"),children:"Yearly"}),l&&a.jsxs(Yr,{variant:"secondary",className:"bg-green-100 text-green-800",children:["Save $",f]})]})}),a.jsxs("div",{className:"text-center p-6 bg-blue-50 rounded-lg",children:[a.jsxs("div",{className:"text-4xl font-bold text-gray-900",children:["$",g]}),a.jsxs("div",{className:"text-gray-600",children:["per ",l?"year":"month"]}),l&&a.jsx("div",{className:"text-sm text-green-600 mt-2",children:"Save 20% with yearly billing"})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"What's included:"}),a.jsx("ul",{className:"space-y-2",children:h.features.map((e,s)=>a.jsxs("li",{className:"flex items-start",children:[a.jsx(ae,{className:"h-5 w-5 text-green-500 mr-3 mt-0.5 flex-shrink-0"}),a.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))})]})]})]}),a.jsxs(zr,{className:"h-fit",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(Ks,{className:"h-5 w-5 mr-2"}),"Complete Your Subscription"]}),a.jsx(Vr,{children:"Secure payment powered by Stripe"})]}),a.jsxs(Wr,{className:"space-y-6",children:[m&&a.jsx(on,{variant:"destructive",children:a.jsx(dn,{children:m})}),a.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-green-50 rounded-lg",children:[a.jsx(U,{className:"h-5 w-5 text-green-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-green-900",children:"Secure Payment"}),a.jsx("p",{className:"text-xs text-green-700",children:"Your payment information is encrypted and secure. We use Stripe for payment processing."})]})]}),a.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Plan"}),a.jsx("span",{className:"text-sm font-medium",children:h.name})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Billing"}),a.jsx("span",{className:"text-sm font-medium",children:l?"Yearly":"Monthly"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Price"}),a.jsxs("span",{className:"text-sm font-medium",children:["$",g,"/",l?"year":"month"]})]}),l&&a.jsxs("div",{className:"flex justify-between text-green-600",children:[a.jsx("span",{className:"text-sm",children:"Savings"}),a.jsxs("span",{className:"text-sm font-medium",children:["$",f,"/year"]})]})]}),a.jsx(fr,{onClick:async()=>{if(e&&["premium","pro"].includes(e))try{d(!0),u(null),await gl.subscribeTo(e,l?"yearly":"monthly",{successUrl:`${window.location.origin}/payment/success`,cancelUrl:`${window.location.origin}/pricing?subscription=cancelled`,metadata:{source:"subscribe_page"}})}catch(s){u(s instanceof Error?s.message:"Failed to start subscription process"),i({title:"Subscription Error",description:"Failed to start subscription process. Please try again.",variant:"destructive"})}finally{d(!1)}else u("Invalid subscription tier")},disabled:o,className:"w-full",size:"lg",children:o?a.jsxs(a.Fragment,{children:[a.jsx(us,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Subscribe Now"]})}),a.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["By subscribing, you agree to our"," ",a.jsx("a",{href:"/terms",className:"underline hover:text-gray-700",children:"Terms of Service"})," ","and"," ",a.jsx("a",{href:"/privacy",className:"underline hover:text-gray-700",children:"Privacy Policy"}),". You can cancel anytime."]})]})]})]})]}),a.jsx(nn,{})]})},_l=()=>{const[e]=bs(),s=S(),{user:r,profile:n}=hr(),[i,l]=t.useState(null),[c,o]=t.useState(!0);e.get("session_id"),e.get("subscription"),t.useEffect(()=>{r?d():s("/auth/login")},[r]);const d=async()=>{try{const e=await gl.getCurrentSubscription();l(e)}catch(e){}finally{o(!1)}};return r?a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20",children:[a.jsxs("div",{className:"text-center mb-12",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-6",children:a.jsx(L,{className:"h-8 w-8 text-green-600"})}),a.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Payment Successful!"}),a.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Thank you for subscribing to LawMattersSG. Your account has been upgraded successfully."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-12",children:[a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(Ks,{className:"h-5 w-5 mr-2"}),"Subscription Details"]}),a.jsx(Vr,{children:"Your new subscription is now active"})]}),a.jsx(Wr,{className:"space-y-4",children:c?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-1/2"})]}):i?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Plan"}),a.jsx(Yr,{variant:"default",className:"capitalize",children:i.tier})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status"}),a.jsx(Yr,{variant:"secondary",className:"capitalize",children:i.status})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Next Billing"}),a.jsx("span",{className:"text-sm text-gray-900",children:new Date(1e3*i.current_period_end).toLocaleDateString()})]})]}):a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Plan"}),a.jsx(Yr,{variant:"default",className:"capitalize",children:n?.subscription_tier||"Premium"})]})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(Me,{className:"h-5 w-5 mr-2"}),"What's Next?"]}),a.jsx(Vr,{children:"Get started with your new features"})]}),a.jsx(Wr,{className:"space-y-4",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(L,{className:"h-5 w-5 text-green-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Access Premium Features"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Start using advanced AI tools and templates"})]})]}),a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(L,{className:"h-5 w-5 text-green-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Increased Limits"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Enjoy higher monthly usage limits"})]})]}),a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(L,{className:"h-5 w-5 text-green-500 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Priority Support"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Get faster response times for support"})]})]})]})})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[a.jsxs(fr,{onClick:()=>{s("/dashboard")},size:"lg",className:"flex items-center",children:["Continue to Dashboard",a.jsx(F,{className:"h-4 w-4 ml-2"})]}),a.jsx(fr,{variant:"outline",onClick:()=>{s("/dashboard/subscription")},size:"lg",children:"Manage Subscription"})]}),a.jsxs("div",{className:"mt-12 p-6 bg-blue-50 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Important Information"}),a.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("li",{children:" You will receive a confirmation email shortly with your receipt"}),a.jsx("li",{children:" Your subscription will automatically renew at the end of each billing period"}),a.jsx("li",{children:" You can cancel or modify your subscription at any time from your account settings"}),a.jsx("li",{children:" If you have any questions, please contact our support team"})]})]})]}),a.jsx(nn,{})]}):null},Sl=()=>{const[e]=bs(),s=S(),t=e.get("error"),r=e.get("error_description");return a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20",children:[a.jsxs("div",{className:"text-center mb-12",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-6",children:a.jsx(es,{className:"h-8 w-8 text-red-600"})}),a.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Payment Failed"}),a.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"We couldn't process your payment. Don't worry, no charges were made to your account."})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-12",children:[a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center text-red-600",children:[a.jsx(es,{className:"h-5 w-5 mr-2"}),"What Happened?"]}),a.jsx(Vr,{children:"Details about the payment issue"})]}),a.jsx(Wr,{children:a.jsxs(on,{children:[a.jsx(os,{className:"h-4 w-4"}),a.jsx(dn,{children:(()=>{switch(t){case"payment_failed":return"Your payment could not be processed. Please check your payment details and try again.";case"card_declined":return"Your card was declined. Please try a different payment method or contact your bank.";case"insufficient_funds":return"Your card has insufficient funds. Please try a different payment method.";case"expired_card":return"Your card has expired. Please update your payment method and try again.";case"processing_error":return"There was an error processing your payment. Please try again in a few minutes.";default:return r||"We encountered an issue processing your payment. Please try again."}})()})]})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center",children:[a.jsx(Z,{className:"h-5 w-5 mr-2"}),"What Can You Do?"]}),a.jsx(Vr,{children:"Steps to resolve the issue"})]}),a.jsx(Wr,{className:"space-y-4",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"1"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Check Your Payment Method"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Ensure your card details are correct and up to date"})]})]}),a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"2"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Try Again"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Return to pricing and attempt the payment again"})]})]}),a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"3"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Contact Support"}),a.jsx("p",{className:"text-xs text-gray-600",children:"If the issue persists, our team is here to help"})]})]})]})})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-12",children:[a.jsxs(fr,{onClick:()=>{s("/pricing")},size:"lg",className:"flex items-center",children:[a.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Try Payment Again"]}),a.jsxs(fr,{variant:"outline",onClick:()=>{window.location.href="mailto:support@lawmatterssg.com?subject=Payment Issue"},size:"lg",children:[a.jsx(os,{className:"h-4 w-4 mr-2"}),"Contact Support"]}),a.jsxs(fr,{variant:"ghost",onClick:()=>{s("/dashboard")},size:"lg",children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Common Payment Issues"}),a.jsx(Vr,{children:"Here are some common reasons why payments fail and how to fix them"})]}),a.jsx(Wr,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Card Issues"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:" Expired or invalid card"}),a.jsx("li",{children:" Insufficient funds"}),a.jsx("li",{children:" Card blocked by bank"}),a.jsx("li",{children:" Incorrect card details"})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Technical Issues"}),a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:" Network connectivity problems"}),a.jsx("li",{children:" Browser compatibility issues"}),a.jsx("li",{children:" Temporary payment processor issues"}),a.jsx("li",{children:" Security verification required"})]})]})]})})]}),a.jsxs("div",{className:"mt-8 p-6 bg-gray-50 rounded-lg text-center",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Need Help?"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Our support team is available to help you resolve any payment issues."}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center text-sm text-gray-600",children:[a.jsx("span",{children:"Email: support@lawmatterssg.com"}),a.jsx("span",{className:"hidden sm:inline",children:""}),a.jsx("span",{children:"Response time: Within 24 hours"})]})]})]}),a.jsx(nn,{})]})};const kl=new class{async createShareLink(e,s,t={}){const{data:{user:a}}=await Ct.auth.getUser();if(!a)throw new Error("Authentication required");const{data:r,error:n}=await Ct.from("uploaded_documents").select("user_id").eq("id",e).single();if(n||!r)throw new Error("Document not found");if(r.user_id!==a.id)throw new Error("You can only share documents you own");const i=this.generateShareToken(),l=t.expiresIn?new Date(Date.now()+60*t.expiresIn*60*1e3).toISOString():void 0,{data:c,error:o}=await Ct.from("document_shares").insert({document_id:e,shared_by:a.id,shared_with:t.shareWithEmail?await this.getUserIdByEmail(t.shareWithEmail):null,share_token:i,permissions:s,expires_at:l,is_active:!0,access_count:0}).select().single();if(o)throw new Error(`Failed to create share link: ${o.message}`);return t.shareWithEmail&&await this.sendShareNotification(t.shareWithEmail,a.email||"",e,i,t.message),{token:i,url:`${window.location.origin}/shared/${i}`,permissions:s,expiresAt:l}}async accessSharedDocument(e){const{data:s,error:t}=await Ct.from("document_shares").select("\n        *,\n        document:uploaded_documents(*),\n        shared_by_user:profiles!document_shares_shared_by_fkey(email, first_name, last_name)\n      ").eq("share_token",e).eq("is_active",!0).single();if(t||!s)throw new Error("Invalid or expired share link");if(s.expires_at&&new Date(s.expires_at)<new Date)throw new Error("Share link has expired");if(s.shared_with){const{data:{user:e}}=await Ct.auth.getUser();if(!e||e.id!==s.shared_with)throw new Error("You do not have permission to access this document")}return await Ct.from("document_shares").update({access_count:s.access_count+1,last_accessed:(new Date).toISOString()}).eq("id",s.id),{document:s.document,permissions:s.permissions,share:s}}async getDocumentShares(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("Authentication required");const{data:t,error:a}=await Ct.from("document_shares").select("\n        *,\n        shared_with_user:profiles!document_shares_shared_with_fkey(email, first_name, last_name)\n      ").eq("document_id",e).eq("shared_by",s.id).order("created_at",{ascending:!1});if(a)throw new Error(`Failed to fetch shares: ${a.message}`);return t||[]}async revokeShare(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("Authentication required");const{error:t}=await Ct.from("document_shares").update({is_active:!1}).eq("id",e).eq("shared_by",s.id);if(t)throw new Error(`Failed to revoke share: ${t.message}`)}async addComment(e,s,t,a){const{data:{user:r}}=await Ct.auth.getUser();if(!r)throw new Error("Authentication required");const{data:n,error:i}=await Ct.from("document_comments").insert({document_id:e,user_id:r.id,content:s,position:t,parent_id:a,is_resolved:!1}).select("\n        *,\n        user:profiles(email, first_name, last_name, avatar_url)\n      ").single();if(i)throw new Error(`Failed to add comment: ${i.message}`);return n}async getDocumentComments(e){const{data:s,error:t}=await Ct.from("document_comments").select("\n        *,\n        user:profiles(email, first_name, last_name, avatar_url),\n        replies:document_comments!parent_id(\n          *,\n          user:profiles(email, first_name, last_name, avatar_url)\n        )\n      ").eq("document_id",e).is("parent_id",null).order("created_at",{ascending:!0});if(t)throw new Error(`Failed to fetch comments: ${t.message}`);return s||[]}async resolveComment(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("Authentication required");const{error:t}=await Ct.from("document_comments").update({is_resolved:!0}).eq("id",e);if(t)throw new Error(`Failed to resolve comment: ${t.message}`)}async startCollaborationSession(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("Authentication required");const{data:t}=await Ct.from("collaboration_sessions").select("*").eq("document_id",e).eq("is_active",!0).single();if(t)return this.joinCollaborationSession(t.id);const{data:a,error:r}=await Ct.from("collaboration_sessions").insert({document_id:e,participants:[{user_id:s.id,user_name:s.email,joined_at:(new Date).toISOString(),last_seen:(new Date).toISOString()}],is_active:!0}).select().single();if(r)throw new Error(`Failed to start collaboration session: ${r.message}`);return a}async joinCollaborationSession(e){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("Authentication required");const{data:t,error:a}=await Ct.from("collaboration_sessions").select("*").eq("id",e).single();if(a||!t)throw new Error("Collaboration session not found");const r=t.participants||[];if(!r.find(e=>e.user_id===s.id)){r.push({user_id:s.id,user_name:s.email||"Unknown User",joined_at:(new Date).toISOString(),last_seen:(new Date).toISOString()});const{error:t}=await Ct.from("collaboration_sessions").update({participants:r}).eq("id",e);if(t)throw new Error(`Failed to join session: ${t.message}`)}return{...t,participants:r}}generateShareToken(){return crypto.randomUUID().replace(/-/g,"")}async getUserIdByEmail(e){const{data:s}=await Ct.from("profiles").select("id").eq("email",e).single();return s?.id||null}async sendShareNotification(e,s,t,a,r){}};const Al=new class{async callEdgeFunction(e,s){const{data:{session:t}}=await Ct.auth.getSession();if(!t)throw new Error("Authentication required");const a=await fetch(`https://kvlaydeyqidlfpfutbmp.supabase.co/functions/v1/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify(s)});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.error||`HTTP ${a.status}: ${a.statusText}`)}return a.json()}async sendChatMessage(e){const{usageTrackingService:s}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url),t=await s.checkAndIncrementUsage("ai_query",void 0,{operation:"chat",message_length:e.message.length,document_ids:e.documentIds,use_rag:e.useRAG});if(!t.allowed)throw new Error(`Usage limit exceeded. You have used ${t.limit?.current}/${t.limit?.limit} AI queries this month. Please upgrade your plan to continue.`);return this.callEdgeFunction("ai-chat",e)}async processDocument(e){const{usageTrackingService:s}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url),t=await s.checkAndIncrementUsage("document_upload",e.documentId,{operation:e.operation,options:e.options});if(!t.allowed)throw new Error(`Usage limit exceeded. You have used ${t.limit?.current}/${t.limit?.limit} document operations this month. Please upgrade your plan to continue.`);return this.callEdgeFunction("document-processor",e)}async generateTemplate(e){const{usageTrackingService:s}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url),t=await s.checkAndIncrementUsage("ai_query",void 0,{operation:"template_generation",template_type:e.templateType,description_length:e.description.length});if(!t.allowed)throw new Error(`Usage limit exceeded. You have used ${t.limit?.current}/${t.limit?.limit} AI queries this month. Please upgrade your plan to continue.`);return this.callEdgeFunction("template-generator",e)}async extractText(e){return(await this.processDocument({documentId:e,operation:"extract-text"})).result}async generateEmbeddings(e){return(await this.processDocument({documentId:e,operation:"generate-embeddings"})).result}async classifyDocument(e){return(await this.processDocument({documentId:e,operation:"classify"})).result}async summarizeDocument(e){return(await this.processDocument({documentId:e,operation:"summarize"})).result}async askDocumentQuestion(e,s,t){return this.sendChatMessage({message:e,documentIds:s,useRAG:!0,conversationId:t})}async getChatHistory(e){const{data:s,error:t}=await Ct.from("chat_messages").select("role, content, created_at").eq("conversation_id",e).order("created_at",{ascending:!0});if(t)throw new Error(`Failed to fetch chat history: ${t.message}`);return s.map(e=>({role:e.role,content:e.content,timestamp:e.created_at}))}async getUsageStats(e=30){const{data:{user:s}}=await Ct.auth.getUser();if(!s)throw new Error("Authentication required");const{data:t,error:a}=await Ct.rpc("get_user_usage_stats",{user_id_param:s.id,period_days:e});if(a)throw new Error(`Failed to fetch usage stats: ${a.message}`);return t||[]}async checkUsageLimit(e){const{usageTrackingService:s}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url);let t;switch(e){case"ai_chat":case"chat":case"summarize":case"extract-entities":case"generate-template":default:t="ai_query";break;case"document_analysis":case"document_upload":t="document_upload"}const a=await s.checkUsageLimit(t);return{allowed:a.allowed,limit:a.limit,used:a.current}}};const Cl=new class{async analyzeDocument(e,s={}){const t=Date.now(),a=await Ei.checkUsageLimit("ai_query");if(!a.allowed)throw new Error(`AI analysis limit exceeded. You have used ${a.current}/${a.limit} AI queries this month.`);const{data:r,error:n}=await Ct.from("uploaded_documents").select("*").eq("id",e).single();if(n||!r)throw new Error("Document not found");if(!r.ocr_text)throw new Error("Document text not available. Please ensure the document has been processed.");const{includeSummary:i=!0,includeEntities:l=!0,includeInsights:c=!0,customPrompt:o}=s,[d,m,u]=await Promise.all([i?this.generateSummary(r):Promise.resolve(null),l?this.extractEntities(r):Promise.resolve(null),c?this.generateLegalInsights(r,o):Promise.resolve(null)]);await Ei.incrementUsage("ai_query",e,{operation:"document_analysis",analysis_types:[i&&"summary",l&&"entities",c&&"insights"].filter(Boolean),text_length:r.ocr_text.length});const h=Date.now()-t,x={documentId:e,summary:d||this.getDefaultSummary(),entities:m||this.getDefaultEntities(),insights:u||this.getDefaultInsights(),analysisDate:(new Date).toISOString(),processingTime:h};return await this.saveAnalysisResults(e,x),x}async generateSummary(e){const s=`\n      Analyze the following legal document and provide a comprehensive summary:\n\n      Document Type: ${e.document_type}\n      Text: ${e.ocr_text}\n\n      Please provide:\n      1. A concise summary (2-3 paragraphs)\n      2. Key points (bullet points)\n      3. Document type classification\n      4. Confidence level (0-1)\n      5. Word count\n      6. Estimated reading time in minutes\n\n      Format your response as JSON with the following structure:\n      {\n        "summary": "...",\n        "keyPoints": ["...", "..."],\n        "documentType": "...",\n        "confidence": 0.95,\n        "wordCount": 1234,\n        "readingTime": 5\n      }\n    `,t=await Al.sendChatMessage({message:s,useRAG:!1});try{return JSON.parse(t.response)}catch(a){return this.parseTextSummary(t.response,e)}}async extractEntities(e){const s=`\n      Extract entities and relationships from the following legal document:\n\n      Text: ${e.ocr_text}\n\n      Please identify:\n      1. Entities (persons, organizations, locations, dates, monetary amounts, legal terms, case references)\n      2. Relationships between entities\n\n      Format your response as JSON with the following structure:\n      {\n        "entities": [\n          {\n            "type": "person|organization|location|date|money|legal_term|case_reference",\n            "text": "...",\n            "confidence": 0.95,\n            "startIndex": 0,\n            "endIndex": 10\n          }\n        ],\n        "relationships": [\n          {\n            "entity1": "...",\n            "entity2": "...",\n            "relationship": "...",\n            "confidence": 0.9\n          }\n        ]\n      }\n    `,t=await Al.sendChatMessage({message:s,useRAG:!1});try{return JSON.parse(t.response)}catch(a){return this.getDefaultEntities()}}async generateLegalInsights(e,s){const t=`\n      Analyze the following legal document and provide legal insights:\n\n      Document Type: ${e.document_type}\n      Text: ${e.ocr_text}\n\n      Please provide:\n      1. Document category classification\n      2. Key legal concepts identified\n      3. Potential legal issues or concerns\n      4. Recommendations for action\n      5. Compliance checks (if applicable)\n      6. Risk assessment\n\n      ${s?`Additional instructions: ${s}`:""}\n\n      Format your response as JSON with the following structure:\n      {\n        "documentCategory": "...",\n        "legalConcepts": ["...", "..."],\n        "potentialIssues": ["...", "..."],\n        "recommendations": ["...", "..."],\n        "complianceChecks": [\n          {\n            "requirement": "...",\n            "status": "compliant|non_compliant|unclear",\n            "details": "..."\n          }\n        ],\n        "riskAssessment": {\n          "level": "low|medium|high",\n          "factors": ["...", "..."],\n          "mitigation": ["...", "..."]\n        }\n      }\n    `,a=await Al.sendChatMessage({message:t,useRAG:!1});try{return JSON.parse(a.response)}catch(r){return this.getDefaultInsights()}}async saveAnalysisResults(e,s){const{error:t}=await Ct.from("document_analysis").upsert({document_id:e,analysis_data:s,created_at:(new Date).toISOString()})}async getAnalysisResults(e){const{data:s,error:t}=await Ct.from("document_analysis").select("analysis_data").eq("document_id",e).order("created_at",{ascending:!1}).limit(1).single();return t||!s?null:s.analysis_data}async compareDocuments(e,s){if(!(await Ei.checkUsageLimit("ai_query")).allowed)throw new Error("AI analysis limit exceeded.");const{data:t,error:a}=await Ct.from("uploaded_documents").select("*").in("id",[e,s]);if(a||!t||2!==t.length)throw new Error("Documents not found");const[r,n]=t,i=`\n      Compare the following two legal documents and provide analysis:\n\n      Document 1:\n      Type: ${r.document_type}\n      Text: ${r.ocr_text}\n\n      Document 2:\n      Type: ${n.document_type}\n      Text: ${n.ocr_text}\n\n      Please provide:\n      1. Key similarities between the documents\n      2. Important differences\n      3. Recommendations based on the comparison\n\n      Format as JSON:\n      {\n        "similarities": ["...", "..."],\n        "differences": ["...", "..."],\n        "recommendations": ["...", "..."]\n      }\n    `,l=await Al.sendChatMessage({message:i,useRAG:!1});await Ei.incrementUsage("ai_query",void 0,{operation:"document_comparison",document_ids:[e,s]});try{return JSON.parse(l.response)}catch(c){return{similarities:["Unable to parse comparison results"],differences:["Analysis failed"],recommendations:["Please try again"]}}}parseTextSummary(e,s){const t=s.ocr_text?.split(/\s+/).length||0;return{summary:e.substring(0,500)+"...",keyPoints:["Analysis completed","Summary generated"],documentType:s.document_type,confidence:.7,wordCount:t,readingTime:Math.ceil(t/200)}}getDefaultSummary(){return{summary:"Summary not available",keyPoints:[],documentType:"unknown",confidence:0,wordCount:0,readingTime:0}}getDefaultEntities(){return{entities:[],relationships:[]}}getDefaultInsights(){return{documentCategory:"unknown",legalConcepts:[],potentialIssues:[],recommendations:[],complianceChecks:[],riskAssessment:{level:"low",factors:[],mitigation:[]}}}};const El=new class{async downloadDocument(e,s={format:"pdf"}){const t=await Ei.checkAndIncrementUsage("document_download",e,{operation:"download",format:s.format,include_analysis:s.includeAnalysis});if(!t.allowed)throw new Error(`Download limit exceeded. You have used ${t.limit?.current}/${t.limit?.limit} document downloads this month.`);const{data:a,error:r}=await Ct.from("uploaded_documents").select("*").eq("id",e).single();if(r||!a)throw new Error("Document not found");const n=this.extractFileNameFromUrl(a.file_url),{data:i,error:l}=await Ct.storage.from("documents").download(n);if(l)throw new Error(`Failed to download document: ${l.message}`);let c=i,o=this.getContentType(s.format),d=this.generateFilename(a.filename,s.format);if(s.includeAnalysis){const t=await Cl.getAnalysisResults(e);t&&(c=await this.createEnhancedDocument(a,t,s),d=this.generateFilename(a.filename,s.format,"enhanced"))}return{blob:c,filename:d,contentType:o,size:c.size}}async generateCustomDocument(e,s={format:"pdf"}){const t=await Ei.checkAndIncrementUsage("custom_document",void 0,{operation:"generate",template_type:e.templateType,format:s.format});if(!t.allowed)throw new Error(`Custom document limit exceeded. You have used ${t.limit?.current}/${t.limit?.limit} custom documents this month.`);let a=e.content;"custom"!==e.templateType&&(a=await this.generateTemplateContent(e)),e.variables&&(a=this.applyVariables(a,e.variables));const r=await this.createDocumentBlob(a,e,s);return{blob:r,filename:this.generateCustomFilename(e.title,s.format),contentType:this.getContentType(s.format),size:r.size}}async exportAnalysis(e,s={format:"pdf"}){const t=await Cl.getAnalysisResults(e);if(!t)throw new Error("No analysis found for this document");const{data:a}=await Ct.from("uploaded_documents").select("filename").eq("id",e).single(),r=this.formatAnalysisForExport(t),n=await this.createAnalysisBlob(r,s);return{blob:n,filename:this.generateFilename(a?.filename||"document",s.format,"analysis"),contentType:this.getContentType(s.format),size:n.size}}async bulkExport(e,s={format:"pdf"}){for(const n of e){const e=await Ei.checkUsageLimit("document_download");if(!e.allowed)throw new Error(`Download limit would be exceeded. You have ${e.remaining} downloads remaining.`)}const t=new(0,(await Bt(async()=>{const{default:e}=await import("./vendor-CrSvAuNw.js").then(e=>e.j);return{default:e}},__vite__mapDeps([2,3,4,5,1,6,7]),import.meta.url)).default);for(const n of e)try{const e=await this.downloadDocument(n,s);t.file(e.filename,e.blob)}catch(r){}const a=await t.generateAsync({type:"blob"});return{blob:a,filename:`documents-export-${(new Date).toISOString().split("T")[0]}.zip`,contentType:"application/zip",size:a.size}}async generateTemplateContent(e){const s=`\n      Generate a professional ${e.templateType} document with the following specifications:\n      \n      Title: ${e.title}\n      Content Requirements: ${e.content}\n      \n      Please create a well-structured, legally appropriate document that includes:\n      1. Proper formatting and sections\n      2. Professional language\n      3. Placeholder variables where appropriate (use {{variable_name}} format)\n      4. Standard clauses for this type of document\n      \n      Return only the document content without any explanations.\n    `;return(await Al.sendChatMessage({message:s,useRAG:!1})).response}applyVariables(e,s){let t=e;return Object.entries(s).forEach(([e,s])=>{const a=new RegExp(`{{${e}}}`,"g");t=t.replace(a,s)}),t}async createDocumentBlob(e,s,t){switch(t.format){case"txt":default:return new Blob([e],{type:"text/plain"});case"json":const t={title:s.title,content:e,templateType:s.templateType,variables:s.variables,formatting:s.formatting,generatedAt:(new Date).toISOString()};return new Blob([JSON.stringify(t,null,2)],{type:"application/json"});case"pdf":case"docx":const a=this.contentToHtml(e,s);return new Blob([a],{type:"text/html"})}}async createEnhancedDocument(e,s,t){const a=`\n      Document: ${e.filename}\n      \n      ORIGINAL CONTENT:\n      ${e.ocr_text||"Text not available"}\n      \n      ANALYSIS SUMMARY:\n      ${s.summary?.summary||"No summary available"}\n      \n      KEY POINTS:\n      ${s.summary?.keyPoints?.map(e=>` ${e}`).join("\n")||"No key points identified"}\n      \n      LEGAL INSIGHTS:\n      Category: ${s.insights?.documentCategory||"Unknown"}\n      Risk Level: ${s.insights?.riskAssessment?.level||"Unknown"}\n      \n      RECOMMENDATIONS:\n      ${s.insights?.recommendations?.map(e=>` ${e}`).join("\n")||"No recommendations available"}\n    `;return new Blob([a],{type:"text/plain"})}async createAnalysisBlob(e,s){switch(s.format){case"json":return new Blob([e],{type:"application/json"});case"txt":return new Blob([e],{type:"text/plain"});default:return new Blob([`\n          <html>\n            <head><title>Document Analysis Report</title></head>\n            <body>\n              <h1>Document Analysis Report</h1>\n              <pre>${e}</pre>\n            </body>\n          </html>\n        `],{type:"text/html"})}}formatAnalysisForExport(e){return JSON.stringify(e,null,2)}contentToHtml(e,s){const{formatting:t={}}=s;return`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>${s.title}</title>\n          <style>\n            body {\n              font-family: ${t.fontFamily||"Arial, sans-serif"};\n              font-size: ${t.fontSize||12}pt;\n              margin: ${t.margins?.top||1}in ${t.margins?.right||1}in ${t.margins?.bottom||1}in ${t.margins?.left||1}in;\n              line-height: 1.5;\n            }\n            h1 { font-size: 18pt; margin-bottom: 20px; }\n            p { margin-bottom: 12px; }\n          </style>\n        </head>\n        <body>\n          ${t.header?`<header>${t.header}</header>`:""}\n          <h1>${s.title}</h1>\n          <div>${e.replace(/\n/g,"<br>")}</div>\n          ${t.footer?`<footer>${t.footer}</footer>`:""}\n        </body>\n      </html>\n    `}extractFileNameFromUrl(e){const s=e.split("/");return s[s.length-1]}getContentType(e){return{pdf:"application/pdf",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",txt:"text/plain",json:"application/json",html:"text/html"}[e]||"application/octet-stream"}generateFilename(e,s,t){return`${e.replace(/\.[^/.]+$/,"")}${t?`-${t}`:""}.${s}`}generateCustomFilename(e,s){return`${e.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"-")}.${s}`}},Tl=()=>{const{shareToken:e}=We(),s=S(),{toast:r}=Xt(),[n,i]=t.useState(!0),[l,c]=t.useState(null),[o,d]=t.useState(null),[m,u]=t.useState(null),[h,x]=t.useState(null),[p,g]=t.useState([]),[f,y]=t.useState(""),[j,w]=t.useState(!1),[b,v]=t.useState(!1);t.useEffect(()=>{e&&N()},[e]);const N=async()=>{if(e)try{i(!0),c(null);const s=await kl.accessSharedDocument(e);d(s.document),u(s.permissions),x(s.share),s.permissions.canComment&&await _(s.document.id)}catch(s){c(s instanceof Error?s.message:"Failed to load document")}finally{i(!1)}},_=async e=>{try{const s=await kl.getDocumentComments(e);g(s)}catch(s){}};return n?a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20",children:a.jsxs("div",{className:"text-center",children:[a.jsx(us,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),a.jsx("p",{children:"Loading shared document..."})]})}),a.jsx(nn,{})]}):l?a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20",children:a.jsx(zr,{children:a.jsx(Wr,{className:"pt-6",children:a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx(fs,{className:"h-12 w-12 text-red-500 mx-auto"}),a.jsx("h2",{className:"text-xl font-semibold",children:"Access Denied"}),a.jsx("p",{className:"text-gray-600",children:l}),a.jsx(fr,{onClick:()=>s("/"),children:"Go Home"})]})})})}),a.jsx(nn,{})]}):o&&m&&h?a.jsxs("div",{className:"min-h-screen bg-white",children:[a.jsx(Sr,{}),a.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(Ye,{className:"h-6 w-6 text-blue-600"}),a.jsx("h1",{className:"text-2xl font-bold",children:"Shared Document"})]}),m.canDownload&&a.jsx(fr,{onClick:async()=>{if(o&&m?.canDownload)try{v(!0);const e=await El.downloadDocument(o.id,{format:"pdf",includeAnalysis:!1}),s=URL.createObjectURL(e.blob),t=o.createElement("a");t.href=s,t.download=e.filename,o.body.appendChild(t),t.click(),o.body.removeChild(t),URL.revokeObjectURL(s),r({title:"Download Started",description:`Downloading ${e.filename}`})}catch(e){r({title:"Download Failed",description:e instanceof Error?e.message:"Failed to download document",variant:"destructive"})}finally{v(!1)}},disabled:b,children:b?a.jsxs(a.Fragment,{children:[a.jsx(us,{className:"h-4 w-4 mr-2 animate-spin"}),"Downloading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(O,{className:"h-4 w-4 mr-2"}),"Download"]})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h2",{className:"text-xl font-semibold",children:o.filename}),a.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[a.jsxs("span",{children:["Shared by ",h.shared_by_user?.email||"Unknown"]}),a.jsx("span",{children:""}),a.jsx("span",{children:$t(new Date(h.created_at),{addSuffix:!0})}),h.expires_at&&a.jsxs(a.Fragment,{children:[a.jsx("span",{children:""}),a.jsxs("span",{className:"flex items-center",children:[a.jsx(q,{className:"h-4 w-4 mr-1"}),"Expires ",$t(new Date(h.expires_at),{addSuffix:!0})]})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Your permissions:"}),(()=>{if(!m)return null;const e=Object.entries(m).filter(([e,s])=>s&&"expiresAt"!==e).map(([e])=>{switch(e){case"canView":return{icon:a.jsx(rs,{className:"h-3 w-3"}),label:"View"};case"canDownload":return{icon:a.jsx(O,{className:"h-3 w-3"}),label:"Download"};case"canComment":return{icon:a.jsx(P,{className:"h-3 w-3"}),label:"Comment"};case"canEdit":return{icon:a.jsx(T,{className:"h-3 w-3"}),label:"Edit"};default:return null}}).filter(Boolean);return a.jsx("div",{className:"flex flex-wrap gap-2",children:e.map((e,s)=>a.jsxs(Yr,{variant:"outline",className:"flex items-center space-x-1",children:[e?.icon,a.jsx("span",{children:e?.label})]},s))})})()]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsxs(Br,{className:"flex items-center",children:[a.jsx(T,{className:"h-5 w-5 mr-2"}),"Document Content"]})}),a.jsx(Wr,{children:o.ocr_text?a.jsx("div",{className:"prose max-w-none",children:a.jsx("pre",{className:"whitespace-pre-wrap text-sm leading-relaxed",children:o.ocr_text})}):a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(T,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),a.jsx("p",{children:"Document content is not available for preview"}),m.canDownload&&a.jsx("p",{className:"text-sm",children:"Download the document to view its contents"})]})})]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{className:"text-base",children:"Document Information"})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Type:"}),a.jsx("span",{className:"text-sm font-medium",children:o.document_type})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Size:"}),a.jsxs("span",{className:"text-sm font-medium",children:[(o.file_size/1024/1024).toFixed(2)," MB"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Uploaded:"}),a.jsx("span",{className:"text-sm font-medium",children:$t(new Date(o.created_at),{addSuffix:!0})})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),a.jsx(Yr,{variant:"completed"===o.processing_status?"default":"secondary",children:o.processing_status})]})]})]}),m.canComment&&a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsxs(Br,{className:"text-base flex items-center",children:[a.jsx(P,{className:"h-4 w-4 mr-2"}),"Comments (",p.length,")"]})}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(an,{placeholder:"Add a comment...",value:f,onChange:e=>y(e.target.value),rows:3}),a.jsx(fr,{onClick:async()=>{if(o&&f.trim()&&m?.canComment)try{w(!0),await kl.addComment(o.id,f.trim()),y(""),await _(o.id),r({title:"Comment Added",description:"Your comment has been added successfully"})}catch(e){r({title:"Comment Failed",description:e instanceof Error?e.message:"Failed to add comment",variant:"destructive"})}finally{w(!1)}},disabled:!f.trim()||j,size:"sm",className:"w-full",children:j?a.jsxs(a.Fragment,{children:[a.jsx(us,{className:"h-4 w-4 mr-2 animate-spin"}),"Adding..."]}):a.jsxs(a.Fragment,{children:[a.jsx(P,{className:"h-4 w-4 mr-2"}),"Add Comment"]})})]}),a.jsx("div",{className:"space-y-3",children:p.map(e=>a.jsxs("div",{className:"p-3 border rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(E,{className:"h-4 w-4 text-gray-400"}),a.jsx("span",{className:"text-sm font-medium",children:e.user?.first_name||e.user?.email||"Anonymous"}),a.jsx("span",{className:"text-xs text-gray-500",children:$t(new Date(e.created_at),{addSuffix:!0})})]}),a.jsx("p",{className:"text-sm text-gray-700",children:e.content})]},e.id))})]})]})]})]})]}),a.jsx(nn,{})]}):null};function Il({onFileUpload:e,disabled:s=!1,maxFileSize:r=10485760,allowedTypes:n=["application/pdf","image/jpeg","image/png","image/webp"]}){const[i,l]=t.useState(null),[o,d]=t.useState(null),m=t.useCallback(e=>{if(e.size>r)return{valid:!1,error:`File size exceeds limit of ${Math.round(r/1048576)}MB`};if(!n.includes(e.type)){return{valid:!1,error:`File type not supported. Allowed types: ${n.map(e=>{switch(e){case"application/pdf":return"PDF";case"image/jpeg":return"JPEG";case"image/png":return"PNG";case"image/webp":return"WebP";default:return e}}).join(", ")}`}}return{valid:!0}},[r,n]),u=t.useCallback((e,s)=>{if(d(null),s.length>0){const e=s[0];return void("file-too-large"===e.errors?.[0]?.code?d(`File size exceeds limit of ${Math.round(r/1048576)}MB`):"file-invalid-type"===e.errors?.[0]?.code?d("File type not supported"):d("File upload failed"))}if(e.length>0){const s=e[0],t=m(s);if(!t.valid)return void d(t.error||"File validation failed");l(s),d(null)}},[r,m]),{getRootProps:h,getInputProps:x,isDragActive:p}=mt({onDrop:u,accept:{"application/pdf":[".pdf"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/webp":[".webp"]},maxSize:r,multiple:!1,disabled:s});return a.jsxs("div",{className:"space-y-4",children:[a.jsx(zr,{className:Wa("border-2 border-dashed transition-colors",p?"border-blue-500 bg-blue-50":"border-gray-300",s&&"opacity-50 cursor-not-allowed"),children:a.jsx(Wr,{className:"p-8",children:a.jsxs("div",{...h(),className:Wa("text-center cursor-pointer",s&&"cursor-not-allowed"),children:[a.jsx("input",{...x()}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx(ss,{className:Wa("h-12 w-12",p?"text-blue-500":"text-gray-400")})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p?"Drop your file here":"Upload Document"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Drag and drop your file here, or click to browse"})]}),a.jsxs("div",{className:"flex justify-center gap-2",children:[a.jsx(Yr,{variant:"secondary",children:"PDF"}),a.jsx(Yr,{variant:"secondary",children:"JPEG"}),a.jsx(Yr,{variant:"secondary",children:"PNG"}),a.jsx(Yr,{variant:"secondary",children:"WebP"})]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Maximum file size: ",Math.round(r/1048576),"MB"]})]})]})})}),o&&a.jsxs(on,{className:"border-red-200 bg-red-50",children:[a.jsx(fs,{className:"h-4 w-4 text-red-600"}),a.jsx(dn,{className:"text-red-700",children:o})]}),i&&a.jsx(zr,{className:"border-green-200 bg-green-50",children:a.jsx(Wr,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[(g=i.type,"application/pdf"===g?a.jsx(T,{className:"h-8 w-8 text-red-500"}):g.startsWith("image/")?a.jsx(T,{className:"h-8 w-8 text-blue-500"}):a.jsx(T,{className:"h-8 w-8 text-gray-500"})),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:i.name}),a.jsxs("p",{className:"text-sm text-gray-600",children:[(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(i.size),"  ",i.type]})]}),a.jsx(L,{className:"h-5 w-5 text-green-600"})]}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>{l(null),d(null)},className:"text-gray-500 hover:text-gray-700",children:a.jsx(c,{className:"h-4 w-4"})})]})})}),i&&a.jsx("div",{className:"flex justify-center",children:a.jsx(fr,{onClick:()=>{i&&e(i)},disabled:s,className:"px-8 py-2 bg-blue-600 hover:bg-blue-700",children:"Analyze Document"})}),a.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Upload Guidelines:"}),a.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[a.jsx("li",{children:"Ensure document text is clear and readable"}),a.jsx("li",{children:"For best results, use high-resolution scans"}),a.jsx("li",{children:"Documents are automatically deleted after 24 hours"}),a.jsx("li",{children:"No personal information is stored permanently"})]})]})]});var g}const Dl=new class{constructor(){s(this,"config",$r)}async checkRateLimit(e){try{const{data:s,error:t}=await Ct.functions.invoke("public-rate-limiter",{body:{ipAddress:e,action:"check"}});return t?{allowed:!1,remaining:{hourly:0,daily:0},resetTime:{hourly:new Date,daily:new Date},message:"Unable to verify rate limit. Please try again."}:{allowed:s.allowed,remaining:s.remaining,resetTime:{hourly:new Date(s.resetTime.hourly),daily:new Date(s.resetTime.daily)},message:s.message}}catch(s){return{allowed:!1,remaining:{hourly:0,daily:0},resetTime:{hourly:new Date,daily:new Date},message:"Rate limit check failed. Please try again."}}}async getOrCreateSession(e,s){const t=new Date,a=new Date(t.getTime()+this.config.rateLimits.sessionDuration),{data:r}=await Ct.from("public_analysis_sessions").select("*").eq("ip_address",e).gt("expires_at",t.toISOString()).order("created_at",{ascending:!1}).limit(1).single();if(r)return{id:r.id,ipAddress:r.ip_address,userAgent:r.user_agent,documentsAnalyzed:r.documents_analyzed,createdAt:new Date(r.created_at),expiresAt:new Date(r.expires_at),totalStorageUsed:r.total_storage_used};const{data:n,error:i}=await Ct.from("public_analysis_sessions").insert({ip_address:e,user_agent:s,documents_analyzed:0,expires_at:a.toISOString(),total_storage_used:0}).select().single();if(i)throw new Error(`Failed to create session: ${i.message}`);return{id:n.id,ipAddress:n.ip_address,userAgent:n.user_agent,documentsAnalyzed:n.documents_analyzed,createdAt:new Date(n.created_at),expiresAt:new Date(n.expires_at),totalStorageUsed:n.total_storage_used}}validateFile(e){return e.size>this.config.rateLimits.maxFileSize?{valid:!1,error:`File size exceeds limit of ${this.config.rateLimits.maxFileSize/1048576}MB`}:this.config.rateLimits.allowedFileTypes.includes(e.type)?{valid:!0}:{valid:!1,error:`File type ${e.type} is not supported. Allowed types: PDF, JPEG, PNG, WebP`}}async analyzeDocument(e,s,t){const a=this.validateFile(e);if(!a.valid)throw new Error(a.error);const r=await this.checkRateLimit(t);if(!r.allowed)throw new Error(r.message||"Rate limit exceeded");try{const a=await this.fileToBase64(e),{data:r,error:n}=await Ct.functions.invoke("public-document-analysis",{body:{sessionId:s,ipAddress:t,filename:e.name,fileSize:e.size,fileType:e.type,fileContent:a}});if(n)throw new Error(`Analysis service error: ${n.message}`);if(!r.success)throw new Error(r.error??"Analysis failed");const i=await this.getAnalysisResult(r.analysisId);if(!i)throw new Error("Failed to retrieve analysis result");return i}catch(n){throw new Error(`Analysis failed: ${n instanceof Error?n.message:"Unknown error"}`)}}async fileToBase64(e){return new Promise((s,t)=>{const a=new FileReader;a.onload=()=>{const e=a.result.split(",")[1];s(e)},a.onerror=()=>t(new Error("Failed to read file")),a.readAsDataURL(e)})}async getAnalysisResult(e){const{data:s,error:t}=await Ct.from("public_document_analyses").select("*").eq("id",e).gt("expires_at",(new Date).toISOString()).single();return t||!s?null:{id:s.id,sessionId:s.session_id,filename:s.filename,fileSize:s.file_size,fileType:s.file_type,analysisResult:s.analysis_result,createdAt:new Date(s.created_at),expiresAt:new Date(s.expires_at)}}async cleanupExpiredData(){const e=(new Date).toISOString();await Ct.from("public_document_analyses").delete().lt("expires_at",e),await Ct.from("public_analysis_sessions").delete().lt("expires_at",e)}};const Pl=new class{constructor(){s(this,"sessionId",null),s(this,"sessionStartTime",Date.now())}async initializeSession(){return this.sessionId||(this.sessionId=crypto.randomUUID(),this.sessionStartTime=Date.now(),await this.trackEvent("session_start",{timestamp:(new Date).toISOString(),user_agent:navigator.userAgent,screen_resolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language})),this.sessionId}async trackEvent(e,s={}){try{this.sessionId||await this.initializeSession();const t={event_type:e,event_data:{...s,session_duration:Date.now()-this.sessionStartTime},session_id:this.sessionId,ip_address:await this.getClientIP(),user_agent:navigator.userAgent,page_url:window.location.href,referrer:document.referrer||null,timestamp:(new Date).toISOString()},{error:a}=await Ct.from("public_analytics_events").insert(t);await this.sendToExternalAnalytics(t)}catch(t){}}async trackPageView(e,s={}){await this.trackEvent("page_view",{page_name:e,...s})}async trackDocumentUpload(e,s,t){await this.trackEvent("document_upload",{file_size:e,file_type:s,file_name_length:t.length,file_extension:t.split(".").pop()?.toLowerCase()})}async trackAnalysisComplete(e,s,t,a){await this.trackEvent("analysis_complete",{analysis_id:e,processing_time:s,document_type:t,text_length:a})}async trackConversion(e,s={}){await this.trackEvent("conversion",{conversion_type:e,...s})}async trackInteraction(e,s,t={}){await this.trackEvent("user_interaction",{interaction_type:e,element:s,...t})}async trackError(e,s,t={}){await this.trackEvent("error",{error_type:e,error_message:s,...t})}async trackRateLimit(e,s){await this.trackEvent("rate_limit_hit",{limit_type:e,remaining_quota:s})}async getConversionFunnel(e){try{const{data:s,error:t}=await Ct.rpc("get_conversion_funnel",{start_date:e.start,end_date:e.end});return t?[]:s||[]}catch(s){return[]}}async getUsageMetrics(e){try{const{data:s,error:t}=await Ct.rpc("get_usage_metrics",{start_date:e.start,end_date:e.end});return t?null:s}catch(s){return null}}async getClientIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch{return"127.0.0.1"}}async sendToExternalAnalytics(e){try{"undefined"!=typeof gtag&&gtag("event",e.event_type,{custom_parameter_1:JSON.stringify(e.event_data),session_id:e.session_id}),"undefined"!=typeof posthog&&posthog.capture(e.event_type,{...e.event_data,session_id:e.session_id,ip_address:e.ip_address}),"undefined"!=typeof mixpanel&&mixpanel.track(e.event_type,{...e.event_data,session_id:e.session_id})}catch(s){}}async trackSessionEnd(){this.sessionId&&await this.trackEvent("session_end",{session_duration:Date.now()-this.sessionStartTime})}getSessionId(){return this.sessionId}resetSession(){this.sessionId=null,this.sessionStartTime=Date.now()}};function Rl(){const e=S(),{analysisState:s,rateLimitStatus:r,analyzeDocument:n}=function(e={}){const{autoCheckRateLimit:s=!0,rateLimitCheckInterval:a=6e4}=e,r=ut(),[n,i]=t.useState({isAnalyzing:!1,progress:0,error:null,currentAnalysis:null}),l=t.useCallback(async()=>{try{const e=await fetch("https://api.ipify.org?format=json");if(!e?.ok)return"127.0.0.1";const s=await e.json();return s?.ip??"127.0.0.1"}catch{return"127.0.0.1"}},[]);t.useEffect(()=>{Pl.initializeSession(),Pl.trackPageView("public_analysis")},[]);const{data:c,error:o,refetch:d,isLoading:m}=ht({queryKey:["publicRateLimit"],queryFn:async()=>{const e=await l(),s=await Dl.checkRateLimit(e);return s.allowed||await Pl.trackRateLimit(0===s.remaining.hourly?"hourly":"daily",s.remaining.hourly+s.remaining.daily),s},enabled:s,refetchInterval:a,staleTime:3e4,retry:2}),u=xt({mutationFn:async()=>{const e=await l(),s=navigator.userAgent;return Dl.getOrCreateSession(e,s)},onError:e=>{i(e=>({...e,error:"Failed to create analysis session"}))}}),h=xt({mutationFn:async({file:e,session:s,startTime:t})=>{const a=await l();await Pl.trackDocumentUpload(e.size,e.type,e.name);const r=await Dl.analyzeDocument(e,s.id,a),n=Date.now()-t;return await Pl.trackAnalysisComplete(r.id,n,r.analysisResult.documentType,r.analysisResult.textLength),r},onSuccess:e=>{i(s=>({...s,currentAnalysis:e,isAnalyzing:!1,progress:100,error:null})),r.invalidateQueries({queryKey:["publicRateLimit"]})},onError:e=>{Pl.trackError("analysis_failed",e instanceof Error?e.message:"Unknown error"),i(s=>({...s,isAnalyzing:!1,progress:0,error:e instanceof Error?e.message:"Analysis failed"}))}}),x=t.useCallback(async e=>{try{return await Dl.getAnalysisResult(e)}catch(s){return null}},[]),p=t.useCallback(async e=>{const s=Date.now();i(e=>({...e,isAnalyzing:!0,progress:0,error:null,currentAnalysis:null}));try{await Pl.trackEvent("analysis_started",{file_size:e.size,file_type:e.type,file_name_length:e.name.length});const t=Dl.validateFile(e);if(!t.valid)throw await Pl.trackError("validation_failed",t.error||"File validation failed"),new Error(t.error);i(e=>({...e,progress:10}));const a=await l(),r=await Dl.checkRateLimit(a);if(!r.allowed)throw await Pl.trackRateLimit(0===r.remaining.hourly?"hourly":"daily",r.remaining.hourly+r.remaining.daily),new Error(r.message||"Rate limit exceeded");i(e=>({...e,progress:20}));const n=await u.mutateAsync();return i(e=>({...e,progress:40})),await h.mutateAsync({file:e,session:n,startTime:s})}catch(t){const e=t instanceof Error?t.message:"Analysis failed";throw i(s=>({...s,isAnalyzing:!1,progress:0,error:e})),t}},[u,h,l]),g=t.useCallback(()=>{i({isAnalyzing:!1,progress:0,error:null,currentAnalysis:null})},[]),f=t.useCallback(()=>!!c&&c.allowed&&!n.isAnalyzing,[c,n.isAnalyzing]),y=t.useCallback(()=>c?c.remaining:{hourly:0,daily:0},[c]);return t.useEffect(()=>{n.currentAnalysis&&!n.isAnalyzing&&d()},[n.currentAnalysis,n.isAnalyzing,d]),{analysisState:n,rateLimitStatus:c,isCheckingRateLimit:m,rateLimitError:o,analyzeDocument:p,getAnalysisResult:x,resetAnalysis:g,refetchRateLimit:d,canAnalyze:f,getRemainingUsage:y,getUserIP:l,isCreatingSession:u.isPending,isAnalyzing:h.isPending||n.isAnalyzing}}(),i=t.useCallback(async s=>{try{const t=await n(s);setTimeout(()=>{e(`${Lr.publicAnalysisResult}/${t.id}`)},500)}catch(t){}},[n,e]),l=[{icon:T,title:"Text Extraction",description:"Extract text from PDFs and images using advanced OCR technology"},{icon:R,title:"Quick Analysis",description:"Get document summary and key insights in seconds"},{icon:U,title:"Secure & Private",description:"Documents are automatically deleted after 24 hours"},{icon:q,title:"No Registration",description:"Start analyzing immediately without creating an account"}],c=["Advanced legal insights and compliance checks","Entity extraction and risk assessment","Unlimited document analysis","Permanent document storage","AI-powered legal Q&A","Custom document templates"];return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:a.jsxs("div",{className:"container mx-auto px-4 py-8",children:[a.jsxs("div",{className:"text-center mb-12",children:[a.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Free Document Analysis"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Upload your legal documents and get instant analysis with our AI-powered platform. No registration required."})]}),a.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsxs(zr,{className:"shadow-lg",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(T,{className:"h-5 w-5"}),"Upload Document"]}),a.jsx(Vr,{children:"Upload a PDF or image file to get started with free document analysis"})]}),a.jsxs(Wr,{children:[s.error&&a.jsx(on,{className:"mb-6 border-red-200 bg-red-50",children:a.jsx(dn,{className:"text-red-700",children:s.error})}),r&&!r.allowed&&a.jsx(on,{className:"mb-6 border-orange-200 bg-orange-50",children:a.jsx(dn,{className:"text-orange-700",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{children:r.message}),a.jsxs("div",{className:"text-sm",children:[a.jsxs("p",{children:["Remaining today: ",r.remaining.daily," documents"]}),a.jsxs("p",{children:["Remaining this hour: ",r.remaining.hourly," documents"]})]})]})})}),s.isAnalyzing&&a.jsxs("div",{className:"mb-6 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{children:"Analyzing document..."}),a.jsxs("span",{children:[s.progress,"%"]})]}),a.jsx(xl,{value:s.progress,className:"h-2"})]}),a.jsx(Il,{onFileUpload:i,disabled:s.isAnalyzing||r&&!r.allowed,maxFileSize:$r.rateLimits.maxFileSize,allowedTypes:$r.rateLimits.allowedFileTypes}),r?.allowed&&a.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("div",{className:"text-sm text-blue-700",children:[a.jsx("p",{className:"font-medium",children:"Usage Remaining:"}),a.jsxs("div",{className:"mt-1 space-y-1",children:[a.jsxs("p",{children:["This hour: ",r.remaining.hourly," documents"]}),a.jsxs("p",{children:["Today: ",r.remaining.daily," documents"]})]})]})})]})]}),a.jsx("div",{className:"mt-8 grid md:grid-cols-2 gap-4",children:l.map(e=>a.jsx(zr,{className:"border-l-4 border-l-blue-500",children:a.jsx(Wr,{className:"p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(e.icon,{className:"h-5 w-5 text-blue-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]})]})})},e.title))})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{className:"text-lg",children:"Free Analysis Includes"})}),a.jsx(Wr,{className:"space-y-3",children:["Basic text extraction and summary only","Limited to 3 documents per hour, 10 per day","Maximum file size: 10MB","Documents deleted after 24 hours"].map(e=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(L,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),a.jsx("span",{className:"text-sm text-gray-600",children:e})]},e))})]}),a.jsxs(zr,{className:"border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100",children:[a.jsxs(Mr,{children:[a.jsx(Br,{className:"text-lg text-blue-900",children:"Unlock Advanced Features"}),a.jsx(Vr,{className:"text-blue-700",children:"Get unlimited access and advanced legal insights"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[c.slice(0,4).map(e=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(L,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsx("span",{className:"text-sm text-blue-800",children:e})]},e)),c.length>4&&a.jsxs("p",{className:"text-sm text-blue-700 font-medium",children:["+",c.length-4," more features"]})]}),a.jsx(ii,{}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs(fr,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{Pl.trackInteraction("button_click","view_pricing_from_public_analysis"),e(Lr.pricing)},children:["View Pricing Plans",a.jsx(F,{className:"ml-2 h-4 w-4"})]}),a.jsx(fr,{variant:"outline",className:"w-full border-blue-300 text-blue-700 hover:bg-blue-50",onClick:()=>{Pl.trackInteraction("button_click","create_account_from_public_analysis"),e(Lr.register)},children:"Create Free Account"})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{className:"text-lg",children:"File Requirements"})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Supported Formats"}),a.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[a.jsx(Yr,{variant:"secondary",children:"PDF"}),a.jsx(Yr,{variant:"secondary",children:"JPEG"}),a.jsx(Yr,{variant:"secondary",children:"PNG"}),a.jsx(Yr,{variant:"secondary",children:"WebP"})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Size Limit"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Maximum 10MB per file"})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Privacy"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Files are automatically deleted after 24 hours"})]})]})]})]})]})]})})}function Fl(){const{analysisId:e}=We(),s=S(),{data:t,isLoading:r,error:n}=function(e){return ht({queryKey:["publicAnalysisResult",e],queryFn:()=>{if(!e)throw new Error("Analysis ID is required");return Dl.getAnalysisResult(e)},enabled:!!e,retry:2,staleTime:3e5})}(e),i=[{icon:$,title:"Advanced Legal Insights",description:"Get detailed legal analysis, risk assessment, and compliance checks"},{icon:R,title:"Unlimited Analysis",description:"Analyze unlimited documents without rate limits or file size restrictions"},{icon:U,title:"Secure Storage",description:"Permanent document storage with enterprise-grade security"},{icon:M,title:"Team Collaboration",description:"Share documents and collaborate with team members"}];if(r)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:a.jsx(zr,{className:"w-full max-w-md",children:a.jsx(Wr,{className:"p-8 text-center",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("h3",{className:"text-lg font-semibold",children:"Loading Analysis Results..."}),a.jsx("p",{className:"text-gray-600",children:"Please wait while we retrieve your document analysis."})]})})})});if(n||!t)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:a.jsx(zr,{className:"w-full max-w-md",children:a.jsxs(Wr,{className:"p-8 text-center",children:[a.jsx(fs,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Analysis Not Found"}),a.jsx("p",{className:"text-gray-600 mb-6",children:n?.message??"The analysis you're looking for doesn't exist or has expired."}),a.jsx(fr,{onClick:()=>s(Lr.publicAnalysis),children:"Analyze New Document"})]})})});const l=(e=>{const s=new Date,t=e.getTime()-s.getTime(),a=Math.floor(t/36e5),r=Math.floor(t%36e5/6e4);return a>0?`${a}h ${r}m`:r>0?`${r}m`:"Expired"})(t.expiresAt),o=new Date>t.expiresAt;return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:a.jsxs("div",{className:"container mx-auto px-4 py-8",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Document Analysis Complete"}),a.jsx("p",{className:"text-gray-600",children:"Here are the results from your free document analysis"})]}),a.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(T,{className:"h-5 w-5"}),"Document Information"]})}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Filename"}),a.jsx("p",{className:"text-gray-600",children:t.filename})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"File Size"}),a.jsx("p",{className:"text-gray-600",children:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(t.fileSize)})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Document Type"}),a.jsx(Yr,{variant:"secondary",children:t.analysisResult.documentType})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Text Length"}),a.jsxs("p",{className:"text-gray-600",children:[t.analysisResult.textLength.toLocaleString()," characters"]})]})]}),!o&&a.jsxs(on,{className:"border-orange-200 bg-orange-50",children:[a.jsx(q,{className:"h-4 w-4 text-orange-600"}),a.jsxs(dn,{className:"text-orange-700",children:["This analysis will expire in ",l,". Results are automatically deleted after 24 hours."]})]}),o&&a.jsxs(on,{className:"border-red-200 bg-red-50",children:[a.jsx(fs,{className:"h-4 w-4 text-red-600"}),a.jsx(dn,{className:"text-red-700",children:"This analysis has expired and will be deleted soon."})]})]})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Document Summary"}),a.jsx(Vr,{children:"AI-generated summary and key insights from your document"})]}),a.jsxs(Wr,{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Text Extraction Quality"}),a.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(100*t.analysisResult.ocrQuality),"%"]})]}),a.jsx(xl,{value:100*t.analysisResult.ocrQuality,className:"h-2"})]}),a.jsx(ii,{}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Document Summary"}),a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.analysisResult.summary})})]}),a.jsx(ii,{}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Key Terms"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:t.analysisResult.keyWords.map(e=>a.jsx(Yr,{variant:"outline",children:e},e))})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Next Steps"})}),a.jsx(Wr,{className:"space-y-4",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsx(fr,{onClick:()=>s(Lr.publicAnalysis),variant:"outline",className:"w-full",children:"Analyze Another Document"}),a.jsxs(fr,{onClick:()=>s(Lr.register),className:"w-full bg-blue-600 hover:bg-blue-700",children:["Create Free Account",a.jsx(F,{className:"ml-2 h-4 w-4"})]})]})})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{className:"border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100",children:[a.jsxs(Mr,{children:[a.jsx(Br,{className:"text-blue-900",children:"Unlock Advanced Analysis"}),a.jsx(Vr,{className:"text-blue-700",children:"Get deeper insights with our premium features"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsx("div",{className:"space-y-3",children:i.map(e=>a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(e.icon,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-blue-900",children:e.title}),a.jsx("p",{className:"text-sm text-blue-700",children:e.description})]})]},e.title))}),a.jsx(ii,{}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs(fr,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>s(Lr.pricing),children:["View Pricing Plans",a.jsx(F,{className:"ml-2 h-4 w-4"})]}),a.jsx(fr,{variant:"outline",className:"w-full border-blue-300 text-blue-700 hover:bg-blue-50",onClick:()=>s(Lr.register),children:"Start Free Trial"})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{className:"text-lg",children:"What You're Missing"})}),a.jsx(Wr,{className:"space-y-3",children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Legal entity extraction"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Risk assessment"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Compliance checking"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Document comparison"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(c,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Export to Word/PDF"})]})]})})]})]})]})]})})}function Ll({className:e,...s}){return a.jsx("div",{className:Wa("animate-pulse rounded-md bg-muted",e),...s})}"undefined"!=typeof window&&(window.addEventListener("beforeunload",()=>{Pl.trackSessionEnd()}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?Pl.trackEvent("page_hidden"):Pl.trackEvent("page_visible")}));const $l=new class{constructor(){s(this,"config",Ur)}async getCategories(){const{data:e,error:s}=await Ct.from("template_categories").select("*").eq("is_active",!0).order("sort_order",{ascending:!0});if(s)throw new Error(`Failed to fetch categories: ${s.message}`);return this.transformCategories(e||[])}async searchTemplates(e={}){let s=Ct.from("templates").select("\n        *,\n        category:template_categories(id, name, slug, description, icon)\n      ").eq("is_active",!0);switch(e.categoryId&&(s=s.eq("category_id",e.categoryId)),e.subcategory&&(s=s.eq("subcategory",e.subcategory)),e.accessLevel&&(s=s.eq("access_level",e.accessLevel)),e.priceRange&&(s=s.gte("price_sgd",e.priceRange.min).lte("price_sgd",e.priceRange.max)),e.tags&&e.tags.length>0&&(s=s.overlaps("tags",e.tags)),e.legalAreas&&e.legalAreas.length>0&&(s=s.overlaps("legal_areas",e.legalAreas)),e.minRating&&(s=s.gte("rating_average",e.minRating)),e.sortBy){case"popularity":s=s.order("download_count",{ascending:!1});break;case"rating":s=s.order("rating_average",{ascending:!1});break;case"newest":s=s.order("created_at",{ascending:!1});break;case"price_low":s=s.order("price_sgd",{ascending:!0});break;case"price_high":s=s.order("price_sgd",{ascending:!1});break;default:s=s.order("is_featured",{ascending:!1}).order("download_count",{ascending:!1})}const t=e.limit||20,a=e.offset||0;s=s.range(a,a+t-1);const{data:r,error:n,count:i}=await s;if(n)throw new Error(`Failed to search templates: ${n.message}`);const{count:l}=await Ct.from("templates").select("*",{count:"exact",head:!0}).eq("is_active",!0),c=l||0;return{templates:this.transformTemplates(r||[]),total:c,hasMore:a+t<c,filters:await this.getFilterAggregations(e)}}async getTemplate(e){const{data:s,error:t}=await Ct.from("templates").select("\n        *,\n        category:template_categories(id, name, slug, description, icon)\n      ").or(`id.eq.${e},slug.eq.${e}`).eq("is_active",!0).single();if(t){if("PGRST116"===t.code)return null;throw new Error(`Failed to fetch template: ${t.message}`)}return this.transformTemplate(s)}async getTemplateBySlug(e){return this.getTemplate(e)}async getFeaturedTemplates(e=6){const{data:s,error:t}=await Ct.from("templates").select("\n        *,\n        category:template_categories(id, name, slug, description, icon)\n      ").eq("is_active",!0).eq("is_featured",!0).order("download_count",{ascending:!1}).limit(e);if(t)throw new Error(`Failed to fetch featured templates: ${t.message}`);return this.transformTemplates(s||[])}async getPopularTemplates(e,s,t=10){const{data:a,error:r}=await Ct.rpc("get_popular_templates",{limit_count:t,category_filter:e||null,access_level_filter:s||null});if(r)throw new Error(`Failed to fetch popular templates: ${r.message}`);return this.transformPopularTemplates(a||[])}async createCustomization(e,s,t,a){const{data:r,error:n}=await Ct.from("template_customizations").insert({template_id:e,user_id:t,session_id:a,custom_fields:s,status:"draft"}).select().single();if(n)throw new Error(`Failed to create customization: ${n.message}`);return this.transformCustomization(r)}async updateCustomization(e,s){const{data:t,error:a}=await Ct.from("template_customizations").update({custom_fields:s.customFields,generated_content:s.generatedContent,generated_html:s.generatedHtml,generated_pdf_url:s.generatedPdfUrl,status:s.status,error_message:s.errorMessage,updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(a)throw new Error(`Failed to update customization: ${a.message}`);return this.transformCustomization(t)}async getUserCustomizations(e){const{data:s,error:t}=await Ct.from("template_customizations").select("\n        *,\n        template:templates(id, title, slug)\n      ").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw new Error(`Failed to fetch customizations: ${t.message}`);return this.transformCustomizations(s||[])}async recordDownload(e,s,t="pdf",a,r){const{error:n}=await Ct.from("template_downloads").insert({template_id:e,customization_id:s,user_id:a,session_id:r,format:t,ip_address:await this.getClientIP(),user_agent:navigator.userAgent})}async rateTemplate(e,s,t,a){const{error:r}=await Ct.from("template_ratings").upsert({template_id:e,user_id:s,rating:t,review:a,updated_at:(new Date).toISOString()});if(r)throw new Error(`Failed to rate template: ${r.message}`)}async getTemplateRatings(e){const{data:s,error:t}=await Ct.from("template_ratings").select("\n        *,\n        user:profiles(id, email, first_name, last_name, avatar_url)\n      ").eq("template_id",e).order("created_at",{ascending:!1});if(t)throw new Error(`Failed to fetch template ratings: ${t.message}`);return s||[]}async getUserTemplateRating(e,s){const{data:t,error:a}=await Ct.from("template_ratings").select("*").eq("template_id",e).eq("user_id",s).single();if(a&&"PGRST116"!==a.code)throw new Error(`Failed to fetch user rating: ${a.message}`);return t}async trackEvent(e,s,t={},a,r){const{error:n}=await Ct.from("template_analytics").insert({template_id:e,event_type:s,event_data:t,user_id:a,session_id:r,ip_address:await this.getClientIP(),user_agent:navigator.userAgent})}transformCategories(e){return e.map(e=>({id:e.id,name:e.name,slug:e.slug,description:e.description,icon:e.icon,parentId:e.parent_id,sortOrder:e.sort_order,isActive:e.is_active}))}transformTemplates(e){return e.map(e=>this.transformTemplate(e))}transformTemplate(e){return{id:e.id,title:e.title,slug:e.slug,description:e.description,categoryId:e.category_id,subcategory:e.subcategory,content:e.content,fields:e.fields,previewHtml:e.preview_html,previewPdfUrl:e.preview_pdf_url,accessLevel:e.access_level,priceSgd:parseFloat(e.price_sgd||"0"),jurisdiction:e.jurisdiction,legalAreas:e.legal_areas||[],complianceTags:e.compliance_tags||[],downloadCount:e.download_count,ratingAverage:parseFloat(e.rating_average||"0"),ratingCount:e.rating_count,createdBy:e.created_by,isActive:e.is_active,isFeatured:e.is_featured,tags:e.tags||[],language:e.language,version:e.version,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),category:e.category?{id:e.category.id,name:e.category.name,slug:e.category.slug,description:e.category.description,icon:e.category.icon,sortOrder:0,isActive:!0}:void 0}}transformPopularTemplates(e){return e.map(e=>({id:e.template_id,title:e.title,slug:"",description:e.description,categoryId:"",content:{},fields:[],accessLevel:"public",priceSgd:0,jurisdiction:"Singapore",legalAreas:[],complianceTags:[],downloadCount:e.download_count,ratingAverage:parseFloat(e.rating_average||"0"),ratingCount:e.rating_count,isActive:!0,isFeatured:!1,tags:[],language:"en",version:1,createdAt:new Date,updatedAt:new Date,category:{id:"",name:e.category_name,slug:"",sortOrder:0,isActive:!0}}))}transformCustomization(e){return{id:e.id,templateId:e.template_id,userId:e.user_id,sessionId:e.session_id,customFields:e.custom_fields,generatedContent:e.generated_content,generatedHtml:e.generated_html,generatedPdfUrl:e.generated_pdf_url,status:e.status,errorMessage:e.error_message,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}transformCustomizations(e){return e.map(e=>this.transformCustomization(e))}async getFilterAggregations(e){return{categories:[],priceRanges:[],tags:[]}}async getClientIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch{return"127.0.0.1"}}},Ul={employment:gt,business:ft,property:ee,family:M,"intellectual-property":cs,compliance:U};function ql(){const e=S(),[s,r]=bs(),[n,i]=t.useState([]),[l,c]=t.useState([]),[o,d]=t.useState([]),[m,u]=t.useState(!0),[h,x]=t.useState(!1),[p,g]=t.useState(null),[f,y]=t.useState("grid"),[j,w]=t.useState(!1),b=Array.isArray(l)?l:[],[v,N]=t.useState(s.get("q")||""),[_,k]=t.useState(s.get("category")||""),[C,E]=t.useState(s.get("access")||""),[T,I]=t.useState(s.get("sort")||"popularity"),[D,P]=t.useState(Number(s.get("rating"))||0),[R,F]=t.useState(!0),[L,U]=t.useState(0),[q,z]=t.useState(0);t.useEffect(()=>{M()},[]),t.useEffect(()=>{const e={query:v||void 0,categoryId:_||void 0,accessLevel:C||void 0,sortBy:T,minRating:D||void 0,limit:20,offset:0};z(0),B(e),V()},[v,_,C,T,D]);const M=async()=>{try{u(!0);const[e,s]=await Promise.all([$l.getCategories(),$l.getFeaturedTemplates(6)]);c(e),d(s)}catch(e){g(e instanceof Error?e.message:"Failed to load data")}finally{u(!1)}},B=async e=>{try{x(!0);const s=await $l.searchTemplates(e);i(s.templates),U(s.total),F(s.hasMore)}catch(s){g(s instanceof Error?s.message:"Search failed")}finally{x(!1)}},V=()=>{const e=new URLSearchParams;v&&e.set("q",v),_&&e.set("category",_),C&&e.set("access",C),"popularity"!==T&&e.set("sort",T),D>0&&e.set("rating",D.toString()),r(e)},W=t.useCallback(e=>{N(e)},[]),G=s=>{$l.trackEvent(s.id,"template_view",{source:"browser",category:s.category?.name,access_level:s.accessLevel}),e(`${Lr.templatePreview}/${s.slug}`)},H=e=>null==e||isNaN(e)||0===e?"Free":`S$${e.toFixed(2)}`,Y=e=>Array.from({length:5},(s,t)=>a.jsx($,{className:"h-4 w-4 "+(t<Math.floor(e)?"text-yellow-400 fill-current":"text-gray-300")},t)),Q=e=>{const s=Ul[e];return s?a.jsx(s,{className:"h-5 w-5"}):a.jsx(gt,{className:"h-5 w-5"})};return m?a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs("div",{className:"space-y-8",children:[a.jsx(Ll,{className:"h-12 w-full max-w-md mx-auto"}),a.jsx("div",{className:"grid md:grid-cols-3 lg:grid-cols-4 gap-6",children:Array.from({length:8}).map((e,s)=>a.jsx(Ll,{className:"h-64 w-full"},`loading-${s}`))})]})})}):a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsxs("div",{className:"container mx-auto px-4 py-8",children:[a.jsxs("div",{className:"text-center mb-12",children:[a.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Legal Document Templates"}),a.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Browse our comprehensive collection of Singapore-specific legal document templates. Customize, download, and use with confidence."})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-8",children:[a.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[a.jsxs("div",{className:"relative flex-1 max-w-md",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx(yr,{placeholder:"Search templates...",value:v,onChange:e=>W(e.target.value),className:"pl-10"})]}),a.jsxs(yn,{value:_||"all",onValueChange:e=>k("all"===e?"":e),children:[a.jsx(wn,{className:"w-full lg:w-48",children:a.jsx(jn,{placeholder:"All Categories"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"all",children:"All Categories"}),b.map(e=>e&&e.id&&e.name?a.jsx(_n,{value:e.id,children:a.jsxs("div",{className:"flex items-center gap-2",children:[Q(e.slug),e.name]})},e.id):null)]})]}),a.jsxs(yn,{value:C||"all",onValueChange:e=>E("all"===e?"":e),children:[a.jsx(wn,{className:"w-full lg:w-32",children:a.jsx(jn,{placeholder:"All"})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"all",children:"All"}),a.jsx(_n,{value:"public",children:"Free"}),a.jsx(_n,{value:"premium",children:"Premium"}),a.jsx(_n,{value:"enterprise",children:"Enterprise"})]})]}),a.jsxs(yn,{value:T,onValueChange:I,children:[a.jsx(wn,{className:"w-full lg:w-40",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"popularity",children:"Most Popular"}),a.jsx(_n,{value:"rating",children:"Highest Rated"}),a.jsx(_n,{value:"newest",children:"Newest"}),a.jsx(_n,{value:"price_low",children:"Price: Low to High"}),a.jsx(_n,{value:"price_high",children:"Price: High to Low"})]})]}),a.jsxs("div",{className:"flex border rounded-lg",children:[a.jsx(fr,{variant:"grid"===f?"default":"ghost",size:"sm",onClick:()=>y("grid"),className:"rounded-r-none",children:a.jsx(Ee,{className:"h-4 w-4"})}),a.jsx(fr,{variant:"list"===f?"default":"ghost",size:"sm",onClick:()=>y("list"),className:"rounded-l-none",children:a.jsx(ce,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsxs(fr,{variant:"ghost",size:"sm",onClick:()=>w(!j),className:"text-gray-600",children:[a.jsx(pt,{className:"h-4 w-4 mr-2"}),"Advanced Filters",a.jsx(he,{className:"h-4 w-4 ml-2 transition-transform "+(j?"rotate-180":"")})]}),j&&a.jsx("div",{className:"mt-4 pt-4 border-t",children:a.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:a.jsxs("div",{children:[a.jsx("label",{htmlFor:"min-rating-select",className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Rating"}),a.jsxs(yn,{value:D.toString(),onValueChange:e=>P(Number(e)),children:[a.jsx(wn,{id:"min-rating-select",children:a.jsx(jn,{})}),a.jsxs(Nn,{children:[a.jsx(_n,{value:"0",children:"Any Rating"}),a.jsx(_n,{value:"3",children:"3+ Stars"}),a.jsx(_n,{value:"4",children:"4+ Stars"}),a.jsx(_n,{value:"4.5",children:"4.5+ Stars"})]})]})]})})})]})]}),o.length>0&&!v&&a.jsxs("div",{className:"mb-12",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Featured Templates"}),a.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(e=>a.jsxs(zr,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 border-blue-200",onClick:()=>G(e),children:[a.jsx(Mr,{children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(Br,{className:"text-lg line-clamp-2",children:e.title}),a.jsx(Vr,{className:"mt-2 line-clamp-2",children:e.description})]}),a.jsx(Yr,{variant:"secondary",className:"ml-2 bg-blue-100 text-blue-800",children:"Featured"})]})}),a.jsx(Wr,{children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[Y(e.ratingAverage),a.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",e.ratingCount,")"]})]}),a.jsx("span",{className:"font-semibold text-blue-600",children:H(e.priceSgd)})]}),a.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(O,{className:"h-4 w-4"}),e.downloadCount.toLocaleString()]}),a.jsxs("div",{className:"flex items-center gap-1",children:[Q(e.category?.slug||""),e.category?.name]})]})]})})]},e.id))}),a.jsx(ii,{className:"mt-12"})]}),a.jsx("div",{className:"flex items-center justify-between mb-6",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:v?`Search Results for "${v}"`:"All Templates"}),a.jsxs("p",{className:"text-gray-600 mt-1",children:[L.toLocaleString()," templates found"]})]})}),h?a.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((e,s)=>a.jsx(Ll,{className:"h-64 w-full"},`search-loading-${s}`))}):n.length>0?a.jsx("div",{className:"grid"===f?"grid md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:n.map(e=>a.jsxs(zr,{className:"cursor-pointer hover:shadow-lg transition-shadow "+("list"===f?"flex":""),onClick:()=>G(e),children:[a.jsx(Mr,{className:"list"===f?"flex-1":"",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(Br,{className:"text-lg line-clamp-2",children:e.title}),a.jsx(Vr,{className:"mt-2 line-clamp-2",children:e.description})]}),a.jsxs("div",{className:"ml-4 text-right",children:[a.jsx("div",{className:"font-semibold text-blue-600",children:H(e.priceSgd)}),"public"!==e.accessLevel&&a.jsx(Yr,{variant:"outline",className:"mt-1",children:e.accessLevel})]})]})}),a.jsxs(Wr,{className:"list"===f?"flex items-center":"",children:[a.jsxs("div",{className:"space-y-3 flex-1",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-1",children:[Y(e.ratingAverage),a.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",e.ratingCount,")"]})]})}),a.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(O,{className:"h-4 w-4"}),e.downloadCount.toLocaleString()]}),a.jsxs("div",{className:"flex items-center gap-1",children:[Q(e.category?.slug||""),e.category?.name]})]}),e.tags.length>0&&a.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.tags.slice(0,3).map(e=>a.jsx(Yr,{variant:"outline",className:"text-xs",children:e},e)),e.tags.length>3&&a.jsxs(Yr,{variant:"outline",className:"text-xs",children:["+",e.tags.length-3]})]})]}),"list"===f&&a.jsx("div",{className:"ml-4",children:a.jsxs(fr,{size:"sm",children:[a.jsx(rs,{className:"h-4 w-4 mr-2"}),"Preview"]})})]})]},e.id))}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"text-gray-400 mb-4",children:a.jsx(A,{className:"h-16 w-16 mx-auto"})}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No templates found"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Try adjusting your search criteria or browse all categories."}),a.jsx(fr,{onClick:()=>{N(""),k(""),E(""),P(0)},children:"Clear Filters"})]}),R&&n.length>0&&a.jsx("div",{className:"text-center mt-12",children:a.jsx(fr,{variant:"outline",onClick:async()=>{if(!h&&R)try{x(!0);const e=q+20,s={query:v||void 0,categoryId:_||void 0,accessLevel:C||void 0,sortBy:T,minRating:D||void 0,limit:20,offset:e},t=await $l.searchTemplates(s);i(e=>[...e,...t.templates]),z(e),F(t.hasMore)}catch(e){g(e instanceof Error?e.message:"Failed to load more templates")}finally{x(!1)}},disabled:h,children:h?"Loading...":"Load More Templates"})}),p&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"text-red-400 mb-4",children:a.jsx(fs,{className:"h-16 w-16 mx-auto"})}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong"}),a.jsx("p",{className:"text-gray-600 mb-6",children:p}),a.jsx(fr,{onClick:()=>window.location.reload(),children:"Try Again"})]})]})})}const Ol=({template:e,className:s=""})=>{const{user:r}=hr(),[n,i]=t.useState([]),[l,c]=t.useState(!0),[o,d]=t.useState(!1),[m,u]=t.useState(!1),[h,x]=t.useState(null),[p,g]=t.useState(0),[f,y]=t.useState(0),[j,w]=t.useState("");t.useEffect(()=>{b()},[e.id]);const b=async()=>{try{c(!0);const t=(await $l.getTemplateRatings(e.id)).map(e=>({id:e.id,templateId:e.template_id,userId:e.user_id,rating:e.rating,review:e.review,isVerified:e.is_verified,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),user:e.user?{id:e.user.id,email:e.user.email,firstName:e.user.first_name,lastName:e.user.last_name,avatar:e.user.avatar_url}:void 0}));if(i(t),r)try{const s=await $l.getUserTemplateRating(e.id,r.id);if(s){const e={id:s.id,templateId:s.template_id,userId:s.user_id,rating:s.rating,review:s.review,isVerified:s.is_verified,createdAt:new Date(s.created_at),updatedAt:new Date(s.updated_at)};x(e),g(e.rating),w(e.review||"")}}catch(s){}}catch(s){Pt.error("Failed to load ratings")}finally{c(!1)}},v=(e,s=!1,t="h-4 w-4")=>Array.from({length:5},(r,n)=>{const i=n+1,l=i<=(s?f||p:e);return a.jsx("button",{type:"button",disabled:!s,className:`${s?"cursor-pointer":"cursor-default"} transition-colors ${l?"text-yellow-400":"text-gray-300"} ${s?"hover:text-yellow-300":""}`,onMouseEnter:()=>s&&y(i),onMouseLeave:()=>s&&y(0),onClick:()=>s&&g(i),children:a.jsx($,{className:`${t} ${l?"fill-current":""}`})},n)}),N=(()=>{const e={5:0,4:0,3:0,2:0,1:0};return n.forEach(s=>{e[s.rating]++}),e})(),_=n.length;return a.jsxs("div",{className:`space-y-6 ${s}`,children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx($,{className:"h-5 w-5 text-yellow-400"}),"Ratings & Reviews"]}),r&&!h&&a.jsxs(li,{open:m,onOpenChange:u,children:[a.jsx(ci,{asChild:!0,children:a.jsxs(fr,{size:"sm",children:[a.jsx(P,{className:"h-4 w-4 mr-2"}),"Write Review"]})}),a.jsxs(mi,{className:"sm:max-w-md",children:[a.jsxs(ui,{children:[a.jsx(xi,{children:"Rate this Template"}),a.jsx(pi,{children:"Share your experience with this template to help other users"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rating"}),a.jsx("div",{className:"flex items-center gap-1",children:v(p,!0,"h-8 w-8")}),p>0&&a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[1===p&&"Poor",2===p&&"Fair",3===p&&"Good",4===p&&"Very Good",5===p&&"Excellent"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Review (Optional)"}),a.jsx(an,{placeholder:"Share your thoughts about this template...",value:j,onChange:e=>w(e.target.value),rows:4,maxLength:500}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[j.length,"/500 characters"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{onClick:async()=>{if(r)if(0!==p)try{d(!0),await $l.rateTemplate(e.id,r.id,p,j.trim()||void 0),Pt.success("Rating submitted successfully!"),u(!1),b(),await $l.trackEvent(e.id,"template_rated",{rating:p,has_review:!!j.trim()})}catch(s){Pt.error("Failed to submit rating: "+s.message)}finally{d(!1)}else Pt.error("Please select a rating");else Pt.error("Please log in to rate this template")},disabled:o||0===p,className:"flex-1",children:o?"Submitting...":"Submit Rating"}),a.jsx(fr,{variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"Cancel"})]})]})]})]})]})}),a.jsxs(Wr,{children:[a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:e.ratingAverage.toFixed(1)}),a.jsx("div",{className:"flex items-center justify-center gap-1 mb-2",children:v(e.ratingAverage)}),a.jsxs("p",{className:"text-gray-600",children:["Based on ",e.ratingCount," review",1!==e.ratingCount?"s":""]})]}),a.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(e=>a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx("span",{className:"w-8",children:e}),a.jsx($,{className:"h-4 w-4 text-yellow-400 fill-current"}),a.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:_>0?N[e]/_*100+"%":"0%"}})}),a.jsx("span",{className:"w-8 text-gray-600",children:N[e]})]},e))})]}),h&&a.jsxs(on,{className:"mt-4",children:[a.jsx(L,{className:"h-4 w-4"}),a.jsxs(dn,{children:["You rated this template ",h.rating," star",1!==h.rating?"s":"",".",h.review&&" Thank you for your review!"]})]})]})]}),n.length>0&&a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Reviews"})}),a.jsx(Wr,{children:a.jsx("div",{className:"space-y-6",children:n.map((e,s)=>{return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsxs(Pn,{className:"h-10 w-10",children:[a.jsx(Rn,{src:e.user?.avatar}),a.jsx(Fn,{children:(t=e.user?.firstName,r=e.user?.lastName,i=e.user?.email,t&&r?`${t[0]}${r[0]}`.toUpperCase():i?i.substring(0,2).toUpperCase():"U")})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("span",{className:"font-medium",children:e.user?.firstName&&e.user?.lastName?`${e.user.firstName} ${e.user.lastName}`:e.user?.email?.split("@")[0]||"Anonymous"}),e.isVerified&&a.jsxs(Yr,{variant:"secondary",className:"text-xs",children:[a.jsx(L,{className:"h-3 w-3 mr-1"}),"Verified"]}),a.jsx("span",{className:"text-sm text-gray-500",children:$t(e.createdAt,{addSuffix:!0})})]}),a.jsx("div",{className:"flex items-center gap-1 mb-2",children:v(e.rating)}),e.review&&a.jsx("p",{className:"text-gray-700 leading-relaxed",children:e.review})]})]}),s<n.length-1&&a.jsx(ii,{className:"mt-6"})]},e.id);var t,r,i})})})]}),!l&&0===n.length&&a.jsx(zr,{children:a.jsxs(Wr,{className:"text-center py-8",children:[a.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No reviews yet"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Be the first to review this template and help other users!"}),r&&a.jsx(fr,{onClick:()=>u(!0),children:"Write the First Review"})]})})]})};const zl=new class{async checkTemplateAccess(e,s,t){if("public"===s)return{hasAccess:!0};if(!e)return{hasAccess:!1,reason:"Authentication required for premium templates",upgradeRequired:"premium"};try{const t=await this.getUserSubscription(e);if(!t)return{hasAccess:!1,reason:"No active subscription found",upgradeRequired:"enterprise"===s?"enterprise":"premium"};if("active"!==t.status)return{hasAccess:!1,reason:"Subscription is not active",upgradeRequired:"enterprise"===s?"enterprise":"premium"};if(!this.checkTierAccess(t.tier,s))return{hasAccess:!1,reason:`${s} template requires ${"enterprise"===s?"Enterprise":"Premium"} subscription`,upgradeRequired:"enterprise"===s?"enterprise":"premium"};const a=await this.checkUsageLimits(e,t.tier);return a.hasAccess?{hasAccess:!0,remainingUsage:a.remainingUsage,resetDate:a.resetDate}:a}catch(a){return{hasAccess:!1,reason:"Error checking access permissions"}}}async checkCustomizationAccess(e,s){return this.checkTemplateAccess(e,s)}async checkDownloadAccess(e,s,t){const a=await this.checkTemplateAccess(e,s);if(!a.hasAccess)return a;if(!e&&"pdf"!==t)return{hasAccess:!1,reason:"Account required for DOCX and HTML downloads",upgradeRequired:"premium"};if(!e)return{hasAccess:!0};try{const s=await this.getUserSubscription(e);if(!s)return"pdf"===t?{hasAccess:!0}:{hasAccess:!1,reason:"Premium subscription required for DOCX and HTML downloads",upgradeRequired:"premium"};s.tier;return"free"===s.tier&&"pdf"!==t?{hasAccess:!1,reason:"Premium subscription required for DOCX and HTML downloads",upgradeRequired:"premium"}:{hasAccess:!0}}catch(r){return{hasAccess:!1,reason:"Error checking download permissions"}}}async getUserSubscription(e){const{data:s,error:t}=await Ct.from("user_subscriptions").select("*").eq("user_id",e).eq("status","active").single();if(t&&"PGRST116"!==t.code)throw new Error(`Failed to fetch subscription: ${t.message}`);return s?{id:s.id,userId:s.user_id,tier:s.tier,status:s.status,currentPeriodStart:new Date(s.current_period_start),currentPeriodEnd:new Date(s.current_period_end),cancelAtPeriodEnd:s.cancel_at_period_end}:null}async getUserUsageStats(e){const{data:s,error:t}=await Ct.from("user_usage").select("*").eq("user_id",e).single();if(t&&"PGRST116"!==t.code)throw new Error(`Failed to fetch usage stats: ${t.message}`);return s?{templatesUsedThisMonth:s.templates_used_this_month||0,templatesUsedToday:s.templates_used_today||0,customizationsThisMonth:s.customizations_this_month||0,downloadsThisMonth:s.downloads_this_month||0,lastResetDate:new Date(s.last_reset_date)}:{templatesUsedThisMonth:0,templatesUsedToday:0,customizationsThisMonth:0,downloadsThisMonth:0,lastResetDate:new Date}}async recordTemplateUsage(e,s){try{const{error:t}=await Ct.rpc("increment_template_usage",{p_user_id:e,p_action:s})}catch(t){}}checkTierAccess(e,s){return{free:0,premium:1,pro:2,enterprise:3}[e]>={public:0,premium:1,enterprise:3}[s]}async checkUsageLimits(e,s){try{const t=await this.getUserUsageStats(e),a=Ir[s].limits;if(-1!==a.monthlyDocumentUploads&&t.templatesUsedThisMonth>=a.monthlyDocumentUploads)return{hasAccess:!1,reason:`Monthly template limit reached (${a.monthlyDocumentUploads})`,upgradeRequired:"free"===s?"premium":"premium"===s?"pro":"enterprise",remainingUsage:0,resetDate:this.getNextResetDate(t.lastResetDate)};if(-1!==a.dailyDocumentUploads&&t.templatesUsedToday>=a.dailyDocumentUploads)return{hasAccess:!1,reason:`Daily template limit reached (${a.dailyDocumentUploads})`,remainingUsage:0,resetDate:this.getTomorrowDate()};const r=-1===a.monthlyDocumentUploads?-1:a.monthlyDocumentUploads-t.templatesUsedThisMonth,n=-1===a.dailyDocumentUploads?-1:a.dailyDocumentUploads-t.templatesUsedToday;return{hasAccess:!0,remainingUsage:-1===r?n:Math.min(r,n),resetDate:this.getNextResetDate(t.lastResetDate)}}catch(t){return{hasAccess:!0}}}getNextResetDate(e){const s=new Date(e);return s.setMonth(s.getMonth()+1),s}getTomorrowDate(){const e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),e}};const Ml=({children:e,templateAccessLevel:s,templateId:r,className:n=""})=>{const{user:i}=hr(),l=function(e,s){const{user:a}=hr(),[r,n]=t.useState(null),[i,l]=t.useState(null),[c,o]=t.useState(null),[d,m]=t.useState(!0),[u,h]=t.useState(null),x=async()=>{try{m(!0),h(null);const r=await zl.checkTemplateAccess(a?.id||null,e,s);if(n(r),a)try{const[e,s]=await Promise.all([zl.getUserSubscription(a.id),zl.getUserUsageStats(a.id)]);l(e),o(s)}catch(t){}}catch(t){h(t instanceof Error?t.message:"Failed to check access"),n({hasAccess:!1,reason:"Error checking access"})}finally{m(!1)}};t.useEffect(()=>{x()},[a?.id,e,s]);const p=r?.hasAccess??!1,g=p,f=p,y=p&&(!a||"premium"===i?.tier||"pro"===i?.tier||"enterprise"===i?.tier);return{canViewTemplate:p,canCustomizeTemplate:g,canDownloadPDF:f,canDownloadDOCX:y,canDownloadHTML:y,accessResult:r,subscription:i,usageStats:c,loading:d,error:u,checkAccess:x,recordUsage:async e=>{if(a)try{await zl.recordTemplateUsage(a.id,e);const s=await zl.getUserUsageStats(a.id);o(s)}catch(s){}}}}(s,r);return l.loading?a.jsx("div",{className:`flex items-center justify-center p-8 ${n}`,children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):l.canViewTemplate?a.jsxs("div",{className:n,children:[e,l.usageStats&&l.subscription&&a.jsx(Gl,{accessData:l})]}):a.jsxs("div",{className:`space-y-6 ${n}`,children:[a.jsx(Bl,{accessData:l,templateAccessLevel:s}),i&&a.jsx(Vl,{accessData:l}),!i&&a.jsx(Wl,{})]})},Bl=({accessData:e,templateAccessLevel:s})=>a.jsxs(zr,{className:"border-2 border-dashed border-gray-300",children:[a.jsxs(Mr,{className:"text-center",children:[a.jsx("div",{className:"flex justify-center mb-4",children:(()=>{switch(s){case"premium":return a.jsx(re,{className:"h-8 w-8 text-yellow-500"});case"enterprise":return a.jsx($,{className:"h-8 w-8 text-purple-500"});default:return a.jsx(vs,{className:"h-8 w-8 text-gray-500"})}})()}),a.jsxs(Br,{className:"flex items-center justify-center gap-2",children:["Access Restricted",(()=>{switch(s){case"premium":return a.jsx(Yr,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"Premium"});case"enterprise":return a.jsx(Yr,{variant:"secondary",className:"bg-purple-100 text-purple-800",children:"Enterprise"});default:return a.jsx(Yr,{variant:"secondary",children:"Public"})}})()]}),a.jsx(Vr,{children:e.accessResult?.reason||"You need a subscription to access this template"})]}),a.jsx(Wr,{className:"text-center",children:a.jsxs(on,{children:[a.jsx(X,{className:"h-4 w-4"}),a.jsxs(dn,{children:["This template requires a ","enterprise"===s?"Enterprise":"Premium"," subscription to access."]})]})})]}),Vl=({accessData:e})=>{const s=e.accessResult?.upgradeRequired;if(!s)return null;const t=(e=>{switch(e){case"premium":return["Access to Premium templates","DOCX and HTML downloads","Advanced customization options","Priority support"];case"pro":return["Everything in Premium","Unlimited template usage","Advanced AI features","Team collaboration tools"];case"enterprise":return["Everything in Pro","Enterprise templates","Custom branding","Dedicated account manager","SLA guarantee"];default:return[]}})(s);return a.jsxs(zr,{className:"border-blue-200 bg-blue-50",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(R,{className:"h-5 w-5 text-blue-600"}),"Upgrade to ",s.charAt(0).toUpperCase()+s.slice(1)]}),a.jsx(Vr,{children:"Unlock this template and many more features"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsx("div",{className:"grid gap-2",children:t.map((e,s)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm",children:e})]},s))}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{asChild:!0,className:"flex-1",children:a.jsxs(k,{to:Lr.pricing,children:[a.jsx(re,{className:"h-4 w-4 mr-2"}),"Upgrade Now"]})}),a.jsx(fr,{variant:"outline",asChild:!0,children:a.jsxs(k,{to:Lr.pricing,children:["View Plans",a.jsx(F,{className:"h-4 w-4 ml-2"})]})})]})]})]})},Wl=()=>a.jsxs(zr,{className:"border-green-200 bg-green-50",children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(M,{className:"h-5 w-5 text-green-600"}),"Sign In Required"]}),a.jsx(Vr,{children:"Create a free account to access this template"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm",children:"Free account creation"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm",children:"Access to public templates"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm",children:"Save your customizations"})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{asChild:!0,className:"flex-1",children:a.jsx(k,{to:Lr.register,children:"Create Account"})}),a.jsx(fr,{variant:"outline",asChild:!0,children:a.jsxs(k,{to:Lr.login,children:["Sign In",a.jsx(F,{className:"h-4 w-4 ml-2"})]})})]})]})]}),Gl=({accessData:e})=>{const{subscription:s,usageStats:t,accessResult:r}=e;if(!s||!t||!r?.remainingUsage)return null;if(-1===r.remainingUsage)return null;const n="free"===s.tier?Math.min(t.templatesUsedThisMonth/5*100,100):Math.min(t.templatesUsedThisMonth/50*100,100),i=n>80;return a.jsxs(zr,{className:"mt-4 "+(i?"border-orange-200 bg-orange-50":"border-gray-200"),children:[a.jsx(Mr,{className:"pb-3",children:a.jsxs(Br,{className:"text-sm flex items-center gap-2",children:[a.jsx(T,{className:"h-4 w-4"}),"Template Usage",a.jsx(Yr,{variant:i?"destructive":"secondary",className:"ml-auto",children:s.tier.charAt(0).toUpperCase()+s.tier.slice(1)})]})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"This month"}),a.jsxs("span",{children:[t.templatesUsedThisMonth," used"]})]}),a.jsx(xl,{value:n,className:"h-2"}),r.remainingUsage>0&&a.jsxs("p",{className:"text-xs text-gray-600",children:[r.remainingUsage," templates remaining"]})]}),r.resetDate&&a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[a.jsx(Me,{className:"h-3 w-3"}),"Resets on ",r.resetDate.toLocaleDateString()]}),i&&a.jsxs(on,{children:[a.jsx(X,{className:"h-4 w-4"}),a.jsx(dn,{className:"text-xs",children:"You're approaching your monthly limit. Consider upgrading for unlimited access."})]})]})]})};const Hl=new class{async getTemplateVersions(e){const{data:s,error:t}=await Ct.from("template_versions").select("\n        *,\n        created_by_user:profiles!template_versions_created_by_fkey(id, email, first_name, last_name),\n        approved_by_user:profiles!template_versions_approved_by_fkey(id, email, first_name, last_name)\n      ").eq("template_id",e).order("major_version",{ascending:!1}).order("minor_version",{ascending:!1}).order("patch_version",{ascending:!1});if(t)throw new Error(`Failed to fetch template versions: ${t.message}`);return s.map(this.transformVersionData)}async getTemplateVersion(e){const{data:s,error:t}=await Ct.from("template_versions").select("\n        *,\n        created_by_user:profiles!template_versions_created_by_fkey(id, email, first_name, last_name),\n        approved_by_user:profiles!template_versions_approved_by_fkey(id, email, first_name, last_name)\n      ").eq("id",e).single();if(t&&"PGRST116"!==t.code)throw new Error(`Failed to fetch template version: ${t.message}`);return s?this.transformVersionData(s):null}async getCurrentVersion(e){const{data:s,error:t}=await Ct.from("template_versions").select("\n        *,\n        created_by_user:profiles!template_versions_created_by_fkey(id, email, first_name, last_name),\n        approved_by_user:profiles!template_versions_approved_by_fkey(id, email, first_name, last_name)\n      ").eq("template_id",e).eq("is_current",!0).single();if(t&&"PGRST116"!==t.code)throw new Error(`Failed to fetch current version: ${t.message}`);return s?this.transformVersionData(s):null}async createVersion(e,s){const{data:t,error:a}=await Ct.rpc("create_template_version",{p_template_id:e.templateId,p_title:e.title,p_description:e.description||null,p_content:e.content,p_fields:JSON.stringify(e.fields),p_change_summary:e.changeSummary,p_change_details:JSON.stringify(e.changeDetails||{}),p_breaking_changes:e.breakingChanges||!1,p_user_id:s,p_version_type:e.versionType||"minor"});if(a)throw new Error(`Failed to create template version: ${a.message}`);return t}async publishVersion(e,s){const{data:t,error:a}=await Ct.rpc("publish_template_version",{p_version_id:e,p_user_id:s});if(a)throw new Error(`Failed to publish template version: ${a.message}`);return t}async rollbackToVersion(e,s,t,a){const{data:r,error:n}=await Ct.rpc("rollback_template_version",{p_template_id:e,p_target_version_id:s,p_user_id:t,p_reason:a||"No reason provided"});if(n)throw new Error(`Failed to rollback template version: ${n.message}`);return r}async getChangeLog(e,s=50){const{data:t,error:a}=await Ct.from("template_change_log").select("\n        *,\n        user:profiles!template_change_log_user_id_fkey(id, email, first_name, last_name),\n        version:template_versions!template_change_log_version_id_fkey(version_number)\n      ").eq("template_id",e).order("created_at",{ascending:!1}).limit(s);if(a)throw new Error(`Failed to fetch change log: ${a.message}`);return t.map(e=>({id:e.id,templateId:e.template_id,versionId:e.version_id,changeType:e.change_type,fieldChanged:e.field_changed,oldValue:e.old_value,newValue:e.new_value,changeReason:e.change_reason,userId:e.user_id,createdAt:new Date(e.created_at),user:e.user?{id:e.user.id,email:e.user.email,firstName:e.user.first_name,lastName:e.user.last_name}:void 0}))}async compareVersions(e,s){const[t,a]=await Promise.all([this.getTemplateVersion(e),this.getTemplateVersion(s)]);if(!t||!a)throw new Error("One or both versions not found");return{version1:t,version2:a,differences:this.calculateDifferences(t,a)}}async getVersionComments(e){const{data:s,error:t}=await Ct.from("template_version_comments").select("\n        *,\n        user:profiles!template_version_comments_user_id_fkey(id, email, first_name, last_name),\n        resolved_by_user:profiles!template_version_comments_resolved_by_fkey(id, email, first_name, last_name)\n      ").eq("version_id",e).order("created_at",{ascending:!0});if(t)throw new Error(`Failed to fetch version comments: ${t.message}`);return s.map(e=>({id:e.id,versionId:e.version_id,userId:e.user_id,commentText:e.comment_text,commentType:e.comment_type,lineNumber:e.line_number,fieldName:e.field_name,isResolved:e.is_resolved,resolvedBy:e.resolved_by,resolvedAt:e.resolved_at?new Date(e.resolved_at):void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),user:e.user?{id:e.user.id,email:e.user.email,firstName:e.user.first_name,lastName:e.user.last_name}:void 0}))}async addVersionComment(e,s,t,a="general",r,n){const{data:i,error:l}=await Ct.from("template_version_comments").insert({version_id:e,user_id:s,comment_text:t,comment_type:a,line_number:r,field_name:n}).select("id").single();if(l)throw new Error(`Failed to add comment: ${l.message}`);return i.id}async resolveComment(e,s){const{error:t}=await Ct.from("template_version_comments").update({is_resolved:!0,resolved_by:s,resolved_at:(new Date).toISOString()}).eq("id",e);if(t)throw new Error(`Failed to resolve comment: ${t.message}`)}transformVersionData(e){return{id:e.id,templateId:e.template_id,versionNumber:e.version_number,majorVersion:e.major_version,minorVersion:e.minor_version,patchVersion:e.patch_version,isCurrent:e.is_current,isPublished:e.is_published,status:e.status,title:e.title,description:e.description,content:e.content,fields:e.fields||[],metadata:e.metadata||{},changeSummary:e.change_summary,changeDetails:e.change_details||{},breakingChanges:e.breaking_changes,migrationNotes:e.migration_notes,createdBy:e.created_by,approvedBy:e.approved_by,approvedAt:e.approved_at?new Date(e.approved_at):void 0,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),publishedAt:e.published_at?new Date(e.published_at):void 0}}calculateDifferences(e,s){const t=[];["title","description","content"].forEach(a=>{const r=e[a],n=s[a];r!==n&&t.push({field:a,type:"modified",oldValue:r,newValue:n})});const a=e.fields||[],r=s.fields||[];return JSON.stringify(a)!==JSON.stringify(r)&&t.push({field:"fields",type:"modified",oldValue:a,newValue:r}),t}},Yl=({templateId:e,currentVersionId:s,onVersionSelect:r,className:n=""})=>{const{user:i}=hr(),[l,c]=t.useState([]),[o,d]=t.useState([]),[m,u]=t.useState(!0),[h,x]=t.useState(null),[p,g]=t.useState(!1),[f,y]=t.useState(""),[j,w]=t.useState(!1);t.useEffect(()=>{b()},[e]);const b=async()=>{try{u(!0);const[s,t]=await Promise.all([Hl.getTemplateVersions(e),Hl.getChangeLog(e)]);c(s),d(t)}catch(s){Pt.error("Failed to load version history")}finally{u(!1)}},v=e=>{const s={draft:{variant:"secondary",label:"Draft",icon:T},review:{variant:"outline",label:"In Review",icon:rs},published:{variant:"default",label:"Published",icon:L},archived:{variant:"secondary",label:"Archived",icon:yt},deprecated:{variant:"destructive",label:"Deprecated",icon:X}}[e.status],t=s.icon;return a.jsxs(Yr,{variant:s.variant,className:"flex items-center gap-1",children:[a.jsx(t,{className:"h-3 w-3"}),s.label]})},N=e=>e.breakingChanges?a.jsx(R,{className:"h-4 w-4 text-red-500",title:"Breaking Changes"}):e.majorVersion>1?a.jsx(wt,{className:"h-4 w-4 text-blue-500",title:"Major Version"}):a.jsx(bt,{className:"h-4 w-4 text-green-500",title:"Minor/Patch Version"});return m?a.jsx("div",{className:`space-y-4 ${n}`,children:[...Array(3)].map((e,s)=>a.jsx(zr,{className:"animate-pulse",children:a.jsx(Wr,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-32"})]}),a.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]})})},s))}):a.jsxs("div",{className:`space-y-6 ${n}`,children:[a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(yt,{className:"h-5 w-5"}),"Version History"]}),a.jsx(Vr,{children:"Track changes and manage different versions of this template"})]}),a.jsx(Wr,{children:a.jsx("div",{className:"space-y-4",children:l.map((e,s)=>a.jsxs("div",{className:"relative",children:[s<l.length-1&&a.jsx("div",{className:"absolute left-6 top-12 bottom-0 w-px bg-gray-200"}),a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0 mt-1",children:N(e)}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("h4",{className:"font-medium text-gray-900",children:["v",e.versionNumber]}),e.isCurrent&&a.jsx(Yr,{variant:"outline",className:"text-xs",children:"Current"}),v(e)]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(fr,{variant:"ghost",size:"sm",onClick:()=>{x(e),r?.(e)},children:[a.jsx(rs,{className:"h-4 w-4 mr-1"}),"View"]}),!e.isCurrent&&e.isPublished&&i&&a.jsxs(fr,{variant:"outline",size:"sm",onClick:()=>{x(e),g(!0)},children:[a.jsx(jt,{className:"h-4 w-4 mr-1"}),"Rollback"]})]})]}),e.changeSummary&&a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.changeSummary}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Me,{className:"h-3 w-3"}),$t(e.createdAt,{addSuffix:!0})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(E,{className:"h-3 w-3"}),e.createdBy]}),e.breakingChanges&&a.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[a.jsx(X,{className:"h-3 w-3"}),"Breaking Changes"]})]})]})]})]},e.id))})})]}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsxs(Br,{className:"flex items-center gap-2",children:[a.jsx(P,{className:"h-5 w-5"}),"Change Log"]}),a.jsx(Vr,{children:"Detailed history of all changes made to this template"})]}),a.jsx(Wr,{children:a.jsx(cl,{className:"h-64",children:a.jsx("div",{className:"space-y-3",children:o.map((e,s)=>{return a.jsxs("div",{className:"relative",children:[s<o.length-1&&a.jsx("div",{className:"absolute left-6 top-8 bottom-0 w-px bg-gray-200"}),a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0 mt-1",children:(t=e.changeType,{created:a.jsx(L,{className:"h-4 w-4 text-green-500"}),updated:a.jsx(T,{className:"h-4 w-4 text-blue-500"}),published:a.jsx(L,{className:"h-4 w-4 text-green-500"}),archived:a.jsx(yt,{className:"h-4 w-4 text-gray-500"}),restored:a.jsx(jt,{className:"h-4 w-4 text-orange-500"}),deleted:a.jsx(X,{className:"h-4 w-4 text-red-500"})}[t]||a.jsx(T,{className:"h-4 w-4"}))}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"text-sm font-medium capitalize",children:e.changeType}),a.jsx("span",{className:"text-xs text-gray-500",children:$t(e.createdAt,{addSuffix:!0})})]}),e.changeReason&&a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:e.changeReason}),a.jsxs("div",{className:"text-xs text-gray-500",children:["by ",e.user?.firstName&&e.user?.lastName?`${e.user.firstName} ${e.user.lastName}`:e.user?.email||"Unknown"]})]})]})]},e.id);var t})})})})]}),a.jsx(li,{open:p,onOpenChange:g,children:a.jsxs(mi,{children:[a.jsxs(ui,{children:[a.jsxs(xi,{children:["Rollback to Version ",h?.versionNumber]}),a.jsx(pi,{children:"This will create a new version based on the selected version. The current version will remain in history."})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs(on,{children:[a.jsx(X,{className:"h-4 w-4"}),a.jsx(dn,{children:"Rolling back will create a new version. This action cannot be undone."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason for rollback (optional)"}),a.jsx("textarea",{className:"w-full p-2 border rounded-md",rows:3,value:f,onChange:e=>y(e.target.value),placeholder:"Explain why you're rolling back to this version..."})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{onClick:()=>h&&(async s=>{if(i)try{w(!0),await Hl.rollbackToVersion(e,s.id,i.id,f),Pt.success(`Successfully rolled back to version ${s.versionNumber}`),g(!1),y(""),b()}catch(t){Pt.error("Failed to rollback version: "+t.message)}finally{w(!1)}else Pt.error("Please log in to rollback versions")})(h),disabled:j,className:"flex-1",children:j?"Rolling back...":"Confirm Rollback"}),a.jsx(fr,{variant:"outline",onClick:()=>g(!1),className:"flex-1",children:"Cancel"})]})]})]})})]})};function Ql(){const{slug:e}=We(),s=S(),[r,n]=t.useState(null),[i,l]=t.useState(!0),[c,o]=t.useState(null),[d,m]=t.useState("preview"),[u,h]=t.useState(!1);t.useEffect(()=>{e&&x(e)},[e]);const x=async e=>{try{l(!0);const s=await $l.getTemplate(e);if(!s)return void o("Template not found");n(s),await $l.trackEvent(s.id,"template_preview",{source:"direct_link",category:s.category?.name,access_level:s.accessLevel})}catch(s){o(s instanceof Error?s.message:"Failed to load template")}finally{l(!1)}},p=e=>0===e?"Free":`S$${e.toFixed(2)}`;return i?a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[a.jsx(Ll,{className:"h-8 w-32"}),a.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsx(Ll,{className:"h-64 w-full"}),a.jsx(Ll,{className:"h-32 w-full"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(Ll,{className:"h-48 w-full"}),a.jsx(Ll,{className:"h-32 w-full"})]})]})]})})}):c||!r?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsx(zr,{className:"w-full max-w-md",children:a.jsxs(Wr,{className:"p-8 text-center",children:[a.jsx(fs,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Template Not Found"}),a.jsx("p",{className:"text-gray-600 mb-6",children:c||"The template you're looking for doesn't exist or has been removed."}),a.jsx(fr,{onClick:()=>s(Lr.templateBrowser),children:"Browse Templates"})]})})}):a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-6",children:[a.jsxs(fr,{variant:"ghost",size:"sm",onClick:()=>s(Lr.templateBrowser),className:"p-0 h-auto",children:[a.jsx(Ge,{className:"h-4 w-4 mr-1"}),"Back to Templates"]}),a.jsx("span",{children:"/"}),a.jsx("span",{children:r.category?.name}),a.jsx("span",{children:"/"}),a.jsx("span",{className:"text-gray-900",children:r.title})]}),a.jsx(Ml,{templateAccessLevel:r.accessLevel,templateId:r.id,children:a.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:r.title}),a.jsx("p",{className:"text-lg text-gray-600 mb-4",children:r.description}),a.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[(g=r.ratingAverage,Array.from({length:5},(e,s)=>a.jsx($,{className:"h-4 w-4 "+(s<Math.floor(g)?"text-yellow-400 fill-current":"text-gray-300")},s))),a.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:[r.ratingAverage.toFixed(1)," (",r.ratingCount," reviews)"]})]}),a.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[a.jsx(O,{className:"h-4 w-4"}),r.downloadCount.toLocaleString()," downloads"]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx(Yr,{variant:"outline",children:r.category?.name}),r.subcategory&&a.jsx(Yr,{variant:"outline",children:r.subcategory}),"public"!==r.accessLevel&&a.jsx(Yr,{variant:"secondary",children:r.accessLevel}),r.tags.slice(0,3).map(e=>a.jsx(Yr,{variant:"outline",className:"text-xs",children:e},e))]})]}),a.jsxs("div",{className:"text-right ml-6",children:[a.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:p(r.priceSgd)}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>h(!u),children:a.jsx(He,{className:"h-4 w-4 "+(u?"fill-current text-red-500":"")})}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:async()=>{if(r)try{await navigator.share({title:r.title,text:r.description,url:window.location.href})}catch{await navigator.clipboard.writeText(window.location.href),alert("Link copied to clipboard!")}},children:a.jsx(Ye,{className:"h-4 w-4"})})]})]})]})}),a.jsxs(En,{value:d,onValueChange:m,children:[a.jsxs(Tn,{className:"grid w-full grid-cols-5",children:[a.jsxs(In,{value:"preview",children:[a.jsx(rs,{className:"h-4 w-4 mr-2"}),"Preview"]}),a.jsxs(In,{value:"fields",children:[a.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Fields"]}),a.jsxs(In,{value:"details",children:[a.jsx(T,{className:"h-4 w-4 mr-2"}),"Details"]}),a.jsxs(In,{value:"reviews",children:[a.jsx($,{className:"h-4 w-4 mr-2"}),"Reviews"]}),a.jsxs(In,{value:"versions",children:[a.jsx(yt,{className:"h-4 w-4 mr-2"}),"Versions"]})]}),a.jsx(Dn,{value:"preview",className:"mt-6",children:a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Document Preview"}),a.jsx(Vr,{children:"This is how your document will look when generated"})]}),a.jsx(Wr,{children:r.previewHtml?a.jsx("div",{className:"prose max-w-none border rounded-lg p-6 bg-white",dangerouslySetInnerHTML:{__html:r.previewHtml}}):r.previewPdfUrl?a.jsx("div",{className:"border rounded-lg overflow-hidden",children:a.jsx("iframe",{src:r.previewPdfUrl,className:"w-full h-96",title:"Template Preview"})}):a.jsxs("div",{className:"text-center py-12 text-gray-500",children:[a.jsx(T,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),a.jsx("p",{children:"Preview not available for this template"})]})})]})}),a.jsx(Dn,{value:"fields",className:"mt-6",children:a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Customizable Fields"}),a.jsx(Vr,{children:"These fields can be customized when you use this template"})]}),a.jsx(Wr,{children:r.fields.length>0?a.jsx("div",{className:"space-y-4",children:r.fields.map(e=>a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h4",{className:"font-medium",children:e.label}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Yr,{variant:"outline",className:"text-xs",children:e.type}),e.required&&a.jsx(Yr,{variant:"destructive",className:"text-xs",children:"Required"})]})]}),e.helpText&&a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.helpText}),e.placeholder&&a.jsxs("p",{className:"text-xs text-gray-500",children:["Placeholder: ",e.placeholder]})]},e.id))}):a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(Xs,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),a.jsx("p",{children:"This template has no customizable fields"})]})})]})}),a.jsx(Dn,{value:"details",className:"mt-6",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Legal Information"})}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Jurisdiction"}),a.jsx("p",{className:"text-gray-600",children:r.jurisdiction})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Language"}),a.jsx("p",{className:"text-gray-600",children:"en"===r.language?"English":r.language})]})]}),r.legalAreas.length>0&&a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Legal Areas"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:r.legalAreas.map(e=>a.jsx(Yr,{variant:"outline",children:e},e))})]}),r.complianceTags.length>0&&a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Compliance"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:r.complianceTags.map(e=>a.jsxs(Yr,{variant:"outline",className:"text-green-700 border-green-300",children:[a.jsx(U,{className:"h-3 w-3 mr-1"}),e]},e))})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Template Information"})}),a.jsx(Wr,{className:"space-y-4",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Version"}),a.jsxs("p",{className:"text-gray-600",children:["v",r.version]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Last Updated"}),a.jsx("p",{className:"text-gray-600",children:r.updatedAt.toLocaleDateString()})]})]})})]})]})}),a.jsx(Dn,{value:"reviews",className:"mt-6",children:a.jsx(Ol,{template:r})}),a.jsx(Dn,{value:"versions",className:"mt-6",children:a.jsx(Yl,{templateId:r.id,currentVersionId:r.id})})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(zr,{className:"sticky top-6",children:[a.jsxs(Mr,{children:[a.jsx(Br,{className:"text-xl",children:"Get This Template"}),a.jsx(Vr,{children:"Customize and download this template for your needs"})]}),a.jsxs(Wr,{className:"space-y-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:p(r.priceSgd)}),"public"===r.accessLevel&&a.jsxs("p",{className:"text-sm text-green-600 mb-4",children:[a.jsx(L,{className:"h-4 w-4 inline mr-1"}),"Free to use and customize"]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs(fr,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{r&&($l.trackEvent(r.id,"customization_started",{source:"preview_page",access_level:r.accessLevel}),s(`${Lr.templateCustomize}/${r.slug}`))},children:[a.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Customize Template"]}),a.jsxs(fr,{variant:"outline",className:"w-full",onClick:async()=>{r&&(await $l.recordDownload(r.id,void 0,"pdf"),alert("Download functionality will be implemented with the generation system"))},children:[a.jsx(O,{className:"h-4 w-4 mr-2"}),"Download Sample"]})]}),"public"!==r.accessLevel&&a.jsxs(on,{children:[a.jsx(U,{className:"h-4 w-4"}),a.jsxs(dn,{children:["This is a ",r.accessLevel," template.","premium"===r.accessLevel?" Upgrade to Premium":" Contact us"," ","to access all features."]})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"What's Included"})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{children:"Customizable fields"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{children:"PDF download"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{children:"Legal compliance checked"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(L,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{children:"Singapore jurisdiction"})]}),"premium"===r.accessLevel&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(L,{className:"h-4 w-4 text-blue-500"}),a.jsx("span",{children:"Word document format"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(L,{className:"h-4 w-4 text-blue-500"}),a.jsx("span",{children:"Legal review included"})]})]})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Need Help?"})}),a.jsxs(Wr,{className:"space-y-3",children:[a.jsxs(fr,{variant:"outline",className:"w-full justify-start",children:[a.jsx(P,{className:"h-4 w-4 mr-2"}),"Contact Support"]}),a.jsxs(fr,{variant:"outline",className:"w-full justify-start",children:[a.jsx(Qs,{className:"h-4 w-4 mr-2"}),"View Documentation"]})]})]})]})]})})]})})});var g}const Jl=()=>{hr();const[e,s]=t.useState([]),[r,n]=t.useState([]),[i,l]=t.useState(!0),[c,o]=t.useState(""),[d,m]=t.useState("all");t.useEffect(()=>{const e=[{id:"1",query:"employment contract singapore",type:"legal_qa",timestamp:new Date(Date.now()-72e5),results_count:15,clicked_result:"Employment Act basics"},{id:"2",query:"corporate law firms",type:"law_firms",timestamp:new Date(Date.now()-18e6),results_count:8,clicked_result:"Lee & Associates"},{id:"3",query:"tenancy agreement template",type:"templates",timestamp:new Date(Date.now()-864e5),results_count:12,clicked_result:"Residential Tenancy Agreement"},{id:"4",query:"contract analysis",type:"documents",timestamp:new Date(Date.now()-1728e5),results_count:6},{id:"5",query:"divorce proceedings singapore",type:"legal_qa",timestamp:new Date(Date.now()-2592e5),results_count:22,clicked_result:"Family Court procedures"}];s(e),n(e),l(!1)},[]),t.useEffect(()=>{let s=e;c.trim()&&(s=s.filter(e=>e.query.toLowerCase().includes(c.toLowerCase())||e.clicked_result?.toLowerCase().includes(c.toLowerCase()))),"all"!==d&&(s=s.filter(e=>e.type===d)),n(s)},[e,c,d]);const u=e=>{switch(e){case"legal_qa":return a.jsx(P,{className:"h-4 w-4"});case"law_firms":return a.jsx(D,{className:"h-4 w-4"});case"documents":case"templates":return a.jsx(T,{className:"h-4 w-4"});default:return a.jsx(A,{className:"h-4 w-4"})}},h=e=>{switch(e){case"legal_qa":return"Legal Q&A";case"law_firms":return"Law Firms";case"documents":return"Documents";case"templates":return"Templates";default:return"Search"}},x=e=>{switch(e){case"legal_qa":return"bg-blue-100 text-blue-800";case"law_firms":return"bg-green-100 text-green-800";case"documents":return"bg-purple-100 text-purple-800";case"templates":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},p=(()=>{const s=e.length,t=e.reduce((e,s)=>(e[s.type]=(e[s.type]||0)+1,e),{}),a=Object.entries(t).reduce((e,s)=>t[e[0]]>t[s[0]]?e:s)?.[0]||"legal_qa";return{totalSearches:s,typeStats:t,mostSearchedType:a}})();return a.jsx(ul,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Search History"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Track and manage your search activity across the platform"})]}),a.jsxs(fr,{variant:"outline",onClick:()=>{s([]),n([])},className:"text-red-600 border-red-600 hover:bg-red-50",children:[a.jsx(vt,{className:"h-4 w-4 mr-2"}),"Clear History"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Searches"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.totalSearches})]}),a.jsx(A,{className:"h-8 w-8 text-blue-600"})]})})}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Most Used"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:h(p.mostSearchedType)})]}),a.jsx(st,{className:"h-8 w-8 text-green-600"})]})})}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"This Week"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>Date.now()-e.timestamp.getTime()<6048e5).length})]}),a.jsx(Me,{className:"h-8 w-8 text-purple-600"})]})})}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Results"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:e.length>0?Math.round(e.reduce((e,s)=>e+s.results_count,0)/e.length):0})]}),a.jsx(et,{className:"h-8 w-8 text-orange-600"})]})})})]}),a.jsx(zr,{children:a.jsx(Wr,{className:"p-6",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx(yr,{placeholder:"Filter search history...",value:c,onChange:e=>o(e.target.value),className:"pl-10"})]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(fr,{variant:"all"===d?"default":"outline",size:"sm",onClick:()=>m("all"),children:"All"}),a.jsx(fr,{variant:"legal_qa"===d?"default":"outline",size:"sm",onClick:()=>m("legal_qa"),children:"Q&A"}),a.jsx(fr,{variant:"law_firms"===d?"default":"outline",size:"sm",onClick:()=>m("law_firms"),children:"Law Firms"}),a.jsx(fr,{variant:"documents"===d?"default":"outline",size:"sm",onClick:()=>m("documents"),children:"Documents"}),a.jsx(fr,{variant:"templates"===d?"default":"outline",size:"sm",onClick:()=>m("templates"),children:"Templates"})]})]})})}),a.jsxs(zr,{children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Recent Searches"}),a.jsx(Vr,{children:"Your search activity across Legal Q&A, Law Firms, Documents, and Templates"})]}),a.jsx(Wr,{children:i?a.jsx("div",{className:"space-y-4",children:[...Array(5)].map((e,s)=>a.jsxs("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),a.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},s))}):r.length>0?a.jsx("div",{className:"space-y-4",children:r.map(t=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[a.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[u(t.type),a.jsx(Yr,{className:x(t.type),children:h(t.type)})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-medium text-gray-900",children:['"',t.query,'"']}),a.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mt-1",children:[a.jsxs("span",{className:"flex items-center space-x-1",children:[a.jsx(q,{className:"h-3 w-3"}),a.jsx("span",{children:$t(t.timestamp,{addSuffix:!0})})]}),a.jsxs("span",{children:[t.results_count," results"]}),t.clicked_result&&a.jsxs("span",{className:"text-blue-600",children:[" ",t.clicked_result]})]})]})]}),a.jsx(fr,{variant:"ghost",size:"sm",onClick:()=>(t=>{const a=e.filter(e=>e.id!==t);s(a)})(t.id),className:"text-gray-400 hover:text-red-600",children:a.jsx(vt,{className:"h-4 w-4"})})]},t.id))}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No search history found"}),a.jsx("p",{className:"text-gray-500",children:c||"all"!==d?"Try adjusting your filters to see more results.":"Start searching to see your history here."})]})})]})]})})},Kl=()=>{const e=ps();return t.useEffect(()=>{},[e.pathname]),a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),a.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),a.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},Xl=()=>{const{user:e,loading:s,profile:r,signOut:n}=hr(),[i,l]=t.useState([]),[c,o]=t.useState(!1),[d,m]=t.useState(!1),u=async()=>{o(!0);const s=[];s.push({name:"Authentication Status",status:e?"success":"error",message:e?`Authenticated as ${e.email}`:"Not authenticated",details:{user:e?{id:e.id,email:e.email}:null}}),s.push({name:"Profile Loading",status:r?"success":"warning",message:r?`Profile loaded: ${r.email}`:"No profile loaded",details:r});try{const{data:e,error:t}=await Ct.auth.getUser();s.push({name:"Supabase Connection",status:t?"error":"success",message:t?`Connection error: ${t.message}`:"Connected successfully",details:{data:e,error:t}})}catch(t){s.push({name:"Supabase Connection",status:"error",message:`Connection failed: ${t instanceof Error?t.message:"Unknown error"}`,details:t})}try{const e=await Ai.getDocuments();s.push({name:"Documents API",status:"success",message:`Successfully loaded ${e.length} documents`,details:e})}catch(t){s.push({name:"Documents API",status:"error",message:`Failed to load documents: ${t instanceof Error?t.message:"Unknown error"}`,details:t})}try{const{data:e,error:t}=await Ct.from("uploaded_documents").select("count(*)").limit(1);s.push({name:"Database Query",status:t?"error":"success",message:t?`Query failed: ${t.message}`:"Database query successful",details:{data:e,error:t}})}catch(t){s.push({name:"Database Query",status:"error",message:`Query error: ${t instanceof Error?t.message:"Unknown error"}`,details:t})}l(s),o(!1)};t.useEffect(()=>{s||u()},[s]);const h=e=>{switch(e){case"success":return a.jsx(L,{className:"h-5 w-5 text-green-500"});case"error":return a.jsx(es,{className:"h-5 w-5 text-red-500"});case"warning":return a.jsx(X,{className:"h-5 w-5 text-yellow-500"})}},x=e=>{switch(e){case"success":return"bg-green-100 text-green-800";case"error":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800"}};return s?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Z,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),a.jsx("p",{children:"Loading authentication..."})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-center mb-4",children:"Authentication Debug"}),a.jsx("p",{className:"text-gray-600 text-center",children:"Debugging authentication and document loading issues"})]}),a.jsxs(zr,{className:"mb-6",children:[a.jsxs(Mr,{children:[a.jsx(Br,{children:"Debug Tests"}),a.jsx(Vr,{children:"Testing authentication, database connection, and API functionality"})]}),a.jsxs(Wr,{children:[a.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[a.jsxs(fr,{onClick:u,disabled:c,size:"default",children:[a.jsx(Z,{className:"h-4 w-4 mr-2 "+(c?"animate-spin":"")}),c?"Running...":"Run Tests"]}),a.jsxs(fr,{onClick:async()=>{const e=[];try{const{data:{user:a}}=await Ct.auth.getUser();if(e.push({name:"Authentication Check",status:a?"success":"error",message:a?`Authenticated as ${a.email}`:"Not authenticated"}),!a)return void l(e);const{usageTrackingService:r}=await Bt(async()=>{const{usageTrackingService:e}=await Promise.resolve().then(()=>Ti);return{usageTrackingService:e}},void 0,import.meta.url),n=await r.checkUsageLimit("document_upload");e.push({name:"Usage Limit Check",status:n.allowed?"success":"error",message:`${n.current}/${n.limit} uploads used (${Math.round(n.percentage)}%)`});const i=`test-${Date.now()}.txt`,c=new File(["test content"],i,{type:"text/plain"});try{const{error:s}=await Ct.storage.from("documents").upload(`${a.id}/${i}`,c);s?e.push({name:"Storage Upload Test",status:"error",message:`Storage upload failed: ${s.message}`}):(e.push({name:"Storage Upload Test",status:"success",message:"Storage upload successful"}),await Ct.storage.from("documents").remove([`${a.id}/${i}`]))}catch(s){e.push({name:"Storage Upload Test",status:"error",message:`Storage test failed: ${s.message}`})}try{const{error:s}=await Ct.from("uploaded_documents").select("id").limit(1);e.push({name:"Database Access Test",status:s?"error":"success",message:s?`Database error: ${s.message}`:"Database access successful"})}catch(t){e.push({name:"Database Access Test",status:"error",message:`Database test failed: ${t.message}`})}}catch(a){e.push({name:"Upload Test Failed",status:"error",message:a.message})}l(e)},disabled:c,size:"default",variant:"outline",children:[a.jsx(Z,{className:"h-4 w-4 mr-2 "+(c?"animate-spin":"")}),"Test Upload"]}),a.jsxs(fr,{onClick:async()=>{m(!0);try{localStorage.setItem("skipSessionRestore","true"),await n(),localStorage.clear(),sessionStorage.clear(),Object.keys(localStorage).forEach(e=>{(e.startsWith("sb-")||e.includes("supabase"))&&localStorage.removeItem(e)}),window.location.href="/"}catch(e){}finally{m(!1)}},disabled:d,size:"default",variant:"destructive",children:[a.jsx(es,{className:"h-4 w-4 mr-2 "+(d?"animate-spin":"")}),d?"Clearing...":"Clear Auth"]})]}),a.jsx("div",{className:"space-y-4",children:i.map((e,s)=>a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[h(e.status),a.jsx("h3",{className:"font-medium",children:e.name})]}),a.jsx(Yr,{className:x(e.status),children:e.status})]}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),e.details&&a.jsxs("details",{className:"text-xs",children:[a.jsx("summary",{className:"cursor-pointer text-gray-500 hover:text-gray-700",children:"Show details"}),a.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto",children:JSON.stringify(e.details,null,2)})]})]},s))})]})]}),a.jsxs(zr,{children:[a.jsx(Mr,{children:a.jsx(Br,{children:"Environment Information"})}),a.jsx(Wr,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Supabase URL:"}),a.jsx("p",{className:"text-gray-600",children:"https://kvlaydeyqidlfpfutbmp.supabase.co"})]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Environment:"}),a.jsx("p",{className:"text-gray-600",children:"production"})]}),a.jsxs("div",{children:[a.jsx("strong",{children:"User Agent:"}),a.jsx("p",{className:"text-gray-600 break-all",children:navigator.userAgent})]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Current URL:"}),a.jsx("p",{className:"text-gray-600 break-all",children:window.location.href})]})]})})]})]})})},Zl=()=>{const{user:e,loading:s,signIn:t,signOut:r}=hr();return a.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:a.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Auth Test Page"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Loading:"})," ",s?"Yes":"No"]}),a.jsxs("div",{children:[a.jsx("strong",{children:"User:"})," ",e?e.email:"Not logged in"]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("button",{onClick:async()=>{try{await t("test@example.com","password123")}catch(e){}},className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700",disabled:s,children:"Test Login"}),a.jsx("button",{onClick:async()=>{try{await r()}catch(e){}},className:"w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700",disabled:s,children:"Test Logout"})]})]})]})})},ec=t.lazy(()=>Bt(()=>import("./PdfAnnotationsDemo-CsQ0M3Ac.js"),__vite__mapDeps([10,3,4,5,2,1,6,7,11,0,8,9,12]),import.meta.url)),sc=t.lazy(()=>Bt(()=>import("./Documents-Bd5Cz1lW.js"),__vite__mapDeps([13,3,4,5,2,1,6,7,0,8,9,11,14]),import.meta.url)),tc=t.lazy(()=>Bt(()=>import("./AIAssistant-nwzJ4eaX.js"),__vite__mapDeps([15,3,4,5,2,1,6,7,9,14,0,8]),import.meta.url)),ac=t.lazy(()=>Bt(()=>import("./Templates-BK6dpfEN.js"),__vite__mapDeps([16,3,4,5,2,1,6,7,17,9,0,8]),import.meta.url)),rc=t.lazy(()=>Bt(()=>import("./TemplateCustomize-Dj5YpMAt.js"),__vite__mapDeps([18,3,4,5,2,1,6,7,0,8,9]),import.meta.url)),nc=t.lazy(()=>Bt(()=>import("./TemplateVersionManagement-BcWS2HVW.js"),__vite__mapDeps([19,3,4,5,2,1,6,7,0,8,9,17]),import.meta.url)),ic=t.lazy(()=>Bt(()=>import("./TemplateAnalytics-DMVBGNnM.js"),__vite__mapDeps([20,3,4,5,2,1,6,7,21,0,8,9]),import.meta.url)),lc=t.lazy(()=>Bt(()=>import("./Admin-cT6jFs62.js"),__vite__mapDeps([22,3,4,5,2,1,6,7,21,0,8,9]),import.meta.url)),cc=new Lt,oc=()=>a.jsx(mn,{level:"page",children:a.jsx(Nt,{client:cc,children:a.jsxs(sr,{children:[a.jsx(Za,{}),a.jsx(er,{}),a.jsx(_t,{children:a.jsx(un,{children:a.jsx(pr,{children:a.jsxs(St,{children:[a.jsx(kt,{path:Lr.home,element:a.jsx(hn,{})}),a.jsx(kt,{path:"/law-firms",element:a.jsx(fn,{})}),a.jsx(kt,{path:"/law-firms/:id",element:a.jsx(Wn,{})}),a.jsx(kt,{path:"/documents",element:a.jsx(Hn,{})}),a.jsx(kt,{path:"/legal-qa",element:a.jsx(ri,{})}),a.jsx(kt,{path:"/legal-qa/:id",element:a.jsx(ti,{})}),a.jsx(kt,{path:Lr.pricing,element:a.jsx(pn,{})}),a.jsx(kt,{path:Lr.login,element:a.jsx(Ni,{})}),a.jsx(kt,{path:Lr.register,element:a.jsx(Fi,{})}),a.jsx(kt,{path:Lr.forgotPassword,element:a.jsx(Ui,{})}),a.jsx(kt,{path:Lr.resetPassword,element:a.jsx(Qi,{})}),a.jsx(kt,{path:"/debug",element:a.jsx(ki,{})}),a.jsx(kt,{path:"/debug/upload",element:a.jsx(Di,{})}),a.jsx(kt,{path:"/debug-auth",element:a.jsx(Xl,{})}),a.jsx(kt,{path:"/auth-test",element:a.jsx(Zl,{})}),a.jsx(kt,{path:Lr.dashboard,element:a.jsx(bi,{children:a.jsx(Ji,{})})}),a.jsx(kt,{path:Lr.documents,element:a.jsx(bi,{children:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(sc,{})})})}),a.jsx(kt,{path:"/dashboard/ai-assistant",element:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(tc,{})})}),a.jsx(kt,{path:"/dashboard/templates",element:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(ac,{})})}),a.jsx(kt,{path:"/dashboard/law-firms",element:a.jsx(hl,{})}),a.jsx(kt,{path:"/dashboard/admin",element:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(lc,{})})}),a.jsx(kt,{path:"/dashboard/template-analytics",element:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(ic,{})})}),a.jsx(kt,{path:"/dashboard/search-history",element:a.jsx(Jl,{})}),a.jsx(kt,{path:"/dashboard/subscription",element:a.jsx(yl,{})}),a.jsx(kt,{path:"/dashboard/settings",element:a.jsx(wl,{})}),a.jsx(kt,{path:"/dashboard/security",element:a.jsx(vl,{})}),a.jsx(kt,{path:"/subscribe/:tier",element:a.jsx(Nl,{})}),a.jsx(kt,{path:"/payment/success",element:a.jsx(_l,{})}),a.jsx(kt,{path:"/payment/failure",element:a.jsx(Sl,{})}),a.jsx(kt,{path:"/shared/:shareToken",element:a.jsx(Tl,{})}),a.jsx(kt,{path:Lr.publicAnalysis,element:a.jsx(Rl,{})}),a.jsx(kt,{path:`${Lr.publicAnalysisResult}/:analysisId`,element:a.jsx(Fl,{})}),a.jsx(kt,{path:Lr.templateBrowser,element:a.jsx(ql,{})}),a.jsx(kt,{path:Lr.templateMarketplace,element:a.jsx(ql,{})}),a.jsx(kt,{path:`${Lr.templatePreview}/:slug`,element:a.jsx(Ql,{})}),a.jsx(kt,{path:`${Lr.templateCustomize}/:slug`,element:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(rc,{})})}),a.jsx(kt,{path:"/templates/:slug/versions",element:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(nc,{})})}),a.jsx(kt,{path:"/pdf-annotations-demo",element:a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:a.jsx(ec,{})})}),a.jsx(kt,{path:"*",element:a.jsx(Kl,{})})]})})})})]})})});function dc(e,s,t,a,r){if("function"==typeof s?e!==s||!r:!s.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s.set(e,t),t}function mc(e,s,t,a){if("a"===t&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof s?e!==s||!a:!s.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?a:"a"===t?a.call(e):a?a.value:s.get(e)}At(document.getElementById("root")).render(a.jsx(oc,{}));let uc=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return uc=e.randomUUID.bind(e),e.randomUUID();const s=new Uint8Array(1),t=e?()=>e.getRandomValues(s)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^t()&15>>+e/4).toString(16))};function hc(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const xc=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const s=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(s.stack=e.stack),e.cause&&!s.cause&&(s.cause=e.cause),e.name&&(s.name=e.name),s}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class pc extends Error{}class gc extends pc{constructor(e,s,t,a){super(`${gc.makeMessage(e,s,t)}`),this.status=e,this.headers=a,this.requestID=a?.get("x-request-id"),this.error=s;const r=s;this.code=r?.code,this.param=r?.param,this.type=r?.type}static makeMessage(e,s,t){const a=s?.message?"string"==typeof s.message?s.message:JSON.stringify(s.message):s?JSON.stringify(s):t;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,s,t,a){if(!e||!a)return new yc({message:t,cause:xc(s)});const r=s?.error;return 400===e?new wc(e,r,t,a):401===e?new bc(e,r,t,a):403===e?new vc(e,r,t,a):404===e?new Nc(e,r,t,a):409===e?new _c(e,r,t,a):422===e?new Sc(e,r,t,a):429===e?new kc(e,r,t,a):e>=500?new Ac(e,r,t,a):new gc(e,r,t,a)}}class fc extends gc{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class yc extends gc{constructor({message:e,cause:s}){super(void 0,void 0,e||"Connection error.",void 0),s&&(this.cause=s)}}class jc extends yc{constructor({message:e}={}){super({message:e??"Request timed out."})}}class wc extends gc{}class bc extends gc{}class vc extends gc{}class Nc extends gc{}class _c extends gc{}class Sc extends gc{}class kc extends gc{}class Ac extends gc{}class Cc extends pc{constructor(){super("Could not parse response content as the length limit was reached")}}class Ec extends pc{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}const Tc=/^[a-z][a-z0-9+.-]*:/i;let Ic=e=>(Ic=Array.isArray,Ic(e)),Dc=Ic;function Pc(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}const Rc=e=>new Promise(s=>setTimeout(s,e)),Fc="5.5.1";const Lc=()=>{const e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fc,"X-Stainless-OS":Uc(Deno.build.os),"X-Stainless-Arch":$c(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fc,"X-Stainless-OS":Uc(globalThis.process.platform??"unknown"),"X-Stainless-Arch":$c(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const s=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:s,pattern:t}of e){const e=t.exec(navigator.userAgent);if(e){return{browser:s,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Fc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const $c=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",Uc=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let qc;function Oc(...e){const s=globalThis.ReadableStream;if(void 0===s)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new s(...e)}function zc(e){let s=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Oc({start(){},async pull(e){const{done:t,value:a}=await s.next();t?e.close():e.enqueue(a)},async cancel(){await(s.return?.())}})}function Mc(e){if(e[Symbol.asyncIterator])return e;const s=e.getReader();return{async next(){try{const e=await s.read();return e?.done&&s.releaseLock(),e}catch(e){throw s.releaseLock(),e}},async return(){const e=s.cancel();return s.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Bc=({headers:e,body:s})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(s)}),Vc="RFC3986",Wc=e=>String(e),Gc={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:Wc};let Hc=(e,s)=>(Hc=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Hc(e,s));const Yc=(()=>{const e=[];for(let s=0;s<256;++s)e.push("%"+((s<16?"0":"")+s.toString(16)).toUpperCase());return e})(),Qc=1024;function Jc(e,s){if(Ic(e)){const t=[];for(let a=0;a<e.length;a+=1)t.push(s(e[a]));return t}return s(e)}const Kc={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,s)=>String(e)+"["+s+"]",repeat:e=>String(e)},Xc=function(e,s){Array.prototype.push.apply(e,Ic(s)?s:[s])};let Zc;const eo={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,s,t,a,r)=>{if(0===e.length)return e;let n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===t)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let l=0;l<n.length;l+=Qc){const e=n.length>=Qc?n.slice(l,l+Qc):n,s=[];for(let t=0;t<e.length;++t){let a=e.charCodeAt(t);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||"RFC1738"===r&&(40===a||41===a)?s[s.length]=e.charAt(t):a<128?s[s.length]=Yc[a]:a<2048?s[s.length]=Yc[192|a>>6]+Yc[128|63&a]:a<55296||a>=57344?s[s.length]=Yc[224|a>>12]+Yc[128|a>>6&63]+Yc[128|63&a]:(t+=1,a=65536+((1023&a)<<10|1023&e.charCodeAt(t)),s[s.length]=Yc[240|a>>18]+Yc[128|a>>12&63]+Yc[128|a>>6&63]+Yc[128|63&a])}i+=s.join("")}return i},encodeValuesOnly:!1,format:Vc,formatter:Wc,indices:!1,serializeDate:e=>(Zc??(Zc=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1};const so={};function to(e,s,t,a,r,n,i,l,c,o,d,m,u,h,x,p,g,f){let y=e,j=f,w=0,b=!1;for(;void 0!==(j=j.get(so))&&!b;){const s=j.get(e);if(w+=1,void 0!==s){if(s===w)throw new RangeError("Cyclic object value");b=!0}void 0===j.get(so)&&(w=0)}if("function"==typeof o?y=o(s,y):y instanceof Date?y=u?.(y):"comma"===t&&Ic(y)&&(y=Jc(y,function(e){return e instanceof Date?u?.(e):e})),null===y){if(n)return c&&!p?c(s,eo.encoder,g,"key",h):s;y=""}if("string"==typeof(v=y)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(y)){if(c){const e=p?s:c(s,eo.encoder,g,"key",h);return[x?.(e)+"="+x?.(c(y,eo.encoder,g,"value",h))]}return[x?.(s)+"="+x?.(String(y))]}var v;const N=[];if(void 0===y)return N;let _;if("comma"===t&&Ic(y))p&&c&&(y=Jc(y,c)),_=[{value:y.length>0?y.join(",")||null:void 0}];else if(Ic(o))_=o;else{const e=Object.keys(y);_=d?e.sort(d):e}const S=l?String(s).replace(/\./g,"%2E"):String(s),k=a&&Ic(y)&&1===y.length?S+"[]":S;if(r&&Ic(y)&&0===y.length)return k+"[]";for(let A=0;A<_.length;++A){const s=_[A],j="object"==typeof s&&void 0!==s.value?s.value:y[s];if(i&&null===j)continue;const b=m&&l?s.replace(/\./g,"%2E"):s,v=Ic(y)?"function"==typeof t?t(k,b):k:k+(m?"."+b:"["+b+"]");f.set(e,w);const S=new WeakMap;S.set(so,f),Xc(N,to(j,v,t,a,r,n,i,l,"comma"===t&&p&&Ic(y)?null:c,o,d,m,u,h,x,p,g,S))}return N}function ao(e,s={}){let t=e;const a=function(e=eo){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const s=e.charset||eo.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Vc;if(void 0!==e.format){if(!Hc(Gc,e.format))throw new TypeError("Unknown format option provided.");t=e.format}const a=Gc[t];let r,n=eo.filter;if(("function"==typeof e.filter||Ic(e.filter))&&(n=e.filter),r=e.arrayFormat&&e.arrayFormat in Kc?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":eo.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=void 0===e.allowDots?1==!!e.encodeDotInKeys||eo.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:eo.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:eo.allowEmptyArrays,arrayFormat:r,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:eo.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?eo.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:eo.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:eo.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:eo.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:eo.encodeValuesOnly,filter:n,format:t,formatter:a,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:eo.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:eo.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:eo.strictNullHandling}}(s);let r,n;"function"==typeof a.filter?(n=a.filter,t=n("",t)):Ic(a.filter)&&(n=a.filter,r=n);const i=[];if("object"!=typeof t||null===t)return"";const l=Kc[a.arrayFormat],c="comma"===l&&a.commaRoundTrip;r||(r=Object.keys(t)),a.sort&&r.sort(a.sort);const o=new WeakMap;for(let u=0;u<r.length;++u){const e=r[u];a.skipNulls&&null===t[e]||Xc(i,to(t[e],e,l,c,a.allowEmptyArrays,a.strictNullHandling,a.skipNulls,a.encodeDotInKeys,a.encode?a.encoder:null,a.filter,a.sort,a.allowDots,a.serializeDate,a.format,a.formatter,a.encodeValuesOnly,a.charset,o))}const d=i.join(a.delimiter);let m=!0===a.addQueryPrefix?"?":"";return a.charsetSentinel&&("iso-8859-1"===a.charset?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),d.length>0?m+d:""}let ro,no;function io(e){let s;return(ro??(s=new globalThis.TextEncoder,ro=s.encode.bind(s)))(e)}function lo(e){let s;return(no??(s=new globalThis.TextDecoder,no=s.decode.bind(s)))(e)}var co,oo;class mo{constructor(){co.set(this,void 0),oo.set(this,void 0),dc(this,co,new Uint8Array),dc(this,oo,null)}decode(e){if(null==e)return[];const s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?io(e):e;dc(this,co,function(e){let s=0;for(const r of e)s+=r.length;const t=new Uint8Array(s);let a=0;for(const r of e)t.set(r,a),a+=r.length;return t}([mc(this,co,"f"),s]));const t=[];let a;for(;null!=(a=uo(mc(this,co,"f"),mc(this,oo,"f")));){if(a.carriage&&null==mc(this,oo,"f")){dc(this,oo,a.index);continue}if(null!=mc(this,oo,"f")&&(a.index!==mc(this,oo,"f")+1||a.carriage)){t.push(lo(mc(this,co,"f").subarray(0,mc(this,oo,"f")-1))),dc(this,co,mc(this,co,"f").subarray(mc(this,oo,"f"))),dc(this,oo,null);continue}const e=null!==mc(this,oo,"f")?a.preceding-1:a.preceding,s=lo(mc(this,co,"f").subarray(0,e));t.push(s),dc(this,co,mc(this,co,"f").subarray(a.index)),dc(this,oo,null)}return t}flush(){return mc(this,co,"f").length?this.decode("\n"):[]}}function uo(e,s){for(let t=s??0;t<e.length;t++){if(10===e[t])return{preceding:t,index:t+1,carriage:!1};if(13===e[t])return{preceding:t,index:t+1,carriage:!0}}return null}function ho(e){for(let s=0;s<e.length-1;s++){if(10===e[s]&&10===e[s+1])return s+2;if(13===e[s]&&13===e[s+1])return s+2;if(13===e[s]&&10===e[s+1]&&s+3<e.length&&13===e[s+2]&&10===e[s+3])return s+4}return-1}co=new WeakMap,oo=new WeakMap,mo.NEWLINE_CHARS=new Set(["\n","\r"]),mo.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class xo{constructor(e,s){this.iterator=e,this.controller=s}static fromSSEResponse(e,s){let t=!1;return new xo(async function*(){if(t)throw new pc("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");t=!0;let a=!1;try{for await(const t of async function*(e,s){if(!e.body){if(s.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new pc("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new pc("Attempted to iterate over a response with no body")}const t=new po,a=new mo,r=Mc(e.body);for await(const n of async function*(e){let s=new Uint8Array;for await(const t of e){if(null==t)continue;const e=t instanceof ArrayBuffer?new Uint8Array(t):"string"==typeof t?io(t):t;let a,r=new Uint8Array(s.length+e.length);for(r.set(s),r.set(e,s.length),s=r;-1!==(a=ho(s));)yield s.slice(0,a),s=s.slice(a)}s.length>0&&(yield s)}(r))for(const e of a.decode(n)){const s=t.decode(e);s&&(yield s)}for(const n of a.flush()){const e=t.decode(n);e&&(yield e)}}(e,s))if(!a)if(t.data.startsWith("[DONE]"))a=!0;else if(null===t.event||t.event.startsWith("response.")||t.event.startsWith("transcript.")){let s;try{s=JSON.parse(t.data)}catch(r){throw r}if(s&&s.error)throw new gc(void 0,s.error,void 0,e.headers);yield s}else{let e;try{e=JSON.parse(t.data)}catch(r){throw r}if("error"==t.event)throw new gc(void 0,e.error,e.message,void 0);yield{event:t.event,data:e}}a=!0}catch(r){if(hc(r))return;throw r}finally{a||s.abort()}},s)}static fromReadableStream(e,s){let t=!1;return new xo(async function*(){if(t)throw new pc("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");t=!0;let a=!1;try{for await(const s of async function*(){const s=new mo,t=Mc(e);for await(const e of t)for(const t of s.decode(e))yield t;for(const e of s.flush())yield e}())a||s&&(yield JSON.parse(s));a=!0}catch(r){if(hc(r))return;throw r}finally{a||s.abort()}},s)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],s=[],t=this.iterator(),a=a=>({next:()=>{if(0===a.length){const a=t.next();e.push(a),s.push(a)}return a.shift()}});return[new xo(()=>a(e),this.controller),new xo(()=>a(s),this.controller)]}toReadableStream(){const e=this;let s;return Oc({async start(){s=e[Symbol.asyncIterator]()},async pull(e){try{const{value:t,done:a}=await s.next();if(a)return e.close();const r=io(JSON.stringify(t)+"\n");e.enqueue(r)}catch(t){e.error(t)}},async cancel(){await(s.return?.())}})}}class po{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[s,t,a]=function(e,s){const t=e.indexOf(s);if(-1!==t)return[e.substring(0,t),s,e.substring(t+s.length)];return[e,"",""]}(e,":");return a.startsWith(" ")&&(a=a.substring(1)),"event"===s?this.event=a:"data"===s&&this.data.push(a),null}}const go={off:0,error:200,warn:300,info:400,debug:500},fo=(e,s,t)=>{var a,r;if(e)return a=go,r=e,Object.prototype.hasOwnProperty.call(a,r)?e:void vo(t).warn(`${s} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(go))}`)};function yo(){}function jo(e,s,t){return!s||go[e]>go[t]?yo:s[e].bind(s)}const wo={error:yo,warn:yo,info:yo,debug:yo};let bo=new WeakMap;function vo(e){const s=e.logger,t=e.logLevel??"off";if(!s)return wo;const a=bo.get(s);if(a&&a[0]===t)return a[1];const r={error:jo("error",s,t),warn:jo("warn",s,t),info:jo("info",s,t),debug:jo("debug",s,t)};return bo.set(s,[t,r]),r}const No=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,s])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":s]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);async function _o(e,s){const{response:t,requestLogID:a,retryOfRequestLogID:r,startTime:n}=s,i=await(async()=>{if(s.options.stream)return vo(e).debug("response",t.status,t.url,t.headers,t.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(t,s.controller):xo.fromSSEResponse(t,s.controller);if(204===t.status)return null;if(s.options.__binaryResponse)return t;const a=t.headers.get("content-type"),r=a?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){return So(await t.json(),t)}return await t.text()})();return vo(e).debug(`[${a}] response parsed`,No({retryOfRequestLogID:r,url:t.url,status:t.status,body:i,durationMs:Date.now()-n})),i}function So(e,s){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:s.headers.get("x-request-id"),enumerable:!1})}var ko,Ao;class Co extends Promise{constructor(e,s,t=_o){super(e=>{e(null)}),this.responsePromise=s,this.parseResponse=t,ko.set(this,void 0),dc(this,ko,e)}_thenUnwrap(e){return new Co(mc(this,ko,"f"),this.responsePromise,async(s,t)=>So(e(await this.parseResponse(s,t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:s,request_id:s.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(mc(this,ko,"f"),e))),this.parsedPromise}then(e,s){return this.parse().then(e,s)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}ko=new WeakMap;class Eo{constructor(e,s,t,a){Ao.set(this,void 0),dc(this,Ao,e),this.options=a,this.response=s,this.body=t}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new pc("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await mc(this,Ao,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ao=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const s of e.getPaginatedItems())yield s}}class To extends Co{constructor(e,s,t){super(e,s,async(e,s)=>new t(e,s.response,await _o(e,s),s.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const s of e)yield s}}class Io extends Eo{constructor(e,s,t,a){super(e,s,t,a),this.data=t.data||[],this.object=t.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Do extends Eo{constructor(e,s,t,a){super(e,s,t,a),this.data=t.data||[],this.has_more=t.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems(),s=e[e.length-1]?.id;return s?{...this.options,query:{...(t=this.options.query,"object"!=typeof t?{}:t??{}),after:s}}:null;var t}}const Po=()=>{if("undefined"==typeof File){const{process:e}=globalThis,s="string"==typeof e?.versions?.node&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(s?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ro(e,s,t){return Po(),new File(e,s??"unknown_file",t)}function Fo(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const Lo=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],$o=async(e,s)=>({...e,body:await qo(e.body,s)}),Uo=new WeakMap;const qo=async(e,s)=>{if(!(await function(e){const s="function"==typeof e?e:e.fetch,t=Uo.get(s);if(t)return t;const a=(async()=>{try{const e="Response"in s?s.Response:(await s("data:,")).constructor,t=new FormData;return t.toString()!==await new e(t).text()}catch{return!0}})();return Uo.set(s,a),a}(s)))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,s])=>Oo(t,e,s))),t},Oo=async(e,s,t)=>{if(void 0!==t){if(null==t)throw new TypeError(`Received null for "${s}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)e.append(s,String(t));else if(t instanceof Response)e.append(s,Ro([await t.blob()],Fo(t)));else if(Lo(t))e.append(s,Ro([await new Response(zc(t)).blob()],Fo(t)));else if((e=>e instanceof Blob&&"name"in e)(t))e.append(s,t,Fo(t));else if(Array.isArray(t))await Promise.all(t.map(t=>Oo(e,s+"[]",t)));else{if("object"!=typeof t)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`);await Promise.all(Object.entries(t).map(([t,a])=>Oo(e,`${s}[${t}]`,a)))}}},zo=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function Mo(e){let s=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(zo(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!Lo(e)){const s=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${s?`; constructor: ${s}`:""}${function(e){if("object"!=typeof e||null===e)return"";const s=Object.getOwnPropertyNames(e);return`; props: [${s.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}for await(const t of e)s.push(...await Mo(t))}return s}class Bo{constructor(e){this._client=e}}function Vo(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Wo=((e=Vo)=>function(s,...t){if(1===s.length)return s[0];let a=!1;const r=s.reduce((s,r,n)=>(/[?#]/.test(r)&&(a=!0),s+r+(n===t.length?"":(a?encodeURIComponent:e)(String(t[n])))),""),n=r.split(/[?#]/,1)[0],i=[],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let c;for(;null!==(c=l.exec(n));)i.push({start:c.index,length:c[0].length});if(i.length>0){let e=0;const s=i.reduce((s,t)=>{const a=" ".repeat(t.start-e),r="^".repeat(t.length);return e=t.start+t.length,s+a+r},"");throw new pc(`Path parameters result in path with invalid segments:\n${r}\n${s}`)}return r})(Vo);let Go=class extends Bo{list(e,s={},t){return this._client.getAPIList(Wo`/chat/completions/${e}/messages`,Do,{query:s,...t})}};function Ho(e){return"function"==typeof e.parse}const Yo=e=>"assistant"===e?.role,Qo=e=>"tool"===e?.role;var Jo,Ko,Xo,Zo,ed,sd,td,ad,rd,nd,id,ld,cd,od,dd,md,ud,hd,xd,pd,gd;class fd{constructor(){Jo.add(this),this.controller=new AbortController,Ko.set(this,void 0),Xo.set(this,()=>{}),Zo.set(this,()=>{}),ed.set(this,void 0),sd.set(this,()=>{}),td.set(this,()=>{}),ad.set(this,{}),rd.set(this,!1),nd.set(this,!1),id.set(this,!1),ld.set(this,!1),dc(this,Ko,new Promise((e,s)=>{dc(this,Xo,e),dc(this,Zo,s)})),dc(this,ed,new Promise((e,s)=>{dc(this,sd,e),dc(this,td,s)})),mc(this,Ko,"f").catch(()=>{}),mc(this,ed,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},mc(this,Jo,"m",cd).bind(this))},0)}_connected(){this.ended||(mc(this,Xo,"f").call(this),this._emit("connect"))}get ended(){return mc(this,rd,"f")}get errored(){return mc(this,nd,"f")}get aborted(){return mc(this,id,"f")}abort(){this.controller.abort()}on(e,s){return(mc(this,ad,"f")[e]||(mc(this,ad,"f")[e]=[])).push({listener:s}),this}off(e,s){const t=mc(this,ad,"f")[e];if(!t)return this;const a=t.findIndex(e=>e.listener===s);return a>=0&&t.splice(a,1),this}once(e,s){return(mc(this,ad,"f")[e]||(mc(this,ad,"f")[e]=[])).push({listener:s,once:!0}),this}emitted(e){return new Promise((s,t)=>{dc(this,ld,!0),"error"!==e&&this.once("error",t),this.once(e,s)})}async done(){dc(this,ld,!0),await mc(this,ed,"f")}_emit(e,...s){if(mc(this,rd,"f"))return;"end"===e&&(dc(this,rd,!0),mc(this,sd,"f").call(this));const t=mc(this,ad,"f")[e];if(t&&(mc(this,ad,"f")[e]=t.filter(e=>!e.once),t.forEach(({listener:e})=>e(...s))),"abort"===e){const e=s[0];return mc(this,ld,"f")||t?.length||Promise.reject(e),mc(this,Zo,"f").call(this,e),mc(this,td,"f").call(this,e),void this._emit("end")}if("error"===e){const e=s[0];mc(this,ld,"f")||t?.length||Promise.reject(e),mc(this,Zo,"f").call(this,e),mc(this,td,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function yd(e){return"auto-parseable-response-format"===e?.$brand}function jd(e){return"auto-parseable-tool"===e?.$brand}function wd(e,s){const t=e.choices.map(e=>{if("length"===e.finish_reason)throw new Cc;if("content_filter"===e.finish_reason)throw new Ec;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>function(e,s){const t=e.tools?.find(e=>e.function?.name===s.function.name);return{...s,function:{...s.function,parsed_arguments:jd(t)?t.$parseRaw(s.function.arguments):t?.function.strict?JSON.parse(s.function.arguments):null}}}(s,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?bd(s,e.message.content):null}}});return{...e,choices:t}}function bd(e,s){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(s)}return JSON.parse(s)}return null}function vd(e,s){if(!e)return!1;const t=e.tools?.find(e=>e.function?.name===s.function.name);return jd(t)||t?.function.strict||!1}function Nd(e){return!!yd(e.response_format)||(e.tools?.some(e=>jd(e)||"function"===e.type&&!0===e.function.strict)??!1)}Ko=new WeakMap,Xo=new WeakMap,Zo=new WeakMap,ed=new WeakMap,sd=new WeakMap,td=new WeakMap,ad=new WeakMap,rd=new WeakMap,nd=new WeakMap,id=new WeakMap,ld=new WeakMap,Jo=new WeakSet,cd=function(e){if(dc(this,nd,!0),e instanceof Error&&"AbortError"===e.name&&(e=new fc),e instanceof fc)return dc(this,id,!0),this._emit("abort",e);if(e instanceof pc)return this._emit("error",e);if(e instanceof Error){const s=new pc(e.message);return s.cause=e,this._emit("error",s)}return this._emit("error",new pc(String(e)))};const _d=10;class Sd extends fd{constructor(){super(...arguments),od.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const s=e.choices[0]?.message;return s&&this._addMessage(s),e}_addMessage(e,s=!0){if("content"in e||(e.content=null),this.messages.push(e),s)if(this._emit("message",e),Qo(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Yo(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new pc("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),mc(this,od,"m",dd).call(this)}async finalMessage(){return await this.done(),mc(this,od,"m",md).call(this)}async finalFunctionToolCall(){return await this.done(),mc(this,od,"m",ud).call(this)}async finalFunctionToolCallResult(){return await this.done(),mc(this,od,"m",hd).call(this)}async totalUsage(){return await this.done(),mc(this,od,"m",xd).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const s=mc(this,od,"m",md).call(this);s&&this._emit("finalMessage",s);const t=mc(this,od,"m",dd).call(this);t&&this._emit("finalContent",t);const a=mc(this,od,"m",ud).call(this);a&&this._emit("finalFunctionToolCall",a);const r=mc(this,od,"m",hd).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",mc(this,od,"m",xd).call(this))}async _createChatCompletion(e,s,t){const a=t?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),mc(this,od,"m",pd).call(this,s);const r=await e.chat.completions.create({...s,stream:!1},{...t,signal:this.controller.signal});return this._connected(),this._addChatCompletion(wd(r,s))}async _runChatCompletion(e,s,t){for(const a of s.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,s,t)}async _runTools(e,s,t){const a="tool",{tool_choice:r="auto",stream:n,...i}=s,l="string"!=typeof r&&r?.function?.name,{maxChatCompletions:c=_d}=t||{},o=s.tools.map(e=>{if(jd(e)){if(!e.$callback)throw new pc("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),d={};for(const h of o)"function"===h.type&&(d[h.function.name||h.function.function.name]=h.function);const m="tools"in s?o.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const h of s.messages)this._addMessage(h,!1);for(let h=0;h<c;++h){const s=await this._createChatCompletion(e,{...i,tool_choice:r,tools:m,messages:[...this.messages]},t),n=s.choices[0]?.message;if(!n)throw new pc("missing message in ChatCompletion response");if(!n.tool_calls?.length)return;for(const e of n.tool_calls){if("function"!==e.type)continue;const s=e.id,{name:t,arguments:r}=e.function,n=d[t];if(!n){const e=`Invalid tool_call: ${JSON.stringify(t)}. Available options are: ${Object.keys(d).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:s,content:e});continue}if(l&&l!==t){const e=`Invalid tool_call: ${JSON.stringify(t)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:a,tool_call_id:s,content:e});continue}let i;try{i=Ho(n)?await n.parse(r):r}catch(u){const e=u instanceof Error?u.message:String(u);this._addMessage({role:a,tool_call_id:s,content:e});continue}const c=await n.function(i,this),o=mc(this,od,"m",gd).call(this,c);if(this._addMessage({role:a,tool_call_id:s,content:o}),l)return}}}}od=new WeakSet,dd=function(){return mc(this,od,"m",md).call(this).content??null},md=function(){let e=this.messages.length;for(;e-- >0;){const s=this.messages[e];if(Yo(s)){return{...s,content:s.content??null,refusal:s.refusal??null}}}throw new pc("stream ended without producing a ChatCompletionMessage with role=assistant")},ud=function(){for(let e=this.messages.length-1;e>=0;e--){const s=this.messages[e];if(Yo(s)&&s?.tool_calls?.length)return s.tool_calls.at(-1)?.function}},hd=function(){for(let e=this.messages.length-1;e>=0;e--){const s=this.messages[e];if(Qo(s)&&null!=s.content&&"string"==typeof s.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===s.tool_call_id)))return s.content}},xd=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:s}of this._chatCompletions)s&&(e.completion_tokens+=s.completion_tokens,e.prompt_tokens+=s.prompt_tokens,e.total_tokens+=s.total_tokens);return e},pd=function(e){if(null!=e.n&&e.n>1)throw new pc("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},gd=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class kd extends Sd{static runTools(e,s,t){const a=new kd,r={...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,s,r)),a}_addMessage(e,s=!0){super._addMessage(e,s),Yo(e)&&e.content&&this._emit("content",e.content)}}const Ad=1,Cd=2,Ed=4,Td=8,Id=16,Dd=32,Pd=64,Rd=128,Fd=256,Ld=511;class $d extends Error{}class Ud extends Error{}const qd=(e,s)=>{const t=e.length;let a=0;const r=e=>{throw new $d(`${e} at position ${a}`)},n=e=>{throw new Ud(`${e} at position ${a}`)},i=()=>(m(),a>=t&&r("Unexpected end of input"),'"'===e[a]?l():"{"===e[a]?c():"["===e[a]?o():"null"===e.substring(a,a+4)||Id&s&&t-a<4&&"null".startsWith(e.substring(a))?(a+=4,null):"true"===e.substring(a,a+4)||Dd&s&&t-a<4&&"true".startsWith(e.substring(a))?(a+=4,!0):"false"===e.substring(a,a+5)||Dd&s&&t-a<5&&"false".startsWith(e.substring(a))?(a+=5,!1):"Infinity"===e.substring(a,a+8)||Rd&s&&t-a<8&&"Infinity".startsWith(e.substring(a))?(a+=8,1/0):"-Infinity"===e.substring(a,a+9)||Fd&s&&1<t-a&&t-a<9&&"-Infinity".startsWith(e.substring(a))?(a+=9,-1/0):"NaN"===e.substring(a,a+3)||Pd&s&&t-a<3&&"NaN".startsWith(e.substring(a))?(a+=3,NaN):d()),l=()=>{const i=a;let l=!1;for(a++;a<t&&('"'!==e[a]||l&&"\\"===e[a-1]);)l="\\"===e[a]&&!l,a++;if('"'==e.charAt(a))try{return JSON.parse(e.substring(i,++a-Number(l)))}catch(c){n(String(c))}else if(Ad&s)try{return JSON.parse(e.substring(i,a-Number(l))+'"')}catch(c){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},c=()=>{a++,m();const n={};try{for(;"}"!==e[a];){if(m(),a>=t&&Td&s)return n;const r=l();m(),a++;try{const e=i();Object.defineProperty(n,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(c){if(Td&s)return n;throw c}m(),","===e[a]&&a++}}catch(c){if(Td&s)return n;r("Expected '}' at end of object")}return a++,n},o=()=>{a++;const t=[];try{for(;"]"!==e[a];)t.push(i()),m(),","===e[a]&&a++}catch(n){if(Ed&s)return t;r("Expected ']' at end of array")}return a++,t},d=()=>{if(0===a){"-"===e&&Cd&s&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(l){if(Cd&s)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(c){}n(String(l))}}const i=a;for("-"===e[a]&&a++;e[a]&&!",]}".includes(e[a]);)a++;a!=t||Cd&s||r("Unterminated number literal");try{return JSON.parse(e.substring(i,a))}catch(l){"-"===e.substring(i,a)&&Cd&s&&r("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(c){n(String(c))}}},m=()=>{for(;a<t&&" \n\r\t".includes(e[a]);)a++};return i()},Od=e=>function(e,s=Ld){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return qd(e.trim(),s)}(e,Ld^Cd);var zd,Md,Bd,Vd,Wd,Gd,Hd,Yd,Qd,Jd,Kd,Xd;class Zd extends Sd{constructor(e){super(),zd.add(this),Md.set(this,void 0),Bd.set(this,void 0),Vd.set(this,void 0),dc(this,Md,e),dc(this,Bd,[])}get currentChatCompletionSnapshot(){return mc(this,Vd,"f")}static fromReadableStream(e){const s=new Zd(null);return s._run(()=>s._fromReadableStream(e)),s}static createChatCompletion(e,s,t){const a=new Zd(s);return a._run(()=>a._runChatCompletion(e,{...s,stream:!0},{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,s,t){super._createChatCompletion;const a=t?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),mc(this,zd,"m",Wd).call(this);const r=await e.chat.completions.create({...s,stream:!0},{...t,signal:this.controller.signal});this._connected();for await(const n of r)mc(this,zd,"m",Hd).call(this,n);if(r.controller.signal?.aborted)throw new fc;return this._addChatCompletion(mc(this,zd,"m",Jd).call(this))}async _fromReadableStream(e,s){const t=s?.signal;t&&(t.aborted&&this.controller.abort(),t.addEventListener("abort",()=>this.controller.abort())),mc(this,zd,"m",Wd).call(this),this._connected();const a=xo.fromReadableStream(e,this.controller);let r;for await(const n of a)r&&r!==n.id&&this._addChatCompletion(mc(this,zd,"m",Jd).call(this)),mc(this,zd,"m",Hd).call(this,n),r=n.id;if(a.controller.signal?.aborted)throw new fc;return this._addChatCompletion(mc(this,zd,"m",Jd).call(this))}[(Md=new WeakMap,Bd=new WeakMap,Vd=new WeakMap,zd=new WeakSet,Wd=function(){this.ended||dc(this,Vd,void 0)},Gd=function(e){let s=mc(this,Bd,"f")[e.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},mc(this,Bd,"f")[e.index]=s,s)},Hd=function(e){if(this.ended)return;const s=mc(this,zd,"m",Xd).call(this,e);this._emit("chunk",e,s);for(const t of e.choices){const e=s.choices[t.index];null!=t.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",t.delta.content,e.message.content),this._emit("content.delta",{delta:t.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=t.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:t.delta.refusal,snapshot:e.message.refusal}),null!=t.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:t.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=t.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:t.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const a=mc(this,zd,"m",Gd).call(this,e);e.finish_reason&&(mc(this,zd,"m",Qd).call(this,e),null!=a.current_tool_call_index&&mc(this,zd,"m",Yd).call(this,e,a.current_tool_call_index));for(const s of t.delta.tool_calls??[])a.current_tool_call_index!==s.index&&(mc(this,zd,"m",Qd).call(this,e),null!=a.current_tool_call_index&&mc(this,zd,"m",Yd).call(this,e,a.current_tool_call_index)),a.current_tool_call_index=s.index;for(const s of t.delta.tool_calls??[]){const t=e.message.tool_calls?.[s.index];t?.type&&("function"===t?.type?this._emit("tool_calls.function.arguments.delta",{name:t.function?.name,index:s.index,arguments:t.function.arguments,parsed_arguments:t.function.parsed_arguments,arguments_delta:s.function?.arguments??""}):sm(t?.type))}}},Yd=function(e,s){if(mc(this,zd,"m",Gd).call(this,e).done_tool_calls.has(s))return;const t=e.message.tool_calls?.[s];if(!t)throw new Error("no tool call snapshot");if(!t.type)throw new Error("tool call snapshot missing `type`");if("function"===t.type){const e=mc(this,Md,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===t.function.name);this._emit("tool_calls.function.arguments.done",{name:t.function.name,index:s,arguments:t.function.arguments,parsed_arguments:jd(e)?e.$parseRaw(t.function.arguments):e?.function.strict?JSON.parse(t.function.arguments):null})}else t.type},Qd=function(e){const s=mc(this,zd,"m",Gd).call(this,e);if(e.message.content&&!s.content_done){s.content_done=!0;const t=mc(this,zd,"m",Kd).call(this);this._emit("content.done",{content:e.message.content,parsed:t?t.$parseRaw(e.message.content):null})}e.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Jd=function(){if(this.ended)throw new pc("stream has ended, this shouldn't happen");const e=mc(this,Vd,"f");if(!e)throw new pc("request ended without sending any chunks");return dc(this,Vd,void 0),dc(this,Bd,[]),function(e,s){const{id:t,choices:a,created:r,model:n,system_fingerprint:i,...l}=e,c={...l,id:t,choices:a.map(({message:s,finish_reason:t,index:a,logprobs:r,...n})=>{if(!t)throw new pc(`missing finish_reason for choice ${a}`);const{content:i=null,function_call:l,tool_calls:c,...o}=s,d=s.role;if(!d)throw new pc(`missing role for choice ${a}`);if(l){const{arguments:e,name:c}=l;if(null==e)throw new pc(`missing function_call.arguments for choice ${a}`);if(!c)throw new pc(`missing function_call.name for choice ${a}`);return{...n,message:{content:i,function_call:{arguments:e,name:c},role:d,refusal:s.refusal??null},finish_reason:t,index:a,logprobs:r}}return c?{...n,index:a,finish_reason:t,logprobs:r,message:{...o,role:d,content:i,refusal:s.refusal??null,tool_calls:c.map((s,t)=>{const{function:r,type:n,id:i,...l}=s,{arguments:c,name:o,...d}=r||{};if(null==i)throw new pc(`missing choices[${a}].tool_calls[${t}].id\n${em(e)}`);if(null==n)throw new pc(`missing choices[${a}].tool_calls[${t}].type\n${em(e)}`);if(null==o)throw new pc(`missing choices[${a}].tool_calls[${t}].function.name\n${em(e)}`);if(null==c)throw new pc(`missing choices[${a}].tool_calls[${t}].function.arguments\n${em(e)}`);return{...l,id:i,type:n,function:{...d,name:o,arguments:c}}})}}:{...n,message:{...o,content:i,role:d,refusal:s.refusal??null},finish_reason:t,index:a,logprobs:r}}),created:r,model:n,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,s){return s&&Nd(s)?wd(e,s):{...e,choices:e.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(c,s)}(e,mc(this,Md,"f"))},Kd=function(){const e=mc(this,Md,"f")?.response_format;return yd(e)?e:null},Xd=function(e){var s,t,a,r;let n=mc(this,Vd,"f");const{choices:i,...l}=e;n?Object.assign(n,l):n=dc(this,Vd,{...l,choices:[]});for(const{delta:c,finish_reason:o,index:d,logprobs:m=null,...u}of e.choices){let e=n.choices[d];if(e||(e=n.choices[d]={finish_reason:o,index:d,message:{},logprobs:m,...u}),m)if(e.logprobs){const{content:a,refusal:r,...n}=m;Object.assign(e.logprobs,n),a&&((s=e.logprobs).content??(s.content=[]),e.logprobs.content.push(...a)),r&&((t=e.logprobs).refusal??(t.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},m);if(o&&(e.finish_reason=o,mc(this,Md,"f")&&Nd(mc(this,Md,"f")))){if("length"===o)throw new Cc;if("content_filter"===o)throw new Ec}if(Object.assign(e,u),!c)continue;const{content:i,refusal:l,function_call:h,role:x,tool_calls:p,...g}=c;if(Object.assign(e.message,g),l&&(e.message.refusal=(e.message.refusal||"")+l),x&&(e.message.role=x),h&&(e.message.function_call?(h.name&&(e.message.function_call.name=h.name),h.arguments&&((a=e.message.function_call).arguments??(a.arguments=""),e.message.function_call.arguments+=h.arguments)):e.message.function_call=h),i&&(e.message.content=(e.message.content||"")+i,!e.message.refusal&&mc(this,zd,"m",Kd).call(this)&&(e.message.parsed=Od(e.message.content))),p){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:s,id:t,type:a,function:n,...i}of p){const l=(r=e.message.tool_calls)[s]??(r[s]={});Object.assign(l,i),t&&(l.id=t),a&&(l.type=a),n&&(l.function??(l.function={name:n.name??"",arguments:""})),n?.name&&(l.function.name=n.name),n?.arguments&&(l.function.arguments+=n.arguments,vd(mc(this,Md,"f"),l)&&(l.function.parsed_arguments=Od(l.function.arguments)))}}}return n},Symbol.asyncIterator)](){const e=[],s=[];let t=!1;return this.on("chunk",t=>{const a=s.shift();a?a.resolve(t):e.push(t)}),this.on("end",()=>{t=!0;for(const e of s)e.resolve(void 0);s.length=0}),this.on("abort",e=>{t=!0;for(const t of s)t.reject(e);s.length=0}),this.on("error",e=>{t=!0;for(const t of s)t.reject(e);s.length=0}),{next:async()=>{if(!e.length)return t?{value:void 0,done:!0}:new Promise((e,t)=>s.push({resolve:e,reject:t})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new xo(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function em(e){return JSON.stringify(e)}function sm(e){}class tm extends Zd{static fromReadableStream(e){const s=new tm(null);return s._run(()=>s._fromReadableStream(e)),s}static runTools(e,s,t){const a=new tm(s),r={...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,s,r)),a}}let am=class extends Bo{constructor(){super(...arguments),this.messages=new Go(this._client)}create(e,s){return this._client.post("/chat/completions",{body:e,...s,stream:e.stream??!1})}retrieve(e,s){return this._client.get(Wo`/chat/completions/${e}`,s)}update(e,s,t){return this._client.post(Wo`/chat/completions/${e}`,{body:s,...t})}list(e={},s){return this._client.getAPIList("/chat/completions",Do,{query:e,...s})}delete(e,s){return this._client.delete(Wo`/chat/completions/${e}`,s)}parse(e,s){return function(e){for(const s of e??[]){if("function"!==s.type)throw new pc(`Currently only \`function\` tool types support auto-parsing; Received \`${s.type}\``);if(!0!==s.function.strict)throw new pc(`The \`${s.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(s=>wd(s,e))}runTools(e,s){return e.stream?tm.runTools(this._client,e,s):kd.runTools(this._client,e,s)}stream(e,s){return Zd.createChatCompletion(this._client,e,s)}};am.Messages=Go;class rm extends Bo{constructor(){super(...arguments),this.completions=new am(this._client)}}rm.Completions=am;const nm=Symbol("brand.privateNullableHeaders");function*im(e){if(!e)return;if(nm in e){const{values:s,nulls:t}=e;yield*s.entries();for(const e of t)yield[e,null];return}let s,t=!1;e instanceof Headers?s=e.entries():Dc(e)?s=e:(t=!0,s=Object.entries(e??{}));for(let a of s){const e=a[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const s=Dc(a[1])?a[1]:[a[1]];let r=!1;for(const a of s)void 0!==a&&(t&&!r&&(r=!0,yield[e,null]),yield[e,a])}}const lm=e=>{const s=new Headers,t=new Set;for(const a of e){const e=new Set;for(const[r,n]of im(a)){const a=r.toLowerCase();e.has(a)||(s.delete(r),e.add(a)),null===n?(s.delete(r),t.add(a)):(s.append(r,n),t.delete(a))}}return{[nm]:!0,values:s,nulls:t}};class cm extends Bo{create(e,s){return this._client.post("/audio/speech",{body:e,...s,headers:lm([{Accept:"application/octet-stream"},s?.headers]),__binaryResponse:!0})}}class om extends Bo{create(e,s){return this._client.post("/audio/transcriptions",$o({body:e,...s,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class dm extends Bo{create(e,s){return this._client.post("/audio/translations",$o({body:e,...s,__metadata:{model:e.model}},this._client))}}class mm extends Bo{constructor(){super(...arguments),this.transcriptions=new om(this._client),this.translations=new dm(this._client),this.speech=new cm(this._client)}}mm.Transcriptions=om,mm.Translations=dm,mm.Speech=cm;class um extends Bo{create(e,s){return this._client.post("/batches",{body:e,...s})}retrieve(e,s){return this._client.get(Wo`/batches/${e}`,s)}list(e={},s){return this._client.getAPIList("/batches",Do,{query:e,...s})}cancel(e,s){return this._client.post(Wo`/batches/${e}/cancel`,s)}}class hm extends Bo{create(e,s){return this._client.post("/assistants",{body:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,s){return this._client.get(Wo`/assistants/${e}`,{...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,s,t){return this._client.post(Wo`/assistants/${e}`,{body:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e={},s){return this._client.getAPIList("/assistants",Do,{query:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,s){return this._client.delete(Wo`/assistants/${e}`,{...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class xm extends Bo{create(e,s){return this._client.post("/realtime/sessions",{body:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class pm extends Bo{create(e,s){return this._client.post("/realtime/transcription_sessions",{body:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class gm extends Bo{constructor(){super(...arguments),this.sessions=new xm(this._client),this.transcriptionSessions=new pm(this._client)}}gm.Sessions=xm,gm.TranscriptionSessions=pm;class fm extends Bo{create(e,s,t){return this._client.post(Wo`/threads/${e}/messages`,{body:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,s,t){const{thread_id:a}=s;return this._client.get(Wo`/threads/${a}/messages/${e}`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,s,t){const{thread_id:a,...r}=s;return this._client.post(Wo`/threads/${a}/messages/${e}`,{body:r,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,s={},t){return this._client.getAPIList(Wo`/threads/${e}/messages`,Do,{query:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,s,t){const{thread_id:a}=s;return this._client.delete(Wo`/threads/${a}/messages/${e}`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ym extends Bo{retrieve(e,s,t){const{thread_id:a,run_id:r,...n}=s;return this._client.get(Wo`/threads/${a}/runs/${r}/steps/${e}`,{query:n,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,s,t){const{thread_id:a,...r}=s;return this._client.getAPIList(Wo`/threads/${a}/runs/${e}/steps`,Do,{query:r,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}var jm={};const wm=e=>void 0!==globalThis.process?jm?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;var bm,vm,Nm,_m,Sm,km,Am,Cm,Em,Tm,Im,Dm,Pm,Rm,Fm,Lm,$m,Um,qm,Om,zm,Mm,Bm;class Vm extends fd{constructor(){super(...arguments),bm.add(this),Nm.set(this,[]),_m.set(this,{}),Sm.set(this,{}),km.set(this,void 0),Am.set(this,void 0),Cm.set(this,void 0),Em.set(this,void 0),Tm.set(this,void 0),Im.set(this,void 0),Dm.set(this,void 0),Pm.set(this,void 0),Rm.set(this,void 0)}[(Nm=new WeakMap,_m=new WeakMap,Sm=new WeakMap,km=new WeakMap,Am=new WeakMap,Cm=new WeakMap,Em=new WeakMap,Tm=new WeakMap,Im=new WeakMap,Dm=new WeakMap,Pm=new WeakMap,Rm=new WeakMap,bm=new WeakSet,Symbol.asyncIterator)](){const e=[],s=[];let t=!1;return this.on("event",t=>{const a=s.shift();a?a.resolve(t):e.push(t)}),this.on("end",()=>{t=!0;for(const e of s)e.resolve(void 0);s.length=0}),this.on("abort",e=>{t=!0;for(const t of s)t.reject(e);s.length=0}),this.on("error",e=>{t=!0;for(const t of s)t.reject(e);s.length=0}),{next:async()=>{if(!e.length)return t?{value:void 0,done:!0}:new Promise((e,t)=>s.push({resolve:e,reject:t})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const s=new vm;return s._run(()=>s._fromReadableStream(e)),s}async _fromReadableStream(e,s){const t=s?.signal;t&&(t.aborted&&this.controller.abort(),t.addEventListener("abort",()=>this.controller.abort())),this._connected();const a=xo.fromReadableStream(e,this.controller);for await(const r of a)mc(this,bm,"m",Fm).call(this,r);if(a.controller.signal?.aborted)throw new fc;return this._addRun(mc(this,bm,"m",Lm).call(this))}toReadableStream(){return new xo(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,s,t,a){const r=new vm;return r._run(()=>r._runToolAssistantStream(e,s,t,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,s,t,a){const r=a?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const n={...t,stream:!0},i=await e.submitToolOutputs(s,n,{...a,signal:this.controller.signal});this._connected();for await(const l of i)mc(this,bm,"m",Fm).call(this,l);if(i.controller.signal?.aborted)throw new fc;return this._addRun(mc(this,bm,"m",Lm).call(this))}static createThreadAssistantStream(e,s,t){const a=new vm;return a._run(()=>a._threadAssistantStream(e,s,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,s,t,a){const r=new vm;return r._run(()=>r._runAssistantStream(e,s,t,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return mc(this,Dm,"f")}currentRun(){return mc(this,Pm,"f")}currentMessageSnapshot(){return mc(this,km,"f")}currentRunStepSnapshot(){return mc(this,Rm,"f")}async finalRunSteps(){return await this.done(),Object.values(mc(this,_m,"f"))}async finalMessages(){return await this.done(),Object.values(mc(this,Sm,"f"))}async finalRun(){if(await this.done(),!mc(this,Am,"f"))throw Error("Final run was not received.");return mc(this,Am,"f")}async _createThreadAssistantStream(e,s,t){const a=t?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const r={...s,stream:!0},n=await e.createAndRun(r,{...t,signal:this.controller.signal});this._connected();for await(const i of n)mc(this,bm,"m",Fm).call(this,i);if(n.controller.signal?.aborted)throw new fc;return this._addRun(mc(this,bm,"m",Lm).call(this))}async _createAssistantStream(e,s,t,a){const r=a?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const n={...t,stream:!0},i=await e.create(s,n,{...a,signal:this.controller.signal});this._connected();for await(const l of i)mc(this,bm,"m",Fm).call(this,l);if(i.controller.signal?.aborted)throw new fc;return this._addRun(mc(this,bm,"m",Lm).call(this))}static accumulateDelta(e,s){for(const[t,a]of Object.entries(s)){if(!e.hasOwnProperty(t)){e[t]=a;continue}let s=e[t];if(null!=s)if("index"!==t&&"type"!==t){if("string"==typeof s&&"string"==typeof a)s+=a;else if("number"==typeof s&&"number"==typeof a)s+=a;else{if(!Pc(s)||!Pc(a)){if(Array.isArray(s)&&Array.isArray(a)){if(s.every(e=>"string"==typeof e||"number"==typeof e)){s.push(...a);continue}for(const e of a){if(!Pc(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const t=e.index;if(null==t)throw new Error("Expected array delta entry to have an `index` property");if("number"!=typeof t)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${t}`);const a=s[t];null==a?s.push(e):s[t]=this.accumulateDelta(a,e)}continue}throw Error(`Unhandled record type: ${t}, deltaValue: ${a}, accValue: ${s}`)}s=this.accumulateDelta(s,a)}e[t]=s}else e[t]=a;else e[t]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,s,t){return await this._createThreadAssistantStream(s,e,t)}async _runAssistantStream(e,s,t,a){return await this._createAssistantStream(s,e,t,a)}async _runToolAssistantStream(e,s,t,a){return await this._createToolAssistantStream(s,e,t,a)}}vm=Vm,Fm=function(e){if(!this.ended)switch(dc(this,Dm,e),mc(this,bm,"m",qm).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":mc(this,bm,"m",Bm).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":mc(this,bm,"m",Um).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":mc(this,bm,"m",$m).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Lm=function(){if(this.ended)throw new pc("stream has ended, this shouldn't happen");if(!mc(this,Am,"f"))throw Error("Final run has not been received");return mc(this,Am,"f")},$m=function(e){const[s,t]=mc(this,bm,"m",zm).call(this,e,mc(this,km,"f"));dc(this,km,s),mc(this,Sm,"f")[s.id]=s;for(const a of t){const e=s.content[a.index];"text"==e?.type&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,s),e.data.delta.content)for(const t of e.data.delta.content){if("text"==t.type&&t.text){let e=t.text,a=s.content[t.index];if(!a||"text"!=a.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,a.text)}if(t.index!=mc(this,Cm,"f")){if(mc(this,Em,"f"))switch(mc(this,Em,"f").type){case"text":this._emit("textDone",mc(this,Em,"f").text,mc(this,km,"f"));break;case"image_file":this._emit("imageFileDone",mc(this,Em,"f").image_file,mc(this,km,"f"))}dc(this,Cm,t.index)}dc(this,Em,s.content[t.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==mc(this,Cm,"f")){const s=e.data.content[mc(this,Cm,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,mc(this,km,"f"));break;case"text":this._emit("textDone",s.text,mc(this,km,"f"))}}mc(this,km,"f")&&this._emit("messageDone",e.data),dc(this,km,void 0)}},Um=function(e){const s=mc(this,bm,"m",Om).call(this,e);switch(dc(this,Rm,s),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const t=e.data.delta;if(t.step_details&&"tool_calls"==t.step_details.type&&t.step_details.tool_calls&&"tool_calls"==s.step_details.type)for(const e of t.step_details.tool_calls)e.index==mc(this,Tm,"f")?this._emit("toolCallDelta",e,s.step_details.tool_calls[e.index]):(mc(this,Im,"f")&&this._emit("toolCallDone",mc(this,Im,"f")),dc(this,Tm,e.index),dc(this,Im,s.step_details.tool_calls[e.index]),mc(this,Im,"f")&&this._emit("toolCallCreated",mc(this,Im,"f")));this._emit("runStepDelta",e.data.delta,s);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":dc(this,Rm,void 0);"tool_calls"==e.data.step_details.type&&mc(this,Im,"f")&&(this._emit("toolCallDone",mc(this,Im,"f")),dc(this,Im,void 0)),this._emit("runStepDone",e.data,s)}},qm=function(e){mc(this,Nm,"f").push(e),this._emit("event",e)},Om=function(e){switch(e.event){case"thread.run.step.created":return mc(this,_m,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let s=mc(this,_m,"f")[e.data.id];if(!s)throw Error("Received a RunStepDelta before creation of a snapshot");let t=e.data;if(t.delta){const a=vm.accumulateDelta(s,t.delta);mc(this,_m,"f")[e.data.id]=a}return mc(this,_m,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":mc(this,_m,"f")[e.data.id]=e.data}if(mc(this,_m,"f")[e.data.id])return mc(this,_m,"f")[e.data.id];throw new Error("No snapshot available")},zm=function(e,s){let t=[];switch(e.event){case"thread.message.created":return[e.data,t];case"thread.message.delta":if(!s)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(const e of a.delta.content)if(e.index in s.content){let t=s.content[e.index];s.content[e.index]=mc(this,bm,"m",Mm).call(this,e,t)}else s.content[e.index]=e,t.push(e);return[s,t];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(s)return[s,t];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Mm=function(e,s){return vm.accumulateDelta(s,e)},Bm=function(e){switch(dc(this,Pm,e.data),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":dc(this,Am,e.data),mc(this,Im,"f")&&(this._emit("toolCallDone",mc(this,Im,"f")),dc(this,Im,void 0))}};let Wm=class extends Bo{constructor(){super(...arguments),this.steps=new ym(this._client)}create(e,s,t){const{include:a,...r}=s;return this._client.post(Wo`/threads/${e}/runs`,{query:{include:a},body:r,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:s.stream??!1})}retrieve(e,s,t){const{thread_id:a}=s;return this._client.get(Wo`/threads/${a}/runs/${e}`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,s,t){const{thread_id:a,...r}=s;return this._client.post(Wo`/threads/${a}/runs/${e}`,{body:r,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,s={},t){return this._client.getAPIList(Wo`/threads/${e}/runs`,Do,{query:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}cancel(e,s,t){const{thread_id:a}=s;return this._client.post(Wo`/threads/${a}/runs/${e}/cancel`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async createAndPoll(e,s,t){const a=await this.create(e,s,t);return await this.poll(a.id,{thread_id:e},t)}createAndStream(e,s,t){return Vm.createAssistantStream(e,this._client.beta.threads.runs,s,t)}async poll(e,s,t){const a=lm([t?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":t?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:r,response:n}=await this.retrieve(e,s,{...t,headers:{...t?.headers,...a}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(t?.pollIntervalMs)e=t.pollIntervalMs;else{const s=n.headers.get("openai-poll-after-ms");if(s){const t=parseInt(s);isNaN(t)||(e=t)}}await Rc(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,s,t){return Vm.createAssistantStream(e,this._client.beta.threads.runs,s,t)}submitToolOutputs(e,s,t){const{thread_id:a,...r}=s;return this._client.post(Wo`/threads/${a}/runs/${e}/submit_tool_outputs`,{body:r,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:s.stream??!1})}async submitToolOutputsAndPoll(e,s,t){const a=await this.submitToolOutputs(e,s,t);return await this.poll(a.id,s,t)}submitToolOutputsStream(e,s,t){return Vm.createToolAssistantStream(e,this._client.beta.threads.runs,s,t)}};Wm.Steps=ym;class Gm extends Bo{constructor(){super(...arguments),this.runs=new Wm(this._client),this.messages=new fm(this._client)}create(e={},s){return this._client.post("/threads",{body:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,s){return this._client.get(Wo`/threads/${e}`,{...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,s,t){return this._client.post(Wo`/threads/${e}`,{body:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,s){return this._client.delete(Wo`/threads/${e}`,{...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}createAndRun(e,s){return this._client.post("/threads/runs",{body:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,s){const t=await this.createAndRun(e,s);return await this.runs.poll(t.id,{thread_id:t.thread_id},s)}createAndRunStream(e,s){return Vm.createThreadAssistantStream(e,this._client.beta.threads,s)}}Gm.Runs=Wm,Gm.Messages=fm;class Hm extends Bo{constructor(){super(...arguments),this.realtime=new gm(this._client),this.assistants=new hm(this._client),this.threads=new Gm(this._client)}}Hm.Realtime=gm,Hm.Assistants=hm,Hm.Threads=Gm;class Ym extends Bo{create(e,s){return this._client.post("/completions",{body:e,...s,stream:e.stream??!1})}}class Qm extends Bo{retrieve(e,s,t){const{container_id:a}=s;return this._client.get(Wo`/containers/${a}/files/${e}/content`,{...t,headers:lm([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}}let Jm=class extends Bo{constructor(){super(...arguments),this.content=new Qm(this._client)}create(e,s,t){return this._client.post(Wo`/containers/${e}/files`,$o({body:s,...t},this._client))}retrieve(e,s,t){const{container_id:a}=s;return this._client.get(Wo`/containers/${a}/files/${e}`,t)}list(e,s={},t){return this._client.getAPIList(Wo`/containers/${e}/files`,Do,{query:s,...t})}delete(e,s,t){const{container_id:a}=s;return this._client.delete(Wo`/containers/${a}/files/${e}`,{...t,headers:lm([{Accept:"*/*"},t?.headers])})}};Jm.Content=Qm;class Km extends Bo{constructor(){super(...arguments),this.files=new Jm(this._client)}create(e,s){return this._client.post("/containers",{body:e,...s})}retrieve(e,s){return this._client.get(Wo`/containers/${e}`,s)}list(e={},s){return this._client.getAPIList("/containers",Do,{query:e,...s})}delete(e,s){return this._client.delete(Wo`/containers/${e}`,{...s,headers:lm([{Accept:"*/*"},s?.headers])})}}Km.Files=Jm;class Xm extends Bo{create(e,s){const t=!!e.encoding_format;let a=t?e.encoding_format:"base64";t&&vo(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:a},...s});return t?r:(vo(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const s=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const s=Buffer.from(e,"base64");return Array.from(new Float32Array(s.buffer,s.byteOffset,s.length/Float32Array.BYTES_PER_ELEMENT))}{const s=atob(e),t=s.length,a=new Uint8Array(t);for(let e=0;e<t;e++)a[e]=s.charCodeAt(e);return Array.from(new Float32Array(a.buffer))}})(s)}),e)))}}class Zm extends Bo{retrieve(e,s,t){const{eval_id:a,run_id:r}=s;return this._client.get(Wo`/evals/${a}/runs/${r}/output_items/${e}`,t)}list(e,s,t){const{eval_id:a,...r}=s;return this._client.getAPIList(Wo`/evals/${a}/runs/${e}/output_items`,Do,{query:r,...t})}}class eu extends Bo{constructor(){super(...arguments),this.outputItems=new Zm(this._client)}create(e,s,t){return this._client.post(Wo`/evals/${e}/runs`,{body:s,...t})}retrieve(e,s,t){const{eval_id:a}=s;return this._client.get(Wo`/evals/${a}/runs/${e}`,t)}list(e,s={},t){return this._client.getAPIList(Wo`/evals/${e}/runs`,Do,{query:s,...t})}delete(e,s,t){const{eval_id:a}=s;return this._client.delete(Wo`/evals/${a}/runs/${e}`,t)}cancel(e,s,t){const{eval_id:a}=s;return this._client.post(Wo`/evals/${a}/runs/${e}`,t)}}eu.OutputItems=Zm;class su extends Bo{constructor(){super(...arguments),this.runs=new eu(this._client)}create(e,s){return this._client.post("/evals",{body:e,...s})}retrieve(e,s){return this._client.get(Wo`/evals/${e}`,s)}update(e,s,t){return this._client.post(Wo`/evals/${e}`,{body:s,...t})}list(e={},s){return this._client.getAPIList("/evals",Do,{query:e,...s})}delete(e,s){return this._client.delete(Wo`/evals/${e}`,s)}}su.Runs=eu;let tu=class extends Bo{create(e,s){return this._client.post("/files",$o({body:e,...s},this._client))}retrieve(e,s){return this._client.get(Wo`/files/${e}`,s)}list(e={},s){return this._client.getAPIList("/files",Do,{query:e,...s})}delete(e,s){return this._client.delete(Wo`/files/${e}`,s)}content(e,s){return this._client.get(Wo`/files/${e}/content`,{...s,headers:lm([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:s=5e3,maxWait:t=18e5}={}){const a=new Set(["processed","error","deleted"]),r=Date.now();let n=await this.retrieve(e);for(;!n.status||!a.has(n.status);)if(await Rc(s),n=await this.retrieve(e),Date.now()-r>t)throw new jc({message:`Giving up on waiting for file ${e} to finish processing after ${t} milliseconds.`});return n}};class au extends Bo{}let ru=class extends Bo{run(e,s){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...s})}validate(e,s){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...s})}};class nu extends Bo{constructor(){super(...arguments),this.graders=new ru(this._client)}}nu.Graders=ru;class iu extends Bo{create(e,s,t){return this._client.getAPIList(Wo`/fine_tuning/checkpoints/${e}/permissions`,Io,{body:s,method:"post",...t})}retrieve(e,s={},t){return this._client.getAPIList(Wo`/fine_tuning/checkpoints/${e}/permissions`,Do,{query:s,...t})}delete(e,s,t){const{fine_tuned_model_checkpoint:a}=s;return this._client.delete(Wo`/fine_tuning/checkpoints/${a}/permissions/${e}`,t)}}let lu=class extends Bo{constructor(){super(...arguments),this.permissions=new iu(this._client)}};lu.Permissions=iu;class cu extends Bo{list(e,s={},t){return this._client.getAPIList(Wo`/fine_tuning/jobs/${e}/checkpoints`,Do,{query:s,...t})}}class ou extends Bo{constructor(){super(...arguments),this.checkpoints=new cu(this._client)}create(e,s){return this._client.post("/fine_tuning/jobs",{body:e,...s})}retrieve(e,s){return this._client.get(Wo`/fine_tuning/jobs/${e}`,s)}list(e={},s){return this._client.getAPIList("/fine_tuning/jobs",Do,{query:e,...s})}cancel(e,s){return this._client.post(Wo`/fine_tuning/jobs/${e}/cancel`,s)}listEvents(e,s={},t){return this._client.getAPIList(Wo`/fine_tuning/jobs/${e}/events`,Do,{query:s,...t})}pause(e,s){return this._client.post(Wo`/fine_tuning/jobs/${e}/pause`,s)}resume(e,s){return this._client.post(Wo`/fine_tuning/jobs/${e}/resume`,s)}}ou.Checkpoints=cu;class du extends Bo{constructor(){super(...arguments),this.methods=new au(this._client),this.jobs=new ou(this._client),this.checkpoints=new lu(this._client),this.alpha=new nu(this._client)}}du.Methods=au,du.Jobs=ou,du.Checkpoints=lu,du.Alpha=nu;class mu extends Bo{}class uu extends Bo{constructor(){super(...arguments),this.graderModels=new mu(this._client)}}uu.GraderModels=mu;class hu extends Bo{createVariation(e,s){return this._client.post("/images/variations",$o({body:e,...s},this._client))}edit(e,s){return this._client.post("/images/edits",$o({body:e,...s},this._client))}generate(e,s){return this._client.post("/images/generations",{body:e,...s})}}class xu extends Bo{retrieve(e,s){return this._client.get(Wo`/models/${e}`,s)}list(e){return this._client.getAPIList("/models",Io,e)}delete(e,s){return this._client.delete(Wo`/models/${e}`,s)}}class pu extends Bo{create(e,s){return this._client.post("/moderations",{body:e,...s})}}function gu(e,s){return s&&function(e){if(yd(e.text?.format))return!0;return!1}(s)?fu(e,s):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}function fu(e,s){const t=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:ju(s,e)};if("message"===e.type){const t=e.content.map(e=>"output_text"===e.type?{...e,parsed:yu(s,e.text)}:e);return{...e,content:t}}return e}),a=Object.assign({},e,{output:t});return Object.getOwnPropertyDescriptor(e,"output_text")||wu(a),Object.defineProperty(a,"output_parsed",{enumerable:!0,get(){for(const e of a.output)if("message"===e.type)for(const s of e.content)if("output_text"===s.type&&null!==s.parsed)return s.parsed;return null}}),a}function yu(e,s){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const t=e.text?.format;return t.$parseRaw(s)}return JSON.parse(s)}function ju(e,s){const t=(a=e.tools??[],r=s.name,a.find(e=>"function"===e.type&&e.name===r));var a,r,n;return{...s,...s,parsed_arguments:(n=t,"auto-parseable-tool"===n?.$brand?t.$parseRaw(s.arguments):t?.strict?JSON.parse(s.arguments):null)}}function wu(e){const s=[];for(const t of e.output)if("message"===t.type)for(const e of t.content)"output_text"===e.type&&s.push(e.text);e.output_text=s.join("")}var bu,vu,Nu,_u,Su,ku,Au,Cu;class Eu extends fd{constructor(e){super(),bu.add(this),vu.set(this,void 0),Nu.set(this,void 0),_u.set(this,void 0),dc(this,vu,e)}static createResponse(e,s,t){const a=new Eu(s);return a._run(()=>a._createOrRetrieveResponse(e,s,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createOrRetrieveResponse(e,s,t){const a=t?.signal;let r;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),mc(this,bu,"m",Su).call(this);let n=null;"response_id"in s?(r=await e.responses.retrieve(s.response_id,{stream:!0},{...t,signal:this.controller.signal,stream:!0}),n=s.starting_after??null):r=await e.responses.create({...s,stream:!0},{...t,signal:this.controller.signal}),this._connected();for await(const i of r)mc(this,bu,"m",ku).call(this,i,n);if(r.controller.signal?.aborted)throw new fc;return mc(this,bu,"m",Au).call(this)}[(vu=new WeakMap,Nu=new WeakMap,_u=new WeakMap,bu=new WeakSet,Su=function(){this.ended||dc(this,Nu,void 0)},ku=function(e,s){if(this.ended)return;const t=(e,t)=>{(null==s||t.sequence_number>s)&&this._emit(e,t)},a=mc(this,bu,"m",Cu).call(this,e);switch(t("event",e),e.type){case"response.output_text.delta":{const s=a.output[e.output_index];if(!s)throw new pc(`missing output at index ${e.output_index}`);if("message"===s.type){const a=s.content[e.content_index];if(!a)throw new pc(`missing content at index ${e.content_index}`);if("output_text"!==a.type)throw new pc(`expected content to be 'output_text', got ${a.type}`);t("response.output_text.delta",{...e,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const s=a.output[e.output_index];if(!s)throw new pc(`missing output at index ${e.output_index}`);"function_call"===s.type&&t("response.function_call_arguments.delta",{...e,snapshot:s.arguments});break}default:t(e.type,e)}},Au=function(){if(this.ended)throw new pc("stream has ended, this shouldn't happen");const e=mc(this,Nu,"f");if(!e)throw new pc("request ended without sending any events");dc(this,Nu,void 0);const s=function(e,s){return gu(e,s)}(e,mc(this,vu,"f"));return dc(this,_u,s),s},Cu=function(e){let s=mc(this,Nu,"f");if(!s){if("response.created"!==e.type)throw new pc(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return s=dc(this,Nu,e.response),s}switch(e.type){case"response.output_item.added":s.output.push(e.item);break;case"response.content_part.added":{const t=s.output[e.output_index];if(!t)throw new pc(`missing output at index ${e.output_index}`);"message"===t.type&&t.content.push(e.part);break}case"response.output_text.delta":{const t=s.output[e.output_index];if(!t)throw new pc(`missing output at index ${e.output_index}`);if("message"===t.type){const s=t.content[e.content_index];if(!s)throw new pc(`missing content at index ${e.content_index}`);if("output_text"!==s.type)throw new pc(`expected content to be 'output_text', got ${s.type}`);s.text+=e.delta}break}case"response.function_call_arguments.delta":{const t=s.output[e.output_index];if(!t)throw new pc(`missing output at index ${e.output_index}`);"function_call"===t.type&&(t.arguments+=e.delta);break}case"response.completed":dc(this,Nu,e.response)}return s},Symbol.asyncIterator)](){const e=[],s=[];let t=!1;return this.on("event",t=>{const a=s.shift();a?a.resolve(t):e.push(t)}),this.on("end",()=>{t=!0;for(const e of s)e.resolve(void 0);s.length=0}),this.on("abort",e=>{t=!0;for(const t of s)t.reject(e);s.length=0}),this.on("error",e=>{t=!0;for(const t of s)t.reject(e);s.length=0}),{next:async()=>{if(!e.length)return t?{value:void 0,done:!0}:new Promise((e,t)=>s.push({resolve:e,reject:t})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=mc(this,_u,"f");if(!e)throw new pc("stream ended without producing a ChatCompletion");return e}}class Tu extends Bo{list(e,s={},t){return this._client.getAPIList(Wo`/responses/${e}/input_items`,Do,{query:s,...t})}}class Iu extends Bo{constructor(){super(...arguments),this.inputItems=new Tu(this._client)}create(e,s){return this._client.post("/responses",{body:e,...s,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&wu(e),e))}retrieve(e,s={},t){return this._client.get(Wo`/responses/${e}`,{query:s,...t,stream:s?.stream??!1})}delete(e,s){return this._client.delete(Wo`/responses/${e}`,{...s,headers:lm([{Accept:"*/*"},s?.headers])})}parse(e,s){return this._client.responses.create(e,s)._thenUnwrap(s=>fu(s,e))}stream(e,s){return Eu.createResponse(this._client,e,s)}cancel(e,s){return this._client.post(Wo`/responses/${e}/cancel`,s)}}Iu.InputItems=Tu;class Du extends Bo{create(e,s,t){return this._client.post(Wo`/uploads/${e}/parts`,$o({body:s,...t},this._client))}}class Pu extends Bo{constructor(){super(...arguments),this.parts=new Du(this._client)}create(e,s){return this._client.post("/uploads",{body:e,...s})}cancel(e,s){return this._client.post(Wo`/uploads/${e}/cancel`,s)}complete(e,s,t){return this._client.post(Wo`/uploads/${e}/complete`,{body:s,...t})}}Pu.Parts=Du;class Ru extends Bo{create(e,s,t){return this._client.post(Wo`/vector_stores/${e}/file_batches`,{body:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,s,t){const{vector_store_id:a}=s;return this._client.get(Wo`/vector_stores/${a}/file_batches/${e}`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}cancel(e,s,t){const{vector_store_id:a}=s;return this._client.post(Wo`/vector_stores/${a}/file_batches/${e}/cancel`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async createAndPoll(e,s,t){const a=await this.create(e,s);return await this.poll(e,a.id,t)}listFiles(e,s,t){const{vector_store_id:a,...r}=s;return this._client.getAPIList(Wo`/vector_stores/${a}/file_batches/${e}/files`,Do,{query:r,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async poll(e,s,t){const a=lm([t?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":t?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:r,response:n}=await this.retrieve(s,{vector_store_id:e},{...t,headers:a}).withResponse();switch(r.status){case"in_progress":let e=5e3;if(t?.pollIntervalMs)e=t.pollIntervalMs;else{const s=n.headers.get("openai-poll-after-ms");if(s){const t=parseInt(s);isNaN(t)||(e=t)}}await Rc(e);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:s,fileIds:t=[]},a){if(null==s||0==s.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=a?.maxConcurrency??5,n=Math.min(r,s.length),i=this._client,l=s.values(),c=[...t];const o=Array(n).fill(l).map(async function(e){for(let s of e){const e=await i.files.create({file:s,purpose:"assistants"},a);c.push(e.id)}});return await(async e=>{const s=await Promise.allSettled(e),t=s.filter(e=>"rejected"===e.status);if(t.length){for(const e of t);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const a=[];for(const r of s)"fulfilled"===r.status&&a.push(r.value);return a})(o),await this.createAndPoll(e,{file_ids:c})}}class Fu extends Bo{create(e,s,t){return this._client.post(Wo`/vector_stores/${e}/files`,{body:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,s,t){const{vector_store_id:a}=s;return this._client.get(Wo`/vector_stores/${a}/files/${e}`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,s,t){const{vector_store_id:a,...r}=s;return this._client.post(Wo`/vector_stores/${a}/files/${e}`,{body:r,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,s={},t){return this._client.getAPIList(Wo`/vector_stores/${e}/files`,Do,{query:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,s,t){const{vector_store_id:a}=s;return this._client.delete(Wo`/vector_stores/${a}/files/${e}`,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async createAndPoll(e,s,t){const a=await this.create(e,s,t);return await this.poll(e,a.id,t)}async poll(e,s,t){const a=lm([t?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":t?.pollIntervalMs?.toString()??void 0}]);for(;;){const r=await this.retrieve(s,{vector_store_id:e},{...t,headers:a}).withResponse(),n=r.data;switch(n.status){case"in_progress":let e=5e3;if(t?.pollIntervalMs)e=t.pollIntervalMs;else{const s=r.response.headers.get("openai-poll-after-ms");if(s){const t=parseInt(s);isNaN(t)||(e=t)}}await Rc(e);break;case"failed":case"completed":return n}}}async upload(e,s,t){const a=await this._client.files.create({file:s,purpose:"assistants"},t);return this.create(e,{file_id:a.id},t)}async uploadAndPoll(e,s,t){const a=await this.upload(e,s,t);return await this.poll(e,a.id,t)}content(e,s,t){const{vector_store_id:a}=s;return this._client.getAPIList(Wo`/vector_stores/${a}/files/${e}/content`,Io,{...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class Lu extends Bo{constructor(){super(...arguments),this.files=new Fu(this._client),this.fileBatches=new Ru(this._client)}create(e,s){return this._client.post("/vector_stores",{body:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,s){return this._client.get(Wo`/vector_stores/${e}`,{...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,s,t){return this._client.post(Wo`/vector_stores/${e}`,{body:s,...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e={},s){return this._client.getAPIList("/vector_stores",Do,{query:e,...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,s){return this._client.delete(Wo`/vector_stores/${e}`,{...s,headers:lm([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}search(e,s,t){return this._client.getAPIList(Wo`/vector_stores/${e}/search`,Io,{body:s,method:"post",...t,headers:lm([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}var $u,Uu,qu,Ou;Lu.Files=Fu,Lu.FileBatches=Ru;class zu{constructor({baseURL:e=wm("OPENAI_BASE_URL"),apiKey:s=wm("OPENAI_API_KEY"),organization:t=wm("OPENAI_ORG_ID")??null,project:a=wm("OPENAI_PROJECT_ID")??null,...r}={}){if($u.add(this),qu.set(this,void 0),this.completions=new Ym(this),this.chat=new rm(this),this.embeddings=new Xm(this),this.files=new tu(this),this.images=new hu(this),this.audio=new mm(this),this.moderations=new pu(this),this.models=new xu(this),this.fineTuning=new du(this),this.graders=new uu(this),this.vectorStores=new Lu(this),this.beta=new Hm(this),this.batches=new um(this),this.uploads=new Pu(this),this.responses=new Iu(this),this.evals=new su(this),this.containers=new Km(this),void 0===s)throw new pc("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const n={apiKey:s,organization:t,project:a,...r,baseURL:e||"https://api.openai.com/v1"};if(!n.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new pc("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=n.baseURL,this.timeout=n.timeout??Uu.DEFAULT_TIMEOUT,this.logger=n.logger??console;const i="warn";this.logLevel=i,this.logLevel=fo(n.logLevel,"ClientOptions.logLevel",this)??fo(wm("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??i,this.fetchOptions=n.fetchOptions,this.maxRetries=n.maxRetries??2,this.fetch=n.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),dc(this,qu,Bc),this._options=n,this.apiKey=s,this.organization=t,this.project=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:s}){}authHeaders(e){return lm([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return ao(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Fc}`}defaultIdempotencyKey(){return`stainless-node-retry-${uc()}`}makeStatusError(e,s,t,a){return gc.generate(e,s,t,a)}buildURL(e,s,t){const a=!mc(this,$u,"m",Ou).call(this)&&t||this.baseURL,r=(e=>Tc.test(e))(e)?new URL(e):new URL(a+(a.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return function(e){if(!e)return!0;for(const s in e)return!1;return!0}(n)||(s={...n,...s}),"object"==typeof s&&s&&!Array.isArray(s)&&(r.search=this.stringifyQuery(s)),r.toString()}async prepareOptions(e){}async prepareRequest(e,{url:s,options:t}){}get(e,s){return this.methodRequest("get",e,s)}post(e,s){return this.methodRequest("post",e,s)}patch(e,s){return this.methodRequest("patch",e,s)}put(e,s){return this.methodRequest("put",e,s)}delete(e,s){return this.methodRequest("delete",e,s)}methodRequest(e,s,t){return this.request(Promise.resolve(t).then(t=>({method:e,path:s,...t})))}request(e,s=null){return new Co(this,this.makeRequest(e,s,void 0))}async makeRequest(e,s,t){const a=await e,r=a.maxRetries??this.maxRetries;null==s&&(s=r),await this.prepareOptions(a);const{req:n,url:i,timeout:l}=this.buildRequest(a,{retryCount:r-s});await this.prepareRequest(n,{url:i,options:a});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),o=void 0===t?"":`, retryOf: ${t}`,d=Date.now();if(vo(this).debug(`[${c}] sending request`,No({retryOfRequestLogID:t,method:a.method,url:i,options:a,headers:n.headers})),a.signal?.aborted)throw new fc;const m=new AbortController,u=await this.fetchWithTimeout(i,n,l,m).catch(xc),h=Date.now();if(u instanceof Error){const e=`retrying, ${s} attempts remaining`;if(a.signal?.aborted)throw new fc;const r=hc(u)||/timed? ?out/i.test(String(u)+("cause"in u?String(u.cause):""));if(s)return vo(this).info(`[${c}] connection ${r?"timed out":"failed"} - ${e}`),vo(this).debug(`[${c}] connection ${r?"timed out":"failed"} (${e})`,No({retryOfRequestLogID:t,url:i,durationMs:h-d,message:u.message})),this.retryRequest(a,s,t??c);if(vo(this).info(`[${c}] connection ${r?"timed out":"failed"} - error; no more retries left`),vo(this).debug(`[${c}] connection ${r?"timed out":"failed"} (error; no more retries left)`,No({retryOfRequestLogID:t,url:i,durationMs:h-d,message:u.message})),r)throw new jc;throw new yc({cause:u})}const x=`[${c}${o}${[...u.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,s])=>", "+e+": "+JSON.stringify(s)).join("")}] ${n.method} ${i} ${u.ok?"succeeded":"failed"} with status ${u.status} in ${h-d}ms`;if(!u.ok){const e=this.shouldRetry(u);if(s&&e){const e=`retrying, ${s} attempts remaining`;return await async function(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(await(e[Symbol.asyncIterator]().return?.()));const s=e.getReader(),t=s.cancel();s.releaseLock(),await t}(u.body),vo(this).info(`${x} - ${e}`),vo(this).debug(`[${c}] response error (${e})`,No({retryOfRequestLogID:t,url:u.url,status:u.status,headers:u.headers,durationMs:h-d})),this.retryRequest(a,s,t??c,u.headers)}const r=e?"error; no more retries left":"error; not retryable";vo(this).info(`${x} - ${r}`);const n=await u.text().catch(e=>xc(e).message),i=(e=>{try{return JSON.parse(e)}catch(s){return}})(n),l=i?void 0:n;vo(this).debug(`[${c}] response error (${r})`,No({retryOfRequestLogID:t,url:u.url,status:u.status,headers:u.headers,message:l,durationMs:Date.now()-d}));throw this.makeStatusError(u.status,i,l,u.headers)}return vo(this).info(x),vo(this).debug(`[${c}] response start`,No({retryOfRequestLogID:t,url:u.url,status:u.status,headers:u.headers,durationMs:h-d})),{response:u,options:a,controller:m,requestLogID:c,retryOfRequestLogID:t,startTime:d}}getAPIList(e,s,t){return this.requestAPIList(s,{method:"get",path:e,...t})}requestAPIList(e,s){const t=this.makeRequest(s,null,void 0);return new To(this,t,e)}async fetchWithTimeout(e,s,t,a){const{signal:r,method:n,...i}=s||{};r&&r.addEventListener("abort",()=>a.abort());const l=setTimeout(()=>a.abort(),t),c=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,o={signal:a.signal,...c?{duplex:"half"}:{},method:"GET",...i};n&&(o.method=n.toUpperCase());try{return await this.fetch.call(void 0,e,o)}finally{clearTimeout(l)}}shouldRetry(e){const s=e.headers.get("x-should-retry");return"true"===s||"false"!==s&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,s,t,a){let r;const n=a?.get("retry-after-ms");if(n){const e=parseFloat(n);Number.isNaN(e)||(r=e)}const i=a?.get("retry-after");if(i&&!r){const e=parseFloat(i);r=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const t=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(s,t)}return await Rc(r),this.makeRequest(e,s-1,t)}calculateDefaultRetryTimeoutMillis(e,s){const t=s-e;return Math.min(.5*Math.pow(2,t),8)*(1-.25*Math.random())*1e3}buildRequest(e,{retryCount:s=0}={}){const t={...e},{method:a,path:r,query:n,defaultBaseURL:i}=t,l=this.buildURL(r,n,i);"timeout"in t&&((e,s)=>{if("number"!=typeof s||!Number.isInteger(s))throw new pc(`${e} must be an integer`);if(s<0)throw new pc(`${e} must be a positive integer`)})("timeout",t.timeout),t.timeout=t.timeout??this.timeout;const{bodyHeaders:c,body:o}=this.buildBody({options:t});return{req:{method:a,headers:this.buildHeaders({options:e,method:a,bodyHeaders:c,retryCount:s}),...t.signal&&{signal:t.signal},...globalThis.ReadableStream&&o instanceof globalThis.ReadableStream&&{duplex:"half"},...o&&{body:o},...this.fetchOptions??{},...t.fetchOptions??{}},url:l,timeout:t.timeout}}buildHeaders({options:e,method:s,bodyHeaders:t,retryCount:a}){let r={};this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const n=lm([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...qc??(qc=Lc()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,t,e.headers]);return this.validateHeaders(n),n.values}buildBody({options:{body:e,headers:s}}){if(!e)return{bodyHeaders:void 0,body:void 0};const t=lm([s]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&t.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:zc(e)}:mc(this,qu,"f").call(this,{body:e,headers:t})}}Uu=zu,qu=new WeakMap,$u=new WeakSet,Ou=function(){return"https://api.openai.com/v1"!==this.baseURL},zu.OpenAI=Uu,zu.DEFAULT_TIMEOUT=6e5,zu.OpenAIError=pc,zu.APIError=gc,zu.APIConnectionError=yc,zu.APIConnectionTimeoutError=jc,zu.APIUserAbortError=fc,zu.NotFoundError=Nc,zu.ConflictError=_c,zu.RateLimitError=kc,zu.BadRequestError=wc,zu.AuthenticationError=bc,zu.InternalServerError=Ac,zu.PermissionDeniedError=vc,zu.UnprocessableEntityError=Sc,zu.toFile=async function(e,s,t){if(Po(),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&zo(e))(e=await e))return e instanceof File?e:Ro([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const a=await e.blob();return s||(s=new URL(e.url).pathname.split(/[\\/]/).pop()),Ro(await Mo(a),s,t)}const a=await Mo(e);if(s||(s=Fo(e)),!t?.type){const e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(t={...t,type:e})}return Ro(a,s,t)},zu.Completions=Ym,zu.Chat=rm,zu.Embeddings=Xm,zu.Files=tu,zu.Images=hu,zu.Audio=mm,zu.Moderations=pu,zu.Models=xu,zu.FineTuning=du,zu.Graders=uu,zu.VectorStores=Lu,zu.Beta=Hm,zu.Batches=um,zu.Uploads=Pu,zu.Responses=Iu,zu.Evals=su,zu.Containers=Km;const Mu=new zu({apiKey:Tr.openai.apiKey,dangerouslyAllowBrowser:!0});async function Bu(e){if(!Tr.openai.apiKey)throw new Error("OpenAI API key not configured");const s=`\n    Analyze this legal document and provide a structured analysis in JSON format:\n    \n    1. Executive summary (2-3 sentences)\n    2. Key entities (people, organizations, dates, amounts)\n    3. Document classification (contract, agreement, legal notice, etc.)\n    4. Legal implications (potential risks, obligations, rights)\n    5. Recommended actions (what the reader should do)\n    6. Confidence score (0-1, how confident you are in this analysis)\n    \n    Document text:\n    ${e.substring(0,8e3)} ${e.length>8e3?"...":""}\n    \n    Respond with valid JSON only, no additional text.\n  `;try{const e=await Mu.chat.completions.create({model:Tr.openai.model,messages:[{role:"system",content:"You are a legal AI assistant specializing in Singapore law. Provide accurate, helpful analysis of legal documents."},{role:"user",content:s}],max_tokens:Tr.openai.maxTokens,temperature:Tr.openai.temperature}),t=e.choices[0]?.message?.content;if(!t)throw new Error("No response from OpenAI");const a=JSON.parse(t);return{summary:a.summary||"",keyEntities:a.keyEntities||[],documentType:a.documentType||"Unknown",legalImplications:a.legalImplications||[],recommendedActions:a.recommendedActions||[],confidence:a.confidence||.5}}catch(t){throw new Error("Failed to analyze document")}}async function Vu(e){if(!Tr.openai.apiKey)throw new Error("OpenAI API key not configured");try{const s=await Mu.embeddings.create({model:"text-embedding-3-small",input:e.substring(0,8e3)});return{embedding:s.data[0].embedding,usage:s.usage}}catch(s){throw new Error("Failed to generate embedding")}}async function Wu(e,s=[],t=[]){if(!Tr.openai.apiKey)throw new Error("OpenAI API key not configured");const a=[{role:"system",content:"You are a legal AI assistant specializing in Singapore law. \n    Provide helpful, accurate legal information while being clear that this is not legal advice.\n    Always recommend consulting with a qualified lawyer for specific legal matters.\n    If you reference information from the user's documents, mention that clearly."},...t,{role:"user",content:`${e}${s.length>0?`\n\nRelevant context from your documents:\n${s.join("\n\n")}`:""}`}];try{const e=await Mu.chat.completions.create({model:Tr.openai.model,messages:a,max_tokens:Tr.openai.maxTokens,temperature:.2}),t=e.choices[0]?.message?.content;if(!t)throw new Error("No response from OpenAI");return{message:t,sources:s.length>0?["Your uploaded documents"]:[],confidence:.8}}catch(r){throw new Error("Failed to get AI response")}}async function Gu(e,s=500){if(!Tr.openai.apiKey)throw new Error("OpenAI API key not configured");const t=`\n    Provide a concise summary of this legal document in approximately ${s} characters.\n    Focus on the key points, parties involved, main obligations, and important dates.\n    \n    Document text:\n    ${e.substring(0,8e3)} ${e.length>8e3?"...":""}\n  `;try{const e=await Mu.chat.completions.create({model:Tr.openai.model,messages:[{role:"system",content:"You are a legal AI assistant. Provide clear, concise summaries of legal documents."},{role:"user",content:t}],max_tokens:Math.min(Tr.openai.maxTokens,1e3),temperature:Tr.openai.temperature});return e.choices[0]?.message?.content||"Unable to generate summary"}catch(a){throw new Error("Failed to summarize document")}}async function Hu(e){if(!Tr.openai.apiKey)throw new Error("OpenAI API key not configured");const s=`\n    Extract key entities from this legal document and return them in JSON format:\n    \n    {\n      "people": ["names of people"],\n      "organizations": ["company names, law firms, etc."],\n      "dates": ["important dates"],\n      "amounts": ["monetary amounts, percentages"],\n      "locations": ["addresses, jurisdictions"]\n    }\n    \n    Document text:\n    ${e.substring(0,8e3)} ${e.length>8e3?"...":""}\n    \n    Respond with valid JSON only.\n  `;try{const e=await Mu.chat.completions.create({model:Tr.openai.model,messages:[{role:"system",content:"You are a legal AI assistant. Extract entities accurately from legal documents."},{role:"user",content:s}],max_tokens:1e3,temperature:.1}),t=e.choices[0]?.message?.content;if(!t)throw new Error("No response from OpenAI");const a=JSON.parse(t);return{people:a.people||[],organizations:a.organizations||[],dates:a.dates||[],amounts:a.amounts||[],locations:a.locations||[]}}catch(t){return{people:[],organizations:[],dates:[],amounts:[],locations:[]}}}export{Fn as $,yn as A,fr as B,zr as C,Ki as D,wn as E,Rr as F,jn as G,Nn as H,yr as I,Dr as J,_n as K,on as L,dn as M,Ai as N,Pr as O,xl as P,Gu as Q,Hu as R,ii as S,sr as T,al as U,rl as V,nl as W,ll as X,Pn as Y,Rn as Z,Bt as _,Xi as a,Un as a0,Sn as a1,Ei as a2,Xt as a3,xn as a4,tl as a5,bi as a6,mn as a7,Ii as a8,Gn as a9,Wu as aa,ul as ab,$l as ac,Ll as ad,Lr as ae,ci as af,pi as ag,Hl as ah,Yl as ai,sl as aj,kn as ak,Ti as al,Zi as b,Wa as c,el as d,tr as e,ar as f,lr as g,Yr as h,rr as i,cl as j,li as k,mi as l,ui as m,xi as n,Wr as o,an as p,En as q,Tn as r,In as s,Dn as t,Mr as u,Br as v,Bu as w,Vu as x,hr as y,Vr as z};
