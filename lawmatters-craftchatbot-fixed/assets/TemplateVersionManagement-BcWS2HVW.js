import{r as e,j as s,aB as a,b$ as r,bC as n,Z as i,W as l,bO as t,b_ as c,F as d,cr as m,p as x,q as o,aE as h,U as j,cs as u,ct as g,aH as p,u as v,b5 as N,aI as f,aU as y,bY as b}from"./react-vendor-SE0pM8Ra.js";import{y as w,k as C,af as V,B as S,l as k,m as T,n as B,ag as D,a0 as F,A as I,E as M,G as P,H as O,K as $,L as A,M as J,I as E,p as z,a1 as G,C as Y,u as q,v as H,z as L,o as R,ah as U,h as K,j as W,S as Z,ac as _,ad as Q,ae as X,q as ee,r as se,s as ae,t as re,ai as ne}from"./ai-services-C7T4cFUa.js";import"./supabase-Cfql4b7O.js";import{J as ie}from"./vendor-CrSvAuNw.js";import"./TemplateGenerator-XiJTXv2a.js";import{f as le}from"./utilities-CJeqyZZO.js";import"./ui-components-ByoYm48K.js";import"./data-fetching-De8LKKym.js";import"./ocr-worker-Ehk6BbiK.js";import"./pdf-worker-CdhgQTyu.js";import"./forms-Mu2Tem6y.js";const te=({templateId:m,currentTitle:x,currentDescription:o,currentContent:h,currentFields:j,onVersionCreated:u,className:g=""})=>{const{user:p}=w(),[v,N]=e.useState(!1),[f,y]=e.useState(!1),[b,K]=e.useState({title:x,description:o||"",content:h,fields:j,changeSummary:"",changeDetails:"",breakingChanges:!1,versionType:"minor"}),W=e=>({major:{icon:s.jsx(c,{className:"h-4 w-4 text-red-500"}),label:"Major Version",description:"Breaking changes, new features, or significant updates",example:"1.0.0 → 2.0.0"},minor:{icon:s.jsx(r,{className:"h-4 w-4 text-blue-500"}),label:"Minor Version",description:"New features or improvements without breaking changes",example:"1.0.0 → 1.1.0"},patch:{icon:s.jsx(d,{className:"h-4 w-4 text-green-500"}),label:"Patch Version",description:"Bug fixes, small improvements, or corrections",example:"1.0.0 → 1.0.1"}}[e]);return s.jsx("div",{className:g,children:s.jsxs(C,{open:v,onOpenChange:N,children:[s.jsx(V,{asChild:!0,children:s.jsxs(S,{className:"flex items-center gap-2",children:[s.jsx(a,{className:"h-4 w-4"}),"Create New Version"]})}),s.jsxs(k,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(T,{children:[s.jsxs(B,{className:"flex items-center gap-2",children:[s.jsx(r,{className:"h-5 w-5"}),"Create New Template Version"]}),s.jsx(D,{children:"Create a new version of this template with your changes and improvements."})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),p)if(b.changeSummary.trim())try{y(!0);const e={templateId:m,title:b.title,description:b.description||void 0,content:b.content,fields:b.fields,changeSummary:b.changeSummary,changeDetails:b.changeDetails?{notes:b.changeDetails}:void 0,breakingChanges:b.breakingChanges,versionType:b.versionType},s=await U.createVersion(e,p.id);ie.success("New template version created successfully!"),N(!1),u?.(s),K({title:x,description:o||"",content:h,fields:j,changeSummary:"",changeDetails:"",breakingChanges:!1,versionType:"minor"})}catch(s){ie.error("Failed to create version: "+s.message)}finally{y(!1)}else ie.error("Please provide a change summary");else ie.error("Please log in to create a new version")},className:"space-y-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx(F,{className:"text-base font-medium",children:"Version Type"}),s.jsxs(I,{value:b.versionType,onValueChange:e=>K(s=>({...s,versionType:e})),children:[s.jsx(M,{children:s.jsx(P,{placeholder:"Select version type"})}),s.jsx(O,{children:["major","minor","patch"].map(e=>{const a=W(e);return s.jsx($,{value:e,children:s.jsxs("div",{className:"flex items-center gap-2",children:[a.icon,s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:a.label}),s.jsx("div",{className:"text-xs text-gray-500",children:a.example})]})]})},e)})})]}),b.versionType&&s.jsxs(A,{children:[s.jsx(n,{className:"h-4 w-4"}),s.jsx(J,{children:W(b.versionType).description})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(F,{htmlFor:"changeSummary",className:"text-base font-medium",children:"Change Summary *"}),s.jsx(E,{id:"changeSummary",value:b.changeSummary,onChange:e=>K(s=>({...s,changeSummary:e.target.value})),placeholder:"Brief description of what changed in this version",required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(F,{htmlFor:"changeDetails",className:"text-base font-medium",children:"Detailed Changes (Optional)"}),s.jsx(z,{id:"changeDetails",value:b.changeDetails,onChange:e=>K(s=>({...s,changeDetails:e.target.value})),placeholder:"Detailed description of changes, new features, bug fixes, etc.",rows:4})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(G,{id:"breakingChanges",checked:b.breakingChanges,onCheckedChange:e=>K(s=>({...s,breakingChanges:e}))}),s.jsxs(F,{htmlFor:"breakingChanges",className:"flex items-center gap-2",children:[s.jsx(i,{className:"h-4 w-4 text-red-500"}),"This version contains breaking changes"]})]}),b.breakingChanges&&s.jsxs(A,{children:[s.jsx(l,{className:"h-4 w-4"}),s.jsx(J,{children:"Breaking changes may affect existing customizations or integrations. Make sure to document migration steps in the detailed changes."})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(F,{className:"text-base font-medium",children:"Template Content"}),s.jsxs(Y,{children:[s.jsxs(q,{className:"pb-3",children:[s.jsx(H,{className:"text-sm",children:b.title}),b.description&&s.jsx(L,{className:"text-xs",children:b.description})]}),s.jsxs(R,{className:"pt-0",children:[s.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 p-3 rounded border max-h-32 overflow-y-auto",children:[b.content.substring(0,200),b.content.length>200&&"..."]}),b.fields.length>0&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-1",children:["Fields: ",b.fields.length]}),s.jsxs("div",{className:"flex flex-wrap gap-1",children:[b.fields.slice(0,5).map((e,a)=>s.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:e.label||e.name||`Field ${a+1}`},a)),b.fields.length>5&&s.jsxs("span",{className:"text-xs text-gray-500",children:["+",b.fields.length-5," more"]})]})]})]})]})]}),s.jsxs("div",{className:"flex gap-3 pt-4",children:[s.jsxs(S,{type:"submit",disabled:f||!b.changeSummary.trim(),className:"flex-1",children:[s.jsx(t,{className:"h-4 w-4 mr-2"}),f?"Creating Version...":"Create Version"]}),s.jsx(S,{type:"button",variant:"outline",onClick:()=>N(!1),className:"flex-1",children:"Cancel"})]})]})]})]})})},ce=({templateId:r,version1Id:i,version2Id:t,onVersionSelect:c,className:p=""})=>{const[v,N]=e.useState([]),[f,y]=e.useState(i||""),[b,w]=e.useState(t||""),[C,V]=e.useState(null),[S,k]=e.useState(!1);e.useEffect(()=>{T()},[r]),e.useEffect(()=>{f&&b&&f!==b&&B()},[f,b]);const T=async()=>{try{const e=await U.getTemplateVersions(r);N(e),!i&&!t&&e.length>=2&&(y(e[0].id),w(e[1].id))}catch(e){ie.error("Failed to load versions")}},B=async()=>{try{k(!0);const e=await U.compareVersions(f,b);V(e)}catch(e){ie.error("Failed to compare versions")}finally{k(!1)}},D=e=>{switch(e){case"added":return s.jsx(a,{className:"h-4 w-4 text-green-500"});case"removed":return s.jsx(g,{className:"h-4 w-4 text-red-500"});case"modified":return s.jsx(u,{className:"h-4 w-4 text-blue-500"});default:return s.jsx(d,{className:"h-4 w-4 text-gray-500"})}},F=e=>{const a={added:{variant:"default",label:"Added",className:"bg-green-100 text-green-800"},removed:{variant:"destructive",label:"Removed",className:"bg-red-100 text-red-800"},modified:{variant:"secondary",label:"Modified",className:"bg-blue-100 text-blue-800"}}[e];return s.jsx(K,{variant:a.variant,className:a.className,children:a.label})},E=(e,a)=>s.jsxs(Y,{children:[s.jsxs(q,{className:"pb-3",children:[s.jsxs(H,{className:"text-lg flex items-center justify-between",children:[a,s.jsxs(K,{variant:e.isCurrent?"default":"secondary",children:["v",e.versionNumber]})]}),s.jsx(L,{children:e.changeSummary||"No change summary available"})]}),s.jsxs(R,{className:"space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-600",children:"Status:"}),s.jsx(K,{variant:"outline",className:"ml-2",children:e.status})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-600",children:"Breaking:"}),e.breakingChanges?s.jsxs(K,{variant:"destructive",className:"ml-2",children:[s.jsx(l,{className:"h-3 w-3 mr-1"}),"Yes"]}):s.jsxs(K,{variant:"secondary",className:"ml-2",children:[s.jsx(o,{className:"h-3 w-3 mr-1"}),"No"]})]})]}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[s.jsx(h,{className:"h-4 w-4"}),le(e.createdAt,{addSuffix:!0})]}),s.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[s.jsx(j,{className:"h-4 w-4"}),e.createdBy]})]}),s.jsx(Z,{}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-sm mb-2",children:"Content Preview"}),s.jsxs("div",{className:"text-xs bg-gray-50 p-3 rounded border max-h-24 overflow-y-auto",children:[e.content.substring(0,150),e.content.length>150&&"..."]})]})]})]});return s.jsxs("div",{className:`space-y-6 ${p}`,children:[s.jsxs(Y,{children:[s.jsxs(q,{children:[s.jsxs(H,{className:"flex items-center gap-2",children:[s.jsx(m,{className:"h-5 w-5"}),"Compare Template Versions"]}),s.jsx(L,{children:"Select two versions to compare their differences"})]}),s.jsxs(R,{children:[s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-center",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Version 1"}),s.jsxs(I,{value:f,onValueChange:y,children:[s.jsx(M,{children:s.jsx(P,{placeholder:"Select first version"})}),s.jsx(O,{children:v.map(e=>s.jsxs($,{value:e.id,children:["v",e.versionNumber," - ",e.changeSummary||"No summary"]},e.id))})]})]}),s.jsx("div",{className:"flex justify-center",children:s.jsx(x,{className:"h-6 w-6 text-gray-400"})}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:"Version 2"}),s.jsxs(I,{value:b,onValueChange:w,children:[s.jsx(M,{children:s.jsx(P,{placeholder:"Select second version"})}),s.jsx(O,{children:v.map(e=>s.jsxs($,{value:e.id,children:["v",e.versionNumber," - ",e.changeSummary||"No summary"]},e.id))})]})]})]}),f&&b&&f===b&&s.jsxs(A,{className:"mt-4",children:[s.jsx(l,{className:"h-4 w-4"}),s.jsx(J,{children:"Please select two different versions to compare."})]})]})]}),C&&s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[E(C.version1,"Version 1"),E(C.version2,"Version 2")]}),C&&s.jsxs(Y,{children:[s.jsxs(q,{children:[s.jsxs(H,{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Differences"}),s.jsxs(K,{variant:"outline",children:[C.differences.length," change",1!==C.differences.length?"s":""]})]}),s.jsxs(L,{children:["Changes between v",C.version1.versionNumber," and v",C.version2.versionNumber]})]}),s.jsx(R,{children:S?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsx(W,{className:"max-h-96",children:C&&C.differences.length?s.jsx("div",{className:"space-y-4",children:C.differences.map((e,a)=>s.jsxs(Y,{children:[s.jsx(q,{className:"pb-3",children:s.jsxs(H,{className:"text-sm flex items-center gap-2",children:[D(e.type),"Field: ",e.field,F(e.type)]})}),s.jsxs(R,{children:["modified"===e.type&&s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("h5",{className:"font-medium text-sm text-red-700 mb-2",children:["Before (v",C.version1.versionNumber,")"]}),s.jsxs("div",{className:"text-xs bg-red-50 border border-red-200 p-3 rounded",children:["string"==typeof e.oldValue?e.oldValue.substring(0,200):JSON.stringify(e.oldValue,null,2).substring(0,200),("string"==typeof e.oldValue?e.oldValue.length:JSON.stringify(e.oldValue).length)>200&&"..."]})]}),s.jsxs("div",{children:[s.jsxs("h5",{className:"font-medium text-sm text-green-700 mb-2",children:["After (v",C.version2.versionNumber,")"]}),s.jsxs("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded",children:["string"==typeof e.newValue?e.newValue.substring(0,200):JSON.stringify(e.newValue,null,2).substring(0,200),("string"==typeof e.newValue?e.newValue.length:JSON.stringify(e.newValue).length)>200&&"..."]})]})]}),"added"===e.type&&s.jsxs("div",{children:[s.jsxs("h5",{className:"font-medium text-sm text-green-700 mb-2",children:["Added in v",C.version2.versionNumber]}),s.jsx("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded",children:"string"==typeof e.newValue?e.newValue:JSON.stringify(e.newValue,null,2)})]}),"removed"===e.type&&s.jsxs("div",{children:[s.jsxs("h5",{className:"font-medium text-sm text-red-700 mb-2",children:["Removed from v",C.version1.versionNumber]}),s.jsx("div",{className:"text-xs bg-red-50 border border-red-200 p-3 rounded",children:"string"==typeof e.oldValue?e.oldValue:JSON.stringify(e.oldValue,null,2)})]})]})]},a))}):s.jsxs(A,{children:[s.jsx(n,{className:"h-4 w-4"}),s.jsx(J,{children:"No differences found between the selected versions."})]})})})]})]})};function de(){const{slug:n}=p(),i=v(),{user:l}=w(),[t,c]=e.useState(null),[d,x]=e.useState(!0),[h,j]=e.useState(null),[g,C]=e.useState("history");e.useEffect(()=>{n&&V(n)},[n]);const V=async e=>{try{x(!0),j(null);const s=await _.getTemplateBySlug(e);if(!s)return void j("Template not found");if(!l||s.createdBy!==l.id)return void j("You do not have permission to manage this template");c(s)}catch(s){j(s.message||"Failed to load template")}finally{x(!1)}};return d?s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[s.jsx(Q,{className:"h-8 w-64"}),s.jsx(Q,{className:"h-32 w-full"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.jsx(Q,{className:"h-64 w-full"}),s.jsx(Q,{className:"h-64 w-full"})]})]})})}):h||!t?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx(Y,{className:"w-full max-w-md",children:s.jsxs(R,{className:"p-8 text-center",children:[s.jsx(N,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Access Denied"}),s.jsx("p",{className:"text-gray-600 mb-6",children:h||"You do not have permission to access this template's version management."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(S,{onClick:()=>i(X.templateBrowser),className:"flex-1",children:"Browse Templates"}),s.jsx(S,{variant:"outline",onClick:()=>i(-1),className:"flex-1",children:"Go Back"})]})]})})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-6",children:[s.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>i(X.templateBrowser),className:"p-0 h-auto",children:[s.jsx(f,{className:"h-4 w-4 mr-1"}),"Templates"]}),s.jsx("span",{children:"/"}),s.jsx(S,{variant:"ghost",size:"sm",onClick:()=>i(`${X.templatePreview}/${n}`),className:"p-0 h-auto",children:t.title}),s.jsx("span",{children:"/"}),s.jsx("span",{className:"text-gray-900",children:"Version Management"})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3",children:[s.jsx(r,{className:"h-8 w-8 text-blue-600"}),"Version Management"]}),s.jsxs("p",{className:"text-lg text-gray-600 mb-4",children:['Manage versions, track changes, and collaborate on "',t.title,'"']}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(K,{variant:"outline",children:["Current: v",t.version]}),s.jsxs(K,{variant:"secondary",children:[t.versionCount," version",1!==t.versionCount?"s":""]})]}),s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[s.jsx(o,{className:"h-4 w-4 text-green-500"}),t.accessLevel," template"]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(S,{variant:"outline",onClick:()=>i(`${X.templatePreview}/${n}`),children:[s.jsx(y,{className:"h-4 w-4 mr-2"}),"View Template"]}),s.jsxs(S,{variant:"outline",onClick:()=>i(`${X.templateCustomize}/${n}`),children:[s.jsx(u,{className:"h-4 w-4 mr-2"}),"Edit Template"]})]})]})}),s.jsxs(ee,{value:g,onValueChange:C,children:[s.jsxs(se,{className:"grid w-full grid-cols-3",children:[s.jsxs(ae,{value:"history",className:"flex items-center gap-2",children:[s.jsx(b,{className:"h-4 w-4"}),"Version History"]}),s.jsxs(ae,{value:"compare",className:"flex items-center gap-2",children:[s.jsx(m,{className:"h-4 w-4"}),"Compare Versions"]}),s.jsxs(ae,{value:"create",className:"flex items-center gap-2",children:[s.jsx(a,{className:"h-4 w-4"}),"Create Version"]})]}),s.jsx(re,{value:"history",className:"mt-6",children:s.jsx(ne,{templateId:t.id,currentVersionId:t.currentVersionId})}),s.jsx(re,{value:"compare",className:"mt-6",children:s.jsx(ce,{templateId:t.id})}),s.jsx(re,{value:"create",className:"mt-6",children:s.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(Y,{children:[s.jsxs(q,{children:[s.jsxs(H,{className:"flex items-center gap-2",children:[s.jsx(a,{className:"h-5 w-5"}),"Create New Version"]}),s.jsx(L,{children:"Create a new version of this template with your changes and improvements."})]}),s.jsx(R,{children:s.jsx(te,{templateId:t.id,currentTitle:t.title,currentDescription:t.description,currentContent:t.content,currentFields:t.fields,onVersionCreated:e=>{ie.success("New version created successfully!"),n&&V(n)}})})]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(Y,{children:[s.jsx(q,{children:s.jsx(H,{className:"text-lg",children:"Current Version"})}),s.jsxs(R,{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium",children:"Version"}),s.jsxs(K,{children:["v",t.version]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium",children:"Status"}),s.jsx(K,{variant:"default",children:"Published"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium",children:"Fields"}),s.jsx("span",{className:"text-sm text-gray-600",children:t.fields.length})]})]})]}),s.jsxs(Y,{children:[s.jsx(q,{children:s.jsx(H,{className:"text-lg",children:"Version Guidelines"})}),s.jsxs(R,{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Major (x.0.0):"})," Breaking changes, new features"]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Minor (1.x.0):"})," New features, improvements"]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Patch (1.0.x):"})," Bug fixes, corrections"]})]})]})]}),s.jsxs(Y,{children:[s.jsx(q,{children:s.jsx(H,{className:"text-lg",children:"Best Practices"})}),s.jsxs(R,{className:"space-y-2 text-sm text-gray-600",children:[s.jsx("p",{children:"• Always provide clear change summaries"}),s.jsx("p",{children:"• Test templates before publishing"}),s.jsx("p",{children:"• Mark breaking changes appropriately"}),s.jsx("p",{children:"• Include migration notes for major changes"})]})]})]})]})})]})]})})})}export{de as default};
