import{r as i,j as e,aw as E,b_ as $,bB as U,Z as ae,aK as z,bN as re,bZ as te,F as X,cr as _,p as ne,q as Q,az as le,aY as ie,cs as W,ct as ce,aC as de,u as me,b3 as oe,aD as xe,aR as he,bX as ge}from"./react-vendor-CQwTX5cM.js";import{y as ee,k as ue,ae as je,B as N,l as pe,m as Ne,n as ve,af as fe,a0 as T,A as H,E as R,G,H as q,K as Y,L as F,M as P,I as be,p as ye,a1 as we,C as u,u as v,v as f,z as D,o as j,ag as Z,h as g,j as Ce,S as Ve,ab as Se,ac as M,ad as k,q as Te,r as ke,s as J,t as L,ah as De}from"./ai-services-C7wGs9RJ.js";import"./supabase-DtnFeX9z.js";import{J as C}from"./vendor-CdHE2p_m.js";import"./TemplateGenerator-qnoc6Sk1.js";import{f as Be}from"./utilities-1ndx239g.js";import"./ui-components-BA32w1ww.js";import"./data-fetching-C9PAuT9r.js";import"./ocr-worker-C-xttgCS.js";import"./pdf-worker-CQFXObSw.js";import"./forms-DACbGb-3.js";const Ae=({templateId:c,currentTitle:o,currentDescription:b,currentContent:t,currentFields:V,onVersionCreated:y,className:S=""})=>{const{user:d}=ee(),[p,m]=i.useState(!1),[w,n]=i.useState(!1),[a,h]=i.useState({title:o,description:b||"",content:t,fields:V,changeSummary:"",changeDetails:"",breakingChanges:!1,versionType:"minor"}),x=async l=>{if(l.preventDefault(),!d){C.error("Please log in to create a new version");return}if(!a.changeSummary.trim()){C.error("Please provide a change summary");return}try{n(!0);const r={templateId:c,title:a.title,description:a.description||void 0,content:a.content,fields:a.fields,changeSummary:a.changeSummary,changeDetails:a.changeDetails?{notes:a.changeDetails}:void 0,breakingChanges:a.breakingChanges,versionType:a.versionType},I=await Z.createVersion(r,d.id);C.success("New template version created successfully!"),m(!1),y==null||y(I),h({title:o,description:b||"",content:t,fields:V,changeSummary:"",changeDetails:"",breakingChanges:!1,versionType:"minor"})}catch(r){console.error("Error creating version:",r),C.error("Failed to create version: "+r.message)}finally{n(!1)}},B=l=>({major:{icon:e.jsx(te,{className:"h-4 w-4 text-red-500"}),label:"Major Version",description:"Breaking changes, new features, or significant updates",example:"1.0.0 → 2.0.0"},minor:{icon:e.jsx($,{className:"h-4 w-4 text-blue-500"}),label:"Minor Version",description:"New features or improvements without breaking changes",example:"1.0.0 → 1.1.0"},patch:{icon:e.jsx(X,{className:"h-4 w-4 text-green-500"}),label:"Patch Version",description:"Bug fixes, small improvements, or corrections",example:"1.0.0 → 1.0.1"}})[l];return e.jsx("div",{className:S,children:e.jsxs(ue,{open:p,onOpenChange:m,children:[e.jsx(je,{asChild:!0,children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Create New Version"]})}),e.jsxs(pe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Create New Template Version"]}),e.jsx(fe,{children:"Create a new version of this template with your changes and improvements."})]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(T,{className:"text-base font-medium",children:"Version Type"}),e.jsxs(H,{value:a.versionType,onValueChange:l=>h(r=>({...r,versionType:l})),children:[e.jsx(R,{children:e.jsx(G,{placeholder:"Select version type"})}),e.jsx(q,{children:["major","minor","patch"].map(l=>{const r=B(l);return e.jsx(Y,{value:l,children:e.jsxs("div",{className:"flex items-center gap-2",children:[r.icon,e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-xs text-gray-500",children:r.example})]})]})},l)})})]}),a.versionType&&e.jsxs(F,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(P,{children:B(a.versionType).description})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"changeSummary",className:"text-base font-medium",children:"Change Summary *"}),e.jsx(be,{id:"changeSummary",value:a.changeSummary,onChange:l=>h(r=>({...r,changeSummary:l.target.value})),placeholder:"Brief description of what changed in this version",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"changeDetails",className:"text-base font-medium",children:"Detailed Changes (Optional)"}),e.jsx(ye,{id:"changeDetails",value:a.changeDetails,onChange:l=>h(r=>({...r,changeDetails:l.target.value})),placeholder:"Detailed description of changes, new features, bug fixes, etc.",rows:4})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{id:"breakingChanges",checked:a.breakingChanges,onCheckedChange:l=>h(r=>({...r,breakingChanges:l}))}),e.jsxs(T,{htmlFor:"breakingChanges",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-red-500"}),"This version contains breaking changes"]})]}),a.breakingChanges&&e.jsxs(F,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(P,{children:"Breaking changes may affect existing customizations or integrations. Make sure to document migration steps in the detailed changes."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{className:"text-base font-medium",children:"Template Content"}),e.jsxs(u,{children:[e.jsxs(v,{className:"pb-3",children:[e.jsx(f,{className:"text-sm",children:a.title}),a.description&&e.jsx(D,{className:"text-xs",children:a.description})]}),e.jsxs(j,{className:"pt-0",children:[e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 p-3 rounded border max-h-32 overflow-y-auto",children:[a.content.substring(0,200),a.content.length>200&&"..."]}),a.fields.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 mb-1",children:["Fields: ",a.fields.length]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.fields.slice(0,5).map((l,r)=>e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:l.label||l.name||`Field ${r+1}`},r)),a.fields.length>5&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",a.fields.length-5," more"]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(N,{type:"submit",disabled:w||!a.changeSummary.trim(),className:"flex-1",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),w?"Creating Version...":"Create Version"]}),e.jsx(N,{type:"button",variant:"outline",onClick:()=>m(!1),className:"flex-1",children:"Cancel"})]})]})]})]})})},Me=({templateId:c,version1Id:o,version2Id:b,onVersionSelect:t,className:V=""})=>{const[y,S]=i.useState([]),[d,p]=i.useState(o||""),[m,w]=i.useState(b||""),[n,a]=i.useState(null),[h,x]=i.useState(!1);i.useEffect(()=>{B()},[c]),i.useEffect(()=>{d&&m&&d!==m&&l()},[d,m]);const B=async()=>{try{const s=await Z.getTemplateVersions(c);S(s),!o&&!b&&s.length>=2&&(p(s[0].id),w(s[1].id))}catch(s){console.error("Error loading versions:",s),C.error("Failed to load versions")}},l=async()=>{try{x(!0);const s=await Z.compareVersions(d,m);a(s)}catch(s){console.error("Error comparing versions:",s),C.error("Failed to compare versions")}finally{x(!1)}},r=s=>{switch(s){case"added":return e.jsx(E,{className:"h-4 w-4 text-green-500"});case"removed":return e.jsx(ce,{className:"h-4 w-4 text-red-500"});case"modified":return e.jsx(W,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(X,{className:"h-4 w-4 text-gray-500"})}},I=s=>{const O={added:{variant:"default",label:"Added",className:"bg-green-100 text-green-800"},removed:{variant:"destructive",label:"Removed",className:"bg-red-100 text-red-800"},modified:{variant:"secondary",label:"Modified",className:"bg-blue-100 text-blue-800"}}[s];return e.jsx(g,{variant:O.variant,className:O.className,children:O.label})},K=(s,A)=>e.jsxs(u,{children:[e.jsxs(v,{className:"pb-3",children:[e.jsxs(f,{className:"text-lg flex items-center justify-between",children:[A,e.jsxs(g,{variant:s.isCurrent?"default":"secondary",children:["v",s.versionNumber]})]}),e.jsx(D,{children:s.changeSummary||"No change summary available"})]}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Status:"}),e.jsx(g,{variant:"outline",className:"ml-2",children:s.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Breaking:"}),s.breakingChanges?e.jsxs(g,{variant:"destructive",className:"ml-2",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Yes"]}):e.jsxs(g,{variant:"secondary",className:"ml-2",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"No"]})]})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(le,{className:"h-4 w-4"}),Be(s.createdAt,{addSuffix:!0})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ie,{className:"h-4 w-4"}),s.createdBy]})]}),e.jsx(Ve,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Content Preview"}),e.jsxs("div",{className:"text-xs bg-gray-50 p-3 rounded border max-h-24 overflow-y-auto",children:[s.content.substring(0,150),s.content.length>150&&"..."]})]})]})]}),se=()=>!n||!n.differences.length?e.jsxs(F,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(P,{children:"No differences found between the selected versions."})]}):e.jsx("div",{className:"space-y-4",children:n.differences.map((s,A)=>e.jsxs(u,{children:[e.jsx(v,{className:"pb-3",children:e.jsxs(f,{className:"text-sm flex items-center gap-2",children:[r(s.type),"Field: ",s.field,I(s.type)]})}),e.jsxs(j,{children:[s.type==="modified"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"font-medium text-sm text-red-700 mb-2",children:["Before (v",n.version1.versionNumber,")"]}),e.jsxs("div",{className:"text-xs bg-red-50 border border-red-200 p-3 rounded",children:[typeof s.oldValue=="string"?s.oldValue.substring(0,200):JSON.stringify(s.oldValue,null,2).substring(0,200),(typeof s.oldValue=="string"?s.oldValue.length:JSON.stringify(s.oldValue).length)>200&&"..."]})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-medium text-sm text-green-700 mb-2",children:["After (v",n.version2.versionNumber,")"]}),e.jsxs("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded",children:[typeof s.newValue=="string"?s.newValue.substring(0,200):JSON.stringify(s.newValue,null,2).substring(0,200),(typeof s.newValue=="string"?s.newValue.length:JSON.stringify(s.newValue).length)>200&&"..."]})]})]}),s.type==="added"&&e.jsxs("div",{children:[e.jsxs("h5",{className:"font-medium text-sm text-green-700 mb-2",children:["Added in v",n.version2.versionNumber]}),e.jsx("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded",children:typeof s.newValue=="string"?s.newValue:JSON.stringify(s.newValue,null,2)})]}),s.type==="removed"&&e.jsxs("div",{children:[e.jsxs("h5",{className:"font-medium text-sm text-red-700 mb-2",children:["Removed from v",n.version1.versionNumber]}),e.jsx("div",{className:"text-xs bg-red-50 border border-red-200 p-3 rounded",children:typeof s.oldValue=="string"?s.oldValue:JSON.stringify(s.oldValue,null,2)})]})]})]},A))});return e.jsxs("div",{className:`space-y-6 ${V}`,children:[e.jsxs(u,{children:[e.jsxs(v,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Compare Template Versions"]}),e.jsx(D,{children:"Select two versions to compare their differences"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Version 1"}),e.jsxs(H,{value:d,onValueChange:p,children:[e.jsx(R,{children:e.jsx(G,{placeholder:"Select first version"})}),e.jsx(q,{children:y.map(s=>e.jsxs(Y,{value:s.id,children:["v",s.versionNumber," - ",s.changeSummary||"No summary"]},s.id))})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(ne,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Version 2"}),e.jsxs(H,{value:m,onValueChange:w,children:[e.jsx(R,{children:e.jsx(G,{placeholder:"Select second version"})}),e.jsx(q,{children:y.map(s=>e.jsxs(Y,{value:s.id,children:["v",s.versionNumber," - ",s.changeSummary||"No summary"]},s.id))})]})]})]}),d&&m&&d===m&&e.jsxs(F,{className:"mt-4",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(P,{children:"Please select two different versions to compare."})]})]})]}),n&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[K(n.version1,"Version 1"),K(n.version2,"Version 2")]}),n&&e.jsxs(u,{children:[e.jsxs(v,{children:[e.jsxs(f,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Differences"}),e.jsxs(g,{variant:"outline",children:[n.differences.length," change",n.differences.length!==1?"s":""]})]}),e.jsxs(D,{children:["Changes between v",n.version1.versionNumber," and v",n.version2.versionNumber]})]}),e.jsx(j,{children:h?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsx(Ce,{className:"max-h-96",children:se()})})]})]})};function Ge(){const{slug:c}=de(),o=me(),{user:b}=ee(),[t,V]=i.useState(null),[y,S]=i.useState(!0),[d,p]=i.useState(null),[m,w]=i.useState("history");i.useEffect(()=>{c&&n(c)},[c]);const n=async h=>{try{S(!0),p(null);const x=await Se.getTemplateBySlug(h);if(!x){p("Template not found");return}if(!b||x.createdBy!==b.id){p("You do not have permission to manage this template");return}V(x)}catch(x){console.error("Error loading template:",x),p(x.message||"Failed to load template")}finally{S(!1)}},a=h=>{C.success("New version created successfully!"),c&&n(c)};return y?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsx(M,{className:"h-8 w-64"}),e.jsx(M,{className:"h-32 w-full"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(M,{className:"h-64 w-full"}),e.jsx(M,{className:"h-64 w-full"})]})]})})}):d||!t?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(u,{className:"w-full max-w-md",children:e.jsxs(j,{className:"p-8 text-center",children:[e.jsx(oe,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-6",children:d||"You do not have permission to access this template's version management."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{onClick:()=>o(k.templateBrowser),className:"flex-1",children:"Browse Templates"}),e.jsx(N,{variant:"outline",onClick:()=>o(-1),className:"flex-1",children:"Go Back"})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-6",children:[e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>o(k.templateBrowser),className:"p-0 h-auto",children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Templates"]}),e.jsx("span",{children:"/"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>o(`${k.templatePreview}/${c}`),className:"p-0 h-auto",children:t.title}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-gray-900",children:"Version Management"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3",children:[e.jsx($,{className:"h-8 w-8 text-blue-600"}),"Version Management"]}),e.jsxs("p",{className:"text-lg text-gray-600 mb-4",children:['Manage versions, track changes, and collaborate on "',t.title,'"']}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",children:["Current: v",t.version]}),e.jsxs(g,{variant:"secondary",children:[t.versionCount," version",t.versionCount!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(Q,{className:"h-4 w-4 text-green-500"}),t.accessLevel," template"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:()=>o(`${k.templatePreview}/${c}`),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"View Template"]}),e.jsxs(N,{variant:"outline",onClick:()=>o(`${k.templateCustomize}/${c}`),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Edit Template"]})]})]})}),e.jsxs(Te,{value:m,onValueChange:w,children:[e.jsxs(ke,{className:"grid w-full grid-cols-3",children:[e.jsxs(J,{value:"history",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Version History"]}),e.jsxs(J,{value:"compare",className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Compare Versions"]}),e.jsxs(J,{value:"create",className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4"}),"Create Version"]})]}),e.jsx(L,{value:"history",className:"mt-6",children:e.jsx(De,{templateId:t.id,currentVersionId:t.currentVersionId})}),e.jsx(L,{value:"compare",className:"mt-6",children:e.jsx(Me,{templateId:t.id})}),e.jsx(L,{value:"create",className:"mt-6",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(u,{children:[e.jsxs(v,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Create New Version"]}),e.jsx(D,{children:"Create a new version of this template with your changes and improvements."})]}),e.jsx(j,{children:e.jsx(Ae,{templateId:t.id,currentTitle:t.title,currentDescription:t.description,currentContent:t.content,currentFields:t.fields,onVersionCreated:a})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(u,{children:[e.jsx(v,{children:e.jsx(f,{className:"text-lg",children:"Current Version"})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Version"}),e.jsxs(g,{children:["v",t.version]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status"}),e.jsx(g,{variant:"default",children:"Published"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Fields"}),e.jsx("span",{className:"text-sm text-gray-600",children:t.fields.length})]})]})]}),e.jsxs(u,{children:[e.jsx(v,{children:e.jsx(f,{className:"text-lg",children:"Version Guidelines"})}),e.jsxs(j,{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Major (x.0.0):"})," Breaking changes, new features"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Minor (1.x.0):"})," New features, improvements"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Patch (1.0.x):"})," Bug fixes, corrections"]})]})]})]}),e.jsxs(u,{children:[e.jsx(v,{children:e.jsx(f,{className:"text-lg",children:"Best Practices"})}),e.jsxs(j,{className:"space-y-2 text-sm text-gray-600",children:[e.jsx("p",{children:"• Always provide clear change summaries"}),e.jsx("p",{children:"• Test templates before publishing"}),e.jsx("p",{children:"• Mark breaking changes appropriately"}),e.jsx("p",{children:"• Include migration notes for major changes"})]})]})]})]})})]})]})})})}export{Ge as default};
