import{a as e,R as t}from"./react-vendor-92YuBQvb.js";import{c as a,a7 as l,v as s,bj as n,B as r,bk as m,w as c,x as i,y as o,bl as d,bm as u,aN as E,ad as g,ae as p,af as v,ag as N,ai as f,am as h,a2 as x,an as y,I as b,H as w,aO as V,al as C,as as k,z as S,a0 as T,a1 as j,ab as B,A as D,aF as M,a8 as F,bn as I,bo as P,Z as O,bp as $,p as A,s as J,a5 as z,J as G,K as Y,U as q,S as H,bf as R,b1 as K,bg as L,bh as U,a4 as W,bi as X,b5 as Z,V as Q,W as _,X as ee,Y as te,bq as ae,$ as le,br as se}from"./index-BheJWwZO.js";import"./TemplateGenerator-DukANcOe.js";import{S as ne}from"./square-pen-CFKfsZWc.js";import{M as re}from"./minus-BnNHPIMG.js";import"./supabase-Br4R_luN.js";import"./openai-xAxfXVJU.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=a("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]),TemplateVersionCreator=({templateId:a,currentTitle:$,currentDescription:A,currentContent:J,currentFields:z,onVersionCreated:G,className:Y=""})=>{const{user:q}=l(),[H,R]=e.useState(!1),[K,L]=e.useState(!1),[U,W]=e.useState({title:$,description:A||"",content:J,fields:z,changeSummary:"",changeDetails:"",breakingChanges:!1,versionType:"minor"}),getVersionTypeInfo=e=>({major:{icon:t.createElement(P,{className:"h-4 w-4 text-red-500"}),label:"Major Version",description:"Breaking changes, new features, or significant updates",example:"1.0.0 → 2.0.0"},minor:{icon:t.createElement(d,{className:"h-4 w-4 text-blue-500"}),label:"Minor Version",description:"New features or improvements without breaking changes",example:"1.0.0 → 1.1.0"},patch:{icon:t.createElement(O,{className:"h-4 w-4 text-green-500"}),label:"Patch Version",description:"Bug fixes, small improvements, or corrections",example:"1.0.0 → 1.0.1"}}[e]);return t.createElement("div",{className:Y},t.createElement(s,{open:H,onOpenChange:R},t.createElement(n,{asChild:!0},t.createElement(r,{className:"flex items-center gap-2"},t.createElement(m,{className:"h-4 w-4"}),"Create New Version")),t.createElement(c,{className:"max-w-2xl max-h-[90vh] overflow-y-auto"},t.createElement(i,null,t.createElement(o,{className:"flex items-center gap-2"},t.createElement(d,{className:"h-5 w-5"}),"Create New Template Version"),t.createElement(u,null,"Create a new version of this template with your changes and improvements.")),t.createElement("form",{onSubmit:async e=>{if(e.preventDefault(),q)if(U.changeSummary.trim())try{L(!0);const e={templateId:a,title:U.title,description:U.description||void 0,content:U.content,fields:U.fields,changeSummary:U.changeSummary,changeDetails:U.changeDetails?{notes:U.changeDetails}:void 0,breakingChanges:U.breakingChanges,versionType:U.versionType},t=await I.createVersion(e,q.id);F.success("New template version created successfully!"),R(!1),G?.(t),W({title:$,description:A||"",content:J,fields:z,changeSummary:"",changeDetails:"",breakingChanges:!1,versionType:"minor"})}catch(t){console.error("Error creating version:",t),F.error("Failed to create version: "+t.message)}finally{L(!1)}else F.error("Please provide a change summary");else F.error("Please log in to create a new version")},className:"space-y-6"},t.createElement("div",{className:"space-y-3"},t.createElement(E,{className:"text-base font-medium"},"Version Type"),t.createElement(g,{value:U.versionType,onValueChange:e=>W(t=>({...t,versionType:e}))},t.createElement(p,null,t.createElement(v,{placeholder:"Select version type"})),t.createElement(N,null,["major","minor","patch"].map(e=>{const a=getVersionTypeInfo(e);return t.createElement(f,{key:e,value:e},t.createElement("div",{className:"flex items-center gap-2"},a.icon,t.createElement("div",null,t.createElement("div",{className:"font-medium"},a.label),t.createElement("div",{className:"text-xs text-gray-500"},a.example))))}))),U.versionType&&t.createElement(h,null,t.createElement(x,{className:"h-4 w-4"}),t.createElement(y,null,getVersionTypeInfo(U.versionType).description))),t.createElement("div",{className:"space-y-2"},t.createElement(E,{htmlFor:"changeSummary",className:"text-base font-medium"},"Change Summary *"),t.createElement(b,{id:"changeSummary",value:U.changeSummary,onChange:e=>W(t=>({...t,changeSummary:e.target.value})),placeholder:"Brief description of what changed in this version",required:!0})),t.createElement("div",{className:"space-y-2"},t.createElement(E,{htmlFor:"changeDetails",className:"text-base font-medium"},"Detailed Changes (Optional)"),t.createElement(w,{id:"changeDetails",value:U.changeDetails,onChange:e=>W(t=>({...t,changeDetails:e.target.value})),placeholder:"Detailed description of changes, new features, bug fixes, etc.",rows:4})),t.createElement("div",{className:"flex items-center space-x-2"},t.createElement(V,{id:"breakingChanges",checked:U.breakingChanges,onCheckedChange:e=>W(t=>({...t,breakingChanges:e}))}),t.createElement(E,{htmlFor:"breakingChanges",className:"flex items-center gap-2"},t.createElement(C,{className:"h-4 w-4 text-red-500"}),"This version contains breaking changes")),U.breakingChanges&&t.createElement(h,null,t.createElement(k,{className:"h-4 w-4"}),t.createElement(y,null,"Breaking changes may affect existing customizations or integrations. Make sure to document migration steps in the detailed changes.")),t.createElement("div",{className:"space-y-2"},t.createElement(E,{className:"text-base font-medium"},"Template Content"),t.createElement(S,null,t.createElement(T,{className:"pb-3"},t.createElement(j,{className:"text-sm"},U.title),U.description&&t.createElement(B,{className:"text-xs"},U.description)),t.createElement(D,{className:"pt-0"},t.createElement("div",{className:"text-xs text-gray-600 bg-gray-50 p-3 rounded border max-h-32 overflow-y-auto"},U.content.substring(0,200),U.content.length>200&&"..."),U.fields.length>0&&t.createElement("div",{className:"mt-2"},t.createElement("p",{className:"text-xs font-medium text-gray-700 mb-1"},"Fields: ",U.fields.length),t.createElement("div",{className:"flex flex-wrap gap-1"},U.fields.slice(0,5).map((e,a)=>t.createElement("span",{key:a,className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded"},e.label||e.name||`Field ${a+1}`)),U.fields.length>5&&t.createElement("span",{className:"text-xs text-gray-500"},"+",U.fields.length-5," more")))))),t.createElement("div",{className:"flex gap-3 pt-4"},t.createElement(r,{type:"submit",disabled:K||!U.changeSummary.trim(),className:"flex-1"},t.createElement(M,{className:"h-4 w-4 mr-2"}),K?"Creating Version...":"Create Version"),t.createElement(r,{type:"button",variant:"outline",onClick:()=>R(!1),className:"flex-1"},"Cancel"))))))},TemplateVersionComparison=({templateId:a,version1Id:l,version2Id:s,onVersionSelect:n,className:r=""})=>{const[c,i]=e.useState([]),[o,d]=e.useState(l||""),[u,E]=e.useState(s||""),[b,w]=e.useState(null),[V,C]=e.useState(!1);e.useEffect(()=>{loadVersions()},[a]),e.useEffect(()=>{o&&u&&o!==u&&compareVersions()},[o,u]);const loadVersions=async()=>{try{const e=await I.getTemplateVersions(a);i(e),!l&&!s&&e.length>=2&&(d(e[0].id),E(e[1].id))}catch(e){console.error("Error loading versions:",e),F.error("Failed to load versions")}},compareVersions=async()=>{try{C(!0);const e=await I.compareVersions(o,u);w(e)}catch(e){console.error("Error comparing versions:",e),F.error("Failed to compare versions")}finally{C(!1)}},renderVersionCard=(e,a)=>t.createElement(S,null,t.createElement(T,{className:"pb-3"},t.createElement(j,{className:"text-lg flex items-center justify-between"},a,t.createElement(A,{variant:e.isCurrent?"default":"secondary"},"v",e.versionNumber)),t.createElement(B,null,e.changeSummary||"No change summary available")),t.createElement(D,{className:"space-y-3"},t.createElement("div",{className:"grid grid-cols-2 gap-4 text-sm"},t.createElement("div",null,t.createElement("span",{className:"font-medium text-gray-600"},"Status:"),t.createElement(A,{variant:"outline",className:"ml-2"},e.status)),t.createElement("div",null,t.createElement("span",{className:"font-medium text-gray-600"},"Breaking:"),e.breakingChanges?t.createElement(A,{variant:"destructive",className:"ml-2"},t.createElement(k,{className:"h-3 w-3 mr-1"}),"Yes"):t.createElement(A,{variant:"secondary",className:"ml-2"},t.createElement(z,{className:"h-3 w-3 mr-1"}),"No"))),t.createElement("div",{className:"text-sm space-y-1"},t.createElement("div",{className:"flex items-center gap-2 text-gray-600"},t.createElement(G,{className:"h-4 w-4"}),Y(e.createdAt,{addSuffix:!0})),t.createElement("div",{className:"flex items-center gap-2 text-gray-600"},t.createElement(q,{className:"h-4 w-4"}),e.createdBy)),t.createElement(H,null),t.createElement("div",null,t.createElement("h4",{className:"font-medium text-sm mb-2"},"Content Preview"),t.createElement("div",{className:"text-xs bg-gray-50 p-3 rounded border max-h-24 overflow-y-auto"},e.content.substring(0,150),e.content.length>150&&"..."))));return t.createElement("div",{className:`space-y-6 ${r}`},t.createElement(S,null,t.createElement(T,null,t.createElement(j,{className:"flex items-center gap-2"},t.createElement(me,{className:"h-5 w-5"}),"Compare Template Versions"),t.createElement(B,null,"Select two versions to compare their differences")),t.createElement(D,null,t.createElement("div",{className:"grid md:grid-cols-3 gap-4 items-center"},t.createElement("div",null,t.createElement("label",{className:"block text-sm font-medium mb-2"},"Version 1"),t.createElement(g,{value:o,onValueChange:d},t.createElement(p,null,t.createElement(v,{placeholder:"Select first version"})),t.createElement(N,null,c.map(e=>t.createElement(f,{key:e.id,value:e.id},"v",e.versionNumber," - ",e.changeSummary||"No summary"))))),t.createElement("div",{className:"flex justify-center"},t.createElement($,{className:"h-6 w-6 text-gray-400"})),t.createElement("div",null,t.createElement("label",{className:"block text-sm font-medium mb-2"},"Version 2"),t.createElement(g,{value:u,onValueChange:E},t.createElement(p,null,t.createElement(v,{placeholder:"Select second version"})),t.createElement(N,null,c.map(e=>t.createElement(f,{key:e.id,value:e.id},"v",e.versionNumber," - ",e.changeSummary||"No summary")))))),o&&u&&o===u&&t.createElement(h,{className:"mt-4"},t.createElement(k,{className:"h-4 w-4"}),t.createElement(y,null,"Please select two different versions to compare.")))),b&&t.createElement("div",{className:"grid md:grid-cols-2 gap-6"},renderVersionCard(b.version1,"Version 1"),renderVersionCard(b.version2,"Version 2")),b&&t.createElement(S,null,t.createElement(T,null,t.createElement(j,{className:"flex items-center justify-between"},t.createElement("span",null,"Differences"),t.createElement(A,{variant:"outline"},b.differences.length," change",1!==b.differences.length?"s":"")),t.createElement(B,null,"Changes between v",b.version1.versionNumber," and v",b.version2.versionNumber)),t.createElement(D,null,V?t.createElement("div",{className:"flex items-center justify-center py-8"},t.createElement("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})):t.createElement(J,{className:"max-h-96"},b&&b.differences.length?t.createElement("div",{className:"space-y-4"},b.differences.map((e,a)=>t.createElement(S,{key:a},t.createElement(T,{className:"pb-3"},t.createElement(j,{className:"text-sm flex items-center gap-2"},(e=>{switch(e){case"added":return t.createElement(m,{className:"h-4 w-4 text-green-500"});case"removed":return t.createElement(re,{className:"h-4 w-4 text-red-500"});case"modified":return t.createElement(ne,{className:"h-4 w-4 text-blue-500"});default:return t.createElement(O,{className:"h-4 w-4 text-gray-500"})}})(e.type),"Field: ",e.field,(e=>{const a={added:{variant:"default",label:"Added",className:"bg-green-100 text-green-800"},removed:{variant:"destructive",label:"Removed",className:"bg-red-100 text-red-800"},modified:{variant:"secondary",label:"Modified",className:"bg-blue-100 text-blue-800"}}[e];return t.createElement(A,{variant:a.variant,className:a.className},a.label)})(e.type))),t.createElement(D,null,"modified"===e.type&&t.createElement("div",{className:"grid md:grid-cols-2 gap-4"},t.createElement("div",null,t.createElement("h5",{className:"font-medium text-sm text-red-700 mb-2"},"Before (v",b.version1.versionNumber,")"),t.createElement("div",{className:"text-xs bg-red-50 border border-red-200 p-3 rounded"},"string"==typeof e.oldValue?e.oldValue.substring(0,200):JSON.stringify(e.oldValue,null,2).substring(0,200),("string"==typeof e.oldValue?e.oldValue.length:JSON.stringify(e.oldValue).length)>200&&"...")),t.createElement("div",null,t.createElement("h5",{className:"font-medium text-sm text-green-700 mb-2"},"After (v",b.version2.versionNumber,")"),t.createElement("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded"},"string"==typeof e.newValue?e.newValue.substring(0,200):JSON.stringify(e.newValue,null,2).substring(0,200),("string"==typeof e.newValue?e.newValue.length:JSON.stringify(e.newValue).length)>200&&"..."))),"added"===e.type&&t.createElement("div",null,t.createElement("h5",{className:"font-medium text-sm text-green-700 mb-2"},"Added in v",b.version2.versionNumber),t.createElement("div",{className:"text-xs bg-green-50 border border-green-200 p-3 rounded"},"string"==typeof e.newValue?e.newValue:JSON.stringify(e.newValue,null,2))),"removed"===e.type&&t.createElement("div",null,t.createElement("h5",{className:"font-medium text-sm text-red-700 mb-2"},"Removed from v",b.version1.versionNumber),t.createElement("div",{className:"text-xs bg-red-50 border border-red-200 p-3 rounded"},"string"==typeof e.oldValue?e.oldValue:JSON.stringify(e.oldValue,null,2))))))):t.createElement(h,null,t.createElement(x,{className:"h-4 w-4"}),t.createElement(y,null,"No differences found between the selected versions."))))))};function TemplateVersionManagement(){const{slug:a}=R(),s=K(),{user:n}=l(),[c,i]=e.useState(null),[o,u]=e.useState(!0),[E,g]=e.useState(null),[p,v]=e.useState("history");e.useEffect(()=>{a&&loadTemplate(a)},[a]);const loadTemplate=async e=>{try{u(!0),g(null);const t=await L.getTemplateBySlug(e);if(!t)return void g("Template not found");if(!n||t.createdBy!==n.id)return void g("You do not have permission to manage this template");i(t)}catch(t){console.error("Error loading template:",t),g(t.message||"Failed to load template")}finally{u(!1)}};return o?t.createElement("div",{className:"min-h-screen bg-gray-50"},t.createElement("div",{className:"container mx-auto px-4 py-8"},t.createElement("div",{className:"max-w-6xl mx-auto space-y-6"},t.createElement(U,{className:"h-8 w-64"}),t.createElement(U,{className:"h-32 w-full"}),t.createElement("div",{className:"grid md:grid-cols-2 gap-6"},t.createElement(U,{className:"h-64 w-full"}),t.createElement(U,{className:"h-64 w-full"}))))):E||!c?t.createElement("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center"},t.createElement(S,{className:"w-full max-w-md"},t.createElement(D,{className:"p-8 text-center"},t.createElement(W,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.createElement("h3",{className:"text-lg font-semibold text-gray-900 mb-2"},"Access Denied"),t.createElement("p",{className:"text-gray-600 mb-6"},E||"You do not have permission to access this template's version management."),t.createElement("div",{className:"flex gap-2"},t.createElement(r,{onClick:()=>s(X.templateBrowser),className:"flex-1"},"Browse Templates"),t.createElement(r,{variant:"outline",onClick:()=>s(-1),className:"flex-1"},"Go Back"))))):t.createElement("div",{className:"min-h-screen bg-gray-50"},t.createElement("div",{className:"container mx-auto px-4 py-8"},t.createElement("div",{className:"max-w-6xl mx-auto"},t.createElement("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-6"},t.createElement(r,{variant:"ghost",size:"sm",onClick:()=>s(X.templateBrowser),className:"p-0 h-auto"},t.createElement(Z,{className:"h-4 w-4 mr-1"}),"Templates"),t.createElement("span",null,"/"),t.createElement(r,{variant:"ghost",size:"sm",onClick:()=>s(`${X.templatePreview}/${a}`),className:"p-0 h-auto"},c.title),t.createElement("span",null,"/"),t.createElement("span",{className:"text-gray-900"},"Version Management")),t.createElement("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6"},t.createElement("div",{className:"flex items-start justify-between"},t.createElement("div",{className:"flex-1"},t.createElement("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3"},t.createElement(d,{className:"h-8 w-8 text-blue-600"}),"Version Management"),t.createElement("p",{className:"text-lg text-gray-600 mb-4"},'Manage versions, track changes, and collaborate on "',c.title,'"'),t.createElement("div",{className:"flex items-center gap-4"},t.createElement("div",{className:"flex items-center gap-2"},t.createElement(A,{variant:"outline"},"Current: v",c.version),t.createElement(A,{variant:"secondary"},c.versionCount," version",1!==c.versionCount?"s":"")),t.createElement("div",{className:"flex items-center gap-1 text-sm text-gray-600"},t.createElement(z,{className:"h-4 w-4 text-green-500"}),c.accessLevel," template"))),t.createElement("div",{className:"flex gap-2"},t.createElement(r,{variant:"outline",onClick:()=>s(`${X.templatePreview}/${a}`)},t.createElement(Q,{className:"h-4 w-4 mr-2"}),"View Template"),t.createElement(r,{variant:"outline",onClick:()=>s(`${X.templateCustomize}/${a}`)},t.createElement(ne,{className:"h-4 w-4 mr-2"}),"Edit Template")))),t.createElement(_,{value:p,onValueChange:v},t.createElement(ee,{className:"grid w-full grid-cols-3"},t.createElement(te,{value:"history",className:"flex items-center gap-2"},t.createElement(ae,{className:"h-4 w-4"}),"Version History"),t.createElement(te,{value:"compare",className:"flex items-center gap-2"},t.createElement(me,{className:"h-4 w-4"}),"Compare Versions"),t.createElement(te,{value:"create",className:"flex items-center gap-2"},t.createElement(m,{className:"h-4 w-4"}),"Create Version")),t.createElement(le,{value:"history",className:"mt-6"},t.createElement(se,{templateId:c.id,currentVersionId:c.currentVersionId})),t.createElement(le,{value:"compare",className:"mt-6"},t.createElement(TemplateVersionComparison,{templateId:c.id})),t.createElement(le,{value:"create",className:"mt-6"},t.createElement("div",{className:"grid lg:grid-cols-3 gap-6"},t.createElement("div",{className:"lg:col-span-2"},t.createElement(S,null,t.createElement(T,null,t.createElement(j,{className:"flex items-center gap-2"},t.createElement(m,{className:"h-5 w-5"}),"Create New Version"),t.createElement(B,null,"Create a new version of this template with your changes and improvements.")),t.createElement(D,null,t.createElement(TemplateVersionCreator,{templateId:c.id,currentTitle:c.title,currentDescription:c.description,currentContent:c.content,currentFields:c.fields,onVersionCreated:e=>{F.success("New version created successfully!"),a&&loadTemplate(a)}})))),t.createElement("div",{className:"space-y-6"},t.createElement(S,null,t.createElement(T,null,t.createElement(j,{className:"text-lg"},"Current Version")),t.createElement(D,{className:"space-y-3"},t.createElement("div",{className:"flex items-center justify-between"},t.createElement("span",{className:"text-sm font-medium"},"Version"),t.createElement(A,null,"v",c.version)),t.createElement("div",{className:"flex items-center justify-between"},t.createElement("span",{className:"text-sm font-medium"},"Status"),t.createElement(A,{variant:"default"},"Published")),t.createElement("div",{className:"flex items-center justify-between"},t.createElement("span",{className:"text-sm font-medium"},"Fields"),t.createElement("span",{className:"text-sm text-gray-600"},c.fields.length)))),t.createElement(S,null,t.createElement(T,null,t.createElement(j,{className:"text-lg"},"Version Guidelines")),t.createElement(D,{className:"space-y-3 text-sm"},t.createElement("div",{className:"flex items-start gap-2"},t.createElement("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"}),t.createElement("div",null,t.createElement("span",{className:"font-medium"},"Major (x.0.0):")," Breaking changes, new features")),t.createElement("div",{className:"flex items-start gap-2"},t.createElement("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),t.createElement("div",null,t.createElement("span",{className:"font-medium"},"Minor (1.x.0):")," New features, improvements")),t.createElement("div",{className:"flex items-start gap-2"},t.createElement("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"}),t.createElement("div",null,t.createElement("span",{className:"font-medium"},"Patch (1.0.x):")," Bug fixes, corrections")))),t.createElement(S,null,t.createElement(T,null,t.createElement(j,{className:"text-lg"},"Best Practices")),t.createElement(D,{className:"space-y-2 text-sm text-gray-600"},t.createElement("p",null,"• Always provide clear change summaries"),t.createElement("p",null,"• Test templates before publishing"),t.createElement("p",null,"• Mark breaking changes appropriately"),t.createElement("p",null,"• Include migration notes for major changes"))))))))))}export{TemplateVersionManagement as default};
