import{r as t,j as e,a6 as Ce,bM as Ye,ca as ce,o as V,cb as qe,cc as pe,cd as Pe,m as Qe,a3 as Ke,aB as Te,ce as Xe,aF as je,b$ as Ze,aY as Me,az as Je,aA as _e,cf as es,cg as ss,ch as as,a0 as ts,ci as ls,cj as ns,ck as is,v as rs,w as me,bA as cs,aR as os,F as he,bD as ze,bB as ds,aO as xs,b3 as ke,q as $}from"./react-vendor-DgOuH3B5.js";import{c as H,T as ms,D as le,a as ne,B as m,b as ie,d as W,e as hs,f as us,h as L,i as ps,S as te,I as Se,j as js,k as ge,l as fe,m as Ne,n as be,C as F,o as U,p as gs,q as Le,r as Ee,s as _,t as ee,u as se,v as ae}from"./ai-services-DbCQJDXZ.js";import{u as fs,a as Ns,b as Ie,c as bs}from"./useAnnotations-Bsm22zON.js";import{f as ue,a as vs}from"./utilities-x5TAO4by.js";import{getPdfJs as ys}from"./pdfWorker-BB4Np4YU.js";import"./ui-components-BA32w1ww.js";import"./data-fetching-C9PAuT9r.js";import"./vendor-DXfpcdns.js";import"./ocr-worker-CHC1Ilq1.js";import"./pdf-worker-D8bnToiL.js";import"./supabase-B5_W4sir.js";import"./forms-zYe9FhTN.js";function ws({annotations:a,scale:h,rotation:f,activeTool:o,selectedAnnotation:r,drawingState:d,readOnly:x=!1,onAnnotationCreate:C,onAnnotationSelect:N,onAnnotationUpdate:A,onAnnotationDelete:u,onDrawingStart:b,onDrawingUpdate:i,onDrawingEnd:j}){const g=t.useRef(null),[k,v]=t.useState(!1),[S,P]=t.useState(null),[p,n]=t.useState(null),y={yellow:"rgba(255, 255, 0, 0.3)",red:"rgba(255, 0, 0, 0.3)",blue:"rgba(0, 0, 255, 0.3)",green:"rgba(0, 255, 0, 0.3)",purple:"rgba(128, 0, 128, 0.3)",orange:"rgba(255, 165, 0, 0.3)",pink:"rgba(255, 192, 203, 0.3)",gray:"rgba(128, 128, 128, 0.3)"},w={yellow:"#FFD700",red:"#FF0000",blue:"#0000FF",green:"#00FF00",purple:"#800080",orange:"#FFA500",pink:"#FFC0CB",gray:"#808080"},T=t.useCallback((s,l)=>{if(!g.current)return{x:0,y:0};const z=g.current.getBoundingClientRect();return{x:(s-z.left)/h,y:(l-z.top)/h}},[h]),O=t.useCallback(s=>{if(x||!o.isActive)return;s.preventDefault();const l=T(s.clientX,s.clientY);o.type==="drawing"?(b(o.color),i(`M ${l.x} ${l.y}`)):(v(!0),P(l),n({x:l.x,y:l.y,width:0,height:0}))},[x,o,T,b,i]),q=t.useCallback(s=>{if(x||!o.isActive)return;const l=T(s.clientX,s.clientY);d.isDrawing?i(`${d.currentPath} L ${l.x} ${l.y}`):k&&S&&n({x:Math.min(S.x,l.x),y:Math.min(S.y,l.y),width:Math.abs(l.x-S.x),height:Math.abs(l.y-S.y)})},[x,o,d,k,S,T,i]),Q=t.useCallback(s=>{x||!o.isActive||(d.isDrawing?(C({annotationType:"drawing",color:d.color,x:0,y:0,width:100,height:100,properties:{pathData:d.currentPath,strokeWidth:d.strokeWidth}}),j()):k&&p&&p.width>5&&p.height>5&&C({annotationType:o.type,color:o.color,x:p.x,y:p.y,width:p.width,height:p.height,content:o.type==="note"?"New note":void 0}),v(!1),P(null),n(null))},[x,o,d,k,p,C,j]),K=t.useCallback((s,l)=>{l.stopPropagation(),N(s,!1)},[N]),G=t.useCallback((s,l)=>{l.stopPropagation(),x||N(s,!0)},[x,N]),X=t.useCallback(s=>{var E,M;const l=((E=r.annotation)==null?void 0:E.id)===s.id,z=y[s.color],I=w[s.color],R={position:"absolute",left:s.x*h,top:s.y*h,width:s.width*h,height:s.height*h,backgroundColor:z,border:`2px ${l?"solid":"dashed"} ${I}`,cursor:x?"default":"pointer",zIndex:l?10:1,transform:`rotate(${f}deg)`};return s.annotationType==="drawing"&&s.properties.pathData?e.jsx("svg",{style:R,onClick:D=>K(s,D),onDoubleClick:D=>G(s,D),children:e.jsx("path",{d:s.properties.pathData,stroke:I,strokeWidth:s.properties.strokeWidth||2,fill:"none"})},s.id):e.jsxs("div",{style:R,onClick:D=>K(s,D),onDoubleClick:D=>G(s,D),className:H("annotation-element",l&&"ring-2 ring-blue-500 ring-offset-2"),children:[s.annotationType==="note"&&e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-yellow-400 rounded-full border border-yellow-600 flex items-center justify-center text-xs",children:"📝"}),s.annotationType==="stamp"&&e.jsx("div",{className:"flex items-center justify-center h-full text-xs font-bold text-red-600",children:((M=s.properties.stampType)==null?void 0:M.toUpperCase())||"STAMP"}),s.content&&l&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 p-2 bg-white border rounded shadow-lg max-w-xs z-20",children:[e.jsx("p",{className:"text-sm",children:s.content}),s.user&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["by ",s.user.firstName," ",s.user.lastName]})]})]},s.id)},[h,f,r,x,y,w,K,G]),Z=t.useCallback(()=>{if(!p||!o.isActive)return null;const s=y[o.color],l=w[o.color];return e.jsx("div",{style:{position:"absolute",left:p.x*h,top:p.y*h,width:p.width*h,height:p.height*h,backgroundColor:s,border:`2px dashed ${l}`,pointerEvents:"none",zIndex:100}})},[p,o,h,y,w]),Y=t.useCallback(()=>{if(!d.isDrawing||!d.currentPath)return null;const s=w[d.color];return e.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:100},children:e.jsx("path",{d:d.currentPath,stroke:s,strokeWidth:d.strokeWidth,fill:"none"})})},[d,w]);return e.jsxs("div",{ref:g,className:"absolute inset-0 w-full h-full",style:{cursor:o.isActive&&!x?"crosshair":"default"},onMouseDown:O,onMouseMove:q,onMouseUp:Q,children:[a.map(X),Z(),Y()]})}const De=[{type:"highlight",icon:ce,label:"Highlight",description:"Highlight text or areas"},{type:"note",icon:V,label:"Note",description:"Add sticky notes"},{type:"text",icon:qe,label:"Text",description:"Add text annotations"},{type:"drawing",icon:pe,label:"Draw",description:"Draw freehand annotations"},{type:"stamp",icon:Pe,label:"Stamp",description:"Add stamps and signatures"}],re=[{color:"yellow",label:"Yellow",value:"#FFFF00"},{color:"red",label:"Red",value:"#FF0000"},{color:"blue",label:"Blue",value:"#0000FF"},{color:"green",label:"Green",value:"#00FF00"},{color:"purple",label:"Purple",value:"#800080"},{color:"orange",label:"Orange",value:"#FFA500"},{color:"pink",label:"Pink",value:"#FFC0CB"},{color:"gray",label:"Gray",value:"#808080"}],Cs=[{type:"approved",label:"Approved",emoji:"✅"},{type:"rejected",label:"Rejected",emoji:"❌"},{type:"reviewed",label:"Reviewed",emoji:"👁️"},{type:"confidential",label:"Confidential",emoji:"🔒"},{type:"draft",label:"Draft",emoji:"📝"}];function ks({activeTool:a,onToolSelect:h,onToolDeselect:f,className:o}){var A,u,b;const[r,d]=t.useState("yellow"),x=i=>{a.isActive&&a.type===i?f():h(i,r)},C=i=>{d(i),a.isActive&&h(a.type,i)},N=i=>{h("stamp",r)};return e.jsx(ms,{children:e.jsxs("div",{className:H("flex items-center space-x-1",o),children:[De.map(i=>{var k;const j=i.icon,g=a.isActive&&a.type===i.type;return i.type==="stamp"?e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(m,{variant:g?"default":"outline",size:"sm",className:H("relative",g&&"bg-blue-600 text-white"),children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx(Ce,{className:"h-3 w-3 ml-1"})]})}),e.jsx(ie,{align:"start",children:Cs.map(v=>e.jsxs(W,{onClick:()=>N(v.type),className:"flex items-center space-x-2",children:[e.jsx("span",{children:v.emoji}),e.jsx("span",{children:v.label})]},v.type))})]},i.type):e.jsxs(hs,{children:[e.jsx(us,{asChild:!0,children:e.jsxs(m,{variant:g?"default":"outline",size:"sm",onClick:()=>x(i.type),className:H("relative",g&&"bg-blue-600 text-white"),children:[e.jsx(j,{className:"h-4 w-4"}),g&&e.jsx(L,{variant:"secondary",className:"absolute -top-2 -right-2 h-4 w-4 p-0 flex items-center justify-center text-xs",style:{backgroundColor:(k=re.find(v=>v.color===a.color))==null?void 0:k.value},children:"●"})]})}),e.jsxs(ps,{children:[e.jsx("p",{className:"font-medium",children:i.label}),e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]})]},i.type)}),e.jsx(te,{orientation:"vertical",className:"h-6"}),e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(m,{variant:"outline",size:"sm",className:"flex items-center space-x-1",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:(A=re.find(i=>i.color===r))==null?void 0:A.value}}),e.jsx(Ce,{className:"h-3 w-3"})]})}),e.jsx(ie,{align:"start",children:e.jsx("div",{className:"grid grid-cols-4 gap-2 p-2",children:re.map(i=>e.jsx("button",{onClick:()=>C(i.color),className:H("w-8 h-8 rounded-full border-2 hover:scale-110 transition-transform",r===i.color?"border-gray-800":"border-gray-300"),style:{backgroundColor:i.value},title:i.label},i.color))})})]}),a.isActive&&e.jsxs(e.Fragment,{children:[e.jsx(te,{orientation:"vertical",className:"h-6"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsxs(L,{variant:"outline",className:"flex items-center space-x-1",children:[e.jsx("span",{children:(u=De.find(i=>i.type===a.type))==null?void 0:u.label}),e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:(b=re.find(i=>i.color===a.color))==null?void 0:b.value}})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:f,className:"h-6 px-2 text-xs",children:"Deselect"})]})]})]})})}const de={highlight:"Highlight",note:"Note",text:"Text",drawing:"Drawing",stamp:"Stamp"},xe={yellow:"Yellow",red:"Red",blue:"Blue",green:"Green",purple:"Purple",orange:"Orange",pink:"Pink",gray:"Gray"};function Ss({annotations:a,currentPage:h,selectedAnnotation:f,onAnnotationSelect:o,onAnnotationUpdate:r,onAnnotationDelete:d,onPageChange:x,readOnly:C=!1,className:N}){var Y;const[A,u]=t.useState(""),[b,i]=t.useState("all"),[j,g]=t.useState("all"),[k,v]=t.useState(null),[S,P]=t.useState(""),[p,n]=t.useState(!1),[y,w]=t.useState("");fs(((Y=f.annotation)==null?void 0:Y.id)||"");const{shareAnnotation:T}=Ns(),O=t.useMemo(()=>a.filter(s=>{var l,z,I,R;if(A){const E=A.toLowerCase(),M=(l=s.content)==null?void 0:l.toLowerCase().includes(E),D=(z=s.selectedText)==null?void 0:z.toLowerCase().includes(E),J=(R=(I=s.user)==null?void 0:I.email)==null?void 0:R.toLowerCase().includes(E);if(!M&&!D&&!J)return!1}return!(b!=="all"&&s.annotationType!==b||j!=="all"&&s.color!==j)}),[a,A,b,j]),q=t.useMemo(()=>{const s={};return O.forEach(l=>{s[l.pageNumber]||(s[l.pageNumber]=[]),s[l.pageNumber].push(l)}),s},[O]),Q=s=>{v(s.id),P(s.content||"")},K=async s=>{await r(s,{content:S}),v(null),P("")},G=()=>{v(null),P("")},X=async s=>{if(y)try{await T({annotationId:s.id,userEmail:y,permissionLevel:"view"}),n(!1),w("")}catch(l){console.error("Failed to share annotation:",l)}},Z=s=>{var I,R,E;const l=((I=f.annotation)==null?void 0:I.id)===s.id,z=k===s.id;return e.jsx(F,{className:H("mb-3 cursor-pointer transition-all",l&&"ring-2 ring-blue-500"),onClick:()=>o(s),children:e.jsxs(U,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{variant:"outline",className:"text-xs",children:de[s.annotationType]}),e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:s.color},title:xe[s.color]})]}),!C&&e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(Xe,{className:"h-3 w-3"})})}),e.jsxs(ie,{align:"end",children:[e.jsxs(W,{onClick:()=>Q(s),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(W,{onClick:()=>n(!0),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Share"]}),e.jsxs(W,{onClick:()=>d(s.id),className:"text-red-600",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),s.selectedText&&e.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded text-sm italic",children:['"',s.selectedText,'"']}),z?e.jsxs("div",{className:"space-y-2",children:[e.jsx(gs,{value:S,onChange:M=>P(M.target.value),placeholder:"Add your note...",className:"min-h-[60px]"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{size:"sm",onClick:()=>K(s.id),children:"Save"}),e.jsx(m,{size:"sm",variant:"outline",onClick:G,children:"Cancel"})]})]}):s.content&&e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:s.content}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Me,{className:"h-3 w-3"}),e.jsxs("span",{children:[(R=s.user)==null?void 0:R.firstName," ",(E=s.user)==null?void 0:E.lastName]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Je,{className:"h-3 w-3"}),e.jsx("span",{children:ue(new Date(s.createdAt),{addSuffix:!0})})]})]}),s.comments&&s.comments.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mb-1",children:[e.jsx(V,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.comments.length," comment(s)"]})]}),s.comments.slice(0,2).map(M=>{var D,J;return e.jsxs("div",{className:"text-xs bg-gray-50 p-2 rounded mb-1",children:[e.jsx("p",{children:M.content}),e.jsxs("span",{className:"text-gray-400",children:["by ",(D=M.user)==null?void 0:D.firstName," ",(J=M.user)==null?void 0:J.lastName]})]},M.id)})]})]})},s.id)};return e.jsxs("div",{className:H("w-80 bg-white border-l flex flex-col",N),children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("h3",{className:"font-semibold mb-3",children:["Annotations (",O.length,")"]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Se,{placeholder:"Search annotations...",value:A,onChange:s=>u(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(m,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(Ke,{className:"h-4 w-4 mr-1"}),b==="all"?"All Types":de[b]]})}),e.jsxs(ie,{children:[e.jsx(W,{onClick:()=>i("all"),children:"All Types"}),Object.entries(de).map(([s,l])=>e.jsx(W,{onClick:()=>i(s),children:l},s))]})]}),e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:j==="all"?"transparent":j}}),e.jsx("span",{children:j==="all"?"All Colors":xe[j]})]})})}),e.jsxs(ie,{children:[e.jsx(W,{onClick:()=>g("all"),children:"All Colors"}),Object.entries(xe).map(([s,l])=>e.jsx(W,{onClick:()=>g(s),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:s}}),e.jsx("span",{children:l})]})},s))]})]})]})]}),e.jsx(js,{className:"flex-1 p-4",children:Object.keys(q).length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No annotations found"}),e.jsx("p",{className:"text-sm",children:"Start by selecting an annotation tool"})]}):Object.entries(q).sort(([s],[l])=>parseInt(s)-parseInt(l)).map(([s,l])=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700",children:["Page ",s," (",l.length,")"]}),parseInt(s)!==h&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>x(parseInt(s)),className:"h-6 px-2 text-xs",children:["Go to page",e.jsx(Te,{className:"h-3 w-3 ml-1"})]})]}),l.map(Z)]},s))}),e.jsx(ge,{open:p,onOpenChange:n,children:e.jsxs(fe,{children:[e.jsx(Ne,{children:e.jsx(be,{children:"Share Annotation"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Se,{placeholder:"Enter email address",value:y,onChange:s=>w(s.target.value)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{onClick:()=>f.annotation&&X(f.annotation),disabled:!y,children:"Share"}),e.jsx(m,{variant:"outline",onClick:()=>n(!1),children:"Cancel"})]})]})]})})]})}function Fe({documentId:a,fileUrl:h,className:f,showAnnotations:o=!0,readOnly:r=!1,onAnnotationCreate:d,onAnnotationUpdate:x,onAnnotationDelete:C}){const[N,A]=t.useState(0),[u,b]=t.useState(1),[i,j]=t.useState(1),[g,k]=t.useState(0),[v,S]=t.useState(!0),[P,p]=t.useState(null),[n,y]=t.useState(!0),[w,T]=t.useState(!1),O=t.useRef(null),q=t.useRef(null),{annotations:Q,isLoading:K,createAnnotation:G,updateAnnotation:X,deleteAnnotation:Z}=Ie(a),{selectedAnnotation:Y,activeTool:s,drawingState:l,selectAnnotation:z,activateTool:I,deactivateTool:R,startDrawing:E,updateDrawingPath:M,stopDrawing:D}=bs(),J=t.useCallback(({numPages:c})=>{A(c),S(!1),p(null)},[]),Re=t.useCallback(c=>{p(`Failed to load PDF: ${c.message}`),S(!1)},[]),Ue=t.useCallback(()=>{b(c=>Math.max(1,c-1))},[]),Be=t.useCallback(()=>{b(c=>Math.min(N,c+1))},[N]),$e=t.useCallback(c=>{b(Math.max(1,Math.min(N,c)))},[N]),Ve=t.useCallback(()=>{j(c=>Math.min(3,c+.25))},[]),He=t.useCallback(()=>{j(c=>Math.max(.5,c-.25))},[]);t.useCallback(()=>{j(1)},[]);const Oe=t.useCallback(()=>{k(c=>(c+90)%360)},[]),Ge=t.useCallback(()=>{var c;document.fullscreenElement?(document.exitFullscreen(),T(!1)):((c=O.current)==null||c.requestFullscreen(),T(!0))},[]);t.useEffect(()=>{const c=()=>{T(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",c),()=>document.removeEventListener("fullscreenchange",c)},[]),t.useEffect(()=>{(async()=>{try{await ys()}catch(B){console.error("Failed to initialize PDF.js:",B)}})()},[]);const We=t.useCallback(async c=>{try{const B=await G({documentId:a,pageNumber:u,...c});d==null||d(B)}catch(B){console.error("Failed to create annotation:",B)}},[G,a,u,d]),ve=t.useCallback(async(c,B)=>{try{const oe=await X(c,B);x==null||x(oe)}catch(oe){console.error("Failed to update annotation:",oe)}},[X,x]),ye=t.useCallback(async c=>{try{await Z(c),C==null||C(c)}catch(B){console.error("Failed to delete annotation:",B)}},[Z,C]),we=Q.filter(c=>c.pageNumber===u);return P?e.jsxs(F,{className:"p-8 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:P}),e.jsx(m,{onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{ref:O,className:H("flex h-full bg-gray-50",w&&"fixed inset-0 z-50 bg-black",f),children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:Ue,disabled:u<=1,children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm font-medium",children:["Page ",u," of ",N]}),e.jsx(m,{variant:"outline",size:"sm",onClick:Be,disabled:u>=N,children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(te,{orientation:"vertical",className:"h-6"}),e.jsx(m,{variant:"outline",size:"sm",onClick:He,children:e.jsx(es,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm font-medium min-w-[60px] text-center",children:[Math.round(i*100),"%"]}),e.jsx(m,{variant:"outline",size:"sm",onClick:Ve,children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(m,{variant:"outline",size:"sm",onClick:Oe,children:e.jsx(as,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o&&!r&&e.jsx(ks,{activeTool:s,onToolSelect:I,onToolDeselect:R}),e.jsx(te,{orientation:"vertical",className:"h-6"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>y(!n),children:["Annotations (",we.length,")"]}),e.jsx(m,{variant:"outline",size:"sm",onClick:Ge,children:e.jsx(ts,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-100 p-4",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{ref:q,className:"relative bg-white shadow-lg",style:{transform:`rotate(${g}deg)`},children:e.jsxs(ls,{file:h,onLoadSuccess:J,onLoadError:Re,loading:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:[e.jsx(ns,{pageNumber:u,scale:i,renderTextLayer:!1,renderAnnotationLayer:!1}),o&&e.jsx(ws,{annotations:we,scale:i,rotation:g,activeTool:s,selectedAnnotation:Y,drawingState:l,readOnly:r,onAnnotationCreate:We,onAnnotationSelect:z,onAnnotationUpdate:ve,onAnnotationDelete:ye,onDrawingStart:E,onDrawingUpdate:M,onDrawingEnd:D})]})})})})]}),o&&n&&e.jsx(Ss,{annotations:Q,currentPage:u,selectedAnnotation:Y,onAnnotationSelect:z,onAnnotationUpdate:ve,onAnnotationDelete:ye,onPageChange:$e,readOnly:r})]})}function Ds({document:a,className:h,readOnly:f=!1,showMetadata:o=!0,showAnnotations:r=!0,onDocumentUpdate:d}){const[x,C]=t.useState("viewer"),[N,A]=t.useState(!1),{annotations:u,isLoading:b}=Ie(a.id),i=a.fileType==="application/pdf"||a.fileName.toLowerCase().endsWith(".pdf"),j=n=>{console.log("Annotation created:",n)},g=n=>{console.log("Annotation updated:",n)},k=n=>{console.log("Annotation deleted:",n)},v=()=>{if(a.fileUrl){const n=a.createElement("a");n.href=a.fileUrl,n.download=a.fileName,n.click()}},S=()=>{navigator.share?navigator.share({title:a.fileName,text:`Check out this document: ${a.fileName}`,url:a.fileUrl}):navigator.clipboard.writeText(a.fileUrl||"")},P=n=>{if(n===0)return"0 Bytes";const y=1024,w=["Bytes","KB","MB","GB"],T=Math.floor(Math.log(n)/Math.log(y));return parseFloat((n/Math.pow(y,T)).toFixed(2))+" "+w[T]},p=n=>n.includes("pdf")?"📄":n.includes("image")?"🖼️":n.includes("text")?"📝":n.includes("word")?"📘":n.includes("excel")?"📊":n.includes("powerpoint")?"📈":"📁";return e.jsxs("div",{className:H("h-full flex flex-col",h),children:[e.jsxs("div",{className:"bg-white border-b p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:p(a.fileType)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:a.fileName}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{children:P(a.fileSize)})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(rs,{className:"h-4 w-4"}),e.jsx("span",{children:ue(new Date(a.uploadedAt),{addSuffix:!0})})]}),r&&u.length>0&&e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsxs("span",{children:[u.length," annotation(s)"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:v,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:S,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Share"]}),i&&e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>A(!0),children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Fullscreen"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-3",children:[e.jsx(L,{variant:a.processingStatus==="completed"?"default":"secondary",children:a.processingStatus}),a.ocrText&&e.jsxs(L,{variant:"outline",children:[e.jsx(os,{className:"h-3 w-3 mr-1"}),"OCR Processed"]}),a.embeddings&&e.jsxs(L,{variant:"outline",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Searchable"]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(Le,{value:x,onValueChange:C,className:"h-full flex flex-col",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3",children:[e.jsxs(_,{value:"viewer",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Viewer"]}),o&&e.jsxs(_,{value:"metadata",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Metadata"]}),r&&e.jsxs(_,{value:"annotations",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Annotations (",u.length,")"]})]}),e.jsx(ee,{value:"viewer",className:"flex-1 overflow-hidden",children:i?e.jsx(Fe,{documentId:a.id,fileUrl:a.fileUrl,showAnnotations:r,readOnly:f,onAnnotationCreate:j,onAnnotationUpdate:g,onAnnotationDelete:k,className:"h-full"}):e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-50",children:e.jsx(F,{className:"max-w-md",children:e.jsxs(U,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:p(a.fileType)}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:a.fileName}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This file type doesn't support inline viewing with annotations."}),e.jsxs(m,{onClick:v,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Download to View"]})]})})})}),o&&e.jsx(ee,{value:"metadata",className:"flex-1 overflow-auto p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"File Information"})}),e.jsx(U,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"File Name"}),e.jsx("p",{className:"text-sm",children:a.fileName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"File Type"}),e.jsx("p",{className:"text-sm",children:a.fileType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"File Size"}),e.jsx("p",{className:"text-sm",children:P(a.fileSize)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Uploaded"}),e.jsx("p",{className:"text-sm",children:vs(new Date(a.uploadedAt),"PPP")})]})]})})]}),e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Processing Status"})}),e.jsx(U,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx(L,{variant:a.processingStatus==="completed"?"default":"secondary",children:a.processingStatus})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"OCR Processed"}),e.jsx("p",{className:"text-sm",children:a.ocrText?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Searchable"}),e.jsx("p",{className:"text-sm",children:a.embeddings?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Annotations"}),e.jsxs("p",{className:"text-sm",children:[u.length," annotation(s)"]})]})]})})]}),a.ocrText&&e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Extracted Text (OCR)"})}),e.jsx(U,{children:e.jsx("div",{className:"max-h-64 overflow-auto bg-gray-50 p-4 rounded text-sm",children:a.ocrText})})]})]})}),r&&e.jsx(ee,{value:"annotations",className:"flex-1 overflow-auto p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:b?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading annotations..."})]}):u.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No annotations yet"}),e.jsx("p",{className:"text-gray-500",children:i?"Switch to the viewer tab to start adding annotations to this PDF.":"Annotations are only available for PDF documents."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["All Annotations (",u.length,")"]}),u.map(n=>{var y,w;return e.jsx(F,{children:e.jsxs(U,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{variant:"outline",children:n.annotationType}),e.jsxs(L,{variant:"outline",children:["Page ",n.pageNumber]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:ue(new Date(n.createdAt),{addSuffix:!0})})]}),n.selectedText&&e.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded text-sm italic",children:['"',n.selectedText,'"']}),n.content&&e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:n.content}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsx(Me,{className:"h-3 w-3"}),e.jsxs("span",{children:[(y=n.user)==null?void 0:y.firstName," ",(w=n.user)==null?void 0:w.lastName]}),n.comments&&n.comments.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(te,{orientation:"vertical",className:"h-3"}),e.jsx(V,{className:"h-3 w-3"}),e.jsxs("span",{children:[n.comments.length," comment(s)"]})]})]})]})},n.id)})]})})})]})}),e.jsx(ge,{open:N,onOpenChange:A,children:e.jsxs(fe,{className:"max-w-[95vw] max-h-[95vh] w-full h-full",children:[e.jsx(Ne,{children:e.jsx(be,{children:a.fileName})}),i&&e.jsx(Fe,{documentId:a.id,fileUrl:a.fileUrl,showAnnotations:r,readOnly:f,onAnnotationCreate:j,onAnnotationUpdate:g,onAnnotationDelete:k,className:"h-full"})]})})]})}const Fs={id:"demo-pdf-1",fileName:"Sample Legal Document.pdf",fileType:"application/pdf",fileSize:2048576,fileUrl:"/sample-legal-document.pdf",uploadedAt:new Date().toISOString(),processingStatus:"completed",ocrText:"This is a sample legal document with extracted text content...",embeddings:!0,userId:"demo-user",isPublic:!1,tags:["legal","contract","sample"],metadata:{title:"Sample Legal Document",author:"LawMattersSG",subject:"PDF Annotations Demo"}},Ae=[{icon:ce,title:"Text Highlighting",description:"Highlight important text passages with customizable colors",status:"implemented"},{icon:V,title:"Sticky Notes",description:"Add contextual notes and comments to specific areas",status:"implemented"},{icon:pe,title:"Freehand Drawing",description:"Draw annotations directly on the PDF with various tools",status:"implemented"},{icon:Pe,title:"Digital Stamps",description:"Add approval stamps, signatures, and status markers",status:"implemented"},{icon:je,title:"Collaborative Annotations",description:"Share annotations with team members and clients",status:"implemented"},{icon:me,title:"Export Annotations",description:"Export annotated PDFs with all markups preserved",status:"planned"}];function Vs(){const[a,h]=t.useState("demo"),[f,o]=t.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"PDF Annotations"})]}),e.jsx(L,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"✅ Fully Implemented"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>o(!0),children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Features"]}),e.jsxs(m,{children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Upload PDF"]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(Le,{value:a,onValueChange:h,className:"space-y-6",children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3",children:[e.jsxs(_,{value:"demo",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Live Demo"]}),e.jsxs(_,{value:"features",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Features"]}),e.jsxs(_,{value:"integration",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Integration"]})]}),e.jsx(ee,{value:"demo",className:"space-y-6",children:e.jsxs(F,{children:[e.jsxs(se,{children:[e.jsxs(ae,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-5 w-5"}),e.jsx("span",{children:"Interactive PDF Viewer with Annotations"})]}),e.jsx("p",{className:"text-gray-600",children:"Try out the complete PDF annotations system. Use the toolbar to highlight text, add notes, draw annotations, and collaborate with others."})]}),e.jsxs(U,{children:[e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-2",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Demo Note: This uses a sample PDF. In production, users can upload their own documents."})]})}),e.jsx("div",{className:"h-[600px] border rounded-lg overflow-hidden",children:e.jsx(Ds,{document:Fs,showAnnotations:!0,showMetadata:!0,readOnly:!1})})]})]})}),e.jsxs(ee,{value:"features",className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ae.map((r,d)=>{const x=r.icon;return e.jsx(F,{children:e.jsxs(U,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(x,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.title}),e.jsxs(L,{variant:r.status==="implemented"?"default":"secondary",className:"mt-1",children:[r.status==="implemented"?e.jsx($,{className:"h-3 w-3 mr-1"}):e.jsx(ke,{className:"h-3 w-3 mr-1"}),r.status]})]})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:r.description})]})},d)})}),e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Technical Implementation"})}),e.jsx(U,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Frontend Components"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"• PdfViewer - Main PDF display component"}),e.jsx("li",{children:"• AnnotationLayer - Handles annotation rendering"}),e.jsx("li",{children:"• AnnotationToolbar - Tool selection interface"}),e.jsx("li",{children:"• AnnotationSidebar - Annotation management"}),e.jsx("li",{children:"• EnhancedDocumentViewer - Complete document interface"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Backend Features"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"• PostgreSQL database with RLS policies"}),e.jsx("li",{children:"• Real-time collaboration support"}),e.jsx("li",{children:"• Annotation sharing and permissions"}),e.jsx("li",{children:"• Comment threading system"}),e.jsx("li",{children:"• Export and import capabilities"})]})]})]})})]})]}),e.jsx(ee,{value:"integration",className:"space-y-6",children:e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Integration with LawMattersSG"})}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Document Management"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Seamless integration with document upload system"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"OCR text extraction for searchable annotations"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Version control and document history"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Secure file storage with Supabase"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"User Experience"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Intuitive annotation tools and interface"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Real-time collaboration features"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Mobile-responsive design"})]}),e.jsxs("li",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{children:"Keyboard shortcuts and accessibility"})]})]})]})]}),e.jsx(te,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Usage Scenarios"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(F,{className:"p-4",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Legal Document Review"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Lawyers can annotate contracts, highlight key clauses, and add review comments."})]}),e.jsxs(F,{className:"p-4",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Client Collaboration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Share annotated documents with clients for feedback and approval."})]}),e.jsxs(F,{className:"p-4",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Case Preparation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Organize evidence, mark important sections, and prepare case materials."})]})]})]})]})]})})]})}),e.jsx(ge,{open:f,onOpenChange:o,children:e.jsxs(fe,{className:"max-w-2xl",children:[e.jsx(Ne,{children:e.jsx(be,{children:"PDF Annotations Features"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Our PDF annotations system provides a complete set of tools for document markup and collaboration."}),e.jsx("div",{className:"space-y-3",children:Ae.map((r,d)=>{const x=r.icon;return e.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[e.jsx(x,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"font-medium",children:r.title}),e.jsx(L,{variant:r.status==="implemented"?"default":"secondary",className:"text-xs",children:r.status})]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description})]})]},d)})})]})]})})]})}export{Vs as default};
