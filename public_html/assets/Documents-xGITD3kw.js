const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdfWorker-CK_K2TCs.js","./supabase-DX_zaqH8.js","./react-vendor-C9QDz5CC.js","./ocr-worker-C8DaBqtP.js","./index-COrRy3_e.js","./ui-components-M2RDdGkt.js","./data-fetching-Cw7dONgA.js","./utilities-DM8KXhwQ.js","./forms-DacywvDT.js","./index-B6zMJYRV.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,__publicField=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{r as s,j as t,R as a}from"./react-vendor-C9QDz5CC.js";import{v as r,w as n,J as i,F as c,x as l,C as o,t as d,u as m,y as x,n as u,B as h,z as p,A as g,E as j,G as f,H as y,K as N,P as w,L as v,M as b,N as S,I as k,O as D,g as C,D as _,a as z,b as T,d as E,p as U,q as A,r as F,s as P,S as I,Q as O,R,U as M,V as $,W as L,X as q,Y as B,o as V,i as W,Z as Q,_ as K,$ as H,a0 as Y,a1 as G,a2 as X,a3 as J,a4 as Z,a5 as ee,a6 as se,a7 as te,a8 as ae}from"./index-COrRy3_e.js";import{_ as re}from"./supabase-DX_zaqH8.js";import{a as ne,g as ie,s as ce,e as le}from"./openai-BCgshE9S.js";import{aN as oe,F as de,r as me,a$ as xe,X as ue,aQ as he,bZ as pe,Z as ge,aY as je,n as fe,bU as ye,w as Ne,bP as we,v as ve,N as be,K as Se,y as ke,aC as De,aI as Ce,H as _e,bV as ze,bW as Te,bQ as Ee,p as Ue,b_ as Ae,bD as Fe,a_ as Pe,bX as Ie,a2 as Oe,a3 as Re,bE as Me,aH as $e,bI as Le,bx as qe,bu as Be,bw as Ve,ap as We,a4 as Qe,b$ as Ke,aM as He,W as Ye,aF as Ge}from"./ui-components-M2RDdGkt.js";import{f as Xe,l as Je}from"./utilities-DM8KXhwQ.js";import{b as Ze}from"./useAnnotations-DRaOyPzN.js";import{b as es,s as ss,e as ts,n as as,d as rs,u as ns}from"./forms-DacywvDT.js";import{c as is,t as cs,s as ls}from"./search-C2gYYNQ9.js";import{a as os,u as ds,b as ms}from"./data-fetching-Cw7dONgA.js";import"./ai-services-BdAg_3mV.js";const xs=s.createContext(null),us={didCatch:!1,error:null};class ErrorBoundary extends s.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=us}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var s,t,a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];null===(s=(t=this.props).onReset)||void 0===s||s.call(t,{args:r,reason:"imperative-api"}),this.setState(us)}}componentDidCatch(e,s){var t,a;null===(t=(a=this.props).onError)||void 0===t||t.call(a,e,s)}componentDidUpdate(e,s){const{didCatch:t}=this.state,{resetKeys:a}=this.props;var r,n;t&&null!==s.error&&function hasArrayChanged(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==s.length||e.some((e,t)=>!Object.is(e,s[t]))}(e.resetKeys,a)&&(null===(r=(n=this.props).onReset)||void 0===r||r.call(n,{next:a,prev:e.resetKeys,reason:"keys"}),this.setState(us))}render(){const{children:e,fallbackRender:t,FallbackComponent:a,fallback:r}=this.props,{didCatch:n,error:i}=this.state;let c=e;if(n){const e={error:i,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)c=t(e);else if(a)c=s.createElement(a,e);else{if(void 0===r)throw i;c=r}}return s.createElement(xs.Provider,{value:{didCatch:n,error:i,resetErrorBoundary:this.resetErrorBoundary}},c)}}async function extractTextFromDocument(e,s){const t=e.type.toLowerCase(),a=e.name.toLowerCase();if("application/pdf"===t||a.endsWith(".pdf"))return async function extractTextFromPDF(e,s){const t=Date.now();try{s?.({status:"initializing",progress:0,message:"Loading PDF..."});const{getPdfJs:a}=await re(async()=>{const{getPdfJs:e}=await import("./pdfWorker-CK_K2TCs.js");return{getPdfJs:e}},__vite__mapDeps([0,1,2]),import.meta.url),r=await a();if(!r)throw new Error("PDF.js failed to load");const n=await e.arrayBuffer(),i=await r.getDocument({data:n}).promise,c=i.numPages,l=[];let o="";for(let e=1;e<=c;e++){s?.({status:"processing",progress:(e-1)/c*100,currentPage:e,totalPages:c,message:`Processing page ${e} of ${c}...`});const t=await i.getPage(e),a=(await t.getTextContent()).items.map(e=>e.str).join(" ").trim();l.push({pageNumber:e,text:a,confidence:.95}),o+=a+"\n"}const d=Date.now()-t;return s?.({status:"completed",progress:100,message:"PDF processing completed"}),{text:o.trim(),confidence:.95,pages:l,metadata:{processingTime:d,fileSize:e.size,pageCount:c}}}catch(a){throw console.error("Error extracting text from PDF:",a),s?.({status:"error",progress:0,message:"Failed to process PDF"}),new Error("Failed to extract text from PDF")}}(e,s);if(t.startsWith("image/")||a.endsWith(".jpg")||a.endsWith(".jpeg")||a.endsWith(".png")||a.endsWith(".gif")||a.endsWith(".bmp")||a.endsWith(".tiff"))return async function extractTextFromImage(e,s){const t=Date.now();try{s?.({status:"initializing",progress:0,message:"Initializing OCR..."});const a=await re(()=>import("./ocr-worker-C8DaBqtP.js").then(e=>e.i),__vite__mapDeps([3,2]),import.meta.url),r=await a.recognize(e,"eng",{logger:e=>{"recognizing text"===e.status&&s?.({status:"processing",progress:100*e.progress,message:`OCR processing: ${Math.round(100*e.progress)}%`})}}),n=Date.now()-t;return s?.({status:"completed",progress:100,message:"OCR processing completed"}),{text:r.data.text,confidence:r.data.confidence/100,pages:[{pageNumber:1,text:r.data.text,confidence:r.data.confidence/100}],metadata:{processingTime:n,fileSize:e.size,pageCount:1}}}catch(a){throw console.error("Error performing OCR:",a),s?.({status:"error",progress:0,message:"OCR processing failed"}),new Error("Failed to perform OCR on image")}}(e,s);if("text/plain"===t||a.endsWith(".txt")){const t=Date.now();s?.({status:"processing",progress:50,message:"Reading text file..."});const a=await e.text(),r=Date.now()-t;return s?.({status:"completed",progress:100,message:"Text file processed"}),{text:a,confidence:1,pages:[{pageNumber:1,text:a,confidence:1}],metadata:{processingTime:r,fileSize:e.size,pageCount:1}}}throw new Error(`Unsupported file type: ${t}`)}function validateOCRQuality(e){const{text:s,confidence:t}=e,a=[];t<.7&&a.push("Low confidence detected. Consider rescanning with higher resolution.");const r=[/[0O]{3,}/,/[1Il]{3,}/,/\s{5,}/,/[^\w\s.,;:!?()-]{3,}/].some(e=>e.test(s));r&&a.push("Potential OCR errors detected. Review the extracted text carefully."),s.length<50&&a.push("Very little text extracted. Ensure the document contains readable text.");let n=t;return r&&(n-=.2),s.length<50&&(n-=.3),n=Math.max(0,Math.min(1,n)),{isGoodQuality:n>=.7,suggestions:a,qualityScore:n}}function cleanExtractedText(e){return e.replace(/\s+/g," ").replace(/[^\w\s.,;:!?()"-]/g,"").replace(/0/g,"O").replace(/1/g,"I").replace(/\n+/g,"\n").trim()}async function processDocument(e,s,t){try{const{usageTrackingService:n}=await re(async()=>{const{usageTrackingService:e}=await import("./index-COrRy3_e.js").then(e=>e.al);return{usageTrackingService:e}},__vite__mapDeps([4,2,1,5,6,7,8,9]),import.meta.url),i=await n.checkUsageLimit("ai_query");if(!i.allowed)throw new Error(`AI processing limit exceeded. You have used ${i.current}/${i.limit} AI queries this month. Please upgrade your plan to continue.`);t?.({stage:"ocr",progress:0,message:"Starting text extraction..."});const c=await extractTextFromDocument(e,e=>{t?.({stage:"ocr",progress:.4*e.progress,message:e.message||"Extracting text..."})}),l=validateOCRQuality(c),o=cleanExtractedText(c.text),{error:d}=await r.from("uploaded_documents").update({ocr_text:o,ocr_quality_score:l.qualityScore,processing_status:"processing",updated_at:(new Date).toISOString()}).eq("id",s);if(d)throw new Error(`Failed to update OCR results: ${d.message}`);t?.({stage:"analysis",progress:40,message:"Analyzing document content..."});const m=await ne(o);await n.incrementUsage("ai_query",s,{operation:"document_analysis",text_length:o.length,document_type:e.type});const{error:x}=await r.from("uploaded_documents").update({document_structure:{analysis:m,ocrQuality:l,metadata:c.metadata},updated_at:(new Date).toISOString()}).eq("id",s);if(x)throw new Error(`Failed to update analysis results: ${x.message}`);let u;if(t?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),o.length>50)try{const e=function splitTextIntoChunks(e,s=1e3){const t=[],a=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let r="";for(const n of a){const e=n.trim();r.length+e.length+1<=s?r+=(r?". ":"")+e:(r&&t.push(r+"."),r=e)}r&&t.push(r+".");if(0===t.length){const a=e.split(/\s+/);let r="";for(const e of a)r.length+e.length+1<=s?r+=(r?" ":"")+e:(r&&t.push(r),r=e);r&&t.push(r)}return t.filter(e=>e.trim().length>0)}(o,1e3);for(let a=0;a<e.length;a++){const n=e[a],i=await ie(n),{data:c,error:l}=await r.from("document_embeddings").insert({document_id:s,chunk_text:n,chunk_index:a,embedding:i.embedding,metadata:{usage:i.usage,chunkLength:n.length,totalChunks:e.length}}).select("id").single();l?console.error("Failed to store embedding:",l):0===a&&(u=c.id);const o=70+(a+1)/e.length*20;t?.({stage:"embedding",progress:o,message:`Processing chunk ${a+1} of ${e.length}...`})}}catch(a){console.error("Embedding generation failed:",a)}t?.({stage:"completed",progress:95,message:"Finalizing document processing..."});const{data:h,error:p}=await r.from("uploaded_documents").update({processing_status:"completed",updated_at:(new Date).toISOString()}).eq("id",s).select().single();if(p)throw new Error(`Failed to finalize document: ${p.message}`);return t?.({stage:"completed",progress:100,message:"Document processing completed successfully!"}),{document:h,ocrResult:c,analysis:m,embeddingId:u}}catch(n){throw console.error("Document processing failed:",n),await r.from("uploaded_documents").update({processing_status:"failed",updated_at:(new Date).toISOString()}).eq("id",s),t?.({stage:"error",progress:0,message:"Document processing failed",error:n instanceof Error?n.message:"Unknown error"}),n}}new class WebSocketService{constructor(){__publicField(this,"ws",null),__publicField(this,"reconnectAttempts",0),__publicField(this,"maxReconnectAttempts",5),__publicField(this,"reconnectDelay",1e3),__publicField(this,"handlers",new Map),__publicField(this,"isConnecting",!1),__publicField(this,"userId",null),console.log("WebSocket service initialized but connections disabled in production")}setupAuthListener(){r.auth.onAuthStateChange((e,s)=>{"SIGNED_IN"===e&&s?.user?(this.userId=s.user.id,this.connect()):"SIGNED_OUT"===e&&(this.userId=null,this.disconnect())})}async connect(){console.log("WebSocket connection skipped - disabled in production")}getWebSocketUrl(){return"https://kvlaydeyqidlfpfutbmp.supabase.co".replace("https://","wss://")+"/realtime/v1/websocket"}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.error("Max reconnection attempts reached");const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts);this.reconnectAttempts++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${e}ms`),setTimeout(()=>{this.connect()},e)}disconnect(){this.ws&&(this.ws.close(1e3,"User disconnected"),this.ws=null),this.isConnecting=!1,this.reconnectAttempts=0}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("WebSocket not connected, cannot send message:",e)}handleMessage(e){(this.handlers.get(e.type)||[]).forEach(s=>{try{s(e)}catch(t){console.error("Error in WebSocket message handler:",t)}});(this.handlers.get("all")||[]).forEach(s=>{try{s(e)}catch(t){console.error("Error in WebSocket all-events handler:",t)}})}subscribe(e,s){return this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(s),()=>{const t=this.handlers.get(e);if(t){const e=t.indexOf(s);e>-1&&t.splice(e,1)}}}sendDocumentProcessingUpdate(e){this.send({type:"document_processing",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0,documentId:e.documentId})}sendAIQueryUpdate(e){this.send({type:"ai_query",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}sendSystemNotification(e){this.send({type:"system_notification",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}get isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}get connectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"unknown"}}};const hs=new class DisabledWebSocketService{async connect(){}disconnect(){}subscribe(e,s){return()=>{}}sendDocumentProcessingUpdate(e){}sendAIQueryUpdate(e){}sendSystemNotification(e){}get isConnected(){return!1}get connectionState(){return"disabled"}};const DocumentUpload=({onUploadComplete:e,maxFiles:a=5})=>{const[r,k]=s.useState([]),[D,C]=s.useState(!1),[_,z]=s.useState(!1),{profile:T,loading:E}=n(),{simulateDocumentProcessing:U}=function useRealTimeSimulation(){return{simulateDocumentProcessing:s.useCallback(e=>{},[]),simulateAIQuery:s.useCallback(e=>{},[]),simulateSystemNotification:s.useCallback(e=>{hs.sendSystemNotification({id:`notification_${Date.now()}`,...e})},[])}}(),A=s.useCallback(e=>{T||E||i.warning("Profile not fully loaded. Upload will proceed with default settings."),z(!0);(async()=>{try{if(T){const{usageTrackingService:e}=await re(async()=>{const{usageTrackingService:e}=await import("./index-COrRy3_e.js").then(e=>e.al);return{usageTrackingService:e}},__vite__mapDeps([4,2,1,5,6,7,8,9]),import.meta.url),s=e.checkUsageLimit("document_upload"),t=new Promise((e,s)=>setTimeout(()=>s(new Error("Usage check timeout")),5e3)),a=await Promise.race([s,t]);if(!a.allowed)return i.error(`Upload limit reached. You have used ${a.current}/${a.limit} document uploads this month. Please upgrade your plan to continue.`),void z(!1);a.percentage>=80&&i.warning(`You have used ${a.current}/${a.limit} document uploads this month (${Math.round(a.percentage)}%).`)}else i.warning("Profile not loaded. Upload will proceed with default free tier limits.")}catch(s){console.error("Error checking usage limits:",s),i.warning("Unable to verify upload limits. Upload will proceed but may be subject to restrictions.")}z(!1),F(e)})()},[T]),F=s.useCallback(e=>{const s=T?.subscription_tier?c.maxSize[T.subscription_tier]:c.maxSize.free,t=e.filter(e=>!(e.size>s)||(i.error(`File ${e.name} is too large. Maximum size is ${Math.round(s/1024/1024)}MB`),!1)).map(e=>({file:e,id:crypto.randomUUID(),progress:0,status:"pending"}));k(e=>[...e,...t].slice(0,a))},[T,a]),{getRootProps:P,getInputProps:I,isDragActive:O}=l({onDrop:A,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:a,disabled:D||_||E}),R=r.some(e=>"pending"===e.status&&e.documentType);return t.jsxs(o,{className:"w-full",children:[t.jsxs(d,{children:[t.jsx(m,{children:"Upload Documents"}),t.jsx(x,{children:"Upload your legal documents for AI-powered analysis and processing"})]}),t.jsxs(u,{className:"space-y-4",children:[t.jsxs("div",{...P(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${O?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${D||_||E||!T?"opacity-50 cursor-not-allowed":""}`,children:[t.jsx("input",{...I()}),t.jsx(oe,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),E?t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:"Loading user profile..."}),t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):_?t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:"Checking upload limits..."}),t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):O?t.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop files here, or click to select files"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((T?.subscription_tier?c.maxSize[T.subscription_tier]:c.maxSize.free)/1024/1024),"MB"]})]})]}),r.length>0&&t.jsx("div",{className:"space-y-3",children:r.map(e=>t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(de,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium",children:e.file.name}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(e.file.size/1024)," KB)"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:["completed"===e.status&&t.jsx(me,{className:"h-4 w-4 text-green-500"}),"error"===e.status&&t.jsx(xe,{className:"h-4 w-4 text-red-500"}),"pending"===e.status&&t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void k(e=>e.filter(e=>e.id!==s));var s},children:t.jsx(ue,{className:"h-4 w-4"})})]})]}),"pending"===e.status&&t.jsx("div",{className:"mb-2",children:t.jsxs(p,{value:e.documentType||"",onValueChange:s=>{return t=e.id,a=s,void k(e=>e.map(e=>e.id===t?{...e,documentType:a}:e));var t,a},children:[t.jsx(g,{className:"w-full",children:t.jsx(j,{placeholder:"Select document type"})}),t.jsx(f,{children:Object.entries(y).map(([e,s])=>t.jsx(N,{value:e,children:s},e))})]})}),("uploading"===e.status||"processing"===e.status)&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:e.processingMessage||"Processing..."}),t.jsxs("span",{children:[Math.round(e.progress),"%"]})]}),t.jsx(w,{value:e.progress,className:"w-full"}),e.processingStage&&t.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:["ocr"===e.processingStage&&t.jsx(he,{className:"h-3 w-3"}),"analysis"===e.processingStage&&t.jsx(pe,{className:"h-3 w-3"}),"embedding"===e.processingStage&&t.jsx(ge,{className:"h-3 w-3"}),t.jsxs("span",{className:"capitalize",children:[e.processingStage," processing"]})]})]}),"error"===e.status&&e.error&&t.jsx(v,{variant:"destructive",children:t.jsx(b,{children:e.error})})]},e.id))}),r.length>0&&t.jsx(h,{onClick:async()=>{if(0!==r.length){C(!0);for(const a of r)if("pending"===a.status&&a.documentType)try{k(e=>e.map(e=>e.id===a.id?{...e,status:"uploading",progress:0,processingMessage:"Uploading file..."}:e));const t=await S.uploadDocument(a.file,a.documentType);try{const{usageTrackingService:e}=await re(async()=>{const{usageTrackingService:e}=await import("./index-COrRy3_e.js").then(e=>e.al);return{usageTrackingService:e}},__vite__mapDeps([4,2,1,5,6,7,8,9]),import.meta.url);await e.incrementUsage("document_upload",t.id,{filename:a.file.name,file_size:a.file.size,document_type:a.documentType})}catch(s){console.warn("Usage tracking increment failed:",s)}k(e=>e.map(e=>e.id===a.id?{...e,status:"processing",progress:20,documentId:t.id,processingMessage:"Starting AI processing..."}:e)),hs.sendDocumentProcessingUpdate({documentId:t.id,status:"processing",progress:20,message:"Starting AI processing..."}),await processDocument(a.file,t.id,e=>{k(s=>s.map(s=>s.id===a.id?{...s,progress:20+.8*e.progress,processingStage:e.stage,processingMessage:e.message}:s)),hs.sendDocumentProcessingUpdate({documentId:t.id,status:"processing",progress:20+.8*e.progress,message:e.message,stage:e.stage})}),k(e=>e.map(e=>e.id===a.id?{...e,status:"completed",progress:100,processingMessage:"Processing completed!"}:e)),hs.sendDocumentProcessingUpdate({documentId:t.id,status:"completed",progress:100,message:"Document processing completed successfully!"}),i.success(`${a.file.name} uploaded and processed successfully`),e&&e(t.id)}catch(t){console.error("Upload/processing error:",t),k(e=>e.map(e=>e.id===a.id?{...e,status:"error",error:t.message??"Upload or processing failed",processingMessage:"Failed"}:e));const e=r.find(e=>e.id===a.id);e?.documentId&&hs.sendDocumentProcessingUpdate({documentId:e.documentId,status:"failed",progress:0,message:"Document processing failed",error:t.message??"Upload or processing failed"}),i.error(`Failed to process ${a.file.name}: ${t.message}`)}C(!1)}},disabled:!R||D,className:"w-full",children:D?"Uploading...":`Upload ${r.filter(e=>"pending"===e.status).length} Files`})]})]})},DocumentUploadFallback=({onUploadComplete:e,maxFiles:a=5})=>{const[r,n]=s.useState([]),[c,l]=s.useState(!1);return t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsxs(m,{className:"flex items-center",children:[t.jsx(oe,{className:"h-5 w-5 mr-2"}),"Document Upload (Fallback Mode)"]}),t.jsx(x,{children:"Basic file upload functionality"})]}),t.jsxs(u,{className:"space-y-4",children:[t.jsxs(v,{children:[t.jsx(xe,{className:"h-4 w-4"}),t.jsx(b,{children:"Advanced upload features are temporarily unavailable. Using basic upload mode."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"file-input",className:"block text-sm font-medium",children:"Select Files"}),t.jsx("input",{id:"file-input",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt",onChange:e=>{const s=Array.from(e.target.files||[]).filter(e=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(e.type)?!(e.size>10485760)||(i.error(`${e.name} is too large (max 10MB)`),!1):(i.error(`${e.name} is not a supported file type`),!1));n(e=>[...e,...s].slice(0,a))},disabled:c,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Supports PDF, DOC, DOCX, TXT files up to 10MB each"})]}),r.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Selected Files:"}),r.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(de,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm",children:e.name}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(e.size/1024)," KB)"]})]}),t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(s=>s.filter((s,t)=>t!==e))})(s),disabled:c,children:"Remove"})]},s))]}),t.jsx(h,{onClick:async()=>{if(0!==r.length){l(!0);try{for(const s of r)await new Promise(e=>setTimeout(e,1e3)),console.log("Uploading file:",s.name),e&&e(`mock-id-${Date.now()}`);i.success(`Successfully uploaded ${r.length} file(s)`),n([])}catch(s){console.error("Upload error:",s),i.error("Upload failed. Please try again.")}finally{l(!1)}}else i.error("Please select files to upload")},disabled:0===r.length||c,className:"w-full",children:c?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(oe,{className:"h-4 w-4 mr-2"}),"Upload ",r.length," File(s)"]})})]})]})},UploadLoadingFallback=()=>t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsxs(m,{className:"flex items-center",children:[t.jsx(oe,{className:"h-5 w-5 mr-2"}),"Document Upload"]}),t.jsx(x,{children:"Loading upload interface..."})]}),t.jsx(u,{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Initializing upload component..."})]})})]}),UploadErrorFallback=({error:e,resetErrorBoundary:s})=>t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsxs(m,{className:"flex items-center text-red-600",children:[t.jsx(xe,{className:"h-5 w-5 mr-2"}),"Upload Error"]}),t.jsx(x,{children:"The upload component encountered an error"})]}),t.jsxs(u,{className:"space-y-4",children:[t.jsxs(v,{variant:"destructive",children:[t.jsx(xe,{className:"h-4 w-4"}),t.jsx(b,{children:e.message||"An unexpected error occurred while loading the upload component."})]}),t.jsx("div",{className:"flex space-x-2",children:t.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Try Again"})}),t.jsxs("details",{className:"text-xs text-gray-500",children:[t.jsx("summary",{className:"cursor-pointer",children:"Technical Details"}),t.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto",children:e.stack})]})]})]}),DocumentUploadWrapper=e=>t.jsx(ErrorBoundary,{FallbackComponent:UploadErrorFallback,onError:(e,s)=>{console.error("DocumentUpload Error:",e,s),"undefined"!=typeof window&&window.gtag&&window.gtag("event","exception",{description:e.message,fatal:!1})},onReset:()=>{console.log("Resetting DocumentUpload component")},children:t.jsx(s.Suspense,{fallback:t.jsx(UploadLoadingFallback,{}),children:t.jsx(DocumentUploadWithFallback,{...e})})}),DocumentUploadWithFallback=e=>{const[s,r]=a.useState(!0),[n,i]=a.useState(!1);return a.useEffect(()=>{i(!1)},[e]),n||!s?t.jsx(DocumentUploadFallback,{...e}):t.jsx(ErrorBoundary,{FallbackComponent:()=>(i(!0),t.jsx(DocumentUploadFallback,{...e})),onError:e=>{console.error("Main DocumentUpload failed, switching to fallback:",e),r(!1),i(!0)},children:t.jsx(DocumentUpload,{...e})})},DocumentList=({onDocumentSelect:e,refreshTrigger:a})=>{const[r,n]=s.useState([]),[c,l]=s.useState(!0),[w,v]=s.useState(""),[b,U]=s.useState("all"),[A,F]=s.useState("all");s.useEffect(()=>{loadDocuments()},[a]);const loadDocuments=async()=>{try{l(!0);const e=await S.getDocuments();n(e)}catch(e){console.error("Error loading documents:",e),i.error("Failed to load documents")}finally{l(!1)}},handleSearch=async()=>{if(w.trim())try{l(!0);const e=await S.searchDocuments(w);n(e)}catch(e){console.error("Error searching documents:",e),i.error("Failed to search documents")}finally{l(!1)}else loadDocuments()},getStatusIcon=e=>{switch(e){case"pending":return t.jsx(ve,{className:"h-4 w-4 text-yellow-500"});case"processing":return t.jsx(je,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return t.jsx(me,{className:"h-4 w-4 text-green-500"});case"failed":return t.jsx(xe,{className:"h-4 w-4 text-red-500"});default:return t.jsx(de,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},P=r.filter(e=>{const s="all"===b||e.processing_status===b,t="all"===A||e.document_type===A;return s&&t});return c&&0===r.length?t.jsx(o,{children:t.jsx(u,{className:"flex items-center justify-center py-8",children:t.jsx(je,{className:"h-8 w-8 animate-spin"})})}):t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsx(m,{children:"Documents"}),t.jsx(x,{children:"Manage and view your uploaded documents"})]}),t.jsxs(u,{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 flex gap-2",children:[t.jsx(k,{placeholder:"Search documents...",value:w,onChange:e=>v(e.target.value),onKeyPress:e=>"Enter"===e.key&&handleSearch()}),t.jsx(h,{onClick:handleSearch,variant:"outline",children:t.jsx(fe,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(p,{value:b,onValueChange:U,children:[t.jsx(g,{className:"w-32",children:t.jsx(j,{})}),t.jsxs(f,{children:[t.jsx(N,{value:"all",children:"All Status"}),Object.entries(D).map(([e,s])=>t.jsx(N,{value:e,children:s},e))]})]}),t.jsxs(p,{value:A,onValueChange:F,children:[t.jsx(g,{className:"w-32",children:t.jsx(j,{})}),t.jsxs(f,{children:[t.jsx(N,{value:"all",children:"All Types"}),Object.entries(y).map(([e,s])=>t.jsx(N,{value:e,children:s},e))]})]})]})]}),0===P.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(de,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents found"}),t.jsx("p",{className:"text-gray-500",children:0===r.length?"Upload your first document to get started":"Try adjusting your search or filters"})]}):t.jsx("div",{className:"space-y-3",children:P.map(s=>t.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[t.jsx(de,{className:"h-8 w-8 text-gray-400"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:s.filename}),t.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[t.jsx("span",{className:"text-xs text-gray-500",children:y[s.document_type]}),t.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(s.file_size/1024)," KB"]}),t.jsx("span",{className:"text-xs text-gray-500",children:Xe(new Date(s.created_at),{addSuffix:!0})})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[getStatusIcon(s.processing_status),t.jsx(C,{className:getStatusColor(s.processing_status),children:D[s.processing_status]})]}),t.jsxs(_,{children:[t.jsx(z,{asChild:!0,children:t.jsx(h,{variant:"ghost",size:"sm",children:t.jsx(ye,{className:"h-4 w-4"})})}),t.jsxs(T,{align:"end",children:[t.jsxs(E,{onClick:()=>e?.(s),children:[t.jsx(he,{className:"mr-2 h-4 w-4"}),"View"]}),t.jsxs(E,{onClick:()=>window.open(s.file_url,"_blank"),children:[t.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Download"]}),t.jsxs(E,{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this document?"))try{await S.deleteDocument(e),n(s=>s.filter(s=>s.id!==e)),i.success("Document deleted successfully")}catch(s){console.error("Error deleting document:",s),i.error("Failed to delete document")}})(s.id),className:"text-red-600",children:[t.jsx(we,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})},s.id))})]})]})},DocumentAnalysisComponent=({document:e,className:a=""})=>{const[r,n]=s.useState(null),[c,l]=s.useState(""),[p,g]=s.useState(null),[j,f]=s.useState(!1),[y,N]=s.useState(0),[S,k]=s.useState("overview");s.useEffect(()=>{if(e.document_structure&&"object"==typeof e.document_structure){const s=e.document_structure.analysis;s&&n(s)}},[e]);const performAnalysis=async()=>{if(e.ocr_text){f(!0),N(0);try{N(20);const s=await ne(e.ocr_text);n(s),N(50);const t=await ce(e.ocr_text,800);l(t),N(80);const a=await le(e.ocr_text);g(a),N(100),i.success("Document analysis completed successfully")}catch(s){console.error("Analysis error:",s),i.error("Failed to analyze document: "+s.message)}finally{f(!1)}}else i.error("No text content available for analysis")};return t.jsxs(o,{className:a,children:[t.jsx(d,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs(m,{className:"flex items-center space-x-2",children:[t.jsx(pe,{className:"h-5 w-5 text-purple-600"}),t.jsx("span",{children:"AI Document Analysis"})]}),t.jsxs(x,{children:["AI-powered analysis of ",e.filename]})]}),t.jsxs("div",{className:"flex space-x-2",children:[(r||c||p)&&t.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{const s={document:{filename:e.filename,type:e.document_type,uploadDate:e.created_at},analysis:r,summary:c,entities:p,generatedAt:(new Date).toISOString()},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=e.createElement("a");n.href=a,n.download=`${e.filename}_analysis.json`,e.body.appendChild(n),n.click(),e.body.removeChild(n),URL.revokeObjectURL(a)},children:[t.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Export"]}),t.jsx(h,{onClick:performAnalysis,disabled:j||!e.ocr_text,size:"sm",children:j?t.jsxs(t.Fragment,{children:[t.jsx(je,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(be,{className:"h-4 w-4 mr-2"}),r?"Re-analyze":"Analyze"]})})]})]})}),t.jsxs(u,{className:"space-y-4",children:[!e.ocr_text&&t.jsxs(v,{children:[t.jsx(Se,{className:"h-4 w-4"}),t.jsx(b,{children:"No text content available. Please ensure the document has been processed with OCR."})]}),j&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"Analyzing document..."}),t.jsxs("span",{children:[y,"%"]})]}),t.jsx(w,{value:y,className:"w-full"})]}),(r||c||p)&&t.jsxs(U,{value:S,onValueChange:k,children:[t.jsxs(A,{className:"grid w-full grid-cols-4",children:[t.jsx(F,{value:"overview",children:"Overview"}),t.jsx(F,{value:"summary",children:"Summary"}),t.jsx(F,{value:"entities",children:"Entities"}),t.jsx(F,{value:"insights",children:"Insights"})]}),t.jsxs(P,{value:"overview",className:"space-y-4",children:[r&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsx(m,{className:"text-sm",children:"Document Classification"})}),t.jsx(u,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(C,{variant:"secondary",children:r.documentType}),t.jsxs("div",{className:"text-sm "+(D=r.confidence,D>=.8?"text-green-600":D>=.6?"text-yellow-600":"text-red-600"),children:[(e=>e>=.8?"High":e>=.6?"Medium":"Low")(r.confidence)," confidence"]})]})})]}),t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsx(m,{className:"text-sm",children:"Key Entities"})}),t.jsx(u,{children:t.jsx("div",{className:"text-sm text-gray-600",children:r.keyEntities.length>0?t.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.keyEntities.slice(0,3).map((e,s)=>t.jsx(C,{variant:"outline",className:"text-xs",children:e},s)),r.keyEntities.length>3&&t.jsxs(C,{variant:"outline",className:"text-xs",children:["+",r.keyEntities.length-3," more"]})]}):"No key entities identified"})})]})]}),r&&t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsx(m,{className:"text-sm",children:"Executive Summary"})}),t.jsx(u,{children:t.jsx("p",{className:"text-sm text-gray-700",children:r.summary})})]})]}),t.jsx(P,{value:"summary",className:"space-y-4",children:c?t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsx(m,{className:"text-sm",children:"Document Summary"})}),t.jsx(u,{children:t.jsx("div",{className:"prose prose-sm max-w-none",children:t.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:c})})})]}):t.jsxs("div",{className:"text-center text-gray-500 py-8",children:[t.jsx(de,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:'No summary available. Click "Analyze" to generate one.'})]})}),t.jsx(P,{value:"entities",className:"space-y-4",children:p?t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsxs(m,{className:"text-sm flex items-center space-x-2",children:[t.jsx(ke,{className:"h-4 w-4"}),t.jsx("span",{children:"People"})]})}),t.jsx(u,{children:p.people.length>0?t.jsx("div",{className:"space-y-1",children:p.people.map((e,s)=>t.jsx(C,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsxs(m,{className:"text-sm flex items-center space-x-2",children:[t.jsx(de,{className:"h-4 w-4"}),t.jsx("span",{children:"Organizations"})]})}),t.jsx(u,{children:p.organizations.length>0?t.jsx("div",{className:"space-y-1",children:p.organizations.map((e,s)=>t.jsx(C,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsxs(m,{className:"text-sm flex items-center space-x-2",children:[t.jsx(De,{className:"h-4 w-4"}),t.jsx("span",{children:"Dates"})]})}),t.jsx(u,{children:p.dates.length>0?t.jsx("div",{className:"space-y-1",children:p.dates.map((e,s)=>t.jsx(C,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsxs(m,{className:"text-sm flex items-center space-x-2",children:[t.jsx(Ce,{className:"h-4 w-4"}),t.jsx("span",{children:"Amounts"})]})}),t.jsx(u,{children:p.amounts.length>0?t.jsx("div",{className:"space-y-1",children:p.amounts.map((e,s)=>t.jsx(C,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsxs(m,{className:"text-sm flex items-center space-x-2",children:[t.jsx(_e,{className:"h-4 w-4"}),t.jsx("span",{children:"Locations"})]})}),t.jsx(u,{children:p.locations.length>0?t.jsx("div",{className:"space-y-1",children:p.locations.map((e,s)=>t.jsx(C,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]})]}):t.jsxs("div",{className:"text-center text-gray-500 py-8",children:[t.jsx(ke,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:'No entities extracted. Click "Analyze" to extract entities.'})]})}),t.jsx(P,{value:"insights",className:"space-y-4",children:r&&t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsx(m,{className:"text-sm",children:"Legal Implications"})}),t.jsx(u,{children:r.legalImplications.length>0?t.jsx("ul",{className:"space-y-2",children:r.legalImplications.map((e,s)=>t.jsxs("li",{className:"flex items-start space-x-2",children:[t.jsx(Se,{className:"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"No legal implications identified"})})]}),t.jsxs(o,{children:[t.jsx(d,{className:"pb-3",children:t.jsx(m,{className:"text-sm",children:"Recommended Actions"})}),t.jsx(u,{children:r.recommendedActions.length>0?t.jsx("ul",{className:"space-y-2",children:r.recommendedActions.map((e,s)=>t.jsxs("li",{className:"flex items-start space-x-2",children:[t.jsx(me,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"No specific actions recommended"})})]})]})})]}),!r&&!c&&!p&&!j&&e.ocr_text&&t.jsxs("div",{className:"text-center text-gray-500 py-8",children:[t.jsx(pe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"mb-4",children:"Ready to analyze this document with AI"}),t.jsxs(h,{onClick:performAnalysis,children:[t.jsx(pe,{className:"h-4 w-4 mr-2"}),"Start Analysis"]})]})]})]});var D},ps=[{name:"Yellow",value:"#FFEB3B",bg:"rgba(255, 235, 59, 0.3)"},{name:"Green",value:"#4CAF50",bg:"rgba(76, 175, 80, 0.3)"},{name:"Blue",value:"#2196F3",bg:"rgba(33, 150, 243, 0.3)"},{name:"Red",value:"#F44336",bg:"rgba(244, 67, 54, 0.3)"},{name:"Purple",value:"#9C27B0",bg:"rgba(156, 39, 176, 0.3)"},{name:"Orange",value:"#FF9800",bg:"rgba(255, 152, 0, 0.3)"}],EnhancedPDFViewer=({documentUrl:e,documentId:a,className:r="",onAnnotationChange:c})=>{const[l,d]=s.useState(100),[m,x]=s.useState(0),[p,g]=s.useState(!1),[j,f]=s.useState("select"),[y,N]=s.useState(ps[0]),[w,v]=s.useState(!0),[b,S]=s.useState(!1),[k,D]=s.useState(null),[_,z]=s.useState(null),[T,E]=s.useState(null),[U,A]=s.useState(""),F=s.useRef(null),P=s.useRef(null),{annotations:W,isLoading:Q,createAnnotation:K,updateAnnotation:H,deleteAnnotation:Y}=Ze(a),{user:G}=n();s.useEffect(()=>{c?.(W)},[W,c]);const X=s.useCallback(e=>{if("select"===j)return;const s=F.current?.getBoundingClientRect();if(!s)return;const t=e.clientX-s.left,a=e.clientY-s.top;"highlight"===j?(S(!0),D({x:t,y:a}),z({x:t,y:a,width:0,height:0})):"note"!==j&&"sticky"!==j||handleCreateAnnotation(t,a)},[j]),J=s.useCallback(e=>{if(!b||!k||"highlight"!==j)return;const s=F.current?.getBoundingClientRect();if(!s)return;const t=e.clientX-s.left,a=e.clientY-s.top;z({x:Math.min(k.x,t),y:Math.min(k.y,a),width:Math.abs(t-k.x),height:Math.abs(a-k.y)})},[b,k,j]),Z=s.useCallback(()=>{b&&_&&"highlight"===j&&_.width>10&&_.height>10&&handleCreateHighlight(_),S(!1),D(null),z(null)},[b,_,j]),handleCreateAnnotation=async(e,s)=>{if(!G)return void i.error("Please log in to create annotations");const t=await K({type:j,page_number:1,position:{x:e,y:s},content:"",color:y.value});t&&(E(t.id),A(""))},handleCreateHighlight=async e=>{G?await K({type:"highlight",page_number:1,position:e,content:"Highlighted text",color:y.value}):i.error("Please log in to create highlights")},ee=p?"fixed inset-0 z-50 bg-white":r;return t.jsxs(o,{className:ee,children:[t.jsx("div",{className:"border-b p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex items-center space-x-1 border rounded-md",children:[t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{d(e=>Math.max(e-25,25))},children:t.jsx(ze,{className:"h-4 w-4"})}),t.jsxs("span",{className:"px-2 text-sm font-medium",children:[l,"%"]}),t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{d(e=>Math.min(e+25,300))},children:t.jsx(Te,{className:"h-4 w-4"})})]}),t.jsx(I,{orientation:"vertical",className:"h-6"}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(h,{variant:"select"===j?"default":"ghost",size:"sm",onClick:()=>f("select"),children:"Select"}),t.jsx(h,{variant:"highlight"===j?"default":"ghost",size:"sm",onClick:()=>f("highlight"),children:t.jsx(Ee,{className:"h-4 w-4"})}),t.jsx(h,{variant:"note"===j?"default":"ghost",size:"sm",onClick:()=>f("note"),children:t.jsx(Ue,{className:"h-4 w-4"})}),t.jsx(h,{variant:"sticky"===j?"default":"ghost",size:"sm",onClick:()=>f("sticky"),children:t.jsx(Ae,{className:"h-4 w-4"})})]}),t.jsx(I,{orientation:"vertical",className:"h-6"}),t.jsxs(O,{children:[t.jsx(R,{asChild:!0,children:t.jsxs(h,{variant:"ghost",size:"sm",children:[t.jsx(Fe,{className:"h-4 w-4 mr-2"}),t.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:y.value}})]})}),t.jsx(M,{className:"w-48",children:t.jsx("div",{className:"grid grid-cols-3 gap-2",children:ps.map(e=>t.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",style:{backgroundColor:e.value},onClick:()=>N(e)},e.value))})})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>v(!w),children:w?t.jsx(he,{className:"h-4 w-4"}):t.jsx(Pe,{className:"h-4 w-4"})}),t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{x(e=>(e+90)%360)},children:t.jsx(Ie,{className:"h-4 w-4"})}),t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{g(e=>!e)},children:p?t.jsx(Oe,{className:"h-4 w-4"}):t.jsx(Re,{className:"h-4 w-4"})}),t.jsx($,{documentId:a,showUserPresence:!0,className:"ml-auto"})]})]})}),t.jsx(u,{className:"p-0 relative",children:t.jsx("div",{ref:F,className:"relative overflow-auto",style:{height:p?"calc(100vh - 120px)":"600px"},onMouseDown:X,onMouseMove:J,onMouseUp:Z,children:t.jsxs("div",{className:"relative",style:{transform:`scale(${l/100}) rotate(${m}deg)`,transformOrigin:"top left",cursor:"select"===j?"default":"crosshair"},children:[t.jsx("iframe",{ref:P,src:`${e}#toolbar=0&navpanes=0&scrollbar=0`,className:"w-full h-[800px] border-0",title:"PDF Document"}),w&&t.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[W.map(e=>t.jsx("div",{className:"absolute pointer-events-auto",style:{left:e.position.x,top:e.position.y,width:e.position.width,height:e.position.height,backgroundColor:"highlight"===e.type?ps.find(s=>s.value===e.color)?.bg:"transparent"},children:"highlight"!==e.type&&t.jsxs(O,{children:[t.jsx(R,{asChild:!0,children:t.jsx(h,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-full",style:{backgroundColor:e.color},children:"note"===e.type?t.jsx(Ue,{className:"h-3 w-3"}):t.jsx(Ae,{className:"h-3 w-3"})})}),t.jsx(M,{className:"w-80",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(L,{className:"h-6 w-6",children:[t.jsx(q,{src:e.user?.avatar_url}),t.jsxs(B,{className:"text-xs",children:[e.user?.first_name?.[0],e.user?.last_name?.[0]]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"text-sm font-medium",children:[e.user?.first_name," ",e.user?.last_name]}),t.jsx("span",{className:"text-xs text-gray-500",children:Xe(new Date(e.created_at),{addSuffix:!0})})]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(C,{variant:"outline",className:"text-xs",children:e.type}),t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>(async e=>{await Y(e)})(e.id),children:t.jsx(we,{className:"h-4 w-4"})})]})]}),T===e.id?t.jsxs("div",{className:"space-y-2",children:[t.jsx(V,{value:U,onChange:e=>A(e.target.value),placeholder:"Enter annotation content...",className:"min-h-[80px]"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs(h,{size:"sm",onClick:()=>(async(e,s)=>{await H(e,{content:s})&&(E(null),A(""))})(e.id,U),children:[t.jsx(Me,{className:"h-4 w-4 mr-1"}),"Save"]}),t.jsx(h,{variant:"outline",size:"sm",onClick:()=>E(null),children:"Cancel"})]})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm",children:e.content||"No content"}),t.jsx(h,{variant:"outline",size:"sm",onClick:()=>{E(e.id),A(e.content)},children:"Edit"})]})]})})]})},e.id)),_&&b&&t.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-200 bg-opacity-30 pointer-events-none",style:{left:_.x,top:_.y,width:_.width,height:_.height}})]})]})})})]})},DocumentViewer=({documentId:e,onClose:a,className:r=""})=>{const[n,c]=s.useState(null),[l,p]=s.useState(!0),[g,j]=s.useState(null),[f,N]=s.useState(!1),[w,v]=s.useState("viewer");s.useEffect(()=>{loadDocument()},[e]);const loadDocument=async()=>{try{p(!0),j(null);const s=await S.getDocument(e);c(s)}catch(s){console.error("Error loading document:",s),j(s.message||"Failed to load document"),i.error("Failed to load document")}finally{p(!1)}},handleDownload=()=>{n&&window.open(n.file_url,"_blank")};if(l)return t.jsx(o,{className:r,children:t.jsx(u,{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx(je,{className:"h-8 w-8 animate-spin"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Loading document..."})]})})});if(g||!n)return t.jsx(o,{className:r,children:t.jsx(u,{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx(xe,{className:"h-8 w-8 text-red-500"}),t.jsx("p",{className:"text-sm text-red-600",children:g||"Document not found"}),t.jsx(h,{onClick:loadDocument,variant:"outline",size:"sm",children:"Try Again"})]})})});const b=f?"fixed inset-0 z-50 bg-white":`${r}`;return t.jsxs(o,{className:b,children:[t.jsx(d,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx(m,{className:"text-lg font-semibold truncate",children:n.filename}),t.jsxs(x,{className:"flex items-center space-x-4 mt-1",children:[t.jsx("span",{children:y[n.document_type]}),t.jsxs("span",{children:[Math.round(n.file_size/1024)," KB"]}),t.jsx("span",{children:Xe(new Date(n.created_at),{addSuffix:!0})})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e){case"processing":return t.jsx(je,{className:"h-4 w-4 animate-spin"});case"failed":return t.jsx(xe,{className:"h-4 w-4"});default:return t.jsx(de,{className:"h-4 w-4"})}})(n.processing_status),t.jsx(C,{className:(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(n.processing_status),children:D[n.processing_status]})]}),a&&t.jsx(h,{onClick:a,variant:"ghost",size:"sm",children:t.jsx(ue,{className:"h-4 w-4"})})]})]})}),t.jsx(I,{}),t.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(h,{onClick:()=>{setZoom(e=>Math.max(e-25,50))},variant:"outline",size:"sm",children:t.jsx(ZoomOut,{className:"h-4 w-4"})}),t.jsxs("span",{className:"text-sm font-medium min-w-[60px] text-center",children:[zoom,"%"]}),t.jsx(h,{onClick:()=>{setZoom(e=>Math.min(e+25,200))},variant:"outline",size:"sm",children:t.jsx(ZoomIn,{className:"h-4 w-4"})}),t.jsx(h,{onClick:()=>{setRotation(e=>(e+90)%360)},variant:"outline",size:"sm",children:t.jsx(RotateCw,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(h,{onClick:handleDownload,variant:"outline",size:"sm",children:[t.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Download"]}),t.jsxs(h,{onClick:async()=>{if(n)try{await navigator.share({title:n.filename,url:n.file_url})}catch(e){await navigator.clipboard.writeText(n.file_url),i.success("Document URL copied to clipboard")}},variant:"outline",size:"sm",children:[t.jsx($e,{className:"h-4 w-4 mr-2"}),"Share"]}),t.jsx(h,{onClick:()=>{N(!f)},variant:"outline",size:"sm",children:t.jsx(Re,{className:"h-4 w-4"})})]})]}),t.jsx(u,{className:"p-0 flex-1",children:t.jsxs(U,{value:w,onValueChange:v,children:[t.jsx("div",{className:"border-b px-4",children:t.jsxs(A,{className:"grid w-full grid-cols-3",children:[t.jsxs(F,{value:"viewer",className:"flex items-center space-x-2",children:[t.jsx(he,{className:"h-4 w-4"}),t.jsx("span",{children:"Document"})]}),t.jsxs(F,{value:"text",className:"flex items-center space-x-2",children:[t.jsx(de,{className:"h-4 w-4"}),t.jsx("span",{children:"Text"})]}),t.jsxs(F,{value:"analysis",className:"flex items-center space-x-2",children:[t.jsx(pe,{className:"h-4 w-4"}),t.jsx("span",{children:"AI Analysis"})]})]})}),t.jsx(P,{value:"viewer",className:"mt-0",children:t.jsx("div",{className:"p-4",children:n.file_url.toLowerCase().endsWith(".pdf")?t.jsx(EnhancedPDFViewer,{documentUrl:n.file_url,documentId:n.id,className:"w-full",onAnnotationChange:e=>{console.log("Annotations updated:",e)}}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(de,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Preview not available"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"This file type cannot be previewed in the browser."}),t.jsxs(h,{onClick:handleDownload,children:[t.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Download to view"]})]})})}),t.jsx(P,{value:"text",className:"mt-0",children:t.jsx(W,{className:f?"h-[calc(100vh-250px)]":"h-[550px]",children:t.jsx("div",{className:"p-4",children:n.ocr_text?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Extracted Text"}),n.ocr_quality_score&&t.jsxs(C,{variant:"outline",children:["Quality: ",Math.round(100*n.ocr_quality_score),"%"]})]}),t.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:t.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:n.ocr_text})})]}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(de,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No text extracted"}),t.jsx("p",{className:"text-gray-500",children:"Text extraction may still be in progress or the document may not contain readable text."})]})})})}),t.jsx(P,{value:"analysis",className:"mt-0",children:t.jsx(W,{className:f?"h-[calc(100vh-250px)]":"h-[550px]",children:t.jsx("div",{className:"p-4",children:t.jsx(DocumentAnalysisComponent,{document:n})})})})]})})]})},gs=es({query:ss().optional(),searchType:ts(["combined","semantic","text"]).default("combined"),documentType:ss().optional(),status:ss().optional(),dateFrom:ss().optional(),dateTo:ss().optional(),minSize:as().optional(),maxSize:as().optional(),hasOcr:rs().optional()}),DocumentSearch=({onResults:e,onLoading:a,className:r=""})=>{const[c,l]=s.useState(!1),[w,v]=s.useState(!1),[b,_]=s.useState([]),[z,T]=s.useState([]),{user:E}=n(),{register:U,handleSubmit:A,watch:F,setValue:P,reset:O,formState:{errors:R}}=ns({resolver:H(gs),defaultValues:{hasOcr:!1}}),M=F("query"),$=s.useCallback(Je.debounce(async s=>{if(s.query?.trim()||hasActiveFilters(s))await performSearch(s);else try{v(!0),a?.(!0);const s=await S.getDocuments();e(s)}catch(t){console.error("Error loading documents:",t),i.error("Failed to load documents")}finally{v(!1),a?.(!1)}},500),[e,a]);s.useEffect(()=>{const e=F(e=>{$(e)});return()=>e.unsubscribe()},[F,$]);const hasActiveFilters=e=>!!(e.documentType||e.status||e.dateFrom||e.dateTo||e.minSize||e.maxSize||e.hasOcr),performSearch=async s=>{if(E)try{v(!0),a?.(!0);let t=[];if(s.query?.trim()){const e=[s.query,...z.filter(e=>e!==s.query)].slice(0,5);T(e),localStorage.setItem("documentSearchHistory",JSON.stringify(e));switch(s.searchType||"combined"){case"semantic":t=(await ls({query:s.query,userId:E.id,maxResults:20})).map(e=>e.document).filter(Boolean);break;case"text":t=await cs({query:s.query,userId:E.id,documentType:s.documentType,dateRange:s.dateFrom&&s.dateTo?{start:new Date(s.dateFrom),end:new Date(s.dateTo)}:void 0});break;default:t=(await is(s.query,E.id,{documentType:s.documentType,dateRange:s.dateFrom&&s.dateTo?{start:new Date(s.dateFrom),end:new Date(s.dateTo)}:void 0,maxResults:20})).textResults}}else t=await S.getDocuments();t=applyFilters(t,s),e(t),updateActiveFilters(s)}catch(t){console.error("Search error:",t),i.error("Search failed. Please try again.")}finally{v(!1),a?.(!1)}else i.error("Please log in to search documents")},applyFilters=(e,s)=>e.filter(e=>{if(s.documentType&&e.document_type!==s.documentType)return!1;if(s.status&&e.processing_status!==s.status)return!1;if(s.dateFrom){if(new Date(e.created_at)<new Date(s.dateFrom))return!1}if(s.dateTo){const t=new Date(e.created_at),a=new Date(s.dateTo);if(a.setHours(23,59,59,999),t>a)return!1}const t=e.file_size/1024;return!(s.minSize&&t<s.minSize)&&(!(s.maxSize&&t>s.maxSize)&&!(s.hasOcr&&!e.ocr_text))}),updateActiveFilters=e=>{const s=[];e.documentType&&s.push(`Type: ${y[e.documentType]}`),e.status&&s.push(`Status: ${D[e.status]}`),e.dateFrom&&s.push(`From: ${new Date(e.dateFrom).toLocaleDateString()}`),e.dateTo&&s.push(`To: ${new Date(e.dateTo).toLocaleDateString()}`),e.minSize&&s.push(`Min: ${e.minSize}KB`),e.maxSize&&s.push(`Max: ${e.maxSize}KB`),e.hasOcr&&s.push("Has OCR text"),_(s)},clearFilters=()=>{O(),_([]),l(!1)};return s.useEffect(()=>{const e=localStorage.getItem("documentSearchHistory");if(e)try{T(JSON.parse(e))}catch(s){console.error("Error loading search history:",s)}},[]),t.jsxs(o,{className:r,children:[t.jsx(d,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(m,{className:"text-lg",children:"Search Documents"}),t.jsx(x,{children:"Find documents by name, content, or metadata"})]}),t.jsxs(h,{variant:"outline",size:"sm",onClick:()=>l(!c),children:[t.jsx(Le,{className:"h-4 w-4 mr-2"}),"Filters"]})]})}),t.jsxs(u,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx(k,{...U("query"),placeholder:"Search by filename or content...",className:"pl-10 pr-10"}),w&&t.jsx(je,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Q,{className:"text-xs text-gray-500",children:"Search type:"}),t.jsxs(p,{onValueChange:e=>P("searchType",e),children:[t.jsx(g,{className:"w-32 h-8",children:t.jsx(j,{placeholder:"Combined"})}),t.jsxs(f,{children:[t.jsx(N,{value:"combined",children:"Combined"}),t.jsx(N,{value:"semantic",children:"AI Semantic"}),t.jsx(N,{value:"text",children:"Text Only"})]})]})]})]}),z.length>0&&!M&&t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Recent:"}),z.map((e,s)=>t.jsx(h,{variant:"outline",size:"sm",className:"h-6 text-xs",onClick:()=>P("query",e),children:e},s))]}),b.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Active filters:"}),b.map((e,s)=>t.jsxs(C,{variant:"secondary",className:"text-xs",children:[e,t.jsx(h,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1",onClick:()=>{clearFilters()},children:t.jsx(ue,{className:"h-3 w-3"})})]},s)),t.jsx(h,{variant:"ghost",size:"sm",className:"text-xs",onClick:clearFilters,children:"Clear all"})]}),c&&t.jsxs(t.Fragment,{children:[t.jsx(I,{}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(Q,{htmlFor:"documentType",children:"Document Type"}),t.jsxs(p,{onValueChange:e=>P("documentType",e),children:[t.jsx(g,{children:t.jsx(j,{placeholder:"Any type"})}),t.jsxs(f,{children:[t.jsx(N,{value:"",children:"Any type"}),Object.entries(y).map(([e,s])=>t.jsx(N,{value:e,children:s},e))]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Q,{htmlFor:"status",children:"Processing Status"}),t.jsxs(p,{onValueChange:e=>P("status",e),children:[t.jsx(g,{children:t.jsx(j,{placeholder:"Any status"})}),t.jsxs(f,{children:[t.jsx(N,{value:"",children:"Any status"}),Object.entries(D).map(([e,s])=>t.jsx(N,{value:e,children:s},e))]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Q,{htmlFor:"dateFrom",children:"Date From"}),t.jsx(k,{...U("dateFrom"),type:"date",className:"w-full"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Q,{htmlFor:"dateTo",children:"Date To"}),t.jsx(k,{...U("dateTo"),type:"date",className:"w-full"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Q,{children:"File Size (KB)"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(k,{...U("minSize",{valueAsNumber:!0}),type:"number",placeholder:"Min",className:"w-full"}),t.jsx(k,{...U("maxSize",{valueAsNumber:!0}),type:"number",placeholder:"Max",className:"w-full"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Q,{children:"Content Options"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(K,{...U("hasOcr"),onCheckedChange:e=>P("hasOcr",!!e)}),t.jsx(Q,{className:"text-sm",children:"Has extracted text"})]})]})]})]})]})]})},DocumentStatusTracker=({onDocumentSelect:e,refreshTrigger:a,className:n=""})=>{const[c,l]=s.useState([]),[p,g]=s.useState({total:0,pending:0,processing:0,completed:0,failed:0}),[j,f]=s.useState(!0),[y,N]=s.useState(!0);s.useEffect(()=>{loadDocuments()},[a]),s.useEffect(()=>{let e;return y&&(e=setInterval(()=>{(p.processing>0||p.pending>0)&&loadDocuments()},3e4)),()=>{e&&clearInterval(e)}},[y,p.processing,p.pending]);const loadDocuments=async()=>{try{f(!0),console.log("DocumentStatusTracker: Starting to load documents...");const{data:{user:e},error:s}=await r.auth.getUser();if(s)throw console.error("DocumentStatusTracker: Auth error:",s),new Error("Authentication failed");if(!e)throw console.error("DocumentStatusTracker: No authenticated user"),new Error("User not authenticated");console.log("DocumentStatusTracker: User authenticated:",e.email);const t=await S.getDocuments();console.log("DocumentStatusTracker: Loaded documents:",t.length);const a=t.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime());l(a),calculateStats(a)}catch(e){console.error("DocumentStatusTracker: Error loading documents:",e),i.error(`Failed to load document status: ${e.message}`)}finally{f(!1)}},calculateStats=e=>{const s=e.reduce((e,s)=>{switch(e.total++,s.processing_status){case"pending":e.pending++;break;case"processing":e.processing++;break;case"completed":e.completed++;break;case"failed":e.failed++}return e},{total:0,pending:0,processing:0,completed:0,failed:0});g(s)},getStatusIcon=e=>{switch(e){case"pending":return t.jsx(ve,{className:"h-4 w-4 text-yellow-500"});case"processing":return t.jsx(je,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return t.jsx(me,{className:"h-4 w-4 text-green-500"});case"failed":return t.jsx(xe,{className:"h-4 w-4 text-red-500"});default:return t.jsx(de,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},getActiveDocuments=()=>c.filter(e=>"pending"===e.processing_status||"processing"===e.processing_status).slice(0,5),getRecentCompletedDocuments=()=>c.filter(e=>"completed"===e.processing_status).slice(0,3),getFailedDocuments=()=>c.filter(e=>"failed"===e.processing_status);return j&&0===c.length?t.jsx(o,{className:n,children:t.jsx(u,{className:"flex items-center justify-center py-8",children:t.jsx(je,{className:"h-8 w-8 animate-spin"})})}):t.jsxs(o,{className:n,children:[t.jsx(d,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(m,{className:"text-lg",children:"Processing Status"}),t.jsx(x,{children:"Real-time document processing status and progress"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(h,{variant:"outline",size:"sm",onClick:()=>N(!y),className:y?"bg-green-50":"",children:[t.jsx(be,{className:"h-4 w-4 mr-2 "+(y?"animate-spin":"")}),"Auto-refresh"]}),t.jsx(h,{onClick:loadDocuments,variant:"outline",size:"sm",children:t.jsx(be,{className:"h-4 w-4"})})]})]})}),t.jsxs(u,{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Overall Progress"}),t.jsxs("span",{className:"text-sm text-gray-500",children:[p.completed," of ",p.total," completed"]})]}),t.jsx(w,{value:0===p.total?0:Math.round(p.completed/p.total*100),className:"w-full"}),t.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:p.pending}),t.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.processing}),t.jsx("div",{className:"text-xs text-gray-500",children:"Processing"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.completed}),t.jsx("div",{className:"text-xs text-gray-500",children:"Completed"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:p.failed}),t.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]})]})]}),getActiveDocuments().length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[t.jsx(qe,{className:"h-4 w-4 mr-2"}),"Currently Processing"]}),t.jsx("div",{className:"space-y-2",children:getActiveDocuments().map(s=>t.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[getStatusIcon(s.processing_status),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),t.jsx("p",{className:"text-xs text-gray-500",children:Xe(new Date(s.created_at),{addSuffix:!0})})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(C,{className:getStatusColor(s.processing_status),children:D[s.processing_status]}),e&&t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>e(s),children:t.jsx(he,{className:"h-4 w-4"})})]})]},s.id))})]}),getRecentCompletedDocuments().length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[t.jsx(me,{className:"h-4 w-4 mr-2 text-green-500"}),"Recently Completed"]}),t.jsx("div",{className:"space-y-2",children:getRecentCompletedDocuments().map(s=>t.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-green-50",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx(me,{className:"h-4 w-4 text-green-500"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Completed ",Xe(new Date(s.updated_at),{addSuffix:!0})]})]})]}),e&&t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>e(s),children:t.jsx(he,{className:"h-4 w-4"})})]},s.id))})]}),getFailedDocuments().length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h4",{className:"text-sm font-medium flex items-center text-red-600",children:[t.jsx(xe,{className:"h-4 w-4 mr-2"}),"Failed Processing (",getFailedDocuments().length,")"]}),t.jsx("div",{className:"space-y-2",children:getFailedDocuments().slice(0,3).map(s=>t.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-red-50",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx(xe,{className:"h-4 w-4 text-red-500"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),t.jsx("p",{className:"text-xs text-red-600",children:"Processing failed"})]})]}),e&&t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>e(s),children:t.jsx(he,{className:"h-4 w-4"})})]},s.id))})]}),0===p.total&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(de,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents yet"}),t.jsx("p",{className:"text-gray-500",children:"Upload your first document to start tracking processing status"})]})]})]})};const js=new class EnhancedDocumentProcessor{constructor(){__publicField(this,"retryAttempts",3),__publicField(this,"retryDelay",1e3)}async processDocument(e,s,t={},a){const r=Date.now();try{let n,i;a?.({stage:"initializing",progress:0,message:"Initializing document processing..."}),await this.checkUsageLimits(),await this.updateDocumentStatus(s,"processing");let c=[];t.skipOCR||(n=await this.performOCR(e,a)),!t.skipAnalysis&&n&&(i=await this.performAnalysis(n.text,s,t.customAnalysisPrompt,a)),!t.skipEmbedding&&n&&(c=await this.generateEmbeddings(n.text,s,t.chunkSize,a)),a?.({stage:"finalizing",progress:95,message:"Finalizing document processing..."});const l=await this.finalizeProcessing(s,n,i,c),o=Date.now()-r;return a?.({stage:"completed",progress:100,message:"Document processing completed successfully!",details:{processingTime:o,ocrQuality:n?.qualityScore||0,textLength:n?.text.length||0,embeddingChunks:c.length}}),{document:l,ocrResult:n,analysis:i,embeddingIds:c,processingTime:o,qualityMetrics:{ocrQuality:n?.qualityScore||0,textLength:n?.text.length||0,embeddingChunks:c.length}}}catch(n){const e=Date.now()-r;throw await this.updateDocumentStatus(s,"failed"),a?.({stage:"error",progress:0,message:"Document processing failed",error:n instanceof Error?n.message:"Unknown error",details:{processingTime:e}}),n}}async checkUsageLimits(){const e=await Y.checkUsageLimit("ai_query");if(!e.allowed)throw new Error(`AI processing limit exceeded. You have used ${e.current}/${e.limit} AI queries this month. Please upgrade your plan to continue.`)}async performOCR(e,s){return s?.({stage:"ocr",progress:10,message:"Extracting text from document..."}),await this.withRetry(async()=>{const t=await extractTextFromDocument(e,e=>{s?.({stage:"ocr",progress:10+.3*e.progress,message:e.message||"Extracting text..."})}),a=validateOCRQuality(t),r=cleanExtractedText(t.text);return{...t,text:r,qualityScore:a.qualityScore}},"OCR processing")}async performAnalysis(e,s,t,a){return a?.({stage:"analysis",progress:40,message:"Analyzing document content with AI..."}),await this.withRetry(async()=>{const a=await ne(e);return await Y.incrementUsage("ai_query",s,{operation:"document_analysis",text_length:e.length,custom_prompt:!!t}),a},"AI analysis")}async generateEmbeddings(e,s,t=1e3,a){return a?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),await this.withRetry(async()=>{const n=this.splitTextIntoChunks(e,t),i=[];for(let e=0;e<n.length;e++){const t=n[e],c=await ie(t),{data:l,error:o}=await r.from("document_embeddings").insert({document_id:s,chunk_text:t,chunk_index:e,embedding:c,metadata:{chunk_size:t.length,total_chunks:n.length}}).select("id").single();if(o)throw o;i.push(l.id);const d=70+(e+1)/n.length*20;a?.({stage:"embedding",progress:d,message:`Generated embedding ${e+1}/${n.length}...`})}return i},"Embedding generation")}async finalizeProcessing(e,s,t,a){const{data:n,error:i}=await r.from("uploaded_documents").update({processing_status:"completed",ocr_text:s?.text,ocr_quality_score:s?.qualityScore,document_structure:{analysis:t,ocrQuality:s?.qualityScore,embeddingCount:a?.length||0,processedAt:(new Date).toISOString()},updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(i)throw i;return n}async updateDocumentStatus(e,s){const{error:t}=await r.from("uploaded_documents").update({processing_status:s,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}async withRetry(e,s){let t;for(let r=1;r<=this.retryAttempts;r++)try{return await e()}catch(a){if(t=a instanceof Error?a:new Error("Unknown error"),r===this.retryAttempts)throw new Error(`${s} failed after ${this.retryAttempts} attempts: ${t.message}`);await new Promise(e=>setTimeout(e,this.retryDelay*r))}throw t}splitTextIntoChunks(e,s=1e3){const t=[],a=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let r="";for(const n of a){const e=n.trim();r.length+e.length+1<=s?r+=(r?". ":"")+e:(r&&t.push(r+"."),r=e)}return r&&t.push(r+"."),t}};function useUsageLimit(e){return os({queryKey:["usage-limit",e],queryFn:()=>Y.checkUsageLimit(e),staleTime:6e4,refetchOnWindowFocus:!1})}const EnhancedDocumentUpload=({onUploadComplete:e,maxFiles:a=5,allowedTypes:r=["pdf","doc","docx","txt"]})=>{const{profile:i}=n(),{uploadAndProcessDocument:v,uploadState:b,resetUploadState:k,isActive:D}=function useDocumentUpload(){const[e,t]=s.useState({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null}),a=ds(),{toast:r}=G();return{uploadAndProcessDocument:s.useCallback(async(e,s,n={})=>{try{t({isUploading:!0,isProcessing:!1,progress:0,status:null,error:null});const i=await S.uploadDocument(e,s);t(e=>({...e,isUploading:!1,isProcessing:!0,progress:10}));const c=await js.processDocument(e,i.id,n,e=>{t(s=>({...s,progress:e.progress,status:e,error:e.error||null}))});return t(e=>({...e,isProcessing:!1,progress:100,error:null})),a.invalidateQueries({queryKey:["documents"]}),a.invalidateQueries({queryKey:["document",i.id]}),r({title:"Document Processed",description:`${e.name} has been successfully uploaded and processed.`}),c}catch(i){const e=i instanceof Error?i.message:"Upload failed";throw t(s=>({...s,isUploading:!1,isProcessing:!1,error:e})),r({title:"Upload Failed",description:e,variant:"destructive"}),i}},[a,r]),uploadState:e,resetUploadState:s.useCallback(()=>{t({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null})},[]),isActive:e.isUploading||e.isProcessing}}(),{canUploadDocuments:_,canUseAI:z,documentUsage:T}=function useFeatureAvailability(){const{data:e}=useUsageLimit("ai_query"),{data:s}=useUsageLimit("document_upload"),{data:t}=useUsageLimit("custom_document");return{canUseAI:e?.allowed??!1,canUploadDocuments:s?.allowed??!1,canDownloadCustomDocuments:t?.allowed??!1,aiUsage:e,documentUsage:s,customDocUsage:t,getUsagePercentage:e=>e&&-1!==e.limit&&e.limit>0?e.current/e.limit*100:0,isNearLimit:(e,s=80)=>!(!e||-1===e.limit)&&(e.limit>0?e.current/e.limit*100:0)>=s}}(),[E,U]=s.useState([]),[A,F]=s.useState(!1),[P,I]=s.useState({skipOCR:!1,skipAnalysis:!1,skipEmbedding:!1,chunkSize:1e3,retryAttempts:3}),O=s.useCallback(async e=>{if(!_)return void toast.warning("Upload not available. Please check your subscription or try again later.");const s=i?.subscription_tier?c.maxSize[i.subscription_tier]:c.maxSize.free,t=e.filter(e=>!(e.size>s)).map(e=>({file:e,id:crypto.randomUUID(),documentType:"other",options:{...P}}));U(e=>[...e,...t].slice(0,a))},[i,a,_,P]),{getRootProps:R,getInputProps:M,isDragActive:$}=l({onDrop:O,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:a,disabled:D||!_});return t.jsxs(o,{className:"w-full",children:[t.jsxs(d,{children:[t.jsxs(m,{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Enhanced Document Upload"}),t.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>F(!A),children:[t.jsx(Be,{className:"h-4 w-4 mr-2"}),"Advanced"]})]}),t.jsx(x,{children:"Upload and process your legal documents with AI-powered analysis"}),T&&t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[t.jsxs("span",{children:["Usage: ",T.current,"/",-1===T.limit?"":T.limit," uploads"]}),T.limit>0&&t.jsx(w,{value:T.percentage,className:"w-24 h-2"})]})]}),t.jsxs(u,{className:"space-y-6",children:[A&&t.jsxs(o,{children:[t.jsx(d,{children:t.jsx(m,{className:"text-lg",children:"Processing Options"})}),t.jsxs(u,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(X,{id:"skip-ocr",checked:!P.skipOCR,onCheckedChange:e=>I(s=>({...s,skipOCR:!e}))}),t.jsx(Q,{htmlFor:"skip-ocr",children:"Text Extraction"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(X,{id:"skip-analysis",checked:!P.skipAnalysis,onCheckedChange:e=>I(s=>({...s,skipAnalysis:!e})),disabled:!z}),t.jsx(Q,{htmlFor:"skip-analysis",children:"AI Analysis"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(X,{id:"skip-embedding",checked:!P.skipEmbedding,onCheckedChange:e=>I(s=>({...s,skipEmbedding:!e})),disabled:!z}),t.jsx(Q,{htmlFor:"skip-embedding",children:"Search Indexing"})]})]}),void 0!==P.customAnalysisPrompt&&t.jsxs("div",{children:[t.jsx(Q,{htmlFor:"custom-prompt",children:"Custom Analysis Prompt"}),t.jsx(V,{id:"custom-prompt",placeholder:"Enter custom instructions for AI analysis...",value:P.customAnalysisPrompt||"",onChange:e=>I(s=>({...s,customAnalysisPrompt:e.target.value}))})]})]})]}),t.jsxs("div",{...R(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${$?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${D||!_?"opacity-50 cursor-not-allowed":""}`,children:[t.jsx("input",{...M()}),t.jsx(oe,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),$?t.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:_?"Drag & drop files here, or click to select":"Upload limit reached for your subscription tier"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((i?.subscription_tier?c.maxSize[i.subscription_tier]:c.maxSize.free)/1024/1024),"MB"]})]})]}),E.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-medium",children:"Files to Upload"}),E.map(e=>t.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[t.jsx(de,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:e.file.name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[(e.file.size/1024/1024).toFixed(2)," MB"]})]}),t.jsxs(p,{value:e.documentType,onValueChange:s=>{return t=e.id,a=s,void U(e=>e.map(e=>e.id===t?{...e,documentType:a}:e));var t,a},children:[t.jsx(g,{className:"w-32",children:t.jsx(j,{})}),t.jsx(f,{children:Object.entries(y).map(([e,s])=>t.jsx(N,{value:e,children:s},e))})]}),t.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void U(e=>e.filter(e=>e.id!==s));var s},disabled:D,children:t.jsx(ue,{className:"h-4 w-4"})})]},e.id))]}),D&&b.status&&t.jsx(o,{children:t.jsx(u,{className:"pt-6",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:(e=>{switch(e){case"completed":return"text-green-600";case"error":return"text-red-600";case"analysis":return"text-blue-600";case"embedding":return"text-purple-600";default:return"text-gray-600"}})(b.status.stage),children:(e=>{switch(e){case"ocr":return t.jsx(he,{className:"h-4 w-4"});case"analysis":return t.jsx(pe,{className:"h-4 w-4"});case"embedding":return t.jsx(ge,{className:"h-4 w-4"});case"completed":return t.jsx(me,{className:"h-4 w-4"});case"error":return t.jsx(xe,{className:"h-4 w-4"});default:return t.jsx(ve,{className:"h-4 w-4"})}})(b.status.stage)}),t.jsx("span",{className:"font-medium capitalize",children:b.status.stage.replace("_"," ")})]}),t.jsxs(C,{variant:"outline",children:[Math.round(b.progress),"%"]})]}),t.jsx(w,{value:b.progress,className:"w-full"}),t.jsx("p",{className:"text-sm text-gray-600",children:b.status.message}),b.status.details&&t.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[b.status.details.ocrQuality&&t.jsxs("p",{children:["OCR Quality: ",Math.round(100*b.status.details.ocrQuality),"%"]}),b.status.details.textLength&&t.jsxs("p",{children:["Text Length: ",b.status.details.textLength.toLocaleString()," characters"]}),b.status.details.embeddingChunks&&t.jsxs("p",{children:["Embedding Chunks: ",b.status.details.embeddingChunks]})]}),b.error&&t.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:b.error})]})})}),E.length>0&&!D&&t.jsxs(h,{onClick:async()=>{for(const t of E)try{const s=await v(t.file,t.documentType,t.options);e&&e(s.document.id)}catch(s){console.error("Upload failed:",s)}U([]),k()},className:"w-full",disabled:!_,children:[t.jsx(oe,{className:"h-4 w-4 mr-2"}),"Upload and Process ",E.length," File",E.length>1?"s":""]})]})]})},DocumentManagementDashboard=()=>{const[e,r]=s.useState("grid"),[n,i]=s.useState(new Set),[c,l]=s.useState("created_at"),[d,m]=s.useState("desc"),[x,w]=s.useState({status:"all",type:"all",dateRange:"all"}),[v,b]=s.useState(!1),{data:C=[],isLoading:_,error:z}=function useDocuments(){return os({queryKey:["documents"],queryFn:()=>S.getDocuments(),staleTime:3e5})}(),{searchQuery:T,setSearchQuery:E,searchResults:U,isSearching:A}=function useDocumentSearch(){const[e,t]=s.useState(""),a=os({queryKey:["documents","search",e],queryFn:async()=>{if(!e||e.length<3)return[];try{return await S.searchDocuments(e)}catch(z){return console.error("Search error:",z),[]}},enabled:e.length>2,staleTime:12e4});return{searchQuery:e,setSearchQuery:t,searchResults:a.data||[],isSearching:a.isLoading,searchError:a.error}}(),F=function useDocumentDeletion(){const e=ds(),{toast:s}=G();return ms({mutationFn:e=>S.deleteDocument(e),onSuccess:(t,a)=>{e.removeQueries({queryKey:["document",a]}),e.invalidateQueries({queryKey:["documents"]}),s({title:"Document Deleted",description:"The document has been successfully deleted."})},onError:e=>{s({title:"Deletion Failed",description:e instanceof Error?e.message:"Failed to delete document",variant:"destructive"})}})}(),P=function useDocumentDownload(){const{toast:e}=G();return ms({mutationFn:({documentId:e,trackUsage:s=!0})=>S.downloadDocument(e,s),onSuccess:s=>{const t=URL.createObjectURL(s.data),a=document.createElement("a");a.href=t,a.download=s.filename,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),e({title:"Download Started",description:`Downloading ${s.filename}...`})},onError:s=>{e({title:"Download Failed",description:s instanceof Error?s.message:"Failed to download document",variant:"destructive"})}})}(),{bulkDelete:I,isBulkDeleting:O}=function useBulkDocumentOperations(){const e=ds(),{toast:s}=G(),t=ms({mutationFn:async e=>{const s=await Promise.allSettled(e.map(e=>S.deleteDocument(e))),t=s.filter(e=>"rejected"===e.status).length;return{succeeded:s.filter(e=>"fulfilled"===e.status).length,failed:t,total:e.length}},onSuccess:t=>{e.invalidateQueries({queryKey:["documents"]}),t.failed>0?s({title:"Bulk Delete Completed",description:`${t.succeeded} documents deleted, ${t.failed} failed.`,variant:"destructive"}):s({title:"Bulk Delete Completed",description:`Successfully deleted ${t.succeeded} documents.`})},onError:e=>{s({title:"Bulk Delete Failed",description:e instanceof Error?e.message:"Failed to delete documents",variant:"destructive"})}});return{bulkDelete:t,isBulkDeleting:t.isPending}}(),{data:R,error:M}=function useDocumentStats(){return os({queryKey:["documents","stats"],queryFn:async()=>{try{const e=await S.getDocuments(),s=await S.getDocumentUsage();return{total:e.length,byStatus:e.reduce((e,s)=>(e[s.processing_status]=(e[s.processing_status]||0)+1,e),{}),byType:e.reduce((e,s)=>(e[s.document_type]=(e[s.document_type]||0)+1,e),{}),totalSize:e.reduce((e,s)=>e+s.file_size,0),usage:s}}catch(z){return console.error("Error fetching document stats:",z),{total:0,byStatus:{},byType:{},totalSize:0,usage:null}}},staleTime:6e5})}();a.useEffect(()=>{z&&console.error("Documents loading error:",z),M&&console.error("Stats loading error:",M)},[z,M]);const $=s.useMemo(()=>{try{let e=T.length>2?U:C;if(!Array.isArray(e))return console.warn("Documents result is not an array:",e),[];if("all"!==x.status&&(e=e.filter(e=>e?.processing_status===x.status)),"all"!==x.type&&(e=e.filter(e=>e?.document_type===x.type)),"all"!==x.dateRange){const s=new Date,t=new Date;switch(x.dateRange){case"today":t.setHours(0,0,0,0);break;case"week":t.setDate(s.getDate()-7);break;case"month":t.setMonth(s.getMonth()-1)}e=e.filter(e=>e?.created_at&&new Date(e.created_at)>=t)}return e.sort((e,s)=>{if(!e||!s)return 0;let t=e[c],a=s[c];return"created_at"===c?(t=new Date(t).getTime(),a=new Date(a).getTime()):"file_size"===c?(t=Number(t)||0,a=Number(a)||0):(t=String(t||"").toLowerCase(),a=String(a||"").toLowerCase()),"asc"===d?t<a?-1:t>a?1:0:t>a?-1:t<a?1:0}),e}catch(e){return console.error("Error filtering documents:",e),[]}},[C,U,T,x,c,d]),getStatusIcon=e=>{switch(e){case"completed":return t.jsx(me,{className:"h-4 w-4 text-green-500"});case"processing":return t.jsx(ve,{className:"h-4 w-4 text-blue-500"});case"failed":return t.jsx(xe,{className:"h-4 w-4 text-red-500"});default:return t.jsx(ve,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return v?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Upload Documents"}),t.jsx(h,{variant:"outline",onClick:()=>b(!1),children:"Back to Dashboard"})]}),t.jsx(EnhancedDocumentUpload,{onUploadComplete:()=>b(!1)})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Document Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage and organize your legal documents"})]}),t.jsxs(h,{onClick:()=>b(!0),children:[t.jsx(oe,{className:"h-4 w-4 mr-2"}),"Upload Documents"]})]}),R&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx(o,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(de,{className:"h-5 w-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Documents"}),t.jsx("p",{className:"text-2xl font-bold",children:R.total})]})]})})}),t.jsx(o,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(me,{className:"h-5 w-5 text-green-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Processed"}),t.jsx("p",{className:"text-2xl font-bold",children:R.byStatus.completed||0})]})]})})}),t.jsx(o,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ve,{className:"h-5 w-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Processing"}),t.jsx("p",{className:"text-2xl font-bold",children:R.byStatus.processing||0})]})]})})}),t.jsx(o,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ve,{className:"h-5 w-5 text-purple-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Size"}),t.jsxs("p",{className:"text-2xl font-bold",children:[(R.totalSize/1024/1024).toFixed(1),"MB"]})]})]})})})]}),t.jsx(o,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx(k,{placeholder:"Search documents...",value:T,onChange:e=>E(e.target.value),className:"pl-10"})]})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(p,{value:x.status,onValueChange:e=>w(s=>({...s,status:e})),children:[t.jsx(g,{className:"w-32",children:t.jsx(j,{placeholder:"Status"})}),t.jsxs(f,{children:[t.jsx(N,{value:"all",children:"All Status"}),Object.entries(D).map(([e,s])=>t.jsx(N,{value:e,children:s},e))]})]}),t.jsxs(p,{value:x.type,onValueChange:e=>w(s=>({...s,type:e})),children:[t.jsx(g,{className:"w-32",children:t.jsx(j,{placeholder:"Type"})}),t.jsxs(f,{children:[t.jsx(N,{value:"all",children:"All Types"}),Object.entries(y).map(([e,s])=>t.jsx(N,{value:e,children:s},e))]})]}),t.jsxs(p,{value:c,onValueChange:e=>l(e),children:[t.jsx(g,{className:"w-32",children:t.jsx(j,{placeholder:"Sort by"})}),t.jsxs(f,{children:[t.jsx(N,{value:"created_at",children:"Date"}),t.jsx(N,{value:"filename",children:"Name"}),t.jsx(N,{value:"file_size",children:"Size"}),t.jsx(N,{value:"processing_status",children:"Status"})]})]}),t.jsx(h,{variant:"outline",size:"sm",onClick:()=>m("asc"===d?"desc":"asc"),children:"asc"===d?"":""})]}),t.jsxs("div",{className:"flex border rounded-md",children:[t.jsx(h,{variant:"grid"===e?"default":"ghost",size:"sm",onClick:()=>r("grid"),children:t.jsx(We,{className:"h-4 w-4"})}),t.jsx(h,{variant:"list"===e?"default":"ghost",size:"sm",onClick:()=>r("list"),children:t.jsx(Qe,{className:"h-4 w-4"})})]})]})})}),n.size>0&&t.jsx(o,{children:t.jsx(u,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:[n.size," document",n.size>1?"s":""," selected"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(h,{variant:"destructive",size:"sm",onClick:async()=>{0!==n.size&&(await I.mutateAsync(Array.from(n)),i(new Set))},disabled:O,children:[t.jsx(we,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),t.jsx(h,{variant:"outline",size:"sm",onClick:()=>i(new Set),children:"Clear Selection"})]})]})})}),_?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{children:"Loading documents..."})}):z?t.jsx("div",{className:"text-center py-8 text-red-600",children:t.jsxs("p",{children:["Error loading documents: ",z.message]})}):0===$.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:T?"No documents found matching your search.":"No documents uploaded yet."}),!T&&t.jsx(h,{className:"mt-4",onClick:()=>b(!0),children:"Upload Your First Document"})]}):t.jsxs("div",{className:"grid"===e?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-2",children:["list"===e&&t.jsxs("div",{className:"flex items-center space-x-3 p-3 border-b",children:[t.jsx(K,{checked:n.size===$.length,onCheckedChange:()=>{n.size===$.length?i(new Set):i(new Set($.map(e=>e.id)))}}),t.jsx("span",{className:"text-sm font-medium",children:"Select All"})]}),$.map(s=>s&&s.id?t.jsx(DocumentCard,{document:s,viewMode:e,isSelected:n.has(s.id),onToggleSelection:()=>(e=>{const s=new Set(n);s.has(e)?s.delete(e):s.add(e),i(s)})(s.id),onDownload:()=>{return e=s.id,void P.mutate({documentId:e});var e},onDelete:()=>{return e=s.id,void F.mutate(e);var e},getStatusIcon:getStatusIcon,getStatusColor:getStatusColor},s.id):(console.warn("Invalid document found:",s),null)).filter(Boolean)]})]})},DocumentCard=({document:e,viewMode:s,isSelected:a,onToggleSelection:r,onDownload:n,onDelete:i,getStatusIcon:c,getStatusColor:l})=>{if(!e)return console.warn("DocumentCard received null/undefined document"),null;const d={id:e.id||"",filename:e.filename||"Unknown File",document_type:e.document_type||"other",file_size:e.file_size||0,created_at:e.created_at||(new Date).toISOString(),processing_status:e.processing_status||"pending"};return"list"===s?t.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50",children:[t.jsx(K,{checked:a,onCheckedChange:r}),t.jsx(de,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium truncate",children:d.filename}),t.jsxs("p",{className:"text-sm text-gray-500",children:[y[d.document_type]||"Unknown"," ",(d.file_size/1024/1024).toFixed(2)," MB ",Xe(new Date(d.created_at),{addSuffix:!0})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(C,{className:l(d.processing_status),children:[c(d.processing_status),t.jsx("span",{className:"ml-1",children:D[d.processing_status]||"Unknown"})]}),t.jsxs(_,{children:[t.jsx(z,{asChild:!0,children:t.jsx(h,{variant:"ghost",size:"sm",children:t.jsx(Ke,{className:"h-4 w-4"})})}),t.jsxs(T,{children:[t.jsxs(E,{onClick:n,children:[t.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Download"]}),t.jsx(J,{}),t.jsxs(E,{onClick:i,className:"text-red-600",children:[t.jsx(we,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}):t.jsx(o,{className:"cursor-pointer transition-colors "+(a?"ring-2 ring-blue-500":""),children:t.jsxs(u,{className:"p-4",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsx(K,{checked:a,onCheckedChange:r}),t.jsxs(_,{children:[t.jsx(z,{asChild:!0,children:t.jsx(h,{variant:"ghost",size:"sm",children:t.jsx(Ke,{className:"h-4 w-4"})})}),t.jsxs(T,{children:[t.jsxs(E,{onClick:n,children:[t.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Download"]}),t.jsx(J,{}),t.jsxs(E,{onClick:i,className:"text-red-600",children:[t.jsx(we,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),t.jsxs("div",{className:"text-center mb-4",children:[t.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),t.jsx("h3",{className:"font-medium truncate",title:d.filename,children:d.filename})]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Type:"}),t.jsx("span",{children:y[d.document_type]||"Unknown"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Size:"}),t.jsxs("span",{children:[(d.file_size/1024/1024).toFixed(2)," MB"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Uploaded:"}),t.jsx("span",{children:Xe(new Date(d.created_at),{addSuffix:!0})})]})]}),t.jsx("div",{className:"mt-3",children:t.jsxs(C,{className:`w-full justify-center ${l(d.processing_status)}`,children:[c(d.processing_status),t.jsx("span",{className:"ml-1",children:D[d.processing_status]||"Unknown"})]})})]})})},DatabaseTest=()=>{const[e,a]=s.useState([]),[n,i]=s.useState(!1),runTests=async()=>{i(!0);const e=[];try{const{data:s,error:t}=await r.from("profiles").select("count").limit(1);e.push({name:"Supabase Connection",status:t?"error":"success",message:t?t.message:"Connected successfully",details:{data:s,error:t}})}catch(n){e.push({name:"Supabase Connection",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:s,error:t}=await r.from("uploaded_documents").select("id, filename, processing_status").limit(5);e.push({name:"uploaded_documents Table",status:t?"error":"success",message:t?t.message:`Found ${s?.length||0} documents`,details:{data:s,error:t}})}catch(n){e.push({name:"uploaded_documents Table",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:{user:s},error:t}=await r.auth.getUser();e.push({name:"Authentication",status:t?"error":"success",message:t?t.message:s?`Logged in as ${s.email}`:"Not logged in",details:{user:s,error:t}})}catch(n){e.push({name:"Authentication",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:s,error:t}=await r.storage.listBuckets(),a=s?.find(e=>"documents"===e.name);e.push({name:"Storage Bucket",status:t?"error":a?"success":"error",message:t?t.message:a?"Documents bucket exists":"Documents bucket not found",details:{buckets:s,error:t}})}catch(n){e.push({name:"Storage Bucket",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}const s={VITE_SUPABASE_URL:"https://kvlaydeyqidlfpfutbmp.supabase.co",VITE_SUPABASE_ANON_KEY:"***",VITE_APP_URL:"https://craftchatbot.com"},t=Object.entries(s).filter(([e,s])=>!s);e.push({name:"Environment Variables",status:t.length>0?"error":"success",message:t.length>0?`Missing: ${t.map(([e])=>e).join(", ")}`:"All required variables present",details:s}),a(e),i(!1)};s.useEffect(()=>{runTests()},[]);const getStatusIcon=e=>{switch(e){case"success":return t.jsx(me,{className:"h-5 w-5 text-green-500"});case"error":return t.jsx(He,{className:"h-5 w-5 text-red-500"});case"pending":return t.jsx(xe,{className:"h-5 w-5 text-yellow-500"})}};return t.jsxs(o,{className:"max-w-4xl mx-auto",children:[t.jsx(d,{children:t.jsxs(m,{className:"flex items-center justify-between",children:["Database Connection Test",t.jsxs(h,{onClick:runTests,disabled:n,size:"sm",children:[t.jsx(be,{className:"h-4 w-4 mr-2 "+(n?"animate-spin":"")}),n?"Running...":"Run Tests"]})]})}),t.jsx(u,{children:t.jsx("div",{className:"space-y-4",children:e.map((e,s)=>t.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[getStatusIcon(e.status),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:e.name}),t.jsx("p",{className:"text-sm text-gray-600",children:e.message}),!1]})]},s))})})]})},Documents=()=>{const{profile:e,forceRefreshProfile:a}=n(),r=Z(),[i,c]=s.useState(null),[l,p]=s.useState([]),[g,j]=s.useState(!1),[f,y]=s.useState(0),[N,w]=s.useState("overview"),v=s.useCallback(e=>{c(e)},[]),b=s.useCallback(()=>{c(null)},[]),S=s.useCallback(e=>{y(e=>e+1)},[]),k=s.useCallback(e=>{p(e)},[]),D=s.useCallback(e=>{j(e)},[]);return t.jsx(ee,{children:t.jsx(se,{children:t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("header",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex justify-between items-center py-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(h,{variant:"outline",size:"sm",onClick:()=>r("/"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Go to Homepage",children:[t.jsx(Ye,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Home"})]}),t.jsxs(h,{variant:"outline",size:"sm",onClick:()=>r("/dashboard"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Back to Dashboard",children:[t.jsx(Ge,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})]}),t.jsxs("div",{className:"hidden md:block",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Document Management"}),t.jsx("p",{className:"text-gray-600",children:"Upload, process, and manage your legal documents with AI"})]}),t.jsx("div",{className:"md:hidden",children:t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Documents"})})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Subscription"}),t.jsx("p",{className:"font-medium capitalize",children:e?.subscription_tier||"Free"}),t.jsxs("p",{className:"text-xs text-gray-400",children:["Debug: ",JSON.stringify({tier:e?.subscription_tier,email:e?.email})]})]}),t.jsxs(h,{variant:"outline",size:"sm",onClick:async()=>{try{await a(),console.log("Profile refreshed successfully")}catch(e){console.error("Failed to refresh profile:",e)}},className:"flex items-center space-x-1",title:"Refresh subscription status",children:[t.jsx(qe,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]})})}),t.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:t.jsx("div",{className:"px-4 py-6 sm:px-0",children:i?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs(h,{onClick:b,variant:"outline",size:"sm",children:[t.jsx(ue,{className:"h-4 w-4 mr-2"}),"Close Viewer"]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Document Viewer"}),t.jsxs("p",{className:"text-gray-600",children:["Viewing: ",i.filename]})]})]})}),t.jsx(DocumentViewer,{documentId:i.id,onClose:b,className:"w-full"})]}):t.jsxs(U,{value:N,onValueChange:w,className:"space-y-6",children:[t.jsxs(A,{className:"grid w-full grid-cols-6",children:[t.jsxs(F,{value:"overview",className:"flex items-center space-x-2",children:[t.jsx(Ve,{className:"h-4 w-4"}),t.jsx("span",{children:"Overview"})]}),t.jsxs(F,{value:"upload",className:"flex items-center space-x-2",children:[t.jsx(oe,{className:"h-4 w-4"}),t.jsx("span",{children:"Upload"})]}),t.jsxs(F,{value:"search",className:"flex items-center space-x-2",children:[t.jsx(fe,{className:"h-4 w-4"}),t.jsx("span",{children:"Search"})]}),t.jsxs(F,{value:"manage",className:"flex items-center space-x-2",children:[t.jsx(Qe,{className:"h-4 w-4"}),t.jsx("span",{children:"Manage"})]}),t.jsxs(F,{value:"enhanced",className:"flex items-center space-x-2",children:[t.jsx(qe,{className:"h-4 w-4"}),t.jsx("span",{children:"Enhanced"})]}),t.jsxs(F,{value:"debug",className:"flex items-center space-x-2",children:[t.jsx(xe,{className:"h-4 w-4"}),t.jsx("span",{children:"Debug"})]})]}),t.jsxs(P,{value:"overview",className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsx(DocumentStatusTracker,{onDocumentSelect:v,refreshTrigger:f})}),t.jsx("div",{children:t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsxs(m,{className:"text-lg flex items-center",children:[t.jsx(oe,{className:"h-5 w-5 mr-2"}),"Quick Upload"]}),t.jsx(x,{children:"Upload documents for AI processing"})]}),t.jsx(u,{children:t.jsx(DocumentUploadWrapper,{onUploadComplete:S,maxFiles:3})})]})})]}),t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsxs(m,{className:"text-lg flex items-center",children:[t.jsx(de,{className:"h-5 w-5 mr-2"}),"Recent Documents"]}),t.jsx(x,{children:"Your most recently uploaded documents"})]}),t.jsx(u,{children:t.jsx(DocumentList,{onDocumentSelect:v,refreshTrigger:f})})]})]}),t.jsx(P,{value:"upload",className:"space-y-6",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsx(DocumentUploadWrapper,{onUploadComplete:S,maxFiles:10})}),t.jsx("div",{children:t.jsx(DocumentStatusTracker,{onDocumentSelect:v,refreshTrigger:f})})]})}),t.jsx(P,{value:"search",className:"space-y-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(DocumentSearch,{onResults:k,onLoading:D}),t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsxs(m,{className:"text-lg flex items-center",children:[t.jsx(fe,{className:"h-5 w-5 mr-2"}),"Search Results",g&&t.jsx("div",{className:"ml-2 h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"})]}),t.jsx(x,{children:l.length>0?`Found ${l.length} document${1===l.length?"":"s"}`:"Enter search criteria to find documents"})]}),t.jsx(u,{children:t.jsx(DocumentList,{onDocumentSelect:v,refreshTrigger:f})})]})]})}),t.jsx(P,{value:"manage",className:"space-y-6",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[t.jsx("div",{className:"lg:col-span-3",children:t.jsxs(o,{children:[t.jsxs(d,{children:[t.jsxs(m,{className:"text-lg flex items-center",children:[t.jsx(Qe,{className:"h-5 w-5 mr-2"}),"All Documents"]}),t.jsx(x,{children:"Manage all your uploaded documents"})]}),t.jsx(u,{children:t.jsx(DocumentList,{onDocumentSelect:v,refreshTrigger:f})})]})}),t.jsx("div",{children:t.jsx(DocumentStatusTracker,{onDocumentSelect:v,refreshTrigger:f})})]})}),t.jsx(P,{value:"enhanced",className:"space-y-6",children:t.jsx(se,{children:t.jsx(DocumentManagementDashboard,{})})}),t.jsx(P,{value:"debug",className:"space-y-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(UploadDiagnostics,{}),t.jsx(te,{}),t.jsx(ae,{}),t.jsx(DatabaseTest,{})]})})]})})})]})})})};export{Documents as default};
