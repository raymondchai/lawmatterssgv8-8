import{r as N,aJ as J,j as e,cq as q,a_ as O,aR as B,bN as z,F as M,q as H,aK as K,aV as W}from"./react-vendor-DgOuH3B5.js";import{o as Y,s as p,e as I,b as Q,t as X}from"./forms-zYe9FhTN.js";import{a9 as Z,C as j,u as f,v,z as A,o as S,a0 as c,A as C,E as P,G as F,H as $,K as h,I as b,p as ee,a1 as ae,B as k,L as te,M as se}from"./ai-services-DbCQJDXZ.js";import{supabase as o}from"./supabase-B5_W4sir.js";import{J as w}from"./vendor-DXfpcdns.js";const re={async getPublicTemplates(){const{data:a,error:s}=await o.from("templates").select("*").eq("is_public",!0).order("created_at",{ascending:!1});if(s)throw s;return a},async getUserTemplates(){const{data:a,error:s}=await o.from("templates").select("*").order("created_at",{ascending:!1});if(s)throw s;return a},async getTemplatesByCategory(a){const{data:s,error:t}=await o.from("templates").select("*").eq("category",a).eq("is_public",!0).order("created_at",{ascending:!1});if(t)throw t;return s},async getTemplate(a){const{data:s,error:t}=await o.from("templates").select("*").eq("id",a).single();if(t)throw t;return s},async createTemplate(a){const s=await o.auth.getUser();if(!s.data.user)throw new Error("User not authenticated");const{data:t,error:r}=await o.from("templates").insert({...a,created_by:s.data.user.id}).select().single();if(r)throw r;return t},async updateTemplate(a,s){const{data:t,error:r}=await o.from("templates").update(s).eq("id",a).select().single();if(r)throw r;return t},async deleteTemplate(a){const{error:s}=await o.from("templates").delete().eq("id",a);if(s)throw s},async searchTemplates(a){const{data:s,error:t}=await o.from("templates").select("*").or(`name.ilike.%${a}%,description.ilike.%${a}%,category.ilike.%${a}%`).eq("is_public",!0).order("created_at",{ascending:!1});if(t)throw t;return s},exportTemplate(a,s="txt"){let t,r;switch(s){case"json":t=JSON.stringify(a,null,2),r="application/json";break;case"docx":t=a.content,r="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case"txt":default:t=a.content,r="text/plain";break}return new Blob([t],{type:r})},downloadTemplate(a,s="txt"){const t=this.exportTemplate(a,s),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=`${a.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.${s}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},async createTemplateVersion(a,s,t){const r=await this.getTemplate(a),i={name:`${r.name} v${Date.now()}`,description:s.description||r.description,category:s.category||r.category,content:s.content||r.content,variables:s.variables||r.variables,is_public:s.is_public??r.is_public};return this.createTemplate(i)}};async function ne(a){const s=le(a);try{const t=await Z(s,[],[]);return{...ie(t.message,a),confidence:t.confidence}}catch(t){throw console.error("Template generation failed:",t),new Error("Failed to generate template")}}function le(a){const{type:s,parties:t,terms:r,customRequirements:i,language:T="english",jurisdiction:u="singapore"}=a;let n=`Generate a professional legal ${s} template for ${u==="singapore"?"Singapore":"international"} use. `;return T==="simplified"?n+="Use clear, simple language that non-lawyers can understand. ":n+="Use standard legal terminology and formal language. ",n+=`

Template Requirements:
`,n+=`- Document Type: ${s}
`,(t.party1||t.party2)&&(n+=`- Parties:
`,t.party1&&(n+=`  - First Party: Use variable {{party1_name}} for ${t.party1}
`),t.party2&&(n+=`  - Second Party: Use variable {{party2_name}} for ${t.party2}
`)),Object.keys(r).length>0&&(n+=`- Key Terms:
`,Object.entries(r).forEach(([m,g])=>{g&&(n+=`  - ${m.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())}: Use variable {{${m}}} for ${g}
`)})),i&&(n+=`- Additional Requirements: ${i}
`),n+=`
Instructions:
`,n+=`1. Create a complete, legally sound template
`,n+=`2. Use variables in double curly braces {{variable_name}} for customizable fields
`,n+=`3. Include all necessary legal clauses and provisions
`,n+=`4. Ensure compliance with Singapore law (if applicable)
`,n+=`5. Add appropriate signature blocks and date fields
`,n+=`6. Include clear section headings and numbering

`,n+=`Format your response as JSON with the following structure:
`,n+=`{
`,n+=`  "name": "Template name",
`,n+=`  "description": "Brief description of the template",
`,n+=`  "category": "Template category (contracts, employment, corporate, etc.)",
`,n+=`  "content": "Full template content with variables",
`,n+=`  "variables": ["list", "of", "variable", "names"]
`,n+=`}

`,n+="Respond with valid JSON only, no additional text.",n}function ie(a,s){try{const t=JSON.parse(a);return{name:t.name||`${s.type} Template`,content:t.content||a,variables:t.variables||L(t.content||a),category:t.category||U(s.type),description:t.description||`AI-generated ${s.type} template`}}catch{return console.warn("Failed to parse JSON response, using raw content"),{name:`${s.type} Template`,content:a,variables:L(a),category:U(s.type),description:`AI-generated ${s.type} template`}}}function L(a){const s=/\{\{([^}]+)\}\}/g,t=a.match(s)||[];return[...new Set(t.map(r=>r.replace(/[{}]/g,"").trim()))]}function U(a){const s={contract:"contracts",agreement:"contracts","employment contract":"employment","service agreement":"contracts",nda:"contracts","non-disclosure agreement":"contracts","lease agreement":"real-estate","rental agreement":"real-estate","purchase agreement":"real-estate","partnership agreement":"corporate","shareholder agreement":"corporate","articles of incorporation":"corporate","trademark application":"intellectual-property","copyright notice":"intellectual-property","privacy policy":"compliance","terms of service":"compliance",will:"personal","power of attorney":"personal"},t=a.toLowerCase();return s[t]||"other"}async function ce(a,s=!1){try{const t={name:a.name,description:a.description,category:a.category,content:a.content,variables:a.variables,is_public:s};return await re.createTemplate(t)}catch(t){throw console.error("Failed to save generated template:",t),new Error("Failed to save template")}}const oe=Y({type:p().min(1,"Template type is required"),party1:p().optional(),party2:p().optional(),duration:p().optional(),amount:p().optional(),jurisdiction:I(["singapore","international"]).default("singapore"),language:I(["english","simplified"]).default("english"),customRequirements:p().optional(),saveAsPublic:Q().default(!1)}),me=[{value:"service agreement",label:"Service Agreement"},{value:"employment contract",label:"Employment Contract"},{value:"non-disclosure agreement",label:"Non-Disclosure Agreement (NDA)"},{value:"consulting agreement",label:"Consulting Agreement"},{value:"partnership agreement",label:"Partnership Agreement"},{value:"lease agreement",label:"Lease Agreement"},{value:"purchase agreement",label:"Purchase Agreement"},{value:"terms of service",label:"Terms of Service"},{value:"privacy policy",label:"Privacy Policy"},{value:"shareholder agreement",label:"Shareholder Agreement"},{value:"licensing agreement",label:"Licensing Agreement"},{value:"distribution agreement",label:"Distribution Agreement"}],xe=({onTemplateGenerated:a,className:s=""})=>{const[t,r]=N.useState(!1),[i,T]=N.useState(null),[u,n]=N.useState(!1),{register:m,handleSubmit:g,watch:x,setValue:y,formState:{errors:_}}=J({resolver:X(oe),defaultValues:{jurisdiction:"singapore",language:"english",saveAsPublic:!1}}),E=x("type"),D=async l=>{r(!0);try{const d={type:l.type,parties:{party1:l.party1,party2:l.party2},terms:{duration:l.duration,amount:l.amount,jurisdiction:l.jurisdiction},customRequirements:l.customRequirements,language:l.language,jurisdiction:l.jurisdiction},R=await ne(d);T(R),n(!0),a==null||a(R),w.success("Template generated successfully!")}catch(d){console.error("Template generation failed:",d),w.error("Failed to generate template: "+d.message)}finally{r(!1)}},V=async()=>{if(i)try{const l=x("saveAsPublic");await ce(i,l),w.success("Template saved successfully!")}catch(l){console.error("Failed to save template:",l),w.error("Failed to save template: "+l.message)}},G=l=>({"service agreement":"A contract for providing services between two parties","employment contract":"An agreement between employer and employee","non-disclosure agreement":"A confidentiality agreement to protect sensitive information","consulting agreement":"A contract for consulting services","partnership agreement":"An agreement between business partners","lease agreement":"A rental agreement for property","purchase agreement":"A contract for buying/selling goods or property","terms of service":"Terms and conditions for using a service or platform","privacy policy":"A policy explaining how personal data is collected and used","shareholder agreement":"An agreement between company shareholders"})[l]||"A legal document template";return e.jsxs("div",{className:`space-y-6 ${s}`,children:[e.jsx(j,{children:e.jsxs(f,{children:[e.jsxs(v,{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{children:"AI Template Generator"})]}),e.jsx(A,{children:"Generate custom legal templates using AI. Fill in the details below to create a professional legal document."})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(v,{className:"text-lg",children:"Template Details"}),e.jsx(A,{children:"Provide information about the template you want to generate"})]}),e.jsx(S,{children:e.jsxs("form",{onSubmit:g(D),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"type",children:"Template Type *"}),e.jsxs(C,{onValueChange:l=>y("type",l),children:[e.jsx(P,{children:e.jsx(F,{placeholder:"Select template type"})}),e.jsx($,{children:me.map(l=>e.jsx(h,{value:l.value,children:l.label},l.value))})]}),_.type&&e.jsx("p",{className:"text-red-500 text-sm",children:_.type.message}),E&&e.jsx("p",{className:"text-sm text-gray-600",children:G(E)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"party1",children:"First Party"}),e.jsx(b,{...m("party1"),placeholder:"e.g., Service Provider, Employer"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"party2",children:"Second Party"}),e.jsx(b,{...m("party2"),placeholder:"e.g., Client, Employee"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"duration",children:"Duration/Term"}),e.jsx(b,{...m("duration"),placeholder:"e.g., 12 months, 2 years"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"amount",children:"Amount/Value"}),e.jsx(b,{...m("amount"),placeholder:"e.g., $5,000, SGD 10,000"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"jurisdiction",children:"Jurisdiction"}),e.jsxs(C,{onValueChange:l=>y("jurisdiction",l),children:[e.jsx(P,{children:e.jsx(F,{placeholder:"Select jurisdiction"})}),e.jsxs($,{children:[e.jsx(h,{value:"singapore",children:"Singapore"}),e.jsx(h,{value:"international",children:"International"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"language",children:"Language Style"}),e.jsxs(C,{onValueChange:l=>y("language",l),children:[e.jsx(P,{children:e.jsx(F,{placeholder:"Select language style"})}),e.jsxs($,{children:[e.jsx(h,{value:"english",children:"Standard Legal"}),e.jsx(h,{value:"simplified",children:"Plain English"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"customRequirements",children:"Additional Requirements"}),e.jsx(ee,{...m("customRequirements"),placeholder:"Describe any specific clauses, terms, or requirements you need...",rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{id:"saveAsPublic",onCheckedChange:l=>y("saveAsPublic",!!l)}),e.jsx(c,{htmlFor:"saveAsPublic",className:"text-sm",children:"Make this template public for other users"})]}),e.jsx(k,{type:"submit",disabled:t,className:"w-full",children:t?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating Template..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Generate Template"]})})]})})]}),e.jsxs(j,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(v,{className:"text-lg",children:"Generated Template"}),e.jsx(A,{children:"Preview and save your AI-generated template"})]}),i&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>n(!u),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),u?"Hide":"Show"," Preview"]}),e.jsxs(k,{size:"sm",onClick:V,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Save"]})]})]})}),e.jsx(S,{children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-900",children:i.name})]}),e.jsx("p",{className:"text-sm text-green-700 mb-2",children:i.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-green-600",children:[e.jsxs("span",{children:["Category: ",i.category]}),e.jsxs("span",{children:["Variables: ",i.variables.length]}),e.jsxs("span",{children:["Confidence: ",Math.round(i.confidence*100),"%"]})]})]}),i.variables.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Template Variables:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:i.variables.map((l,d)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:l},d))})]}),u&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Template Content:"}),e.jsx("div",{className:"max-h-64 overflow-y-auto p-3 bg-gray-50 rounded border text-sm",children:e.jsx("pre",{className:"whitespace-pre-wrap font-mono",children:i.content})})]}),i.confidence<.7&&e.jsxs(te,{children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(se,{children:"This template was generated with lower confidence. Please review carefully and consider consulting a legal professional."})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No template generated yet"}),e.jsx("p",{className:"text-gray-500",children:'Fill in the form and click "Generate Template" to create your custom legal document.'})]})})]})]}),e.jsxs(j,{children:[e.jsx(f,{children:e.jsxs(v,{className:"text-sm flex items-center space-x-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Tips for Better Templates"})]})}),e.jsx(S,{children:e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Be specific about the type of agreement you need"}),e.jsx("li",{children:'• Provide clear party descriptions (e.g., "Software Company" vs "Company A")'}),e.jsx("li",{children:"• Include specific terms like duration, amounts, and key obligations"}),e.jsx("li",{children:"• Mention any special requirements or unique clauses needed"}),e.jsx("li",{children:"• Choose the appropriate jurisdiction for your use case"}),e.jsx("li",{children:'• Use "Plain English" style for simpler, more readable templates'})]})})]})]})};export{xe as T,re as t};
