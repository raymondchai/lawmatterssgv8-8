const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfWorker-7KP207i8.js","assets/ai-services-C7wGs9RJ.js","assets/react-vendor-CQwTX5cM.js","assets/ui-components-BA32w1ww.js","assets/data-fetching-C9PAuT9r.js","assets/vendor-CdHE2p_m.js","assets/ocr-worker-C-xttgCS.js","assets/pdf-worker-CQFXObSw.js","assets/react-vendor-C7U9D9nZ.css","assets/supabase-DtnFeX9z.js","assets/utilities-1ndx239g.js","assets/forms-DACbGb-3.js","assets/ai-services-zerNyzqp.css"])))=>i.map(i=>d[i]);
var qs=Object.defineProperty;var Ls=(n,a,s)=>a in n?qs(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s;var ae=(n,a,s)=>Ls(n,typeof a!="symbol"?a+"":a,s);import{r as u,bQ as ws,j as e,aO as xe,F as L,q as ne,b3 as Y,X as ze,aR as ge,cl as we,Z as vs,cm as bs,c8 as De,a_ as je,m as Ce,ce as Bs,w as be,b$ as _e,v as ve,aM as Te,aK as Ke,U as ls,az as Vs,aG as Qs,G as Ws,cf as Hs,cg as Ks,ca as Gs,o as os,cn as ds,bM as Zs,b0 as Ys,ch as Xs,$ as Js,a0 as Ss,bN as Ps,aF as et,aJ as st,bU as tt,bG as ks,bS as Me,bR as Pe,bT as es,bD as at,bF as Ds,am as nt,a1 as Ge,co as ms,aN as rt,u as ct,b9 as it,aD as lt}from"./react-vendor-CQwTX5cM.js";import{_ as Ae,w as ss,x as Cs,y as Ue,F as pe,C as _,u as I,v as O,z as Z,o as T,B as y,A as re,E as ce,G as ie,H as le,J as oe,K as q,P as Ee,L as Re,M as $e,N as Q,I as fe,O as ue,h as V,D as Ze,a as Ye,b as Xe,d as ye,q as ts,r as as,s as J,t as P,Q as ot,R as dt,S as Ie,U as xs,V as us,W as hs,X as mt,Y as xt,Z as ut,$ as ht,p as _s,j as ps,a0 as se,a1 as Oe,a2 as Je,a3 as qe,a4 as Be,a5 as gs,a6 as pt,a7 as gt,a8 as jt}from"./ai-services-C7wGs9RJ.js";import{supabase as G}from"./supabase-DtnFeX9z.js";import{J as M}from"./vendor-CdHE2p_m.js";import{f as Ne,l as ft}from"./utilities-1ndx239g.js";import{b as yt}from"./useAnnotations-iyIZVN8V.js";import{o as Nt,s as Se,e as wt,n as js,b as vt,t as bt}from"./forms-DACbGb-3.js";import{c as St,t as kt,s as Dt}from"./search-CF5iUmb3.js";import"./ui-components-BA32w1ww.js";import"./data-fetching-C9PAuT9r.js";import"./ocr-worker-C-xttgCS.js";import"./pdf-worker-CQFXObSw.js";async function Ct(n,a){const s=Date.now();try{a==null||a({status:"initializing",progress:0,message:"Loading PDF..."});const{getPdfJs:t}=await Ae(async()=>{const{getPdfJs:j}=await import("./pdfWorker-7KP207i8.js");return{getPdfJs:j}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),c=await t();if(!c)throw new Error("PDF.js failed to load");const i=await n.arrayBuffer(),r=await c.getDocument({data:i}).promise,g=r.numPages,o=[];let d="";for(let j=1;j<=g;j++){a==null||a({status:"processing",progress:(j-1)/g*100,currentPage:j,totalPages:g,message:`Processing page ${j} of ${g}...`});const k=(await(await r.getPage(j)).getTextContent()).items.map(D=>D.str).join(" ").trim();o.push({pageNumber:j,text:k,confidence:.95}),d+=k+`
`}const h=Date.now()-s;return a==null||a({status:"completed",progress:100,message:"PDF processing completed"}),{text:d.trim(),confidence:.95,pages:o,metadata:{processingTime:h,fileSize:n.size,pageCount:g}}}catch(t){throw console.error("Error extracting text from PDF:",t),a==null||a({status:"error",progress:0,message:"Failed to process PDF"}),new Error("Failed to extract text from PDF")}}async function _t(n,a){const s=Date.now();try{a==null||a({status:"initializing",progress:0,message:"Initializing OCR..."});const c=await(await Ae(()=>import("./ocr-worker-C-xttgCS.js").then(r=>r.i),__vite__mapDeps([6,5,2,3,4,7,1,9,10,11,12,8]))).recognize(n,"eng",{logger:r=>{r.status==="recognizing text"&&(a==null||a({status:"processing",progress:r.progress*100,message:`OCR processing: ${Math.round(r.progress*100)}%`}))}}),i=Date.now()-s;return a==null||a({status:"completed",progress:100,message:"OCR processing completed"}),{text:c.data.text,confidence:c.data.confidence/100,pages:[{pageNumber:1,text:c.data.text,confidence:c.data.confidence/100}],metadata:{processingTime:i,fileSize:n.size,pageCount:1}}}catch(t){throw console.error("Error performing OCR:",t),a==null||a({status:"error",progress:0,message:"OCR processing failed"}),new Error("Failed to perform OCR on image")}}async function Ts(n,a){const s=n.type.toLowerCase(),t=n.name.toLowerCase();if(s==="application/pdf"||t.endsWith(".pdf"))return Ct(n,a);if(s.startsWith("image/")||t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".png")||t.endsWith(".gif")||t.endsWith(".bmp")||t.endsWith(".tiff"))return _t(n,a);if(s==="text/plain"||t.endsWith(".txt")){const c=Date.now();a==null||a({status:"processing",progress:50,message:"Reading text file..."});const i=await n.text(),r=Date.now()-c;return a==null||a({status:"completed",progress:100,message:"Text file processed"}),{text:i,confidence:1,pages:[{pageNumber:1,text:i,confidence:1}],metadata:{processingTime:r,fileSize:n.size,pageCount:1}}}throw new Error(`Unsupported file type: ${s}`)}function As(n){const{text:a,confidence:s}=n,t=[];s<.7&&t.push("Low confidence detected. Consider rescanning with higher resolution.");const i=[/[0O]{3,}/,/[1Il]{3,}/,/\s{5,}/,/[^\w\s.,;:!?()-]{3,}/].some(g=>g.test(a));i&&t.push("Potential OCR errors detected. Review the extracted text carefully."),a.length<50&&t.push("Very little text extracted. Ensure the document contains readable text.");let r=s;return i&&(r-=.2),a.length<50&&(r-=.3),r=Math.max(0,Math.min(1,r)),{isGoodQuality:r>=.7,suggestions:t,qualityScore:r}}function Es(n){return n.replace(/\s+/g," ").replace(/[^\w\s.,;:!?()"-]/g,"").replace(/0/g,"O").replace(/1/g,"I").replace(/\n+/g,`
`).trim()}async function Tt(n,a,s){try{const{usageTrackingService:t}=await Ae(async()=>{const{usageTrackingService:k}=await import("./ai-services-C7wGs9RJ.js").then(D=>D.ak);return{usageTrackingService:k}},__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12])),c=await t.checkUsageLimit("ai_query");if(!c.allowed)throw new Error(`AI processing limit exceeded. You have used ${c.current}/${c.limit} AI queries this month. Please upgrade your plan to continue.`);s==null||s({stage:"ocr",progress:0,message:"Starting text extraction..."});const i=await Ts(n,k=>{s==null||s({stage:"ocr",progress:k.progress*.4,message:k.message||"Extracting text..."})}),r=As(i),g=Es(i.text),{error:o}=await G.from("uploaded_documents").update({ocr_text:g,ocr_quality_score:r.qualityScore,processing_status:"processing",updated_at:new Date().toISOString()}).eq("id",a);if(o)throw new Error(`Failed to update OCR results: ${o.message}`);s==null||s({stage:"analysis",progress:40,message:"Analyzing document content..."});const d=await ss(g);await t.incrementUsage("ai_query",a,{operation:"document_analysis",text_length:g.length,document_type:n.type});const{error:h}=await G.from("uploaded_documents").update({document_structure:{analysis:d,ocrQuality:r,metadata:i.metadata},updated_at:new Date().toISOString()}).eq("id",a);if(h)throw new Error(`Failed to update analysis results: ${h.message}`);s==null||s({stage:"embedding",progress:70,message:"Generating embeddings for search..."});let j;if(g.length>50)try{const k=At(g,1e3);for(let D=0;D<k.length;D++){const z=k[D],U=await Cs(z),{data:m,error:p}=await G.from("document_embeddings").insert({document_id:a,chunk_text:z,chunk_index:D,embedding:U.embedding,metadata:{usage:U.usage,chunkLength:z.length,totalChunks:k.length}}).select("id").single();p?console.error("Failed to store embedding:",p):D===0&&(j=m.id);const x=70+(D+1)/k.length*20;s==null||s({stage:"embedding",progress:x,message:`Processing chunk ${D+1} of ${k.length}...`})}}catch(k){console.error("Embedding generation failed:",k)}s==null||s({stage:"completed",progress:95,message:"Finalizing document processing..."});const{data:v,error:R}=await G.from("uploaded_documents").update({processing_status:"completed",updated_at:new Date().toISOString()}).eq("id",a).select().single();if(R)throw new Error(`Failed to finalize document: ${R.message}`);return s==null||s({stage:"completed",progress:100,message:"Document processing completed successfully!"}),{document:v,ocrResult:i,analysis:d,embeddingId:j}}catch(t){throw console.error("Document processing failed:",t),await G.from("uploaded_documents").update({processing_status:"failed",updated_at:new Date().toISOString()}).eq("id",a),s==null||s({stage:"error",progress:0,message:"Document processing failed",error:t instanceof Error?t.message:"Unknown error"}),t}}function At(n,a=1e3){const s=[],t=n.split(/[.!?]+/).filter(i=>i.trim().length>0);let c="";for(const i of t){const r=i.trim();c.length+r.length+1<=a?c+=(c?". ":"")+r:(c&&s.push(c+"."),c=r)}if(c&&s.push(c+"."),s.length===0){const i=n.split(/\s+/);let r="";for(const g of i)r.length+g.length+1<=a?r+=(r?" ":"")+g:(r&&s.push(r),r=g);r&&s.push(r)}return s.filter(i=>i.trim().length>0)}class Et{constructor(){ae(this,"ws",null);ae(this,"reconnectAttempts",0);ae(this,"maxReconnectAttempts",5);ae(this,"reconnectDelay",1e3);ae(this,"handlers",new Map);ae(this,"isConnecting",!1);ae(this,"userId",null);console.log("WebSocket service initialized but connections disabled in production")}setupAuthListener(){G.auth.onAuthStateChange((a,s)=>{a==="SIGNED_IN"&&(s!=null&&s.user)?(this.userId=s.user.id,this.connect()):a==="SIGNED_OUT"&&(this.userId=null,this.disconnect())})}async connect(){console.log("WebSocket connection skipped - disabled in production")}getWebSocketUrl(){return"https://kvlaydeyqidlfpfutbmp.supabase.co".replace("https://","wss://")+"/realtime/v1/websocket"}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}const a=this.reconnectDelay*Math.pow(2,this.reconnectAttempts);this.reconnectAttempts++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${a}ms`),setTimeout(()=>{this.connect()},a)}disconnect(){this.ws&&(this.ws.close(1e3,"User disconnected"),this.ws=null),this.isConnecting=!1,this.reconnectAttempts=0}send(a){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(a)):console.warn("WebSocket not connected, cannot send message:",a)}handleMessage(a){(this.handlers.get(a.type)||[]).forEach(c=>{try{c(a)}catch(i){console.error("Error in WebSocket message handler:",i)}}),(this.handlers.get("all")||[]).forEach(c=>{try{c(a)}catch(i){console.error("Error in WebSocket all-events handler:",i)}})}subscribe(a,s){return this.handlers.has(a)||this.handlers.set(a,[]),this.handlers.get(a).push(s),()=>{const t=this.handlers.get(a);if(t){const c=t.indexOf(s);c>-1&&t.splice(c,1)}}}sendDocumentProcessingUpdate(a){this.send({type:"document_processing",payload:a,timestamp:new Date().toISOString(),userId:this.userId||void 0,documentId:a.documentId})}sendAIQueryUpdate(a){this.send({type:"ai_query",payload:a,timestamp:new Date().toISOString(),userId:this.userId||void 0})}sendSystemNotification(a){this.send({type:"system_notification",payload:a,timestamp:new Date().toISOString(),userId:this.userId||void 0})}get isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}get connectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"unknown"}}}new Et;class zt{async connect(){}disconnect(){}subscribe(a,s){return()=>{}}sendDocumentProcessingUpdate(a){}sendAIQueryUpdate(a){}sendSystemNotification(a){}get isConnected(){return!1}get connectionState(){return"disabled"}}const ke=new zt;function Ut(){const n=u.useCallback(t=>{},[]),a=u.useCallback(t=>{},[]),s=u.useCallback(t=>{ke.sendSystemNotification({id:`notification_${Date.now()}`,...t})},[]);return{simulateDocumentProcessing:n,simulateAIQuery:a,simulateSystemNotification:s}}const Ft=({onUploadComplete:n,maxFiles:a=5})=>{const[s,t]=u.useState([]),[c,i]=u.useState(!1),[r,g]=u.useState(!1),{profile:o,loading:d}=Ue(),{simulateDocumentProcessing:h}=Ut(),j=u.useCallback(x=>{!o&&!d&&M.warning("Profile not fully loaded. Upload will proceed with default settings."),g(!0),(async()=>{try{if(o){const{usageTrackingService:E}=await Ae(async()=>{const{usageTrackingService:l}=await import("./ai-services-C7wGs9RJ.js").then(f=>f.ak);return{usageTrackingService:l}},__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12])),N=E.checkUsageLimit("document_upload"),C=new Promise((l,f)=>setTimeout(()=>f(new Error("Usage check timeout")),5e3)),$=await Promise.race([N,C]);if(!$.allowed){M.error(`Upload limit reached. You have used ${$.current}/${$.limit} document uploads this month. Please upgrade your plan to continue.`),g(!1);return}$.percentage>=80&&M.warning(`You have used ${$.current}/${$.limit} document uploads this month (${Math.round($.percentage)}%).`)}else M.warning("Profile not loaded. Upload will proceed with default free tier limits.")}catch(E){console.error("Error checking usage limits:",E),M.warning("Unable to verify upload limits. Upload will proceed but may be subject to restrictions.")}g(!1),v(x)})()},[o]),v=u.useCallback(x=>{const b=o!=null&&o.subscription_tier?pe.maxSize[o.subscription_tier]:pe.maxSize.free,N=x.filter(C=>C.size>b?(M.error(`File ${C.name} is too large. Maximum size is ${Math.round(b/1024/1024)}MB`),!1):!0).map(C=>({file:C,id:crypto.randomUUID(),progress:0,status:"pending"}));t(C=>[...C,...N].slice(0,a))},[o,a]),{getRootProps:R,getInputProps:k,isDragActive:D}=ws({onDrop:j,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:a,disabled:c||r||d}),z=x=>{t(b=>b.filter(E=>E.id!==x))},U=(x,b)=>{t(E=>E.map(N=>N.id===x?{...N,documentType:b}:N))},m=async()=>{if(s.length!==0){i(!0);for(const x of s)if(!(x.status!=="pending"||!x.documentType))try{t(N=>N.map(C=>C.id===x.id?{...C,status:"uploading",progress:0,processingMessage:"Uploading file..."}:C));const b=await Q.uploadDocument(x.file,x.documentType),{usageTrackingService:E}=await Ae(async()=>{const{usageTrackingService:N}=await import("./ai-services-C7wGs9RJ.js").then(C=>C.ak);return{usageTrackingService:N}},__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12]));await E.incrementUsage("document_upload",b.id,{filename:x.file.name,file_size:x.file.size,document_type:x.documentType}),t(N=>N.map(C=>C.id===x.id?{...C,status:"processing",progress:20,documentId:b.id,processingMessage:"Starting AI processing..."}:C)),ke.sendDocumentProcessingUpdate({documentId:b.id,status:"processing",progress:20,message:"Starting AI processing..."}),await Tt(x.file,b.id,N=>{t(C=>C.map($=>$.id===x.id?{...$,progress:20+N.progress*.8,processingStage:N.stage,processingMessage:N.message}:$)),ke.sendDocumentProcessingUpdate({documentId:b.id,status:"processing",progress:20+N.progress*.8,message:N.message,stage:N.stage})}),t(N=>N.map(C=>C.id===x.id?{...C,status:"completed",progress:100,processingMessage:"Processing completed!"}:C)),ke.sendDocumentProcessingUpdate({documentId:b.id,status:"completed",progress:100,message:"Document processing completed successfully!"}),M.success(`${x.file.name} uploaded and processed successfully`),n&&n(b.id)}catch(b){console.error("Upload/processing error:",b),t(N=>N.map(C=>C.id===x.id?{...C,status:"error",error:b.message??"Upload or processing failed",processingMessage:"Failed"}:C));const E=s.find(N=>N.id===x.id);E!=null&&E.documentId&&ke.sendDocumentProcessingUpdate({documentId:E.documentId,status:"failed",progress:0,message:"Document processing failed",error:b.message??"Upload or processing failed"}),M.error(`Failed to process ${x.file.name}: ${b.message}`)}i(!1)}},p=s.some(x=>x.status==="pending"&&x.documentType);return e.jsxs(_,{className:"w-full",children:[e.jsxs(I,{children:[e.jsx(O,{children:"Upload Documents"}),e.jsx(Z,{children:"Upload your legal documents for AI-powered analysis and processing"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{...R(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${D?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${c||r||d||!o?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{...k()}),e.jsx(xe,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),d?e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Loading user profile..."}),e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):r?e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Checking upload limits..."}),e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):D?e.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop files here, or click to select files"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((o!=null&&o.subscription_tier?pe.maxSize[o.subscription_tier]:pe.maxSize.free)/1024/1024),"MB"]})]})]}),s.length>0&&e.jsx("div",{className:"space-y-3",children:s.map(x=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:x.file.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(x.file.size/1024)," KB)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[x.status==="completed"&&e.jsx(ne,{className:"h-4 w-4 text-green-500"}),x.status==="error"&&e.jsx(Y,{className:"h-4 w-4 text-red-500"}),x.status==="pending"&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>z(x.id),children:e.jsx(ze,{className:"h-4 w-4"})})]})]}),x.status==="pending"&&e.jsx("div",{className:"mb-2",children:e.jsxs(re,{value:x.documentType||"",onValueChange:b=>U(x.id,b),children:[e.jsx(ce,{className:"w-full",children:e.jsx(ie,{placeholder:"Select document type"})}),e.jsx(le,{children:Object.entries(oe).map(([b,E])=>e.jsx(q,{value:b,children:E},b))})]})}),(x.status==="uploading"||x.status==="processing")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:x.processingMessage||"Processing..."}),e.jsxs("span",{children:[Math.round(x.progress),"%"]})]}),e.jsx(Ee,{value:x.progress,className:"w-full"}),x.processingStage&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[x.processingStage==="ocr"&&e.jsx(ge,{className:"h-3 w-3"}),x.processingStage==="analysis"&&e.jsx(we,{className:"h-3 w-3"}),x.processingStage==="embedding"&&e.jsx(vs,{className:"h-3 w-3"}),e.jsxs("span",{className:"capitalize",children:[x.processingStage," processing"]})]})]}),x.status==="error"&&x.error&&e.jsx(Re,{variant:"destructive",children:e.jsx($e,{children:x.error})})]},x.id))}),s.length>0&&e.jsx(y,{onClick:m,disabled:!p||c,className:"w-full",children:c?"Uploading...":`Upload ${s.filter(x=>x.status==="pending").length} Files`})]})]})},fs=({onUploadComplete:n,maxFiles:a=5})=>{const[s,t]=u.useState([]),[c,i]=u.useState(!1),r=d=>{const j=Array.from(d.target.files||[]).filter(v=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(v.type)?v.size>10485760?(M.error(`${v.name} is too large (max 10MB)`),!1):!0:(M.error(`${v.name} is not a supported file type`),!1));t(v=>[...v,...j].slice(0,a))},g=d=>{t(h=>h.filter((j,v)=>v!==d))},o=async()=>{if(s.length===0){M.error("Please select files to upload");return}i(!0);try{for(const d of s)await new Promise(h=>setTimeout(h,1e3)),console.log("Uploading file:",d.name),n&&n(`mock-id-${Date.now()}`);M.success(`Successfully uploaded ${s.length} file(s)`),t([])}catch(d){console.error("Upload error:",d),M.error("Upload failed. Please try again.")}finally{i(!1)}};return e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Document Upload (Fallback Mode)"]}),e.jsx(Z,{children:"Basic file upload functionality"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx($e,{children:"Advanced upload features are temporarily unavailable. Using basic upload mode."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"file-input",className:"block text-sm font-medium",children:"Select Files"}),e.jsx("input",{id:"file-input",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt",onChange:r,disabled:c,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Supports PDF, DOC, DOCX, TXT files up to 10MB each"})]}),s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Selected Files:"}),s.map((d,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:d.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(d.size/1024)," KB)"]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>g(h),disabled:c,children:"Remove"})]},h))]}),e.jsx(y,{onClick:o,disabled:s.length===0||c,className:"w-full",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Upload ",s.length," File(s)"]})})]})]})},It=()=>e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Document Upload"]}),e.jsx(Z,{children:"Loading upload interface..."})]}),e.jsx(T,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Initializing upload component..."})]})})]}),Ot=({error:n,resetErrorBoundary:a})=>e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex items-center text-red-600",children:[e.jsx(Y,{className:"h-5 w-5 mr-2"}),"Upload Error"]}),e.jsx(Z,{children:"The upload component encountered an error"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs(Re,{variant:"destructive",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx($e,{children:n.message||"An unexpected error occurred while loading the upload component."})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Try Again"})}),e.jsxs("details",{className:"text-xs text-gray-500",children:[e.jsx("summary",{className:"cursor-pointer",children:"Technical Details"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto",children:n.stack})]})]})]}),ys=n=>e.jsx(bs,{FallbackComponent:Ot,onError:(a,s)=>{console.error("DocumentUpload Error:",a,s),typeof window<"u"&&window.gtag&&window.gtag("event","exception",{description:a.message,fatal:!1})},onReset:()=>{console.log("Resetting DocumentUpload component")},children:e.jsx(u.Suspense,{fallback:e.jsx(It,{}),children:e.jsx(Mt,{...n})})}),Mt=n=>{const[a,s]=De.useState(!0),[t,c]=De.useState(!1);return De.useEffect(()=>{c(!1)},[n]),t||!a?e.jsx(fs,{...n}):e.jsx(bs,{FallbackComponent:()=>(c(!0),e.jsx(fs,{...n})),onError:i=>{console.error("Main DocumentUpload failed, switching to fallback:",i),s(!1),c(!0)},children:e.jsx(Ft,{...n})})},Ve=({onDocumentSelect:n,refreshTrigger:a})=>{const[s,t]=u.useState([]),[c,i]=u.useState(!0),[r,g]=u.useState(""),[o,d]=u.useState("all"),[h,j]=u.useState("all");u.useEffect(()=>{v()},[a]);const v=async()=>{try{i(!0);const m=await Q.getDocuments();t(m)}catch(m){console.error("Error loading documents:",m),M.error("Failed to load documents")}finally{i(!1)}},R=async()=>{if(!r.trim()){v();return}try{i(!0);const m=await Q.searchDocuments(r);t(m)}catch(m){console.error("Error searching documents:",m),M.error("Failed to search documents")}finally{i(!1)}},k=async m=>{if(confirm("Are you sure you want to delete this document?"))try{await Q.deleteDocument(m),t(p=>p.filter(x=>x.id!==m)),M.success("Document deleted successfully")}catch(p){console.error("Error deleting document:",p),M.error("Failed to delete document")}},D=m=>{switch(m){case"pending":return e.jsx(ve,{className:"h-4 w-4 text-yellow-500"});case"processing":return e.jsx(je,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return e.jsx(ne,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Y,{className:"h-4 w-4 text-red-500"});default:return e.jsx(L,{className:"h-4 w-4 text-gray-500"})}},z=m=>{switch(m){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},U=s.filter(m=>{const p=o==="all"||m.processing_status===o,x=h==="all"||m.document_type===h;return p&&x});return c&&s.length===0?e.jsx(_,{children:e.jsx(T,{className:"flex items-center justify-center py-8",children:e.jsx(je,{className:"h-8 w-8 animate-spin"})})}):e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsx(O,{children:"Documents"}),e.jsx(Z,{children:"Manage and view your uploaded documents"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(fe,{placeholder:"Search documents...",value:r,onChange:m=>g(m.target.value),onKeyPress:m=>m.key==="Enter"&&R()}),e.jsx(y,{onClick:R,variant:"outline",children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(re,{value:o,onValueChange:d,children:[e.jsx(ce,{className:"w-32",children:e.jsx(ie,{})}),e.jsxs(le,{children:[e.jsx(q,{value:"all",children:"All Status"}),Object.entries(ue).map(([m,p])=>e.jsx(q,{value:m,children:p},m))]})]}),e.jsxs(re,{value:h,onValueChange:j,children:[e.jsx(ce,{className:"w-32",children:e.jsx(ie,{})}),e.jsxs(le,{children:[e.jsx(q,{value:"all",children:"All Types"}),Object.entries(oe).map(([m,p])=>e.jsx(q,{value:m,children:p},m))]})]})]})]}),U.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents found"}),e.jsx("p",{className:"text-gray-500",children:s.length===0?"Upload your first document to get started":"Try adjusting your search or filters"})]}):e.jsx("div",{className:"space-y-3",children:U.map(m=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(L,{className:"h-8 w-8 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:m.filename}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:oe[m.document_type]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(m.file_size/1024)," KB"]}),e.jsx("span",{className:"text-xs text-gray-500",children:Ne(new Date(m.created_at),{addSuffix:!0})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[D(m.processing_status),e.jsx(V,{className:z(m.processing_status),children:ue[m.processing_status]})]}),e.jsxs(Ze,{children:[e.jsx(Ye,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(Bs,{className:"h-4 w-4"})})}),e.jsxs(Xe,{align:"end",children:[e.jsxs(ye,{onClick:()=>n==null?void 0:n(m),children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"View"]}),e.jsxs(ye,{onClick:()=>window.open(m.file_url,"_blank"),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Download"]}),e.jsxs(ye,{onClick:()=>k(m.id),className:"text-red-600",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})},m.id))})]})]})},Rt=({document:n,className:a=""})=>{const[s,t]=u.useState(null),[c,i]=u.useState(""),[r,g]=u.useState(null),[o,d]=u.useState(!1),[h,j]=u.useState(0),[v,R]=u.useState("overview");u.useEffect(()=>{if(n.document_structure&&typeof n.document_structure=="object"){const m=n.document_structure.analysis;m&&t(m)}},[n]);const k=async()=>{if(!n.ocr_text){M.error("No text content available for analysis");return}d(!0),j(0);try{j(20);const m=await ss(n.ocr_text);t(m),j(50);const p=await ot(n.ocr_text,800);i(p),j(80);const x=await dt(n.ocr_text);g(x),j(100),M.success("Document analysis completed successfully")}catch(m){console.error("Analysis error:",m),M.error("Failed to analyze document: "+m.message)}finally{d(!1)}},D=()=>{const m={document:{filename:n.filename,type:n.document_type,uploadDate:n.created_at},analysis:s,summary:c,entities:r,generatedAt:new Date().toISOString()},p=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),x=URL.createObjectURL(p),b=n.createElement("a");b.href=x,b.download=`${n.filename}_analysis.json`,n.body.appendChild(b),b.click(),n.body.removeChild(b),URL.revokeObjectURL(x)},z=m=>m>=.8?"text-green-600":m>=.6?"text-yellow-600":"text-red-600",U=m=>m>=.8?"High":m>=.6?"Medium":"Low";return e.jsxs(_,{className:a,children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(we,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{children:"AI Document Analysis"})]}),e.jsxs(Z,{children:["AI-powered analysis of ",n.filename]})]}),e.jsxs("div",{className:"flex space-x-2",children:[(s||c||r)&&e.jsxs(y,{variant:"outline",size:"sm",onClick:D,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsx(y,{onClick:k,disabled:o||!n.ocr_text,size:"sm",children:o?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),s?"Re-analyze":"Analyze"]})})]})]})}),e.jsxs(T,{className:"space-y-4",children:[!n.ocr_text&&e.jsxs(Re,{children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx($e,{children:"No text content available. Please ensure the document has been processed with OCR."})]}),o&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Analyzing document..."}),e.jsxs("span",{children:[h,"%"]})]}),e.jsx(Ee,{value:h,className:"w-full"})]}),(s||c||r)&&e.jsxs(ts,{value:v,onValueChange:R,children:[e.jsxs(as,{className:"grid w-full grid-cols-4",children:[e.jsx(J,{value:"overview",children:"Overview"}),e.jsx(J,{value:"summary",children:"Summary"}),e.jsx(J,{value:"entities",children:"Entities"}),e.jsx(J,{value:"insights",children:"Insights"})]}),e.jsxs(P,{value:"overview",className:"space-y-4",children:[s&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(O,{className:"text-sm",children:"Document Classification"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{variant:"secondary",children:s.documentType}),e.jsxs("div",{className:`text-sm ${z(s.confidence)}`,children:[U(s.confidence)," confidence"]})]})})]}),e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(O,{className:"text-sm",children:"Key Entities"})}),e.jsx(T,{children:e.jsx("div",{className:"text-sm text-gray-600",children:s.keyEntities.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.keyEntities.slice(0,3).map((m,p)=>e.jsx(V,{variant:"outline",className:"text-xs",children:m},p)),s.keyEntities.length>3&&e.jsxs(V,{variant:"outline",className:"text-xs",children:["+",s.keyEntities.length-3," more"]})]}):"No key entities identified"})})]})]}),s&&e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(O,{className:"text-sm",children:"Executive Summary"})}),e.jsx(T,{children:e.jsx("p",{className:"text-sm text-gray-700",children:s.summary})})]})]}),e.jsx(P,{value:"summary",className:"space-y-4",children:c?e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(O,{className:"text-sm",children:"Document Summary"})}),e.jsx(T,{children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:c})})})]}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(L,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:'No summary available. Click "Analyze" to generate one.'})]})}),e.jsx(P,{value:"entities",className:"space-y-4",children:r?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs(O,{className:"text-sm flex items-center space-x-2",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{children:"People"})]})}),e.jsx(T,{children:r.people.length>0?e.jsx("div",{className:"space-y-1",children:r.people.map((m,p)=>e.jsx(V,{variant:"outline",className:"text-xs",children:m},p))}):e.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs(O,{className:"text-sm flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:"Organizations"})]})}),e.jsx(T,{children:r.organizations.length>0?e.jsx("div",{className:"space-y-1",children:r.organizations.map((m,p)=>e.jsx(V,{variant:"outline",className:"text-xs",children:m},p))}):e.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs(O,{className:"text-sm flex items-center space-x-2",children:[e.jsx(Vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Dates"})]})}),e.jsx(T,{children:r.dates.length>0?e.jsx("div",{className:"space-y-1",children:r.dates.map((m,p)=>e.jsx(V,{variant:"outline",className:"text-xs",children:m},p))}):e.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs(O,{className:"text-sm flex items-center space-x-2",children:[e.jsx(Qs,{className:"h-4 w-4"}),e.jsx("span",{children:"Amounts"})]})}),e.jsx(T,{children:r.amounts.length>0?e.jsx("div",{className:"space-y-1",children:r.amounts.map((m,p)=>e.jsx(V,{variant:"outline",className:"text-xs",children:m},p))}):e.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsxs(O,{className:"text-sm flex items-center space-x-2",children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{children:"Locations"})]})}),e.jsx(T,{children:r.locations.length>0?e.jsx("div",{className:"space-y-1",children:r.locations.map((m,p)=>e.jsx(V,{variant:"outline",className:"text-xs",children:m},p))}):e.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]})]}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(ls,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:'No entities extracted. Click "Analyze" to extract entities.'})]})}),e.jsx(P,{value:"insights",className:"space-y-4",children:s&&e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(O,{className:"text-sm",children:"Legal Implications"})}),e.jsx(T,{children:s.legalImplications.length>0?e.jsx("ul",{className:"space-y-2",children:s.legalImplications.map((m,p)=>e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:m})]},p))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No legal implications identified"})})]}),e.jsxs(_,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(O,{className:"text-sm",children:"Recommended Actions"})}),e.jsx(T,{children:s.recommendedActions.length>0?e.jsx("ul",{className:"space-y-2",children:s.recommendedActions.map((m,p)=>e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-700",children:m})]},p))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No specific actions recommended"})})]})]})})]}),!s&&!c&&!r&&!o&&n.ocr_text&&e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(we,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"mb-4",children:"Ready to analyze this document with AI"}),e.jsxs(y,{onClick:k,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Start Analysis"]})]})]})]})},Qe=[{name:"Yellow",value:"#FFEB3B",bg:"rgba(255, 235, 59, 0.3)"},{name:"Green",value:"#4CAF50",bg:"rgba(76, 175, 80, 0.3)"},{name:"Blue",value:"#2196F3",bg:"rgba(33, 150, 243, 0.3)"},{name:"Red",value:"#F44336",bg:"rgba(244, 67, 54, 0.3)"},{name:"Purple",value:"#9C27B0",bg:"rgba(156, 39, 176, 0.3)"},{name:"Orange",value:"#FF9800",bg:"rgba(255, 152, 0, 0.3)"}],$t=({documentUrl:n,documentId:a,className:s="",onAnnotationChange:t})=>{const[c,i]=u.useState(100),[r,g]=u.useState(0),[o,d]=u.useState(!1),[h,j]=u.useState("select"),[v,R]=u.useState(Qe[0]),[k,D]=u.useState(!0),[z,U]=u.useState(!1),[m,p]=u.useState(null),[x,b]=u.useState(null),[E,N]=u.useState(null),[C,$]=u.useState(""),l=u.useRef(null),f=u.useRef(null),{annotations:A,isLoading:H,createAnnotation:W,updateAnnotation:te,deleteAnnotation:Fe}=yt(a),{user:w}=Ue();u.useEffect(()=>{t==null||t(A)},[A,t]);const F=()=>{i(S=>Math.min(S+25,300))},de=()=>{i(S=>Math.max(S-25,25))},B=()=>{g(S=>(S+90)%360)},ee=()=>{d(S=>!S)},zs=u.useCallback(S=>{var he;if(h==="select")return;const K=(he=l.current)==null?void 0:he.getBoundingClientRect();if(!K)return;const X=S.clientX-K.left,me=S.clientY-K.top;h==="highlight"?(U(!0),p({x:X,y:me}),b({x:X,y:me,width:0,height:0})):(h==="note"||h==="sticky")&&Is(X,me)},[h]),Us=u.useCallback(S=>{var he;if(!z||!m||h!=="highlight")return;const K=(he=l.current)==null?void 0:he.getBoundingClientRect();if(!K)return;const X=S.clientX-K.left,me=S.clientY-K.top;b({x:Math.min(m.x,X),y:Math.min(m.y,me),width:Math.abs(X-m.x),height:Math.abs(me-m.y)})},[z,m,h]),Fs=u.useCallback(()=>{z&&x&&h==="highlight"&&x.width>10&&x.height>10&&Os(x),U(!1),p(null),b(null)},[z,x,h]),Is=async(S,K)=>{if(!w){M.error("Please log in to create annotations");return}const X=await W({type:h,page_number:1,position:{x:S,y:K},content:"",color:v.value});X&&(N(X.id),$(""))},Os=async S=>{if(!w){M.error("Please log in to create highlights");return}await W({type:"highlight",page_number:1,position:S,content:"Highlighted text",color:v.value})},Ms=async(S,K)=>{await te(S,{content:K})&&(N(null),$(""))},Rs=async S=>{await Fe(S)},$s=o?"fixed inset-0 z-50 bg-white":s;return e.jsxs(_,{className:$s,children:[e.jsx("div",{className:"border-b p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1 border rounded-md",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:de,children:e.jsx(Hs,{className:"h-4 w-4"})}),e.jsxs("span",{className:"px-2 text-sm font-medium",children:[c,"%"]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:F,children:e.jsx(Ks,{className:"h-4 w-4"})})]}),e.jsx(Ie,{orientation:"vertical",className:"h-6"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(y,{variant:h==="select"?"default":"ghost",size:"sm",onClick:()=>j("select"),children:"Select"}),e.jsx(y,{variant:h==="highlight"?"default":"ghost",size:"sm",onClick:()=>j("highlight"),children:e.jsx(Gs,{className:"h-4 w-4"})}),e.jsx(y,{variant:h==="note"?"default":"ghost",size:"sm",onClick:()=>j("note"),children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(y,{variant:h==="sticky"?"default":"ghost",size:"sm",onClick:()=>j("sticky"),children:e.jsx(ds,{className:"h-4 w-4"})})]}),e.jsx(Ie,{orientation:"vertical",className:"h-6"}),e.jsxs(xs,{children:[e.jsx(us,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",children:[e.jsx(Zs,{className:"h-4 w-4 mr-2"}),e.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:v.value}})]})}),e.jsx(hs,{className:"w-48",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Qe.map(S=>e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",style:{backgroundColor:S.value},onClick:()=>R(S)},S.value))})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>D(!k),children:k?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(Ys,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:B,children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:ee,children:o?e.jsx(Js,{className:"h-4 w-4"}):e.jsx(Ss,{className:"h-4 w-4"})}),e.jsx(mt,{documentId:a,showUserPresence:!0,className:"ml-auto"})]})]})}),e.jsx(T,{className:"p-0 relative",children:e.jsx("div",{ref:l,className:"relative overflow-auto",style:{height:o?"calc(100vh - 120px)":"600px"},onMouseDown:zs,onMouseMove:Us,onMouseUp:Fs,children:e.jsxs("div",{className:"relative",style:{transform:`scale(${c/100}) rotate(${r}deg)`,transformOrigin:"top left",cursor:h==="select"?"default":"crosshair"},children:[e.jsx("iframe",{ref:f,src:`${n}#toolbar=0&navpanes=0&scrollbar=0`,className:"w-full h-[800px] border-0",title:"PDF Document"}),k&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[A.map(S=>{var K,X,me,he,ns,rs,cs,is;return e.jsx("div",{className:"absolute pointer-events-auto",style:{left:S.position.x,top:S.position.y,width:S.position.width,height:S.position.height,backgroundColor:S.type==="highlight"?(K=Qe.find(Le=>Le.value===S.color))==null?void 0:K.bg:"transparent"},children:S.type!=="highlight"&&e.jsxs(xs,{children:[e.jsx(us,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-full",style:{backgroundColor:S.color},children:S.type==="note"?e.jsx(os,{className:"h-3 w-3"}):e.jsx(ds,{className:"h-3 w-3"})})}),e.jsx(hs,{className:"w-80",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(xt,{className:"h-6 w-6",children:[e.jsx(ut,{src:(X=S.user)==null?void 0:X.avatar_url}),e.jsxs(ht,{className:"text-xs",children:[(he=(me=S.user)==null?void 0:me.first_name)==null?void 0:he[0],(rs=(ns=S.user)==null?void 0:ns.last_name)==null?void 0:rs[0]]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm font-medium",children:[(cs=S.user)==null?void 0:cs.first_name," ",(is=S.user)==null?void 0:is.last_name]}),e.jsx("span",{className:"text-xs text-gray-500",children:Ne(new Date(S.created_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(V,{variant:"outline",className:"text-xs",children:S.type}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>Rs(S.id),children:e.jsx(_e,{className:"h-4 w-4"})})]})]}),E===S.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(_s,{value:C,onChange:Le=>$(Le.target.value),placeholder:"Enter annotation content...",className:"min-h-[80px]"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{size:"sm",onClick:()=>Ms(S.id,C),children:[e.jsx(Ps,{className:"h-4 w-4 mr-1"}),"Save"]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>N(null),children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:S.content||"No content"}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>{N(S.id),$(S.content)},children:"Edit"})]})]})})]})},S.id)}),x&&z&&e.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-200 bg-opacity-30 pointer-events-none",style:{left:x.x,top:x.y,width:x.width,height:x.height}})]})]})})})]})},qt=({documentId:n,onClose:a,className:s=""})=>{const[t,c]=u.useState(null),[i,r]=u.useState(!0),[g,o]=u.useState(null),[d,h]=u.useState(!1),[j,v]=u.useState("viewer");u.useEffect(()=>{R()},[n]);const R=async()=>{try{r(!0),o(null);const N=await Q.getDocument(n);c(N)}catch(N){console.error("Error loading document:",N),o(N.message||"Failed to load document"),M.error("Failed to load document")}finally{r(!1)}},k=()=>{t&&window.open(t.file_url,"_blank")},D=async()=>{if(t)try{await navigator.share({title:t.filename,url:t.file_url})}catch{await navigator.clipboard.writeText(t.file_url),M.success("Document URL copied to clipboard")}},z=()=>{setZoom(N=>Math.min(N+25,200))},U=()=>{setZoom(N=>Math.max(N-25,50))},m=()=>{setRotation(N=>(N+90)%360)},p=()=>{h(!d)},x=N=>{switch(N){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},b=N=>{switch(N){case"processing":return e.jsx(je,{className:"h-4 w-4 animate-spin"});case"failed":return e.jsx(Y,{className:"h-4 w-4"});default:return e.jsx(L,{className:"h-4 w-4"})}};if(i)return e.jsx(_,{className:s,children:e.jsx(T,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(je,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading document..."})]})})});if(g||!t)return e.jsx(_,{className:s,children:e.jsx(T,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(Y,{className:"h-8 w-8 text-red-500"}),e.jsx("p",{className:"text-sm text-red-600",children:g||"Document not found"}),e.jsx(y,{onClick:R,variant:"outline",size:"sm",children:"Try Again"})]})})});const E=d?"fixed inset-0 z-50 bg-white":`${s}`;return e.jsxs(_,{className:E,children:[e.jsx(I,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(O,{className:"text-lg font-semibold truncate",children:t.filename}),e.jsxs(Z,{className:"flex items-center space-x-4 mt-1",children:[e.jsx("span",{children:oe[t.document_type]}),e.jsxs("span",{children:[Math.round(t.file_size/1024)," KB"]}),e.jsx("span",{children:Ne(new Date(t.created_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[b(t.processing_status),e.jsx(V,{className:x(t.processing_status),children:ue[t.processing_status]})]}),a&&e.jsx(y,{onClick:a,variant:"ghost",size:"sm",children:e.jsx(ze,{className:"h-4 w-4"})})]})]})}),e.jsx(Ie,{}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{onClick:U,variant:"outline",size:"sm",children:e.jsx(ZoomOut,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm font-medium min-w-[60px] text-center",children:[zoom,"%"]}),e.jsx(y,{onClick:z,variant:"outline",size:"sm",children:e.jsx(ZoomIn,{className:"h-4 w-4"})}),e.jsx(y,{onClick:m,variant:"outline",size:"sm",children:e.jsx(RotateCw,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(y,{onClick:k,variant:"outline",size:"sm",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsxs(y,{onClick:D,variant:"outline",size:"sm",children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),"Share"]}),e.jsx(y,{onClick:p,variant:"outline",size:"sm",children:e.jsx(Ss,{className:"h-4 w-4"})})]})]}),e.jsx(T,{className:"p-0 flex-1",children:e.jsxs(ts,{value:j,onValueChange:v,children:[e.jsx("div",{className:"border-b px-4",children:e.jsxs(as,{className:"grid w-full grid-cols-3",children:[e.jsxs(J,{value:"viewer",className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Document"})]}),e.jsxs(J,{value:"text",className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:"Text"})]}),e.jsxs(J,{value:"analysis",className:"flex items-center space-x-2",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"AI Analysis"})]})]})}),e.jsx(P,{value:"viewer",className:"mt-0",children:e.jsx("div",{className:"p-4",children:t.file_url.toLowerCase().endsWith(".pdf")?e.jsx($t,{documentUrl:t.file_url,documentId:t.id,className:"w-full",onAnnotationChange:N=>{console.log("Annotations updated:",N)}}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Preview not available"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"This file type cannot be previewed in the browser."}),e.jsxs(y,{onClick:k,children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Download to view"]})]})})}),e.jsx(P,{value:"text",className:"mt-0",children:e.jsx(ps,{className:d?"h-[calc(100vh-250px)]":"h-[550px]",children:e.jsx("div",{className:"p-4",children:t.ocr_text?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Extracted Text"}),t.ocr_quality_score&&e.jsxs(V,{variant:"outline",children:["Quality: ",Math.round(t.ocr_quality_score*100),"%"]})]}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:t.ocr_text})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No text extracted"}),e.jsx("p",{className:"text-gray-500",children:"Text extraction may still be in progress or the document may not contain readable text."})]})})})}),e.jsx(P,{value:"analysis",className:"mt-0",children:e.jsx(ps,{className:d?"h-[calc(100vh-250px)]":"h-[550px]",children:e.jsx("div",{className:"p-4",children:e.jsx(Rt,{document:t})})})})]})})]})},Lt=Nt({query:Se().optional(),searchType:wt(["combined","semantic","text"]).default("combined"),documentType:Se().optional(),status:Se().optional(),dateFrom:Se().optional(),dateTo:Se().optional(),minSize:js().optional(),maxSize:js().optional(),hasOcr:vt().optional()}),Bt=({onResults:n,onLoading:a,className:s=""})=>{const[t,c]=u.useState(!1),[i,r]=u.useState(!1),[g,o]=u.useState([]),[d,h]=u.useState([]),{user:j}=Ue(),{register:v,handleSubmit:R,watch:k,setValue:D,reset:z,formState:{errors:U}}=st({resolver:bt(Lt),defaultValues:{hasOcr:!1}}),m=k("query"),p=u.useCallback(ft.debounce(async l=>{var f;if(!((f=l.query)!=null&&f.trim())&&!x(l)){try{r(!0),a==null||a(!0);const A=await Q.getDocuments();n(A)}catch(A){console.error("Error loading documents:",A),M.error("Failed to load documents")}finally{r(!1),a==null||a(!1)}return}await b(l)},500),[n,a]);u.useEffect(()=>{const l=k(f=>{p(f)});return()=>l.unsubscribe()},[k,p]);const x=l=>!!(l.documentType||l.status||l.dateFrom||l.dateTo||l.minSize||l.maxSize||l.hasOcr),b=async l=>{var f;if(!j){M.error("Please log in to search documents");return}try{r(!0),a==null||a(!0);let A=[];if((f=l.query)!=null&&f.trim()){const H=[l.query,...d.filter(te=>te!==l.query)].slice(0,5);switch(h(H),localStorage.setItem("documentSearchHistory",JSON.stringify(H)),l.searchType||"combined"){case"semantic":A=(await Dt({query:l.query,userId:j.id,maxResults:20})).map(w=>w.document).filter(Boolean);break;case"text":A=await kt({query:l.query,userId:j.id,documentType:l.documentType,dateRange:l.dateFrom&&l.dateTo?{start:new Date(l.dateFrom),end:new Date(l.dateTo)}:void 0});break;case"combined":default:A=(await St(l.query,j.id,{documentType:l.documentType,dateRange:l.dateFrom&&l.dateTo?{start:new Date(l.dateFrom),end:new Date(l.dateTo)}:void 0,maxResults:20})).textResults;break}}else A=await Q.getDocuments();A=E(A,l),n(A),N(l)}catch(A){console.error("Search error:",A),M.error("Search failed. Please try again.")}finally{r(!1),a==null||a(!1)}},E=(l,f)=>l.filter(A=>{if(f.documentType&&A.document_type!==f.documentType||f.status&&A.processing_status!==f.status)return!1;if(f.dateFrom){const W=new Date(A.created_at),te=new Date(f.dateFrom);if(W<te)return!1}if(f.dateTo){const W=new Date(A.created_at),te=new Date(f.dateTo);if(te.setHours(23,59,59,999),W>te)return!1}const H=A.file_size/1024;return!(f.minSize&&H<f.minSize||f.maxSize&&H>f.maxSize||f.hasOcr&&!A.ocr_text)}),N=l=>{const f=[];l.documentType&&f.push(`Type: ${oe[l.documentType]}`),l.status&&f.push(`Status: ${ue[l.status]}`),l.dateFrom&&f.push(`From: ${new Date(l.dateFrom).toLocaleDateString()}`),l.dateTo&&f.push(`To: ${new Date(l.dateTo).toLocaleDateString()}`),l.minSize&&f.push(`Min: ${l.minSize}KB`),l.maxSize&&f.push(`Max: ${l.maxSize}KB`),l.hasOcr&&f.push("Has OCR text"),o(f)},C=()=>{z(),o([]),c(!1)},$=l=>{C()};return u.useEffect(()=>{const l=localStorage.getItem("documentSearchHistory");if(l)try{h(JSON.parse(l))}catch(f){console.error("Error loading search history:",f)}},[]),e.jsxs(_,{className:s,children:[e.jsx(I,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-lg",children:"Search Documents"}),e.jsx(Z,{children:"Find documents by name, content, or metadata"})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>c(!t),children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Filters"]})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(fe,{...v("query"),placeholder:"Search by filename or content...",className:"pl-10 pr-10"}),i&&e.jsx(je,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"text-xs text-gray-500",children:"Search type:"}),e.jsxs(re,{onValueChange:l=>D("searchType",l),children:[e.jsx(ce,{className:"w-32 h-8",children:e.jsx(ie,{placeholder:"Combined"})}),e.jsxs(le,{children:[e.jsx(q,{value:"combined",children:"Combined"}),e.jsx(q,{value:"semantic",children:"AI Semantic"}),e.jsx(q,{value:"text",children:"Text Only"})]})]})]})]}),d.length>0&&!m&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Recent:"}),d.map((l,f)=>e.jsx(y,{variant:"outline",size:"sm",className:"h-6 text-xs",onClick:()=>D("query",l),children:l},f))]}),g.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Active filters:"}),g.map((l,f)=>e.jsxs(V,{variant:"secondary",className:"text-xs",children:[l,e.jsx(y,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1",onClick:()=>$(),children:e.jsx(ze,{className:"h-3 w-3"})})]},f)),e.jsx(y,{variant:"ghost",size:"sm",className:"text-xs",onClick:C,children:"Clear all"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"documentType",children:"Document Type"}),e.jsxs(re,{onValueChange:l=>D("documentType",l),children:[e.jsx(ce,{children:e.jsx(ie,{placeholder:"Any type"})}),e.jsxs(le,{children:[e.jsx(q,{value:"",children:"Any type"}),Object.entries(oe).map(([l,f])=>e.jsx(q,{value:l,children:f},l))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"status",children:"Processing Status"}),e.jsxs(re,{onValueChange:l=>D("status",l),children:[e.jsx(ce,{children:e.jsx(ie,{placeholder:"Any status"})}),e.jsxs(le,{children:[e.jsx(q,{value:"",children:"Any status"}),Object.entries(ue).map(([l,f])=>e.jsx(q,{value:l,children:f},l))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"dateFrom",children:"Date From"}),e.jsx(fe,{...v("dateFrom"),type:"date",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{htmlFor:"dateTo",children:"Date To"}),e.jsx(fe,{...v("dateTo"),type:"date",className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{children:"File Size (KB)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(fe,{...v("minSize",{valueAsNumber:!0}),type:"number",placeholder:"Min",className:"w-full"}),e.jsx(fe,{...v("maxSize",{valueAsNumber:!0}),type:"number",placeholder:"Max",className:"w-full"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{children:"Content Options"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Oe,{...v("hasOcr"),onCheckedChange:l=>D("hasOcr",!!l)}),e.jsx(se,{className:"text-sm",children:"Has extracted text"})]})]})]})]})]})]})},We=({onDocumentSelect:n,refreshTrigger:a,className:s=""})=>{const[t,c]=u.useState([]),[i,r]=u.useState({total:0,pending:0,processing:0,completed:0,failed:0}),[g,o]=u.useState(!0),[d,h]=u.useState(!0);u.useEffect(()=>{j()},[a]),u.useEffect(()=>{let p;return d&&(p=setInterval(()=>{(i.processing>0||i.pending>0)&&j()},3e4)),()=>{p&&clearInterval(p)}},[d,i.processing,i.pending]);const j=async()=>{try{o(!0),console.log("DocumentStatusTracker: Starting to load documents...");const{data:{user:p},error:x}=await G.auth.getUser();if(x)throw console.error("DocumentStatusTracker: Auth error:",x),new Error("Authentication failed");if(!p)throw console.error("DocumentStatusTracker: No authenticated user"),new Error("User not authenticated");console.log("DocumentStatusTracker: User authenticated:",p.email);const b=await Q.getDocuments();console.log("DocumentStatusTracker: Loaded documents:",b.length);const E=b.sort((N,C)=>new Date(C.created_at).getTime()-new Date(N.created_at).getTime());c(E),v(E)}catch(p){console.error("DocumentStatusTracker: Error loading documents:",p),M.error(`Failed to load document status: ${p.message}`)}finally{o(!1)}},v=p=>{const x=p.reduce((b,E)=>{switch(b.total++,E.processing_status){case"pending":b.pending++;break;case"processing":b.processing++;break;case"completed":b.completed++;break;case"failed":b.failed++;break}return b},{total:0,pending:0,processing:0,completed:0,failed:0});r(x)},R=p=>{switch(p){case"pending":return e.jsx(ve,{className:"h-4 w-4 text-yellow-500"});case"processing":return e.jsx(je,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return e.jsx(ne,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Y,{className:"h-4 w-4 text-red-500"});default:return e.jsx(L,{className:"h-4 w-4 text-gray-500"})}},k=p=>{switch(p){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},D=()=>i.total===0?0:Math.round(i.completed/i.total*100),z=()=>t.filter(p=>p.processing_status==="pending"||p.processing_status==="processing").slice(0,5),U=()=>t.filter(p=>p.processing_status==="completed").slice(0,3),m=()=>t.filter(p=>p.processing_status==="failed");return g&&t.length===0?e.jsx(_,{className:s,children:e.jsx(T,{className:"flex items-center justify-center py-8",children:e.jsx(je,{className:"h-8 w-8 animate-spin"})})}):e.jsxs(_,{className:s,children:[e.jsx(I,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-lg",children:"Processing Status"}),e.jsx(Z,{children:"Real-time document processing status and progress"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>h(!d),className:d?"bg-green-50":"",children:[e.jsx(Te,{className:`h-4 w-4 mr-2 ${d?"animate-spin":""}`}),"Auto-refresh"]}),e.jsx(y,{onClick:j,variant:"outline",size:"sm",children:e.jsx(Te,{className:"h-4 w-4"})})]})]})}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Overall Progress"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.completed," of ",i.total," completed"]})]}),e.jsx(Ee,{value:D(),className:"w-full"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:i.pending}),e.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.processing}),e.jsx("div",{className:"text-xs text-gray-500",children:"Processing"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.completed}),e.jsx("div",{className:"text-xs text-gray-500",children:"Completed"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:i.failed}),e.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]})]})]}),z().length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Currently Processing"]}),e.jsx("div",{className:"space-y-2",children:z().map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[R(p.processing_status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:p.filename}),e.jsx("p",{className:"text-xs text-gray-500",children:Ne(new Date(p.created_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:k(p.processing_status),children:ue[p.processing_status]}),n&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>n(p),children:e.jsx(ge,{className:"h-4 w-4"})})]})]},p.id))})]}),U().length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-2 text-green-500"}),"Recently Completed"]}),e.jsx("div",{className:"space-y-2",children:U().map(p=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-green-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(ne,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:p.filename}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Completed ",Ne(new Date(p.updated_at),{addSuffix:!0})]})]})]}),n&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>n(p),children:e.jsx(ge,{className:"h-4 w-4"})})]},p.id))})]}),m().length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center text-red-600",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Failed Processing (",m().length,")"]}),e.jsx("div",{className:"space-y-2",children:m().slice(0,3).map(p=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-red-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(Y,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:p.filename}),e.jsx("p",{className:"text-xs text-red-600",children:"Processing failed"})]})]}),n&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>n(p),children:e.jsx(ge,{className:"h-4 w-4"})})]},p.id))})]}),i.total===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents yet"}),e.jsx("p",{className:"text-gray-500",children:"Upload your first document to start tracking processing status"})]})]})]})};class Vt{constructor(){ae(this,"retryAttempts",3);ae(this,"retryDelay",1e3)}async processDocument(a,s,t={},c){const i=Date.now();try{c==null||c({stage:"initializing",progress:0,message:"Initializing document processing..."}),await this.checkUsageLimits(),await this.updateDocumentStatus(s,"processing");let r,g,o=[];t.skipOCR||(r=await this.performOCR(a,c)),!t.skipAnalysis&&r&&(g=await this.performAnalysis(r.text,s,t.customAnalysisPrompt,c)),!t.skipEmbedding&&r&&(o=await this.generateEmbeddings(r.text,s,t.chunkSize,c)),c==null||c({stage:"finalizing",progress:95,message:"Finalizing document processing..."});const d=await this.finalizeProcessing(s,r,g,o),h=Date.now()-i;return c==null||c({stage:"completed",progress:100,message:"Document processing completed successfully!",details:{processingTime:h,ocrQuality:(r==null?void 0:r.qualityScore)||0,textLength:(r==null?void 0:r.text.length)||0,embeddingChunks:o.length}}),{document:d,ocrResult:r,analysis:g,embeddingIds:o,processingTime:h,qualityMetrics:{ocrQuality:(r==null?void 0:r.qualityScore)||0,textLength:(r==null?void 0:r.text.length)||0,embeddingChunks:o.length}}}catch(r){const g=Date.now()-i;throw await this.updateDocumentStatus(s,"failed"),c==null||c({stage:"error",progress:0,message:"Document processing failed",error:r instanceof Error?r.message:"Unknown error",details:{processingTime:g}}),r}}async checkUsageLimits(){const a=await Je.checkUsageLimit("ai_query");if(!a.allowed)throw new Error(`AI processing limit exceeded. You have used ${a.current}/${a.limit} AI queries this month. Please upgrade your plan to continue.`)}async performOCR(a,s){return s==null||s({stage:"ocr",progress:10,message:"Extracting text from document..."}),await this.withRetry(async()=>{const t=await Ts(a,r=>{s==null||s({stage:"ocr",progress:10+r.progress*.3,message:r.message||"Extracting text..."})}),c=As(t),i=Es(t.text);return{...t,text:i,qualityScore:c.qualityScore}},"OCR processing")}async performAnalysis(a,s,t,c){return c==null||c({stage:"analysis",progress:40,message:"Analyzing document content with AI..."}),await this.withRetry(async()=>{const i=await ss(a);return await Je.incrementUsage("ai_query",s,{operation:"document_analysis",text_length:a.length,custom_prompt:!!t}),i},"AI analysis")}async generateEmbeddings(a,s,t=1e3,c){return c==null||c({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),await this.withRetry(async()=>{const i=this.splitTextIntoChunks(a,t),r=[];for(let g=0;g<i.length;g++){const o=i[g],d=await Cs(o),{data:h,error:j}=await G.from("document_embeddings").insert({document_id:s,chunk_text:o,chunk_index:g,embedding:d,metadata:{chunk_size:o.length,total_chunks:i.length}}).select("id").single();if(j)throw j;r.push(h.id);const v=70+(g+1)/i.length*20;c==null||c({stage:"embedding",progress:v,message:`Generated embedding ${g+1}/${i.length}...`})}return r},"Embedding generation")}async finalizeProcessing(a,s,t,c){const{data:i,error:r}=await G.from("uploaded_documents").update({processing_status:"completed",ocr_text:s==null?void 0:s.text,ocr_quality_score:s==null?void 0:s.qualityScore,document_structure:{analysis:t,ocrQuality:s==null?void 0:s.qualityScore,embeddingCount:(c==null?void 0:c.length)||0,processedAt:new Date().toISOString()},updated_at:new Date().toISOString()}).eq("id",a).select().single();if(r)throw r;return i}async updateDocumentStatus(a,s){const{error:t}=await G.from("uploaded_documents").update({processing_status:s,updated_at:new Date().toISOString()}).eq("id",a);if(t)throw t}async withRetry(a,s){let t;for(let c=1;c<=this.retryAttempts;c++)try{return await a()}catch(i){if(t=i instanceof Error?i:new Error("Unknown error"),c===this.retryAttempts)throw new Error(`${s} failed after ${this.retryAttempts} attempts: ${t.message}`);await new Promise(r=>setTimeout(r,this.retryDelay*c))}throw t}splitTextIntoChunks(a,s=1e3){const t=[],c=a.split(/[.!?]+/).filter(r=>r.trim().length>0);let i="";for(const r of c){const g=r.trim();i.length+g.length+1<=s?i+=(i?". ":"")+g:(i&&t.push(i+"."),i=g)}return i&&t.push(i+"."),t}}const Qt=new Vt;function Wt(){const[n,a]=u.useState({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null}),s=Pe(),{toast:t}=qe(),c=u.useCallback(async(r,g,o={})=>{try{a({isUploading:!0,isProcessing:!1,progress:0,status:null,error:null});const d=await Q.uploadDocument(r,g);a(j=>({...j,isUploading:!1,isProcessing:!0,progress:10}));const h=await Qt.processDocument(r,d.id,o,j=>{a(v=>({...v,progress:j.progress,status:j,error:j.error||null}))});return a(j=>({...j,isProcessing:!1,progress:100,error:null})),s.invalidateQueries({queryKey:["documents"]}),s.invalidateQueries({queryKey:["document",d.id]}),t({title:"Document Processed",description:`${r.name} has been successfully uploaded and processed.`}),h}catch(d){const h=d instanceof Error?d.message:"Upload failed";throw a(j=>({...j,isUploading:!1,isProcessing:!1,error:h})),t({title:"Upload Failed",description:h,variant:"destructive"}),d}},[s,t]),i=u.useCallback(()=>{a({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null})},[]);return{uploadAndProcessDocument:c,uploadState:n,resetUploadState:i,isActive:n.isUploading||n.isProcessing}}function Ht(){return Me({queryKey:["documents"],queryFn:()=>Q.getDocuments(),staleTime:5*60*1e3})}function Kt(){const[n,a]=u.useState(""),s=Me({queryKey:["documents","search",n],queryFn:async()=>{if(!n||n.length<3)return[];try{return await Q.searchDocuments(n)}catch(t){return console.error("Search error:",t),[]}},enabled:n.length>2,staleTime:2*60*1e3});return{searchQuery:n,setSearchQuery:a,searchResults:s.data||[],isSearching:s.isLoading,searchError:s.error}}function Gt(){const n=Pe(),{toast:a}=qe();return es({mutationFn:s=>Q.deleteDocument(s),onSuccess:(s,t)=>{n.removeQueries({queryKey:["document",t]}),n.invalidateQueries({queryKey:["documents"]}),a({title:"Document Deleted",description:"The document has been successfully deleted."})},onError:s=>{a({title:"Deletion Failed",description:s instanceof Error?s.message:"Failed to delete document",variant:"destructive"})}})}function Zt(){const{toast:n}=qe();return es({mutationFn:({documentId:a,trackUsage:s=!0})=>Q.downloadDocument(a,s),onSuccess:a=>{const s=URL.createObjectURL(a.data),t=document.createElement("a");t.href=s,t.download=a.filename,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s),n({title:"Download Started",description:`Downloading ${a.filename}...`})},onError:a=>{n({title:"Download Failed",description:a instanceof Error?a.message:"Failed to download document",variant:"destructive"})}})}function Yt(){const n=Pe(),{toast:a}=qe(),s=es({mutationFn:async t=>{const c=await Promise.allSettled(t.map(g=>Q.deleteDocument(g))),i=c.filter(g=>g.status==="rejected").length;return{succeeded:c.filter(g=>g.status==="fulfilled").length,failed:i,total:t.length}},onSuccess:t=>{n.invalidateQueries({queryKey:["documents"]}),t.failed>0?a({title:"Bulk Delete Completed",description:`${t.succeeded} documents deleted, ${t.failed} failed.`,variant:"destructive"}):a({title:"Bulk Delete Completed",description:`Successfully deleted ${t.succeeded} documents.`})},onError:t=>{a({title:"Bulk Delete Failed",description:t instanceof Error?t.message:"Failed to delete documents",variant:"destructive"})}});return{bulkDelete:s,isBulkDeleting:s.isPending}}function Xt(){return Me({queryKey:["documents","stats"],queryFn:async()=>{try{const n=await Q.getDocuments(),a=await Q.getDocumentUsage();return{total:n.length,byStatus:n.reduce((t,c)=>(t[c.processing_status]=(t[c.processing_status]||0)+1,t),{}),byType:n.reduce((t,c)=>(t[c.document_type]=(t[c.document_type]||0)+1,t),{}),totalSize:n.reduce((t,c)=>t+c.file_size,0),usage:a}}catch(n){return console.error("Error fetching document stats:",n),{total:0,byStatus:{},byType:{},totalSize:0,usage:null}}},staleTime:10*60*1e3})}function He(n){return Me({queryKey:["usage-limit",n],queryFn:()=>Je.checkUsageLimit(n),staleTime:1*60*1e3,refetchOnWindowFocus:!1})}function Jt(){const{data:n}=He("ai_query"),{data:a}=He("document_upload"),{data:s}=He("custom_document");return{canUseAI:(n==null?void 0:n.allowed)??!1,canUploadDocuments:(a==null?void 0:a.allowed)??!1,canDownloadCustomDocuments:(s==null?void 0:s.allowed)??!1,aiUsage:n,documentUsage:a,customDocUsage:s,getUsagePercentage:t=>!t||t.limit===-1?0:t.limit>0?t.current/t.limit*100:0,isNearLimit:(t,c=80)=>!t||t.limit===-1?!1:(t.limit>0?t.current/t.limit*100:0)>=c}}const Pt=({onUploadComplete:n,maxFiles:a=5,allowedTypes:s=["pdf","doc","docx","txt"]})=>{const{profile:t}=Ue(),{uploadAndProcessDocument:c,uploadState:i,resetUploadState:r,isActive:g}=Wt(),{canUploadDocuments:o,canUseAI:d,documentUsage:h}=Jt(),[j,v]=u.useState([]),[R,k]=u.useState(!1),[D,z]=u.useState({skipOCR:!1,skipAnalysis:!1,skipEmbedding:!1,chunkSize:1e3,retryAttempts:3}),U=u.useCallback(async l=>{if(!o){toast.warning("Upload not available. Please check your subscription or try again later.");return}const f=t!=null&&t.subscription_tier?pe.maxSize[t.subscription_tier]:pe.maxSize.free,H=l.filter(W=>!(W.size>f)).map(W=>({file:W,id:crypto.randomUUID(),documentType:"other",options:{...D}}));v(W=>[...W,...H].slice(0,a))},[t,a,o,D]),{getRootProps:m,getInputProps:p,isDragActive:x}=ws({onDrop:U,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:a,disabled:g||!o}),b=l=>{v(f=>f.filter(A=>A.id!==l))},E=(l,f)=>{v(A=>A.map(H=>H.id===l?{...H,documentType:f}:H))},N=async()=>{for(const l of j)try{const f=await c(l.file,l.documentType,l.options);n&&n(f.document.id)}catch(f){console.error("Upload failed:",f)}v([]),r()},C=l=>{switch(l){case"ocr":return e.jsx(ge,{className:"h-4 w-4"});case"analysis":return e.jsx(we,{className:"h-4 w-4"});case"embedding":return e.jsx(vs,{className:"h-4 w-4"});case"completed":return e.jsx(ne,{className:"h-4 w-4"});case"error":return e.jsx(Y,{className:"h-4 w-4"});default:return e.jsx(ve,{className:"h-4 w-4"})}},$=l=>{switch(l){case"completed":return"text-green-600";case"error":return"text-red-600";case"analysis":return"text-blue-600";case"embedding":return"text-purple-600";default:return"text-gray-600"}};return e.jsxs(_,{className:"w-full",children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Enhanced Document Upload"}),e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>k(!R),children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Advanced"]})]}),e.jsx(Z,{children:"Upload and process your legal documents with AI-powered analysis"}),h&&e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["Usage: ",h.current,"/",h.limit===-1?"∞":h.limit," uploads"]}),h.limit>0&&e.jsx(Ee,{value:h.percentage,className:"w-24 h-2"})]})]}),e.jsxs(T,{className:"space-y-6",children:[R&&e.jsxs(_,{children:[e.jsx(I,{children:e.jsx(O,{className:"text-lg",children:"Processing Options"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{id:"skip-ocr",checked:!D.skipOCR,onCheckedChange:l=>z(f=>({...f,skipOCR:!l}))}),e.jsx(se,{htmlFor:"skip-ocr",children:"Text Extraction"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{id:"skip-analysis",checked:!D.skipAnalysis,onCheckedChange:l=>z(f=>({...f,skipAnalysis:!l})),disabled:!d}),e.jsx(se,{htmlFor:"skip-analysis",children:"AI Analysis"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{id:"skip-embedding",checked:!D.skipEmbedding,onCheckedChange:l=>z(f=>({...f,skipEmbedding:!l})),disabled:!d}),e.jsx(se,{htmlFor:"skip-embedding",children:"Search Indexing"})]})]}),D.customAnalysisPrompt!==void 0&&e.jsxs("div",{children:[e.jsx(se,{htmlFor:"custom-prompt",children:"Custom Analysis Prompt"}),e.jsx(_s,{id:"custom-prompt",placeholder:"Enter custom instructions for AI analysis...",value:D.customAnalysisPrompt||"",onChange:l=>z(f=>({...f,customAnalysisPrompt:l.target.value}))})]})]})]}),e.jsxs("div",{...m(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${x?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${g||!o?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{...p()}),e.jsx(xe,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),x?e.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-2",children:o?"Drag & drop files here, or click to select":"Upload limit reached for your subscription tier"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((t!=null&&t.subscription_tier?pe.maxSize[t.subscription_tier]:pe.maxSize.free)/1024/1024),"MB"]})]})]}),j.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Files to Upload"}),j.map(l=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:l.file.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(l.file.size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs(re,{value:l.documentType,onValueChange:f=>E(l.id,f),children:[e.jsx(ce,{className:"w-32",children:e.jsx(ie,{})}),e.jsx(le,{children:Object.entries(oe).map(([f,A])=>e.jsx(q,{value:f,children:A},f))})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>b(l.id),disabled:g,children:e.jsx(ze,{className:"h-4 w-4"})})]},l.id))]}),g&&i.status&&e.jsx(_,{children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:$(i.status.stage),children:C(i.status.stage)}),e.jsx("span",{className:"font-medium capitalize",children:i.status.stage.replace("_"," ")})]}),e.jsxs(V,{variant:"outline",children:[Math.round(i.progress),"%"]})]}),e.jsx(Ee,{value:i.progress,className:"w-full"}),e.jsx("p",{className:"text-sm text-gray-600",children:i.status.message}),i.status.details&&e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[i.status.details.ocrQuality&&e.jsxs("p",{children:["OCR Quality: ",Math.round(i.status.details.ocrQuality*100),"%"]}),i.status.details.textLength&&e.jsxs("p",{children:["Text Length: ",i.status.details.textLength.toLocaleString()," characters"]}),i.status.details.embeddingChunks&&e.jsxs("p",{children:["Embedding Chunks: ",i.status.details.embeddingChunks]})]}),i.error&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:i.error})]})})}),j.length>0&&!g&&e.jsxs(y,{onClick:N,className:"w-full",disabled:!o,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Upload and Process ",j.length," File",j.length>1?"s":""]})]})]})},ea=()=>{const[n,a]=u.useState("grid"),[s,t]=u.useState(new Set),[c,i]=u.useState("created_at"),[r,g]=u.useState("desc"),[o,d]=u.useState({status:"all",type:"all",dateRange:"all"}),[h,j]=u.useState(!1),{data:v=[],isLoading:R,error:k}=Ht(),{searchQuery:D,setSearchQuery:z,searchResults:U,isSearching:m}=Kt(),p=Gt(),x=Zt(),{bulkDelete:b,isBulkDeleting:E}=Yt(),{data:N,error:C}=Xt();De.useEffect(()=>{k&&console.error("Documents loading error:",k),C&&console.error("Stats loading error:",C)},[k,C]);const $=u.useMemo(()=>{try{let w=D.length>2?U:v;if(!Array.isArray(w))return console.warn("Documents result is not an array:",w),[];if(o.status!=="all"&&(w=w.filter(F=>(F==null?void 0:F.processing_status)===o.status)),o.type!=="all"&&(w=w.filter(F=>(F==null?void 0:F.document_type)===o.type)),o.dateRange!=="all"){const F=new Date,de=new Date;switch(o.dateRange){case"today":de.setHours(0,0,0,0);break;case"week":de.setDate(F.getDate()-7);break;case"month":de.setMonth(F.getMonth()-1);break}w=w.filter(B=>(B==null?void 0:B.created_at)&&new Date(B.created_at)>=de)}return w.sort((F,de)=>{if(!F||!de)return 0;let B=F[c],ee=de[c];return c==="created_at"?(B=new Date(B).getTime(),ee=new Date(ee).getTime()):c==="file_size"?(B=Number(B)||0,ee=Number(ee)||0):(B=String(B||"").toLowerCase(),ee=String(ee||"").toLowerCase()),r==="asc"?B<ee?-1:B>ee?1:0:B>ee?-1:B<ee?1:0}),w}catch(w){return console.error("Error filtering documents:",w),[]}},[v,U,D,o,c,r]),l=w=>{const F=new Set(s);F.has(w)?F.delete(w):F.add(w),t(F)},f=()=>{s.size===$.length?t(new Set):t(new Set($.map(w=>w.id)))},A=async()=>{s.size!==0&&(await b.mutateAsync(Array.from(s)),t(new Set))},H=w=>{x.mutate({documentId:w})},W=w=>{p.mutate(w)},te=w=>{switch(w){case"completed":return e.jsx(ne,{className:"h-4 w-4 text-green-500"});case"processing":return e.jsx(ve,{className:"h-4 w-4 text-blue-500"});case"failed":return e.jsx(Y,{className:"h-4 w-4 text-red-500"});default:return e.jsx(ve,{className:"h-4 w-4 text-gray-500"})}},Fe=w=>{switch(w){case"completed":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Upload Documents"}),e.jsx(y,{variant:"outline",onClick:()=>j(!1),children:"Back to Dashboard"})]}),e.jsx(Pt,{onUploadComplete:()=>j(!1)})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Document Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage and organize your legal documents"})]}),e.jsxs(y,{onClick:()=>j(!0),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Upload Documents"]})]}),N&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(_,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Documents"}),e.jsx("p",{className:"text-2xl font-bold",children:N.total})]})]})})}),e.jsx(_,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Processed"}),e.jsx("p",{className:"text-2xl font-bold",children:N.byStatus.completed||0})]})]})})}),e.jsx(_,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Processing"}),e.jsx("p",{className:"text-2xl font-bold",children:N.byStatus.processing||0})]})]})})}),e.jsx(_,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ds,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Size"}),e.jsxs("p",{className:"text-2xl font-bold",children:[(N.totalSize/1024/1024).toFixed(1),"MB"]})]})]})})})]}),e.jsx(_,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(fe,{placeholder:"Search documents...",value:D,onChange:w=>z(w.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(re,{value:o.status,onValueChange:w=>d(F=>({...F,status:w})),children:[e.jsx(ce,{className:"w-32",children:e.jsx(ie,{placeholder:"Status"})}),e.jsxs(le,{children:[e.jsx(q,{value:"all",children:"All Status"}),Object.entries(ue).map(([w,F])=>e.jsx(q,{value:w,children:F},w))]})]}),e.jsxs(re,{value:o.type,onValueChange:w=>d(F=>({...F,type:w})),children:[e.jsx(ce,{className:"w-32",children:e.jsx(ie,{placeholder:"Type"})}),e.jsxs(le,{children:[e.jsx(q,{value:"all",children:"All Types"}),Object.entries(oe).map(([w,F])=>e.jsx(q,{value:w,children:F},w))]})]}),e.jsxs(re,{value:c,onValueChange:w=>i(w),children:[e.jsx(ce,{className:"w-32",children:e.jsx(ie,{placeholder:"Sort by"})}),e.jsxs(le,{children:[e.jsx(q,{value:"created_at",children:"Date"}),e.jsx(q,{value:"filename",children:"Name"}),e.jsx(q,{value:"file_size",children:"Size"}),e.jsx(q,{value:"processing_status",children:"Status"})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>g(r==="asc"?"desc":"asc"),children:r==="asc"?"↑":"↓"})]}),e.jsxs("div",{className:"flex border rounded-md",children:[e.jsx(y,{variant:n==="grid"?"default":"ghost",size:"sm",onClick:()=>a("grid"),children:e.jsx(nt,{className:"h-4 w-4"})}),e.jsx(y,{variant:n==="list"?"default":"ghost",size:"sm",onClick:()=>a("list"),children:e.jsx(Ge,{className:"h-4 w-4"})})]})]})})}),s.size>0&&e.jsx(_,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[s.size," document",s.size>1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"destructive",size:"sm",onClick:A,disabled:E,children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>t(new Set),children:"Clear Selection"})]})]})})}),R?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{children:"Loading documents..."})}):k?e.jsx("div",{className:"text-center py-8 text-red-600",children:e.jsxs("p",{children:["Error loading documents: ",k.message]})}):$.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:D?"No documents found matching your search.":"No documents uploaded yet."}),!D&&e.jsx(y,{className:"mt-4",onClick:()=>j(!0),children:"Upload Your First Document"})]}):e.jsxs("div",{className:n==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-2",children:[n==="list"&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 border-b",children:[e.jsx(Oe,{checked:s.size===$.length,onCheckedChange:f}),e.jsx("span",{className:"text-sm font-medium",children:"Select All"})]}),$.map(w=>!w||!w.id?(console.warn("Invalid document found:",w),null):e.jsx(sa,{document:w,viewMode:n,isSelected:s.has(w.id),onToggleSelection:()=>l(w.id),onDownload:()=>H(w.id),onDelete:()=>W(w.id),getStatusIcon:te,getStatusColor:Fe},w.id)).filter(Boolean)]})]})},sa=({document:n,viewMode:a,isSelected:s,onToggleSelection:t,onDownload:c,onDelete:i,getStatusIcon:r,getStatusColor:g})=>{if(!n)return console.warn("DocumentCard received null/undefined document"),null;const o={id:n.id||"",filename:n.filename||"Unknown File",document_type:n.document_type||"other",file_size:n.file_size||0,created_at:n.created_at||new Date().toISOString(),processing_status:n.processing_status||"pending"};return a==="list"?e.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50",children:[e.jsx(Oe,{checked:s,onCheckedChange:t}),e.jsx(L,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:o.filename}),e.jsxs("p",{className:"text-sm text-gray-500",children:[oe[o.document_type]||"Unknown"," •",(o.file_size/1024/1024).toFixed(2)," MB •",Ne(new Date(o.created_at),{addSuffix:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(V,{className:g(o.processing_status),children:[r(o.processing_status),e.jsx("span",{className:"ml-1",children:ue[o.processing_status]||"Unknown"})]}),e.jsxs(Ze,{children:[e.jsx(Ye,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(ms,{className:"h-4 w-4"})})}),e.jsxs(Xe,{children:[e.jsxs(ye,{onClick:c,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsx(gs,{}),e.jsxs(ye,{onClick:i,className:"text-red-600",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}):e.jsx(_,{className:`cursor-pointer transition-colors ${s?"ring-2 ring-blue-500":""}`,children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx(Oe,{checked:s,onCheckedChange:t}),e.jsxs(Ze,{children:[e.jsx(Ye,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(ms,{className:"h-4 w-4"})})}),e.jsxs(Xe,{children:[e.jsxs(ye,{onClick:c,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsx(gs,{}),e.jsxs(ye,{onClick:i,className:"text-red-600",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("h3",{className:"font-medium truncate",title:o.filename,children:o.filename})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{children:oe[o.document_type]||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Size:"}),e.jsxs("span",{children:[(o.file_size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Uploaded:"}),e.jsx("span",{children:Ne(new Date(o.created_at),{addSuffix:!0})})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(V,{className:`w-full justify-center ${g(o.processing_status)}`,children:[r(o.processing_status),e.jsx("span",{className:"ml-1",children:ue[o.processing_status]||"Unknown"})]})})]})})};class Ns extends De.Component{constructor(s){super(s);ae(this,"resetError",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,t){console.error("ErrorBoundary caught an error:",s,t),this.setState({error:s,errorInfo:t})}render(){if(this.state.hasError){if(this.props.fallback){const s=this.props.fallback;return e.jsx(s,{error:this.state.error,resetError:this.resetError})}return e.jsxs(_,{className:"max-w-2xl mx-auto mt-8",children:[e.jsx(I,{children:e.jsxs(O,{className:"flex items-center text-red-600",children:[e.jsx(Ke,{className:"h-5 w-5 mr-2"}),"Something went wrong"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"An error occurred while rendering this component. Please try refreshing the page or contact support if the problem persists."}),this.state.error&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Error Details:"}),e.jsx("pre",{className:"text-xs text-red-600 overflow-auto",children:this.state.error.message})]}),!1,e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{onClick:this.resetError,variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Try Again"]}),e.jsx(y,{onClick:()=>window.location.reload(),children:"Refresh Page"})]})]})]})}return this.props.children}}const ta=()=>{const[n,a]=u.useState([]),[s,t]=u.useState(!1),c=async()=>{t(!0);const r=[];try{const{data:d,error:h}=await G.from("profiles").select("count").limit(1);r.push({name:"Supabase Connection",status:h?"error":"success",message:h?h.message:"Connected successfully",details:{data:d,error:h}})}catch(d){r.push({name:"Supabase Connection",status:"error",message:d instanceof Error?d.message:"Unknown error",details:d})}try{const{data:d,error:h}=await G.from("uploaded_documents").select("id, filename, processing_status").limit(5);r.push({name:"uploaded_documents Table",status:h?"error":"success",message:h?h.message:`Found ${(d==null?void 0:d.length)||0} documents`,details:{data:d,error:h}})}catch(d){r.push({name:"uploaded_documents Table",status:"error",message:d instanceof Error?d.message:"Unknown error",details:d})}try{const{data:{user:d},error:h}=await G.auth.getUser();r.push({name:"Authentication",status:h?"error":"success",message:h?h.message:d?`Logged in as ${d.email}`:"Not logged in",details:{user:d,error:h}})}catch(d){r.push({name:"Authentication",status:"error",message:d instanceof Error?d.message:"Unknown error",details:d})}try{const{data:d,error:h}=await G.storage.listBuckets(),j=d==null?void 0:d.find(v=>v.name==="documents");r.push({name:"Storage Bucket",status:h?"error":j?"success":"error",message:h?h.message:j?"Documents bucket exists":"Documents bucket not found",details:{buckets:d,error:h}})}catch(d){r.push({name:"Storage Bucket",status:"error",message:d instanceof Error?d.message:"Unknown error",details:d})}const g={VITE_SUPABASE_URL:"https://kvlaydeyqidlfpfutbmp.supabase.co",VITE_SUPABASE_ANON_KEY:"***",VITE_APP_URL:"https://craftchatbot.com"},o=Object.entries(g).filter(([d,h])=>!h);r.push({name:"Environment Variables",status:o.length>0?"error":"success",message:o.length>0?`Missing: ${o.map(([d])=>d).join(", ")}`:"All required variables present",details:g}),a(r),t(!1)};u.useEffect(()=>{c()},[]);const i=r=>{switch(r){case"success":return e.jsx(ne,{className:"h-5 w-5 text-green-500"});case"error":return e.jsx(rt,{className:"h-5 w-5 text-red-500"});case"pending":return e.jsx(Y,{className:"h-5 w-5 text-yellow-500"})}};return e.jsxs(_,{className:"max-w-4xl mx-auto",children:[e.jsx(I,{children:e.jsxs(O,{className:"flex items-center justify-between",children:["Database Connection Test",e.jsxs(y,{onClick:c,disabled:s,size:"sm",children:[e.jsx(Te,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),s?"Running...":"Run Tests"]})]})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-4",children:n.map((r,g)=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[i(r.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600",children:r.message}),!1]})]},g))})})]})},ga=()=>{const{profile:n}=Ue(),a=ct(),[s,t]=u.useState(null),[c,i]=u.useState([]),[r,g]=u.useState(!1),[o,d]=u.useState(0),[h,j]=u.useState("overview"),v=u.useCallback(U=>{t(U)},[]),R=u.useCallback(()=>{t(null)},[]),k=u.useCallback(U=>{d(m=>m+1)},[]),D=u.useCallback(U=>{i(U)},[]),z=u.useCallback(U=>{g(U)},[]);return e.jsx(pt,{children:e.jsx(Ns,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>a("/"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Go to Homepage",children:[e.jsx(it,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Home"})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>a("/dashboard"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Back to Dashboard",children:[e.jsx(lt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})]}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Document Management"}),e.jsx("p",{className:"text-gray-600",children:"Upload, process, and manage your legal documents with AI"})]}),e.jsx("div",{className:"md:hidden",children:e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Documents"})})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Subscription"}),e.jsx("p",{className:"font-medium capitalize",children:(n==null?void 0:n.subscription_tier)||"Free"})]})})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"px-4 py-6 sm:px-0",children:s?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(y,{onClick:R,variant:"outline",size:"sm",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Close Viewer"]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Document Viewer"}),e.jsxs("p",{className:"text-gray-600",children:["Viewing: ",s.filename]})]})]})}),e.jsx(qt,{documentId:s.id,onClose:R,className:"w-full"})]}):e.jsxs(ts,{value:h,onValueChange:j,className:"space-y-6",children:[e.jsxs(as,{className:"grid w-full grid-cols-6",children:[e.jsxs(J,{value:"overview",className:"flex items-center space-x-2",children:[e.jsx(Ds,{className:"h-4 w-4"}),e.jsx("span",{children:"Overview"})]}),e.jsxs(J,{value:"upload",className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{children:"Upload"})]}),e.jsxs(J,{value:"search",className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"})]}),e.jsxs(J,{value:"manage",className:"flex items-center space-x-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Manage"})]}),e.jsxs(J,{value:"enhanced",className:"flex items-center space-x-2",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{children:"Enhanced"})]}),e.jsxs(J,{value:"debug",className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Debug"})]})]}),e.jsxs(P,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(We,{onDocumentSelect:v,refreshTrigger:o})}),e.jsx("div",{children:e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(O,{className:"text-lg flex items-center",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Quick Upload"]}),e.jsx(Z,{children:"Upload documents for AI processing"})]}),e.jsx(T,{children:e.jsx(ys,{onUploadComplete:k,maxFiles:3})})]})})]}),e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(O,{className:"text-lg flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Recent Documents"]}),e.jsx(Z,{children:"Your most recently uploaded documents"})]}),e.jsx(T,{children:e.jsx(Ve,{onDocumentSelect:v,refreshTrigger:o})})]})]}),e.jsx(P,{value:"upload",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ys,{onUploadComplete:k,maxFiles:10})}),e.jsx("div",{children:e.jsx(We,{onDocumentSelect:v,refreshTrigger:o})})]})}),e.jsx(P,{value:"search",className:"space-y-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Bt,{onResults:D,onLoading:z}),e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(O,{className:"text-lg flex items-center",children:[e.jsx(Ce,{className:"h-5 w-5 mr-2"}),"Search Results",r&&e.jsx("div",{className:"ml-2 h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"})]}),e.jsx(Z,{children:c.length>0?`Found ${c.length} document${c.length===1?"":"s"}`:"Enter search criteria to find documents"})]}),e.jsx(T,{children:e.jsx(Ve,{onDocumentSelect:v,refreshTrigger:o})})]})]})}),e.jsx(P,{value:"manage",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsxs(O,{className:"text-lg flex items-center",children:[e.jsx(Ge,{className:"h-5 w-5 mr-2"}),"All Documents"]}),e.jsx(Z,{children:"Manage all your uploaded documents"})]}),e.jsx(T,{children:e.jsx(Ve,{onDocumentSelect:v,refreshTrigger:o})})]})}),e.jsx("div",{children:e.jsx(We,{onDocumentSelect:v,refreshTrigger:o})})]})}),e.jsx(P,{value:"enhanced",className:"space-y-6",children:e.jsx(Ns,{children:e.jsx(ea,{})})}),e.jsx(P,{value:"debug",className:"space-y-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(UploadDiagnostics,{}),e.jsx(gt,{}),e.jsx(jt,{}),e.jsx(ta,{})]})})]})})})]})})})};export{ga as default};
