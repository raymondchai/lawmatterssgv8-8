const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdfWorker-Bhr5FxuK-1751157176355.js","./supabase-Bcs4sqBe-1751157176355.js","./react-vendor-C9QDz5CC-1751157176355.js","./ocr-worker-Ce3Q_jUj-1751157176355.js","./index-NM9ZbnoY-1751157176355.js","./ui-components-DE73Qj9M-1751157176355.js","./data-fetching-CFGephQX-1751157176355.js","./utilities-Di4lGP3h-1751157176355.js","./forms-Lgsqrqwi-1751157176355.js","./ai-services-BdAg_3mV-1751157176355.js","./index-BsavmoSt-1751157176355.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,__publicField=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{r as s,j as t,R as a}from"./react-vendor-C9QDz5CC-1751157176355.js";import{v as r,w as n,x as i,y as c,J as l,F as o,z as d,C as m,t as x,u,A as h,n as p,B as g,E as j,G as f,H as y,K as N,L as w,M as v,P as b,N as S,O as D,Q as k,I as C,R as _,g as U,D as T,a as z,b as E,d as F,p as P,q as A,r as I,s as O,U as R,V as $,S as M,W as L,X as q,Y as B,Z as V,_ as W,$ as Q,a0 as K,o as Y,i as H,a1 as G,a2 as X,a3 as J,a4 as Z,a5 as ee,a6 as se,a7 as te,a8 as ae,a9 as re,aa as ne,ab as ie,ac as ce,ad as le}from"./index-NM9ZbnoY-1751157176355.js";import{_ as oe}from"./supabase-Bcs4sqBe-1751157176355.js";import{aZ as de,F as me,r as xe,aY as ue,X as he,aM as pe,bv as ge,Z as je,aT as fe,n as ye,bW as Ne,w as we,bP as ve,v as be,N as Se,K as De,y as ke,aC as Ce,aI as _e,H as Ue,bX as Te,bY as ze,bS as Ee,p as Fe,b$ as Pe,bD as Ae,aW as Ie,bZ as Oe,a2 as Re,a3 as $e,bE as Me,aH as Le,bI as qe,bx as Be,bt as Ve,bw as We,ap as Qe,a4 as Ke,c0 as Ye,aX as He,W as Ge,aF as Xe}from"./ui-components-DE73Qj9M-1751157176355.js";import{f as Je,l as Ze}from"./utilities-Di4lGP3h-1751157176355.js";import{b as es}from"./useAnnotations-KaQ2pfn2-1751157176355.js";import{b as ss,s as ts,e as as,n as rs,d as ns,u as is}from"./forms-Lgsqrqwi-1751157176355.js";import{c as cs,t as ls,s as os}from"./search-DolCbVwz-1751157176355.js";import{a as ds,u as ms,b as xs}from"./data-fetching-CFGephQX-1751157176355.js";import"./ai-services-BdAg_3mV-1751157176355.js";const us=s.createContext(null),hs={didCatch:!1,error:null};class ErrorBoundary extends s.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=hs}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var s,t,a=arguments.length,r=new Array(a),n=0;n<a;n++)r[n]=arguments[n];null===(s=(t=this.props).onReset)||void 0===s||s.call(t,{args:r,reason:"imperative-api"}),this.setState(hs)}}componentDidCatch(e,s){var t,a;null===(t=(a=this.props).onError)||void 0===t||t.call(a,e,s)}componentDidUpdate(e,s){const{didCatch:t}=this.state,{resetKeys:a}=this.props;var r,n;t&&null!==s.error&&function hasArrayChanged(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==s.length||e.some((e,t)=>!Object.is(e,s[t]))}(e.resetKeys,a)&&(null===(r=(n=this.props).onReset)||void 0===r||r.call(n,{next:a,prev:e.resetKeys,reason:"keys"}),this.setState(hs))}render(){const{children:e,fallbackRender:t,FallbackComponent:a,fallback:r}=this.props,{didCatch:n,error:i}=this.state;let c=e;if(n){const e={error:i,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)c=t(e);else if(a)c=s.createElement(a,e);else{if(void 0===r)throw i;c=r}}return s.createElement(us.Provider,{value:{didCatch:n,error:i,resetErrorBoundary:this.resetErrorBoundary}},c)}}async function extractTextFromDocument(e,s){const t=e.type.toLowerCase(),a=e.name.toLowerCase();if("application/pdf"===t||a.endsWith(".pdf"))return async function extractTextFromPDF(e,s){const t=Date.now();try{s?.({status:"initializing",progress:0,message:"Loading PDF..."});const{getPdfJs:r}=await oe(async()=>{const{getPdfJs:e}=await import("./pdfWorker-Bhr5FxuK-1751157176355.js");return{getPdfJs:e}},__vite__mapDeps([0,1,2]),import.meta.url),n=await r();if(!n)throw new Error("PDF.js failed to load. Please refresh the page and try again.");s?.({status:"initializing",progress:5,message:"Reading PDF file..."});const i=await e.arrayBuffer();if(!i||0===i.byteLength)throw new Error("PDF file appears to be empty or corrupted");s?.({status:"initializing",progress:10,message:"Parsing PDF document..."});const c=await n.getDocument({data:i,verbosity:0,isEvalSupported:!1,disableFontFace:!0,useSystemFonts:!1}).promise,l=c.numPages;if(0===l)throw new Error("PDF document contains no pages");if(l>100)throw new Error(`PDF document has too many pages (${l}). Maximum supported is 100 pages.`);const o=[];let d="",m=0;for(let e=1;e<=l;e++)try{s?.({status:"processing",progress:15+(e-1)/l*80,currentPage:e,totalPages:l,message:`Processing page ${e} of ${l}...`});const t=await c.getPage(e),a=(await t.getTextContent()).items.map(e=>"object"==typeof e&&null!==e?e.str||e.text||"":String(e||"")).filter(e=>e.trim().length>0).join(" ").trim();o.push({pageNumber:e,text:a,confidence:.95}),d+=a+"\n",m++}catch(a){console.warn(`Failed to process page ${e}:`,a),o.push({pageNumber:e,text:`[Page ${e} could not be processed]`,confidence:0})}if(0===m)throw new Error("Failed to process any pages from the PDF document");const x=Date.now()-t;return s?.({status:"completed",progress:100,message:"PDF processing completed"}),{text:d.trim(),confidence:.95,pages:o,metadata:{processingTime:x,fileSize:e.size,pageCount:l}}}catch(r){console.error("Error extracting text from PDF:",r);let e="Failed to extract text from PDF";throw r instanceof Error&&(e=r.message.includes("Invalid PDF")?"The uploaded file is not a valid PDF document":r.message.includes("Password")?"This PDF is password protected. Please upload an unlocked PDF":r.message.includes("corrupted")?"The PDF file appears to be corrupted. Please try uploading again":r.message.includes("too many pages")?r.message:r.message.includes("PDF.js failed to load")?"PDF processing library failed to load. Please refresh the page and try again":r.message.includes("empty")?"The PDF file appears to be empty":`PDF processing failed: ${r.message}`),s?.({status:"error",progress:0,message:e}),new Error(e)}}(e,s);if(t.startsWith("image/")||a.endsWith(".jpg")||a.endsWith(".jpeg")||a.endsWith(".png")||a.endsWith(".gif")||a.endsWith(".bmp")||a.endsWith(".tiff"))return async function extractTextFromImage(e,s){const t=Date.now();try{s?.({status:"initializing",progress:0,message:"Initializing OCR..."});const a=await oe(()=>import("./ocr-worker-Ce3Q_jUj-1751157176355.js").then(e=>e.i),__vite__mapDeps([3,2]),import.meta.url),r=await a.recognize(e,"eng",{logger:e=>{"recognizing text"===e.status&&s?.({status:"processing",progress:100*e.progress,message:`OCR processing: ${Math.round(100*e.progress)}%`})}}),n=Date.now()-t;return s?.({status:"completed",progress:100,message:"OCR processing completed"}),{text:r.data.text,confidence:r.data.confidence/100,pages:[{pageNumber:1,text:r.data.text,confidence:r.data.confidence/100}],metadata:{processingTime:n,fileSize:e.size,pageCount:1}}}catch(a){throw console.error("Error performing OCR:",a),s?.({status:"error",progress:0,message:"OCR processing failed"}),new Error("Failed to perform OCR on image")}}(e,s);if("text/plain"===t||a.endsWith(".txt")){const t=Date.now();s?.({status:"processing",progress:50,message:"Reading text file..."});const a=await e.text(),r=Date.now()-t;return s?.({status:"completed",progress:100,message:"Text file processed"}),{text:a,confidence:1,pages:[{pageNumber:1,text:a,confidence:1}],metadata:{processingTime:r,fileSize:e.size,pageCount:1}}}throw new Error(`Unsupported file type: ${t}`)}function validateOCRQuality(e){const{text:s,confidence:t}=e,a=[];t<.7&&a.push("Low confidence detected. Consider rescanning with higher resolution.");const r=[/[0O]{3,}/,/[1Il]{3,}/,/\s{5,}/,/[^\w\s.,;:!?()-]{3,}/].some(e=>e.test(s));r&&a.push("Potential OCR errors detected. Review the extracted text carefully."),s.length<50&&a.push("Very little text extracted. Ensure the document contains readable text.");let n=t;return r&&(n-=.2),s.length<50&&(n-=.3),n=Math.max(0,Math.min(1,n)),{isGoodQuality:n>=.7,suggestions:a,qualityScore:n}}function cleanExtractedText(e){return e.replace(/\s+/g," ").replace(/[^\w\s.,;:!?()"-]/g,"").replace(/0/g,"O").replace(/1/g,"I").replace(/\n+/g,"\n").trim()}async function processDocument(e,s,t){try{const{usageTrackingService:c}=await oe(async()=>{const{usageTrackingService:e}=await import("./index-NM9ZbnoY-1751157176355.js").then(e=>e.ar);return{usageTrackingService:e}},__vite__mapDeps([4,2,1,5,6,7,8,9,10]),import.meta.url),l=await c.checkUsageLimit("ai_query");if(!l.allowed)throw new Error(`AI processing limit exceeded. You have used ${l.current}/${l.limit} AI queries this month. Please upgrade your plan to continue.`);t?.({stage:"ocr",progress:0,message:"Starting text extraction..."});const o=await extractTextFromDocument(e,e=>{t?.({stage:"ocr",progress:.4*e.progress,message:e.message||"Extracting text..."})}),d=validateOCRQuality(o),m=cleanExtractedText(o.text),{error:x}=await r.from("uploaded_documents").update({ocr_text:m,ocr_quality_score:d.qualityScore,processing_status:"processing",updated_at:(new Date).toISOString()}).eq("id",s);if(x)throw new Error(`Failed to update OCR results: ${x.message}`);t?.({stage:"analysis",progress:40,message:"Analyzing document content..."});const u=await n(m);await c.incrementUsage("ai_query",s,{operation:"document_analysis",text_length:m.length,document_type:e.type});const{error:h}=await r.from("uploaded_documents").update({document_structure:{analysis:u,ocrQuality:d,metadata:o.metadata},updated_at:(new Date).toISOString()}).eq("id",s);if(h)throw new Error(`Failed to update analysis results: ${h.message}`);let p;if(t?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),m.length>50)try{const e=function splitTextIntoChunks(e,s=1e3){const t=[],a=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let r="";for(const n of a){const e=n.trim();r.length+e.length+1<=s?r+=(r?". ":"")+e:(r&&t.push(r+"."),r=e)}r&&t.push(r+".");if(0===t.length){const a=e.split(/\s+/);let r="";for(const e of a)r.length+e.length+1<=s?r+=(r?" ":"")+e:(r&&t.push(r),r=e);r&&t.push(r)}return t.filter(e=>e.trim().length>0)}(m,1e3);for(let a=0;a<e.length;a++){const n=e[a],c=await i(n),{data:l,error:o}=await r.from("document_embeddings").insert({document_id:s,chunk_text:n,chunk_index:a,embedding:c.embedding,metadata:{usage:c.usage,chunkLength:n.length,totalChunks:e.length}}).select("id").single();o?console.error("Failed to store embedding:",o):0===a&&(p=l.id);const d=70+(a+1)/e.length*20;t?.({stage:"embedding",progress:d,message:`Processing chunk ${a+1} of ${e.length}...`})}}catch(a){console.error("Embedding generation failed:",a)}t?.({stage:"completed",progress:95,message:"Finalizing document processing..."});const{data:g,error:j}=await r.from("uploaded_documents").update({processing_status:"completed",updated_at:(new Date).toISOString()}).eq("id",s).select().single();if(j)throw new Error(`Failed to finalize document: ${j.message}`);return t?.({stage:"completed",progress:100,message:"Document processing completed successfully!"}),{document:g,ocrResult:o,analysis:u,embeddingId:p}}catch(c){throw console.error("Document processing failed:",c),await r.from("uploaded_documents").update({processing_status:"failed",updated_at:(new Date).toISOString()}).eq("id",s),t?.({stage:"error",progress:0,message:"Document processing failed",error:c instanceof Error?c.message:"Unknown error"}),c}}new class WebSocketService{constructor(){__publicField(this,"ws",null),__publicField(this,"reconnectAttempts",0),__publicField(this,"maxReconnectAttempts",5),__publicField(this,"reconnectDelay",1e3),__publicField(this,"handlers",new Map),__publicField(this,"isConnecting",!1),__publicField(this,"userId",null),console.log("WebSocket service initialized but connections disabled in production")}setupAuthListener(){r.auth.onAuthStateChange((e,s)=>{"SIGNED_IN"===e&&s?.user?(this.userId=s.user.id,this.connect()):"SIGNED_OUT"===e&&(this.userId=null,this.disconnect())})}async connect(){console.log("WebSocket connection skipped - disabled in production")}getWebSocketUrl(){return"https://kvlaydeyqidlfpfutbmp.supabase.co".replace("https://","wss://")+"/realtime/v1/websocket"}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.error("Max reconnection attempts reached");const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts);this.reconnectAttempts++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${e}ms`),setTimeout(()=>{this.connect()},e)}disconnect(){this.ws&&(this.ws.close(1e3,"User disconnected"),this.ws=null),this.isConnecting=!1,this.reconnectAttempts=0}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("WebSocket not connected, cannot send message:",e)}handleMessage(e){(this.handlers.get(e.type)||[]).forEach(s=>{try{s(e)}catch(t){console.error("Error in WebSocket message handler:",t)}});(this.handlers.get("all")||[]).forEach(s=>{try{s(e)}catch(t){console.error("Error in WebSocket all-events handler:",t)}})}subscribe(e,s){return this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(s),()=>{const t=this.handlers.get(e);if(t){const e=t.indexOf(s);e>-1&&t.splice(e,1)}}}sendDocumentProcessingUpdate(e){this.send({type:"document_processing",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0,documentId:e.documentId})}sendAIQueryUpdate(e){this.send({type:"ai_query",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}sendSystemNotification(e){this.send({type:"system_notification",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}get isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}get connectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"unknown"}}};const ps=new class DisabledWebSocketService{async connect(){}disconnect(){}subscribe(e,s){return()=>{}}sendDocumentProcessingUpdate(e){}sendAIQueryUpdate(e){}sendSystemNotification(e){}get isConnected(){return!1}get connectionState(){return"disabled"}};const DocumentUpload=({onUploadComplete:e,maxFiles:a=5})=>{const[r,n]=s.useState([]),[i,C]=s.useState(!1),[_,U]=s.useState(!1),{profile:T,loading:z}=c(),{simulateDocumentProcessing:E}=function useRealTimeSimulation(){return{simulateDocumentProcessing:s.useCallback(e=>{},[]),simulateAIQuery:s.useCallback(e=>{},[]),simulateSystemNotification:s.useCallback(e=>{ps.sendSystemNotification({id:`notification_${Date.now()}`,...e})},[])}}(),F=s.useCallback(e=>{T||z||l.warning("Profile not fully loaded. Upload will proceed with default settings."),U(!0);(async()=>{try{if(T){const{usageTrackingService:e}=await oe(async()=>{const{usageTrackingService:e}=await import("./index-NM9ZbnoY-1751157176355.js").then(e=>e.ar);return{usageTrackingService:e}},__vite__mapDeps([4,2,1,5,6,7,8,9,10]),import.meta.url),s=e.checkUsageLimit("document_upload"),t=new Promise((e,s)=>setTimeout(()=>s(new Error("Usage check timeout")),5e3)),a=await Promise.race([s,t]);if(!a.allowed)return l.error(`Upload limit reached. You have used ${a.current}/${a.limit} document uploads this month. Please upgrade your plan to continue.`),void U(!1);a.percentage>=80&&l.warning(`You have used ${a.current}/${a.limit} document uploads this month (${Math.round(a.percentage)}%).`)}else l.warning("Profile not loaded. Upload will proceed with default free tier limits.")}catch(s){console.error("Error checking usage limits:",s),l.warning("Unable to verify upload limits. Upload will proceed but may be subject to restrictions.")}U(!1),P(e)})()},[T]),P=s.useCallback(e=>{const s=T?.subscription_tier?o.maxSize[T.subscription_tier]:o.maxSize.free,t=e.filter(e=>!(e.size>s)||(l.error(`File ${e.name} is too large. Maximum size is ${Math.round(s/1024/1024)}MB`),!1)).map(e=>({file:e,id:crypto.randomUUID(),progress:0,status:"pending"}));n(e=>[...e,...t].slice(0,a))},[T,a]),{getRootProps:A,getInputProps:I,isDragActive:O}=d({onDrop:F,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:a,disabled:i||_||z}),R=r.some(e=>"pending"===e.status&&e.documentType);return t.jsxs(m,{className:"w-full",children:[t.jsxs(x,{children:[t.jsx(u,{children:"Upload Documents"}),t.jsx(h,{children:"Upload your legal documents for AI-powered analysis and processing"})]}),t.jsxs(p,{className:"space-y-4",children:[t.jsxs("div",{...A(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${O?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${i||_||z||!T?"opacity-50 cursor-not-allowed":""}`,children:[t.jsx("input",{...I()}),t.jsx(de,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),z?t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:"Loading user profile..."}),t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):_?t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:"Checking upload limits..."}),t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]}):O?t.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:"Drag & drop files here, or click to select files"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((T?.subscription_tier?o.maxSize[T.subscription_tier]:o.maxSize.free)/1024/1024),"MB"]})]})]}),r.length>0&&t.jsx("div",{className:"space-y-3",children:r.map(e=>t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(me,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium",children:e.file.name}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(e.file.size/1024)," KB)"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:["completed"===e.status&&t.jsx(xe,{className:"h-4 w-4 text-green-500"}),"error"===e.status&&t.jsx(ue,{className:"h-4 w-4 text-red-500"}),"pending"===e.status&&t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void n(e=>e.filter(e=>e.id!==s));var s},children:t.jsx(he,{className:"h-4 w-4"})})]})]}),"pending"===e.status&&t.jsx("div",{className:"mb-2",children:t.jsxs(j,{value:e.documentType||"",onValueChange:s=>{return t=e.id,a=s,void n(e=>e.map(e=>e.id===t?{...e,documentType:a}:e));var t,a},children:[t.jsx(f,{className:"w-full",children:t.jsx(y,{placeholder:"Select document type"})}),t.jsx(N,{children:Object.entries(w).map(([e,s])=>t.jsx(v,{value:e,children:s},e))})]})}),("uploading"===e.status||"processing"===e.status)&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:e.processingMessage||"Processing..."}),t.jsxs("span",{children:[Math.round(e.progress),"%"]})]}),t.jsx(b,{value:e.progress,className:"w-full"}),e.processingStage&&t.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:["ocr"===e.processingStage&&t.jsx(pe,{className:"h-3 w-3"}),"analysis"===e.processingStage&&t.jsx(ge,{className:"h-3 w-3"}),"embedding"===e.processingStage&&t.jsx(je,{className:"h-3 w-3"}),t.jsxs("span",{className:"capitalize",children:[e.processingStage," processing"]})]})]}),"error"===e.status&&e.error&&t.jsx(S,{variant:"destructive",children:t.jsx(D,{children:e.error})})]},e.id))}),r.length>0&&t.jsx(g,{onClick:async()=>{if(0!==r.length){C(!0);for(const a of r)if("pending"===a.status&&a.documentType)try{n(e=>e.map(e=>e.id===a.id?{...e,status:"uploading",progress:0,processingMessage:"Uploading file..."}:e));const t=await k.uploadDocument(a.file,a.documentType);try{const{usageTrackingService:e}=await oe(async()=>{const{usageTrackingService:e}=await import("./index-NM9ZbnoY-1751157176355.js").then(e=>e.ar);return{usageTrackingService:e}},__vite__mapDeps([4,2,1,5,6,7,8,9,10]),import.meta.url);await e.incrementUsage("document_upload",t.id,{filename:a.file.name,file_size:a.file.size,document_type:a.documentType})}catch(s){console.warn("Usage tracking increment failed:",s)}n(e=>e.map(e=>e.id===a.id?{...e,status:"processing",progress:20,documentId:t.id,processingMessage:"Starting AI processing..."}:e)),ps.sendDocumentProcessingUpdate({documentId:t.id,status:"processing",progress:20,message:"Starting AI processing..."}),await processDocument(a.file,t.id,e=>{n(s=>s.map(s=>s.id===a.id?{...s,progress:20+.8*e.progress,processingStage:e.stage,processingMessage:e.message}:s)),ps.sendDocumentProcessingUpdate({documentId:t.id,status:"processing",progress:20+.8*e.progress,message:e.message,stage:e.stage})}),n(e=>e.map(e=>e.id===a.id?{...e,status:"completed",progress:100,processingMessage:"Processing completed!"}:e)),ps.sendDocumentProcessingUpdate({documentId:t.id,status:"completed",progress:100,message:"Document processing completed successfully!"}),l.success(`${a.file.name} uploaded and processed successfully`),e&&e(t.id)}catch(t){console.error("Upload/processing error:",t);let e=t.message||"Upload or processing failed";t.message?.includes("Upload limit exceeded")?e="You have reached your monthly upload limit. Please upgrade your plan to continue.":t.message?.includes("File size exceeds")?e="File is too large for your subscription tier. Please upgrade or use a smaller file.":t.message?.includes("PDF processing failed")?e="Failed to process PDF. Please ensure the file is not corrupted or password-protected.":t.message?.includes("Failed to extract text")&&(e="Could not extract text from the document. Please try a different file or contact support."),n(s=>s.map(s=>s.id===a.id?{...s,status:"error",error:e,processingMessage:"Failed"}:s));const s=r.find(e=>e.id===a.id);s?.documentId&&ps.sendDocumentProcessingUpdate({documentId:s.documentId,status:"failed",progress:0,message:"Document processing failed",error:e}),l.error(`Failed to process ${a.file.name}: ${e}`)}C(!1)}},disabled:!R||i,className:"w-full",children:i?"Uploading...":`Upload ${r.filter(e=>"pending"===e.status).length} Files`})]})]})},DocumentUploadFallback=({onUploadComplete:e,maxFiles:a=5})=>{const[r,n]=s.useState([]),[i,c]=s.useState(!1);return t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"flex items-center",children:[t.jsx(de,{className:"h-5 w-5 mr-2"}),"Document Upload (Fallback Mode)"]}),t.jsx(h,{children:"Basic file upload functionality"})]}),t.jsxs(p,{className:"space-y-4",children:[t.jsxs(S,{children:[t.jsx(ue,{className:"h-4 w-4"}),t.jsx(D,{children:"Advanced upload features are temporarily unavailable. Using basic upload mode."})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"file-input",className:"block text-sm font-medium",children:"Select Files"}),t.jsx("input",{id:"file-input",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt",onChange:e=>{const s=Array.from(e.target.files||[]).filter(e=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(e.type)?!(e.size>10485760)||(l.error(`${e.name} is too large (max 10MB)`),!1):(l.error(`${e.name} is not a supported file type`),!1));n(e=>[...e,...s].slice(0,a))},disabled:i,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Supports PDF, DOC, DOCX, TXT files up to 10MB each"})]}),r.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Selected Files:"}),r.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(me,{className:"h-4 w-4 text-gray-500"}),t.jsx("span",{className:"text-sm",children:e.name}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",Math.round(e.size/1024)," KB)"]})]}),t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(s=>s.filter((s,t)=>t!==e))})(s),disabled:i,children:"Remove"})]},s))]}),t.jsx(g,{onClick:async()=>{if(0!==r.length){c(!0);try{for(const s of r)await new Promise(e=>setTimeout(e,1e3)),console.log("Uploading file:",s.name),e&&e(`mock-id-${Date.now()}`);l.success(`Successfully uploaded ${r.length} file(s)`),n([])}catch(s){console.error("Upload error:",s),l.error("Upload failed. Please try again.")}finally{c(!1)}}else l.error("Please select files to upload")},disabled:0===r.length||i,className:"w-full",children:i?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(de,{className:"h-4 w-4 mr-2"}),"Upload ",r.length," File(s)"]})})]})]})},UploadLoadingFallback=()=>t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"flex items-center",children:[t.jsx(de,{className:"h-5 w-5 mr-2"}),"Document Upload"]}),t.jsx(h,{children:"Loading upload interface..."})]}),t.jsx(p,{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Initializing upload component..."})]})})]}),UploadErrorFallback=({error:e,resetErrorBoundary:s})=>t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"flex items-center text-red-600",children:[t.jsx(ue,{className:"h-5 w-5 mr-2"}),"Upload Error"]}),t.jsx(h,{children:"The upload component encountered an error"})]}),t.jsxs(p,{className:"space-y-4",children:[t.jsxs(S,{variant:"destructive",children:[t.jsx(ue,{className:"h-4 w-4"}),t.jsx(D,{children:e.message||"An unexpected error occurred while loading the upload component."})]}),t.jsx("div",{className:"flex space-x-2",children:t.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Try Again"})}),t.jsxs("details",{className:"text-xs text-gray-500",children:[t.jsx("summary",{className:"cursor-pointer",children:"Technical Details"}),t.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto",children:e.stack})]})]})]}),DocumentUploadWrapper=e=>t.jsx(ErrorBoundary,{FallbackComponent:UploadErrorFallback,onError:(e,s)=>{console.error("DocumentUpload Error:",e,s),"undefined"!=typeof window&&window.gtag&&window.gtag("event","exception",{description:e.message,fatal:!1})},onReset:()=>{console.log("Resetting DocumentUpload component")},children:t.jsx(s.Suspense,{fallback:t.jsx(UploadLoadingFallback,{}),children:t.jsx(DocumentUploadWithFallback,{...e})})}),DocumentUploadWithFallback=e=>{const[s,r]=a.useState(!0),[n,i]=a.useState(!1);return a.useEffect(()=>{i(!1)},[e]),n||!s?t.jsx(DocumentUploadFallback,{...e}):t.jsx(ErrorBoundary,{FallbackComponent:()=>(i(!0),t.jsx(DocumentUploadFallback,{...e})),onError:e=>{console.error("Main DocumentUpload failed, switching to fallback:",e),r(!1),i(!0)},children:t.jsx(DocumentUpload,{...e})})},DocumentList=({onDocumentSelect:e,refreshTrigger:a})=>{const[r,n]=s.useState([]),[i,c]=s.useState(!0),[o,d]=s.useState(""),[b,S]=s.useState("all"),[D,P]=s.useState("all");s.useEffect(()=>{loadDocuments()},[a]);const loadDocuments=async()=>{try{c(!0);const e=await k.getDocuments();n(e)}catch(e){console.error("Error loading documents:",e),l.error("Failed to load documents")}finally{c(!1)}},handleSearch=async()=>{if(o.trim())try{c(!0);const e=await k.searchDocuments(o);n(e)}catch(e){console.error("Error searching documents:",e),l.error("Failed to search documents")}finally{c(!1)}else loadDocuments()},getStatusIcon=e=>{switch(e){case"pending":return t.jsx(be,{className:"h-4 w-4 text-yellow-500"});case"processing":return t.jsx(fe,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return t.jsx(xe,{className:"h-4 w-4 text-green-500"});case"failed":return t.jsx(ue,{className:"h-4 w-4 text-red-500"});default:return t.jsx(me,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},A=r.filter(e=>{const s="all"===b||e.processing_status===b,t="all"===D||e.document_type===D;return s&&t});return i&&0===r.length?t.jsx(m,{children:t.jsx(p,{className:"flex items-center justify-center py-8",children:t.jsx(fe,{className:"h-8 w-8 animate-spin"})})}):t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsx(u,{children:"Documents"}),t.jsx(h,{children:"Manage and view your uploaded documents"})]}),t.jsxs(p,{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"flex-1 flex gap-2",children:[t.jsx(C,{placeholder:"Search documents...",value:o,onChange:e=>d(e.target.value),onKeyPress:e=>"Enter"===e.key&&handleSearch()}),t.jsx(g,{onClick:handleSearch,variant:"outline",children:t.jsx(ye,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(j,{value:b,onValueChange:S,children:[t.jsx(f,{className:"w-32",children:t.jsx(y,{})}),t.jsxs(N,{children:[t.jsx(v,{value:"all",children:"All Status"}),Object.entries(_).map(([e,s])=>t.jsx(v,{value:e,children:s},e))]})]}),t.jsxs(j,{value:D,onValueChange:P,children:[t.jsx(f,{className:"w-32",children:t.jsx(y,{})}),t.jsxs(N,{children:[t.jsx(v,{value:"all",children:"All Types"}),Object.entries(w).map(([e,s])=>t.jsx(v,{value:e,children:s},e))]})]})]})]}),0===A.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(me,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents found"}),t.jsx("p",{className:"text-gray-500",children:0===r.length?"Upload your first document to get started":"Try adjusting your search or filters"})]}):t.jsx("div",{className:"space-y-3",children:A.map(s=>t.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[t.jsx(me,{className:"h-8 w-8 text-gray-400"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:s.filename}),t.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[t.jsx("span",{className:"text-xs text-gray-500",children:w[s.document_type]}),t.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(s.file_size/1024)," KB"]}),t.jsx("span",{className:"text-xs text-gray-500",children:Je(new Date(s.created_at),{addSuffix:!0})})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[getStatusIcon(s.processing_status),t.jsx(U,{className:getStatusColor(s.processing_status),children:_[s.processing_status]})]}),t.jsxs(T,{children:[t.jsx(z,{asChild:!0,children:t.jsx(g,{variant:"ghost",size:"sm",children:t.jsx(Ne,{className:"h-4 w-4"})})}),t.jsxs(E,{align:"end",children:[t.jsxs(F,{onClick:()=>e?.(s),children:[t.jsx(pe,{className:"mr-2 h-4 w-4"}),"View"]}),t.jsxs(F,{onClick:()=>window.open(s.file_url,"_blank"),children:[t.jsx(we,{className:"mr-2 h-4 w-4"}),"Download"]}),t.jsxs(F,{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this document?"))try{await k.deleteDocument(e),n(s=>s.filter(s=>s.id!==e)),l.success("Document deleted successfully")}catch(s){console.error("Error deleting document:",s),l.error("Failed to delete document")}})(s.id),className:"text-red-600",children:[t.jsx(ve,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]})},s.id))})]})]})},DocumentAnalysisComponent=({document:e,className:a=""})=>{const[r,i]=s.useState(null),[c,o]=s.useState(""),[d,j]=s.useState(null),[f,y]=s.useState(!1),[N,w]=s.useState(0),[v,k]=s.useState("overview");s.useEffect(()=>{if(e.document_structure&&"object"==typeof e.document_structure){const s=e.document_structure.analysis;s&&i(s)}},[e]);const performAnalysis=async()=>{if(e.ocr_text){y(!0),w(0);try{w(20);const s=await n(e.ocr_text);i(s),w(50);const t=await R(e.ocr_text,800);o(t),w(80);const a=await $(e.ocr_text);j(a),w(100),l.success("Document analysis completed successfully")}catch(s){console.error("Analysis error:",s),l.error("Failed to analyze document: "+s.message)}finally{y(!1)}}else l.error("No text content available for analysis")};return t.jsxs(m,{className:a,children:[t.jsx(x,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs(u,{className:"flex items-center space-x-2",children:[t.jsx(ge,{className:"h-5 w-5 text-purple-600"}),t.jsx("span",{children:"AI Document Analysis"})]}),t.jsxs(h,{children:["AI-powered analysis of ",e.filename]})]}),t.jsxs("div",{className:"flex space-x-2",children:[(r||c||d)&&t.jsxs(g,{variant:"outline",size:"sm",onClick:()=>{const s={document:{filename:e.filename,type:e.document_type,uploadDate:e.created_at},analysis:r,summary:c,entities:d,generatedAt:(new Date).toISOString()},t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=e.createElement("a");n.href=a,n.download=`${e.filename}_analysis.json`,e.body.appendChild(n),n.click(),e.body.removeChild(n),URL.revokeObjectURL(a)},children:[t.jsx(we,{className:"h-4 w-4 mr-2"}),"Export"]}),t.jsx(g,{onClick:performAnalysis,disabled:f||!e.ocr_text,size:"sm",children:f?t.jsxs(t.Fragment,{children:[t.jsx(fe,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):t.jsxs(t.Fragment,{children:[t.jsx(Se,{className:"h-4 w-4 mr-2"}),r?"Re-analyze":"Analyze"]})})]})]})}),t.jsxs(p,{className:"space-y-4",children:[!e.ocr_text&&t.jsxs(S,{children:[t.jsx(De,{className:"h-4 w-4"}),t.jsx(D,{children:"No text content available. Please ensure the document has been processed with OCR."})]}),f&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{children:"Analyzing document..."}),t.jsxs("span",{children:[N,"%"]})]}),t.jsx(b,{value:N,className:"w-full"})]}),(r||c||d)&&t.jsxs(P,{value:v,onValueChange:k,children:[t.jsxs(A,{className:"grid w-full grid-cols-4",children:[t.jsx(I,{value:"overview",children:"Overview"}),t.jsx(I,{value:"summary",children:"Summary"}),t.jsx(I,{value:"entities",children:"Entities"}),t.jsx(I,{value:"insights",children:"Insights"})]}),t.jsxs(O,{value:"overview",className:"space-y-4",children:[r&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsx(u,{className:"text-sm",children:"Document Classification"})}),t.jsx(p,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(U,{variant:"secondary",children:r.documentType}),t.jsxs("div",{className:"text-sm "+(C=r.confidence,C>=.8?"text-green-600":C>=.6?"text-yellow-600":"text-red-600"),children:[(e=>e>=.8?"High":e>=.6?"Medium":"Low")(r.confidence)," confidence"]})]})})]}),t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsx(u,{className:"text-sm",children:"Key Entities"})}),t.jsx(p,{children:t.jsx("div",{className:"text-sm text-gray-600",children:r.keyEntities.length>0?t.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.keyEntities.slice(0,3).map((e,s)=>t.jsx(U,{variant:"outline",className:"text-xs",children:e},s)),r.keyEntities.length>3&&t.jsxs(U,{variant:"outline",className:"text-xs",children:["+",r.keyEntities.length-3," more"]})]}):"No key entities identified"})})]})]}),r&&t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsx(u,{className:"text-sm",children:"Executive Summary"})}),t.jsx(p,{children:t.jsx("p",{className:"text-sm text-gray-700",children:r.summary})})]})]}),t.jsx(O,{value:"summary",className:"space-y-4",children:c?t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsx(u,{className:"text-sm",children:"Document Summary"})}),t.jsx(p,{children:t.jsx("div",{className:"prose prose-sm max-w-none",children:t.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:c})})})]}):t.jsxs("div",{className:"text-center text-gray-500 py-8",children:[t.jsx(me,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:'No summary available. Click "Analyze" to generate one.'})]})}),t.jsx(O,{value:"entities",className:"space-y-4",children:d?t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsxs(u,{className:"text-sm flex items-center space-x-2",children:[t.jsx(ke,{className:"h-4 w-4"}),t.jsx("span",{children:"People"})]})}),t.jsx(p,{children:d.people.length>0?t.jsx("div",{className:"space-y-1",children:d.people.map((e,s)=>t.jsx(U,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsxs(u,{className:"text-sm flex items-center space-x-2",children:[t.jsx(me,{className:"h-4 w-4"}),t.jsx("span",{children:"Organizations"})]})}),t.jsx(p,{children:d.organizations.length>0?t.jsx("div",{className:"space-y-1",children:d.organizations.map((e,s)=>t.jsx(U,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsxs(u,{className:"text-sm flex items-center space-x-2",children:[t.jsx(Ce,{className:"h-4 w-4"}),t.jsx("span",{children:"Dates"})]})}),t.jsx(p,{children:d.dates.length>0?t.jsx("div",{className:"space-y-1",children:d.dates.map((e,s)=>t.jsx(U,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsxs(u,{className:"text-sm flex items-center space-x-2",children:[t.jsx(_e,{className:"h-4 w-4"}),t.jsx("span",{children:"Amounts"})]})}),t.jsx(p,{children:d.amounts.length>0?t.jsx("div",{className:"space-y-1",children:d.amounts.map((e,s)=>t.jsx(U,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]}),t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsxs(u,{className:"text-sm flex items-center space-x-2",children:[t.jsx(Ue,{className:"h-4 w-4"}),t.jsx("span",{children:"Locations"})]})}),t.jsx(p,{children:d.locations.length>0?t.jsx("div",{className:"space-y-1",children:d.locations.map((e,s)=>t.jsx(U,{variant:"outline",className:"text-xs",children:e},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"None identified"})})]})]}):t.jsxs("div",{className:"text-center text-gray-500 py-8",children:[t.jsx(ke,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:'No entities extracted. Click "Analyze" to extract entities.'})]})}),t.jsx(O,{value:"insights",className:"space-y-4",children:r&&t.jsxs(t.Fragment,{children:[t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsx(u,{className:"text-sm",children:"Legal Implications"})}),t.jsx(p,{children:r.legalImplications.length>0?t.jsx("ul",{className:"space-y-2",children:r.legalImplications.map((e,s)=>t.jsxs("li",{className:"flex items-start space-x-2",children:[t.jsx(De,{className:"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"No legal implications identified"})})]}),t.jsxs(m,{children:[t.jsx(x,{className:"pb-3",children:t.jsx(u,{className:"text-sm",children:"Recommended Actions"})}),t.jsx(p,{children:r.recommendedActions.length>0?t.jsx("ul",{className:"space-y-2",children:r.recommendedActions.map((e,s)=>t.jsxs("li",{className:"flex items-start space-x-2",children:[t.jsx(xe,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm text-gray-700",children:e})]},s))}):t.jsx("p",{className:"text-sm text-gray-500",children:"No specific actions recommended"})})]})]})})]}),!r&&!c&&!d&&!f&&e.ocr_text&&t.jsxs("div",{className:"text-center text-gray-500 py-8",children:[t.jsx(ge,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{className:"mb-4",children:"Ready to analyze this document with AI"}),t.jsxs(g,{onClick:performAnalysis,children:[t.jsx(ge,{className:"h-4 w-4 mr-2"}),"Start Analysis"]})]})]})]});var C},gs=[{name:"Yellow",value:"#FFEB3B",bg:"rgba(255, 235, 59, 0.3)"},{name:"Green",value:"#4CAF50",bg:"rgba(76, 175, 80, 0.3)"},{name:"Blue",value:"#2196F3",bg:"rgba(33, 150, 243, 0.3)"},{name:"Red",value:"#F44336",bg:"rgba(244, 67, 54, 0.3)"},{name:"Purple",value:"#9C27B0",bg:"rgba(156, 39, 176, 0.3)"},{name:"Orange",value:"#FF9800",bg:"rgba(255, 152, 0, 0.3)"}],EnhancedPDFViewer=({documentUrl:e,documentId:a,className:r="",onAnnotationChange:n})=>{const[i,o]=s.useState(100),[d,x]=s.useState(0),[u,h]=s.useState(!1),[j,f]=s.useState("select"),[y,N]=s.useState(gs[0]),[w,v]=s.useState(!0),[b,S]=s.useState(!1),[D,k]=s.useState(null),[C,_]=s.useState(null),[T,z]=s.useState(null),[E,F]=s.useState(""),P=s.useRef(null),A=s.useRef(null),{annotations:I,isLoading:O,createAnnotation:R,updateAnnotation:$,deleteAnnotation:H}=es(a),{user:G}=c();s.useEffect(()=>{n?.(I)},[I,n]);const X=s.useCallback(e=>{if("select"===j)return;const s=P.current?.getBoundingClientRect();if(!s)return;const t=e.clientX-s.left,a=e.clientY-s.top;"highlight"===j?(S(!0),k({x:t,y:a}),_({x:t,y:a,width:0,height:0})):"note"!==j&&"sticky"!==j||handleCreateAnnotation(t,a)},[j]),J=s.useCallback(e=>{if(!b||!D||"highlight"!==j)return;const s=P.current?.getBoundingClientRect();if(!s)return;const t=e.clientX-s.left,a=e.clientY-s.top;_({x:Math.min(D.x,t),y:Math.min(D.y,a),width:Math.abs(t-D.x),height:Math.abs(a-D.y)})},[b,D,j]),Z=s.useCallback(()=>{b&&C&&"highlight"===j&&C.width>10&&C.height>10&&handleCreateHighlight(C),S(!1),k(null),_(null)},[b,C,j]),handleCreateAnnotation=async(e,s)=>{if(!G)return void l.error("Please log in to create annotations");const t=await R({type:j,page_number:1,position:{x:e,y:s},content:"",color:y.value});t&&(z(t.id),F(""))},handleCreateHighlight=async e=>{G?await R({type:"highlight",page_number:1,position:e,content:"Highlighted text",color:y.value}):l.error("Please log in to create highlights")},ee=u?"fixed inset-0 z-50 bg-white":r;return t.jsxs(m,{className:ee,children:[t.jsx("div",{className:"border-b p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex items-center space-x-1 border rounded-md",children:[t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{o(e=>Math.max(e-25,25))},children:t.jsx(Te,{className:"h-4 w-4"})}),t.jsxs("span",{className:"px-2 text-sm font-medium",children:[i,"%"]}),t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{o(e=>Math.min(e+25,300))},children:t.jsx(ze,{className:"h-4 w-4"})})]}),t.jsx(M,{orientation:"vertical",className:"h-6"}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(g,{variant:"select"===j?"default":"ghost",size:"sm",onClick:()=>f("select"),children:"Select"}),t.jsx(g,{variant:"highlight"===j?"default":"ghost",size:"sm",onClick:()=>f("highlight"),children:t.jsx(Ee,{className:"h-4 w-4"})}),t.jsx(g,{variant:"note"===j?"default":"ghost",size:"sm",onClick:()=>f("note"),children:t.jsx(Fe,{className:"h-4 w-4"})}),t.jsx(g,{variant:"sticky"===j?"default":"ghost",size:"sm",onClick:()=>f("sticky"),children:t.jsx(Pe,{className:"h-4 w-4"})})]}),t.jsx(M,{orientation:"vertical",className:"h-6"}),t.jsxs(L,{children:[t.jsx(q,{asChild:!0,children:t.jsxs(g,{variant:"ghost",size:"sm",children:[t.jsx(Ae,{className:"h-4 w-4 mr-2"}),t.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:y.value}})]})}),t.jsx(B,{className:"w-48",children:t.jsx("div",{className:"grid grid-cols-3 gap-2",children:gs.map(e=>t.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",style:{backgroundColor:e.value},onClick:()=>N(e)},e.value))})})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>v(!w),children:w?t.jsx(pe,{className:"h-4 w-4"}):t.jsx(Ie,{className:"h-4 w-4"})}),t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{x(e=>(e+90)%360)},children:t.jsx(Oe,{className:"h-4 w-4"})}),t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{h(e=>!e)},children:u?t.jsx(Re,{className:"h-4 w-4"}):t.jsx($e,{className:"h-4 w-4"})}),t.jsx(V,{documentId:a,showUserPresence:!0,className:"ml-auto"})]})]})}),t.jsx(p,{className:"p-0 relative",children:t.jsx("div",{ref:P,className:"relative overflow-auto",style:{height:u?"calc(100vh - 120px)":"600px"},onMouseDown:X,onMouseMove:J,onMouseUp:Z,children:t.jsxs("div",{className:"relative",style:{transform:`scale(${i/100}) rotate(${d}deg)`,transformOrigin:"top left",cursor:"select"===j?"default":"crosshair"},children:[t.jsx("iframe",{ref:A,src:`${e}#toolbar=0&navpanes=0&scrollbar=0`,className:"w-full h-[800px] border-0",title:"PDF Document"}),w&&t.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[I.map(e=>t.jsx("div",{className:"absolute pointer-events-auto",style:{left:e.position.x,top:e.position.y,width:e.position.width,height:e.position.height,backgroundColor:"highlight"===e.type?gs.find(s=>s.value===e.color)?.bg:"transparent"},children:"highlight"!==e.type&&t.jsxs(L,{children:[t.jsx(q,{asChild:!0,children:t.jsx(g,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-full",style:{backgroundColor:e.color},children:"note"===e.type?t.jsx(Fe,{className:"h-3 w-3"}):t.jsx(Pe,{className:"h-3 w-3"})})}),t.jsx(B,{className:"w-80",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(W,{className:"h-6 w-6",children:[t.jsx(Q,{src:e.user?.avatar_url}),t.jsxs(K,{className:"text-xs",children:[e.user?.first_name?.[0],e.user?.last_name?.[0]]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"text-sm font-medium",children:[e.user?.first_name," ",e.user?.last_name]}),t.jsx("span",{className:"text-xs text-gray-500",children:Je(new Date(e.created_at),{addSuffix:!0})})]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(U,{variant:"outline",className:"text-xs",children:e.type}),t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>(async e=>{await H(e)})(e.id),children:t.jsx(ve,{className:"h-4 w-4"})})]})]}),T===e.id?t.jsxs("div",{className:"space-y-2",children:[t.jsx(Y,{value:E,onChange:e=>F(e.target.value),placeholder:"Enter annotation content...",className:"min-h-[80px]"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs(g,{size:"sm",onClick:()=>(async(e,s)=>{await $(e,{content:s})&&(z(null),F(""))})(e.id,E),children:[t.jsx(Me,{className:"h-4 w-4 mr-1"}),"Save"]}),t.jsx(g,{variant:"outline",size:"sm",onClick:()=>z(null),children:"Cancel"})]})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm",children:e.content||"No content"}),t.jsx(g,{variant:"outline",size:"sm",onClick:()=>{z(e.id),F(e.content)},children:"Edit"})]})]})})]})},e.id)),C&&b&&t.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-200 bg-opacity-30 pointer-events-none",style:{left:C.x,top:C.y,width:C.width,height:C.height}})]})]})})})]})},DocumentViewer=({documentId:e,onClose:a,className:r=""})=>{const[n,i]=s.useState(null),[c,o]=s.useState(!0),[d,j]=s.useState(null),[f,y]=s.useState(!1),[N,v]=s.useState("viewer");s.useEffect(()=>{loadDocument()},[e]);const loadDocument=async()=>{try{o(!0),j(null);const s=await k.getDocument(e);i(s)}catch(s){console.error("Error loading document:",s),j(s.message||"Failed to load document"),l.error("Failed to load document")}finally{o(!1)}},handleDownload=()=>{n&&window.open(n.file_url,"_blank")};if(c)return t.jsx(m,{className:r,children:t.jsx(p,{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx(fe,{className:"h-8 w-8 animate-spin"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Loading document..."})]})})});if(d||!n)return t.jsx(m,{className:r,children:t.jsx(p,{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx(ue,{className:"h-8 w-8 text-red-500"}),t.jsx("p",{className:"text-sm text-red-600",children:d||"Document not found"}),t.jsx(g,{onClick:loadDocument,variant:"outline",size:"sm",children:"Try Again"})]})})});const b=f?"fixed inset-0 z-50 bg-white":`${r}`;return t.jsxs(m,{className:b,children:[t.jsx(x,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx(u,{className:"text-lg font-semibold truncate",children:n.filename}),t.jsxs(h,{className:"flex items-center space-x-4 mt-1",children:[t.jsx("span",{children:w[n.document_type]}),t.jsxs("span",{children:[Math.round(n.file_size/1024)," KB"]}),t.jsx("span",{children:Je(new Date(n.created_at),{addSuffix:!0})})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e){case"processing":return t.jsx(fe,{className:"h-4 w-4 animate-spin"});case"failed":return t.jsx(ue,{className:"h-4 w-4"});default:return t.jsx(me,{className:"h-4 w-4"})}})(n.processing_status),t.jsx(U,{className:(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(n.processing_status),children:_[n.processing_status]})]}),a&&t.jsx(g,{onClick:a,variant:"ghost",size:"sm",children:t.jsx(he,{className:"h-4 w-4"})})]})]})}),t.jsx(M,{}),t.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(g,{onClick:()=>{setZoom(e=>Math.max(e-25,50))},variant:"outline",size:"sm",children:t.jsx(ZoomOut,{className:"h-4 w-4"})}),t.jsxs("span",{className:"text-sm font-medium min-w-[60px] text-center",children:[zoom,"%"]}),t.jsx(g,{onClick:()=>{setZoom(e=>Math.min(e+25,200))},variant:"outline",size:"sm",children:t.jsx(ZoomIn,{className:"h-4 w-4"})}),t.jsx(g,{onClick:()=>{setRotation(e=>(e+90)%360)},variant:"outline",size:"sm",children:t.jsx(RotateCw,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(g,{onClick:handleDownload,variant:"outline",size:"sm",children:[t.jsx(we,{className:"h-4 w-4 mr-2"}),"Download"]}),t.jsxs(g,{onClick:async()=>{if(n)try{await navigator.share({title:n.filename,url:n.file_url})}catch(e){await navigator.clipboard.writeText(n.file_url),l.success("Document URL copied to clipboard")}},variant:"outline",size:"sm",children:[t.jsx(Le,{className:"h-4 w-4 mr-2"}),"Share"]}),t.jsx(g,{onClick:()=>{y(!f)},variant:"outline",size:"sm",children:t.jsx($e,{className:"h-4 w-4"})})]})]}),t.jsx(p,{className:"p-0 flex-1",children:t.jsxs(P,{value:N,onValueChange:v,children:[t.jsx("div",{className:"border-b px-4",children:t.jsxs(A,{className:"grid w-full grid-cols-3",children:[t.jsxs(I,{value:"viewer",className:"flex items-center space-x-2",children:[t.jsx(pe,{className:"h-4 w-4"}),t.jsx("span",{children:"Document"})]}),t.jsxs(I,{value:"text",className:"flex items-center space-x-2",children:[t.jsx(me,{className:"h-4 w-4"}),t.jsx("span",{children:"Text"})]}),t.jsxs(I,{value:"analysis",className:"flex items-center space-x-2",children:[t.jsx(ge,{className:"h-4 w-4"}),t.jsx("span",{children:"AI Analysis"})]})]})}),t.jsx(O,{value:"viewer",className:"mt-0",children:t.jsx("div",{className:"p-4",children:n.file_url.toLowerCase().endsWith(".pdf")?t.jsx(EnhancedPDFViewer,{documentUrl:n.file_url,documentId:n.id,className:"w-full",onAnnotationChange:e=>{console.log("Annotations updated:",e)}}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(me,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Preview not available"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"This file type cannot be previewed in the browser."}),t.jsxs(g,{onClick:handleDownload,children:[t.jsx(we,{className:"mr-2 h-4 w-4"}),"Download to view"]})]})})}),t.jsx(O,{value:"text",className:"mt-0",children:t.jsx(H,{className:f?"h-[calc(100vh-250px)]":"h-[550px]",children:t.jsx("div",{className:"p-4",children:n.ocr_text?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Extracted Text"}),n.ocr_quality_score&&t.jsxs(U,{variant:"outline",children:["Quality: ",Math.round(100*n.ocr_quality_score),"%"]})]}),t.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:t.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:n.ocr_text})})]}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(me,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No text extracted"}),t.jsx("p",{className:"text-gray-500",children:"Text extraction may still be in progress or the document may not contain readable text."})]})})})}),t.jsx(O,{value:"analysis",className:"mt-0",children:t.jsx(H,{className:f?"h-[calc(100vh-250px)]":"h-[550px]",children:t.jsx("div",{className:"p-4",children:t.jsx(DocumentAnalysisComponent,{document:n})})})})]})})]})},js=ss({query:ts().optional(),searchType:as(["combined","semantic","text"]).default("combined"),documentType:ts().optional(),status:ts().optional(),dateFrom:ts().optional(),dateTo:ts().optional(),minSize:rs().optional(),maxSize:rs().optional(),hasOcr:ns().optional()}),DocumentSearch=({onResults:e,onLoading:a,className:r=""})=>{const[n,i]=s.useState(!1),[o,d]=s.useState(!1),[b,S]=s.useState([]),[D,T]=s.useState([]),{user:z}=c(),{register:E,handleSubmit:F,watch:P,setValue:A,reset:I,formState:{errors:O}}=is({resolver:J(js),defaultValues:{hasOcr:!1}}),R=P("query"),$=s.useCallback(Ze.debounce(async s=>{if(s.query?.trim()||hasActiveFilters(s))await performSearch(s);else try{d(!0),a?.(!0);const s=await k.getDocuments();e(s)}catch(t){console.error("Error loading documents:",t),l.error("Failed to load documents")}finally{d(!1),a?.(!1)}},500),[e,a]);s.useEffect(()=>{const e=P(e=>{$(e)});return()=>e.unsubscribe()},[P,$]);const hasActiveFilters=e=>!!(e.documentType||e.status||e.dateFrom||e.dateTo||e.minSize||e.maxSize||e.hasOcr),performSearch=async s=>{if(z)try{d(!0),a?.(!0);let t=[];if(s.query?.trim()){const e=[s.query,...D.filter(e=>e!==s.query)].slice(0,5);T(e),localStorage.setItem("documentSearchHistory",JSON.stringify(e));switch(s.searchType||"combined"){case"semantic":t=(await os({query:s.query,userId:z.id,maxResults:20})).map(e=>e.document).filter(Boolean);break;case"text":t=await ls({query:s.query,userId:z.id,documentType:s.documentType,dateRange:s.dateFrom&&s.dateTo?{start:new Date(s.dateFrom),end:new Date(s.dateTo)}:void 0});break;default:t=(await cs(s.query,z.id,{documentType:s.documentType,dateRange:s.dateFrom&&s.dateTo?{start:new Date(s.dateFrom),end:new Date(s.dateTo)}:void 0,maxResults:20})).textResults}}else t=await k.getDocuments();t=applyFilters(t,s),e(t),updateActiveFilters(s)}catch(t){console.error("Search error:",t),l.error("Search failed. Please try again.")}finally{d(!1),a?.(!1)}else l.error("Please log in to search documents")},applyFilters=(e,s)=>e.filter(e=>{if(s.documentType&&e.document_type!==s.documentType)return!1;if(s.status&&e.processing_status!==s.status)return!1;if(s.dateFrom){if(new Date(e.created_at)<new Date(s.dateFrom))return!1}if(s.dateTo){const t=new Date(e.created_at),a=new Date(s.dateTo);if(a.setHours(23,59,59,999),t>a)return!1}const t=e.file_size/1024;return!(s.minSize&&t<s.minSize)&&(!(s.maxSize&&t>s.maxSize)&&!(s.hasOcr&&!e.ocr_text))}),updateActiveFilters=e=>{const s=[];e.documentType&&s.push(`Type: ${w[e.documentType]}`),e.status&&s.push(`Status: ${_[e.status]}`),e.dateFrom&&s.push(`From: ${new Date(e.dateFrom).toLocaleDateString()}`),e.dateTo&&s.push(`To: ${new Date(e.dateTo).toLocaleDateString()}`),e.minSize&&s.push(`Min: ${e.minSize}KB`),e.maxSize&&s.push(`Max: ${e.maxSize}KB`),e.hasOcr&&s.push("Has OCR text"),S(s)},clearFilters=()=>{I(),S([]),i(!1)};return s.useEffect(()=>{const e=localStorage.getItem("documentSearchHistory");if(e)try{T(JSON.parse(e))}catch(s){console.error("Error loading search history:",s)}},[]),t.jsxs(m,{className:r,children:[t.jsx(x,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(u,{className:"text-lg",children:"Search Documents"}),t.jsx(h,{children:"Find documents by name, content, or metadata"})]}),t.jsxs(g,{variant:"outline",size:"sm",onClick:()=>i(!n),children:[t.jsx(qe,{className:"h-4 w-4 mr-2"}),"Filters"]})]})}),t.jsxs(p,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx(C,{...E("query"),placeholder:"Search by filename or content...",className:"pl-10 pr-10"}),o&&t.jsx(fe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(G,{className:"text-xs text-gray-500",children:"Search type:"}),t.jsxs(j,{onValueChange:e=>A("searchType",e),children:[t.jsx(f,{className:"w-32 h-8",children:t.jsx(y,{placeholder:"Combined"})}),t.jsxs(N,{children:[t.jsx(v,{value:"combined",children:"Combined"}),t.jsx(v,{value:"semantic",children:"AI Semantic"}),t.jsx(v,{value:"text",children:"Text Only"})]})]})]})]}),D.length>0&&!R&&t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Recent:"}),D.map((e,s)=>t.jsx(g,{variant:"outline",size:"sm",className:"h-6 text-xs",onClick:()=>A("query",e),children:e},s))]}),b.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Active filters:"}),b.map((e,s)=>t.jsxs(U,{variant:"secondary",className:"text-xs",children:[e,t.jsx(g,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1",onClick:()=>{clearFilters()},children:t.jsx(he,{className:"h-3 w-3"})})]},s)),t.jsx(g,{variant:"ghost",size:"sm",className:"text-xs",onClick:clearFilters,children:"Clear all"})]}),n&&t.jsxs(t.Fragment,{children:[t.jsx(M,{}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(G,{htmlFor:"documentType",children:"Document Type"}),t.jsxs(j,{onValueChange:e=>A("documentType",e),children:[t.jsx(f,{children:t.jsx(y,{placeholder:"Any type"})}),t.jsxs(N,{children:[t.jsx(v,{value:"",children:"Any type"}),Object.entries(w).map(([e,s])=>t.jsx(v,{value:e,children:s},e))]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(G,{htmlFor:"status",children:"Processing Status"}),t.jsxs(j,{onValueChange:e=>A("status",e),children:[t.jsx(f,{children:t.jsx(y,{placeholder:"Any status"})}),t.jsxs(N,{children:[t.jsx(v,{value:"",children:"Any status"}),Object.entries(_).map(([e,s])=>t.jsx(v,{value:e,children:s},e))]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(G,{htmlFor:"dateFrom",children:"Date From"}),t.jsx(C,{...E("dateFrom"),type:"date",className:"w-full"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(G,{htmlFor:"dateTo",children:"Date To"}),t.jsx(C,{...E("dateTo"),type:"date",className:"w-full"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(G,{children:"File Size (KB)"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(C,{...E("minSize",{valueAsNumber:!0}),type:"number",placeholder:"Min",className:"w-full"}),t.jsx(C,{...E("maxSize",{valueAsNumber:!0}),type:"number",placeholder:"Max",className:"w-full"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(G,{children:"Content Options"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(X,{...E("hasOcr"),onCheckedChange:e=>A("hasOcr",!!e)}),t.jsx(G,{className:"text-sm",children:"Has extracted text"})]})]})]})]})]})]})},DocumentStatusTracker=({onDocumentSelect:e,refreshTrigger:a,className:n=""})=>{const[i,c]=s.useState([]),[o,d]=s.useState({total:0,pending:0,processing:0,completed:0,failed:0}),[j,f]=s.useState(!0),[y,N]=s.useState(!0);s.useEffect(()=>{loadDocuments()},[a]),s.useEffect(()=>{let e;return y&&(e=setInterval(()=>{(o.processing>0||o.pending>0)&&loadDocuments()},3e4)),()=>{e&&clearInterval(e)}},[y,o.processing,o.pending]);const loadDocuments=async()=>{try{f(!0),console.log("DocumentStatusTracker: Starting to load documents...");const{data:{user:e},error:s}=await r.auth.getUser();if(s)throw console.error("DocumentStatusTracker: Auth error:",s),new Error("Authentication failed");if(!e)throw console.error("DocumentStatusTracker: No authenticated user"),new Error("User not authenticated");console.log("DocumentStatusTracker: User authenticated:",e.email);const t=await k.getDocuments();console.log("DocumentStatusTracker: Loaded documents:",t.length);const a=t.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime());c(a),calculateStats(a)}catch(e){console.error("DocumentStatusTracker: Error loading documents:",e),l.error(`Failed to load document status: ${e.message}`)}finally{f(!1)}},calculateStats=e=>{const s=e.reduce((e,s)=>{switch(e.total++,s.processing_status){case"pending":e.pending++;break;case"processing":e.processing++;break;case"completed":e.completed++;break;case"failed":e.failed++}return e},{total:0,pending:0,processing:0,completed:0,failed:0});d(s)},getStatusIcon=e=>{switch(e){case"pending":return t.jsx(be,{className:"h-4 w-4 text-yellow-500"});case"processing":return t.jsx(fe,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return t.jsx(xe,{className:"h-4 w-4 text-green-500"});case"failed":return t.jsx(ue,{className:"h-4 w-4 text-red-500"});default:return t.jsx(me,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},getActiveDocuments=()=>i.filter(e=>"pending"===e.processing_status||"processing"===e.processing_status).slice(0,5),getRecentCompletedDocuments=()=>i.filter(e=>"completed"===e.processing_status).slice(0,3),getFailedDocuments=()=>i.filter(e=>"failed"===e.processing_status);return j&&0===i.length?t.jsx(m,{className:n,children:t.jsx(p,{className:"flex items-center justify-center py-8",children:t.jsx(fe,{className:"h-8 w-8 animate-spin"})})}):t.jsxs(m,{className:n,children:[t.jsx(x,{className:"pb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(u,{className:"text-lg",children:"Processing Status"}),t.jsx(h,{children:"Real-time document processing status and progress"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(g,{variant:"outline",size:"sm",onClick:()=>N(!y),className:y?"bg-green-50":"",children:[t.jsx(Se,{className:"h-4 w-4 mr-2 "+(y?"animate-spin":"")}),"Auto-refresh"]}),t.jsx(g,{onClick:loadDocuments,variant:"outline",size:"sm",children:t.jsx(Se,{className:"h-4 w-4"})})]})]})}),t.jsxs(p,{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"text-sm font-medium",children:"Overall Progress"}),t.jsxs("span",{className:"text-sm text-gray-500",children:[o.completed," of ",o.total," completed"]})]}),t.jsx(b,{value:0===o.total?0:Math.round(o.completed/o.total*100),className:"w-full"}),t.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:o.pending}),t.jsx("div",{className:"text-xs text-gray-500",children:"Pending"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.processing}),t.jsx("div",{className:"text-xs text-gray-500",children:"Processing"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.completed}),t.jsx("div",{className:"text-xs text-gray-500",children:"Completed"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.failed}),t.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]})]})]}),getActiveDocuments().length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[t.jsx(Be,{className:"h-4 w-4 mr-2"}),"Currently Processing"]}),t.jsx("div",{className:"space-y-2",children:getActiveDocuments().map(s=>t.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[getStatusIcon(s.processing_status),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),t.jsx("p",{className:"text-xs text-gray-500",children:Je(new Date(s.created_at),{addSuffix:!0})})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{className:getStatusColor(s.processing_status),children:_[s.processing_status]}),e&&t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>e(s),children:t.jsx(pe,{className:"h-4 w-4"})})]})]},s.id))})]}),getRecentCompletedDocuments().length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[t.jsx(xe,{className:"h-4 w-4 mr-2 text-green-500"}),"Recently Completed"]}),t.jsx("div",{className:"space-y-2",children:getRecentCompletedDocuments().map(s=>t.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-green-50",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx(xe,{className:"h-4 w-4 text-green-500"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Completed ",Je(new Date(s.updated_at),{addSuffix:!0})]})]})]}),e&&t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>e(s),children:t.jsx(pe,{className:"h-4 w-4"})})]},s.id))})]}),getFailedDocuments().length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("h4",{className:"text-sm font-medium flex items-center text-red-600",children:[t.jsx(ue,{className:"h-4 w-4 mr-2"}),"Failed Processing (",getFailedDocuments().length,")"]}),t.jsx("div",{className:"space-y-2",children:getFailedDocuments().slice(0,3).map(s=>t.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-red-50",children:[t.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[t.jsx(ue,{className:"h-4 w-4 text-red-500"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:s.filename}),t.jsx("p",{className:"text-xs text-red-600",children:"Processing failed"})]})]}),e&&t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>e(s),children:t.jsx(pe,{className:"h-4 w-4"})})]},s.id))})]}),0===o.total&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(me,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No documents yet"}),t.jsx("p",{className:"text-gray-500",children:"Upload your first document to start tracking processing status"})]})]})]})};const fs=new class EnhancedDocumentProcessor{constructor(){__publicField(this,"retryAttempts",3),__publicField(this,"retryDelay",1e3)}async processDocument(e,s,t={},a){const r=Date.now();try{let n,i;a?.({stage:"initializing",progress:0,message:"Initializing document processing..."}),await this.checkUsageLimits(),await this.updateDocumentStatus(s,"processing");let c=[];t.skipOCR||(n=await this.performOCR(e,a)),!t.skipAnalysis&&n&&(i=await this.performAnalysis(n.text,s,t.customAnalysisPrompt,a)),!t.skipEmbedding&&n&&(c=await this.generateEmbeddings(n.text,s,t.chunkSize,a)),a?.({stage:"finalizing",progress:95,message:"Finalizing document processing..."});const l=await this.finalizeProcessing(s,n,i,c),o=Date.now()-r;return a?.({stage:"completed",progress:100,message:"Document processing completed successfully!",details:{processingTime:o,ocrQuality:n?.qualityScore||0,textLength:n?.text.length||0,embeddingChunks:c.length}}),{document:l,ocrResult:n,analysis:i,embeddingIds:c,processingTime:o,qualityMetrics:{ocrQuality:n?.qualityScore||0,textLength:n?.text.length||0,embeddingChunks:c.length}}}catch(n){const e=Date.now()-r;throw await this.updateDocumentStatus(s,"failed"),a?.({stage:"error",progress:0,message:"Document processing failed",error:n instanceof Error?n.message:"Unknown error",details:{processingTime:e}}),n}}async checkUsageLimits(){const e=await Z.checkUsageLimit("ai_query");if(!e.allowed)throw new Error(`AI processing limit exceeded. You have used ${e.current}/${e.limit} AI queries this month. Please upgrade your plan to continue.`)}async performOCR(e,s){return s?.({stage:"ocr",progress:10,message:"Extracting text from document..."}),await this.withRetry(async()=>{const t=await extractTextFromDocument(e,e=>{s?.({stage:"ocr",progress:10+.3*e.progress,message:e.message||"Extracting text..."})}),a=validateOCRQuality(t),r=cleanExtractedText(t.text);return{...t,text:r,qualityScore:a.qualityScore}},"OCR processing")}async performAnalysis(e,s,t,a){return a?.({stage:"analysis",progress:40,message:"Analyzing document content with AI..."}),await this.withRetry(async()=>{const a=await n(e);return await Z.incrementUsage("ai_query",s,{operation:"document_analysis",text_length:e.length,custom_prompt:!!t}),a},"AI analysis")}async generateEmbeddings(e,s,t=1e3,a){return a?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),await this.withRetry(async()=>{const n=this.splitTextIntoChunks(e,t),c=[];for(let e=0;e<n.length;e++){const t=n[e],l=await i(t),{data:o,error:d}=await r.from("document_embeddings").insert({document_id:s,chunk_text:t,chunk_index:e,embedding:l,metadata:{chunk_size:t.length,total_chunks:n.length}}).select("id").single();if(d)throw d;c.push(o.id);const m=70+(e+1)/n.length*20;a?.({stage:"embedding",progress:m,message:`Generated embedding ${e+1}/${n.length}...`})}return c},"Embedding generation")}async finalizeProcessing(e,s,t,a){const{data:n,error:i}=await r.from("uploaded_documents").update({processing_status:"completed",ocr_text:s?.text,ocr_quality_score:s?.qualityScore,document_structure:{analysis:t,ocrQuality:s?.qualityScore,embeddingCount:a?.length||0,processedAt:(new Date).toISOString()},updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(i)throw i;return n}async updateDocumentStatus(e,s){const{error:t}=await r.from("uploaded_documents").update({processing_status:s,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t}async withRetry(e,s){let t;for(let r=1;r<=this.retryAttempts;r++)try{return await e()}catch(a){if(t=a instanceof Error?a:new Error("Unknown error"),r===this.retryAttempts)throw new Error(`${s} failed after ${this.retryAttempts} attempts: ${t.message}`);await new Promise(e=>setTimeout(e,this.retryDelay*r))}throw t}splitTextIntoChunks(e,s=1e3){const t=[],a=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let r="";for(const n of a){const e=n.trim();r.length+e.length+1<=s?r+=(r?". ":"")+e:(r&&t.push(r+"."),r=e)}return r&&t.push(r+"."),t}};function useUsageLimit(e){return ds({queryKey:["usage-limit",e],queryFn:()=>Z.checkUsageLimit(e),staleTime:6e4,refetchOnWindowFocus:!1})}const EnhancedDocumentUpload=({onUploadComplete:e,maxFiles:a=5,allowedTypes:r=["pdf","doc","docx","txt"]})=>{const{profile:n}=c(),{uploadAndProcessDocument:i,uploadState:l,resetUploadState:S,isActive:D}=function useDocumentUpload(){const[e,t]=s.useState({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null}),a=ms(),{toast:r}=ee();return{uploadAndProcessDocument:s.useCallback(async(e,s,n={})=>{try{t({isUploading:!0,isProcessing:!1,progress:0,status:null,error:null});const i=await k.uploadDocument(e,s);t(e=>({...e,isUploading:!1,isProcessing:!0,progress:10}));const c=await fs.processDocument(e,i.id,n,e=>{t(s=>({...s,progress:e.progress,status:e,error:e.error||null}))});return t(e=>({...e,isProcessing:!1,progress:100,error:null})),a.invalidateQueries({queryKey:["documents"]}),a.invalidateQueries({queryKey:["document",i.id]}),r({title:"Document Processed",description:`${e.name} has been successfully uploaded and processed.`}),c}catch(i){const e=i instanceof Error?i.message:"Upload failed";throw t(s=>({...s,isUploading:!1,isProcessing:!1,error:e})),r({title:"Upload Failed",description:e,variant:"destructive"}),i}},[a,r]),uploadState:e,resetUploadState:s.useCallback(()=>{t({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null})},[]),isActive:e.isUploading||e.isProcessing}}(),{canUploadDocuments:C,canUseAI:_,documentUsage:T}=function useFeatureAvailability(){const{data:e}=useUsageLimit("ai_query"),{data:s}=useUsageLimit("document_upload"),{data:t}=useUsageLimit("custom_document");return{canUseAI:e?.allowed??!1,canUploadDocuments:s?.allowed??!1,canDownloadCustomDocuments:t?.allowed??!1,aiUsage:e,documentUsage:s,customDocUsage:t,getUsagePercentage:e=>e&&-1!==e.limit&&e.limit>0?e.current/e.limit*100:0,isNearLimit:(e,s=80)=>!(!e||-1===e.limit)&&(e.limit>0?e.current/e.limit*100:0)>=s}}(),[z,E]=s.useState([]),[F,P]=s.useState(!1),[A,I]=s.useState({skipOCR:!1,skipAnalysis:!1,skipEmbedding:!1,chunkSize:1e3,retryAttempts:3}),O=s.useCallback(async e=>{if(!C)return void toast.warning("Upload not available. Please check your subscription or try again later.");const s=n?.subscription_tier?o.maxSize[n.subscription_tier]:o.maxSize.free,t=e.filter(e=>!(e.size>s)).map(e=>({file:e,id:crypto.randomUUID(),documentType:"other",options:{...A}}));E(e=>[...e,...t].slice(0,a))},[n,a,C,A]),{getRootProps:R,getInputProps:$,isDragActive:M}=d({onDrop:O,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:a,disabled:D||!C});return t.jsxs(m,{className:"w-full",children:[t.jsxs(x,{children:[t.jsxs(u,{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Enhanced Document Upload"}),t.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>P(!F),children:[t.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Advanced"]})]}),t.jsx(h,{children:"Upload and process your legal documents with AI-powered analysis"}),T&&t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[t.jsxs("span",{children:["Usage: ",T.current,"/",-1===T.limit?"":T.limit," uploads"]}),T.limit>0&&t.jsx(b,{value:T.percentage,className:"w-24 h-2"})]})]}),t.jsxs(p,{className:"space-y-6",children:[F&&t.jsxs(m,{children:[t.jsx(x,{children:t.jsx(u,{className:"text-lg",children:"Processing Options"})}),t.jsxs(p,{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(se,{id:"skip-ocr",checked:!A.skipOCR,onCheckedChange:e=>I(s=>({...s,skipOCR:!e}))}),t.jsx(G,{htmlFor:"skip-ocr",children:"Text Extraction"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(se,{id:"skip-analysis",checked:!A.skipAnalysis,onCheckedChange:e=>I(s=>({...s,skipAnalysis:!e})),disabled:!_}),t.jsx(G,{htmlFor:"skip-analysis",children:"AI Analysis"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(se,{id:"skip-embedding",checked:!A.skipEmbedding,onCheckedChange:e=>I(s=>({...s,skipEmbedding:!e})),disabled:!_}),t.jsx(G,{htmlFor:"skip-embedding",children:"Search Indexing"})]})]}),void 0!==A.customAnalysisPrompt&&t.jsxs("div",{children:[t.jsx(G,{htmlFor:"custom-prompt",children:"Custom Analysis Prompt"}),t.jsx(Y,{id:"custom-prompt",placeholder:"Enter custom instructions for AI analysis...",value:A.customAnalysisPrompt||"",onChange:e=>I(s=>({...s,customAnalysisPrompt:e.target.value}))})]})]})]}),t.jsxs("div",{...R(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${M?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${D||!C?"opacity-50 cursor-not-allowed":""}`,children:[t.jsx("input",{...$()}),t.jsx(de,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),M?t.jsx("p",{className:"text-blue-600",children:"Drop the files here..."}):t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 mb-2",children:C?"Drag & drop files here, or click to select":"Upload limit reached for your subscription tier"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((n?.subscription_tier?o.maxSize[n.subscription_tier]:o.maxSize.free)/1024/1024),"MB"]})]})]}),z.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-medium",children:"Files to Upload"}),z.map(e=>t.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[t.jsx(me,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium truncate",children:e.file.name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[(e.file.size/1024/1024).toFixed(2)," MB"]})]}),t.jsxs(j,{value:e.documentType,onValueChange:s=>{return t=e.id,a=s,void E(e=>e.map(e=>e.id===t?{...e,documentType:a}:e));var t,a},children:[t.jsx(f,{className:"w-32",children:t.jsx(y,{})}),t.jsx(N,{children:Object.entries(w).map(([e,s])=>t.jsx(v,{value:e,children:s},e))})]}),t.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void E(e=>e.filter(e=>e.id!==s));var s},disabled:D,children:t.jsx(he,{className:"h-4 w-4"})})]},e.id))]}),D&&l.status&&t.jsx(m,{children:t.jsx(p,{className:"pt-6",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:(e=>{switch(e){case"completed":return"text-green-600";case"error":return"text-red-600";case"analysis":return"text-blue-600";case"embedding":return"text-purple-600";default:return"text-gray-600"}})(l.status.stage),children:(e=>{switch(e){case"ocr":return t.jsx(pe,{className:"h-4 w-4"});case"analysis":return t.jsx(ge,{className:"h-4 w-4"});case"embedding":return t.jsx(je,{className:"h-4 w-4"});case"completed":return t.jsx(xe,{className:"h-4 w-4"});case"error":return t.jsx(ue,{className:"h-4 w-4"});default:return t.jsx(be,{className:"h-4 w-4"})}})(l.status.stage)}),t.jsx("span",{className:"font-medium capitalize",children:l.status.stage.replace("_"," ")})]}),t.jsxs(U,{variant:"outline",children:[Math.round(l.progress),"%"]})]}),t.jsx(b,{value:l.progress,className:"w-full"}),t.jsx("p",{className:"text-sm text-gray-600",children:l.status.message}),l.status.details&&t.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[l.status.details.ocrQuality&&t.jsxs("p",{children:["OCR Quality: ",Math.round(100*l.status.details.ocrQuality),"%"]}),l.status.details.textLength&&t.jsxs("p",{children:["Text Length: ",l.status.details.textLength.toLocaleString()," characters"]}),l.status.details.embeddingChunks&&t.jsxs("p",{children:["Embedding Chunks: ",l.status.details.embeddingChunks]})]}),l.error&&t.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:l.error})]})})}),z.length>0&&!D&&t.jsxs(g,{onClick:async()=>{for(const t of z)try{const s=await i(t.file,t.documentType,t.options);e&&e(s.document.id)}catch(s){console.error("Upload failed:",s)}E([]),S()},className:"w-full",disabled:!C,children:[t.jsx(de,{className:"h-4 w-4 mr-2"}),"Upload and Process ",z.length," File",z.length>1?"s":""]})]})]})},DocumentManagementDashboard=()=>{const[e,n]=s.useState("grid"),[i,c]=s.useState(new Set),[l,o]=s.useState("created_at"),[d,x]=s.useState("desc"),[u,h]=s.useState({status:"all",type:"all",dateRange:"all"}),[b,S]=s.useState(!1),[D,U]=s.useState(null),{data:T=[],isLoading:z,error:E}=function useDocuments(){return ds({queryKey:["documents"],queryFn:()=>k.getDocuments(),staleTime:3e5})}(),{searchQuery:F,setSearchQuery:P,searchResults:A,isSearching:I}=function useDocumentSearch(){const[e,t]=s.useState(""),a=ds({queryKey:["documents","search",e],queryFn:async()=>{if(!e||e.length<3)return[];try{return await k.searchDocuments(e)}catch(E){return console.error("Search error:",E),[]}},enabled:e.length>2,staleTime:12e4});return{searchQuery:e,setSearchQuery:t,searchResults:a.data||[],isSearching:a.isLoading,searchError:a.error}}(),O=function useDocumentDeletion(){const e=ms(),{toast:s}=ee();return xs({mutationFn:e=>k.deleteDocument(e),onSuccess:(t,a)=>{e.removeQueries({queryKey:["document",a]}),e.invalidateQueries({queryKey:["documents"]}),s({title:"Document Deleted",description:"The document has been successfully deleted."})},onError:e=>{s({title:"Deletion Failed",description:e instanceof Error?e.message:"Failed to delete document",variant:"destructive"})}})}(),R=function useDocumentDownload(){const{toast:e}=ee();return xs({mutationFn:({documentId:e,trackUsage:s=!0})=>k.downloadDocument(e,s),onSuccess:s=>{const t=URL.createObjectURL(s.data),a=document.createElement("a");a.href=t,a.download=s.filename,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),e({title:"Download Started",description:`Downloading ${s.filename}...`})},onError:s=>{e({title:"Download Failed",description:s instanceof Error?s.message:"Failed to download document",variant:"destructive"})}})}(),{bulkDelete:$,isBulkDeleting:M}=function useBulkDocumentOperations(){const e=ms(),{toast:s}=ee(),t=xs({mutationFn:async e=>{const s=await Promise.allSettled(e.map(e=>k.deleteDocument(e))),t=s.filter(e=>"rejected"===e.status).length;return{succeeded:s.filter(e=>"fulfilled"===e.status).length,failed:t,total:e.length}},onSuccess:t=>{e.invalidateQueries({queryKey:["documents"]}),t.failed>0?s({title:"Bulk Delete Completed",description:`${t.succeeded} documents deleted, ${t.failed} failed.`,variant:"destructive"}):s({title:"Bulk Delete Completed",description:`Successfully deleted ${t.succeeded} documents.`})},onError:e=>{s({title:"Bulk Delete Failed",description:e instanceof Error?e.message:"Failed to delete documents",variant:"destructive"})}});return{bulkDelete:t,isBulkDeleting:t.isPending}}(),{data:L,error:q}=function useDocumentStats(){return ds({queryKey:["documents","stats"],queryFn:async()=>{try{const e=await k.getDocuments(),s=await k.getDocumentUsage();return{total:e.length,byStatus:e.reduce((e,s)=>(e[s.processing_status]=(e[s.processing_status]||0)+1,e),{}),byType:e.reduce((e,s)=>(e[s.document_type]=(e[s.document_type]||0)+1,e),{}),totalSize:e.reduce((e,s)=>e+s.file_size,0),usage:s}}catch(E){return console.error("Error fetching document stats:",E),{total:0,byStatus:{},byType:{},totalSize:0,usage:null}}},staleTime:6e5})}();a.useEffect(()=>{E&&console.error("Documents loading error:",E),q&&console.error("Stats loading error:",q)},[E,q]),a.useEffect(()=>{(async()=>{try{const{data:{user:e},error:s}=await r.auth.getUser();console.log("Current user:",e),console.log("Auth error:",s);let t=null;if(e){const{data:e,error:s}=await r.from("uploaded_documents").select("count").limit(1);console.log("Direct API test:",{data:e,error:s}),t={data:e,error:s}}U({user:e?{id:e.id,email:e.email}:null,authError:s,apiTestResult:t,timestamp:(new Date).toISOString()})}catch(e){console.error("Debug auth error:",e),U({error:e instanceof Error?e.message:"Unknown error",timestamp:(new Date).toISOString()})}})()},[]);const B=s.useMemo(()=>{try{let e=F.length>2?A:T;if(!Array.isArray(e))return console.warn("Documents result is not an array:",e),[];if("all"!==u.status&&(e=e.filter(e=>e?.processing_status===u.status)),"all"!==u.type&&(e=e.filter(e=>e?.document_type===u.type)),"all"!==u.dateRange){const s=new Date,t=new Date;switch(u.dateRange){case"today":t.setHours(0,0,0,0);break;case"week":t.setDate(s.getDate()-7);break;case"month":t.setMonth(s.getMonth()-1)}e=e.filter(e=>e?.created_at&&new Date(e.created_at)>=t)}return e.sort((e,s)=>{if(!e||!s)return 0;let t=e[l],a=s[l];return"created_at"===l?(t=new Date(t).getTime(),a=new Date(a).getTime()):"file_size"===l?(t=Number(t)||0,a=Number(a)||0):(t=String(t||"").toLowerCase(),a=String(a||"").toLowerCase()),"asc"===d?t<a?-1:t>a?1:0:t>a?-1:t<a?1:0}),e}catch(e){return console.error("Error filtering documents:",e),[]}},[T,A,F,u,l,d]),getStatusIcon=e=>{switch(e){case"completed":return t.jsx(xe,{className:"h-4 w-4 text-green-500"});case"processing":return t.jsx(be,{className:"h-4 w-4 text-blue-500"});case"failed":return t.jsx(ue,{className:"h-4 w-4 text-red-500"});default:return t.jsx(be,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return b?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Upload Documents"}),t.jsx(g,{variant:"outline",onClick:()=>S(!1),children:"Back to Dashboard"})]}),t.jsx(EnhancedDocumentUpload,{onUploadComplete:()=>S(!1)})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Document Management"}),t.jsx("p",{className:"text-gray-600",children:"Manage and organize your legal documents"})]}),t.jsxs(g,{onClick:()=>S(!0),children:[t.jsx(de,{className:"h-4 w-4 mr-2"}),"Upload Documents"]})]}),L&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx(m,{children:t.jsx(p,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(me,{className:"h-5 w-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Documents"}),t.jsx("p",{className:"text-2xl font-bold",children:L.total})]})]})})}),t.jsx(m,{children:t.jsx(p,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(xe,{className:"h-5 w-5 text-green-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Processed"}),t.jsx("p",{className:"text-2xl font-bold",children:L.byStatus.completed||0})]})]})})}),t.jsx(m,{children:t.jsx(p,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(be,{className:"h-5 w-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Processing"}),t.jsx("p",{className:"text-2xl font-bold",children:L.byStatus.processing||0})]})]})})}),t.jsx(m,{children:t.jsx(p,{className:"p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(We,{className:"h-5 w-5 text-purple-500"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Size"}),t.jsxs("p",{className:"text-2xl font-bold",children:[(L.totalSize/1024/1024).toFixed(1),"MB"]})]})]})})})]}),t.jsx(m,{children:t.jsx(p,{className:"p-4",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),t.jsx(C,{placeholder:"Search documents...",value:F,onChange:e=>P(e.target.value),className:"pl-10"})]})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(j,{value:u.status,onValueChange:e=>h(s=>({...s,status:e})),children:[t.jsx(f,{className:"w-32",children:t.jsx(y,{placeholder:"Status"})}),t.jsxs(N,{children:[t.jsx(v,{value:"all",children:"All Status"}),Object.entries(_).map(([e,s])=>t.jsx(v,{value:e,children:s},e))]})]}),t.jsxs(j,{value:u.type,onValueChange:e=>h(s=>({...s,type:e})),children:[t.jsx(f,{className:"w-32",children:t.jsx(y,{placeholder:"Type"})}),t.jsxs(N,{children:[t.jsx(v,{value:"all",children:"All Types"}),Object.entries(w).map(([e,s])=>t.jsx(v,{value:e,children:s},e))]})]}),t.jsxs(j,{value:l,onValueChange:e=>o(e),children:[t.jsx(f,{className:"w-32",children:t.jsx(y,{placeholder:"Sort by"})}),t.jsxs(N,{children:[t.jsx(v,{value:"created_at",children:"Date"}),t.jsx(v,{value:"filename",children:"Name"}),t.jsx(v,{value:"file_size",children:"Size"}),t.jsx(v,{value:"processing_status",children:"Status"})]})]}),t.jsx(g,{variant:"outline",size:"sm",onClick:()=>x("asc"===d?"desc":"asc"),children:"asc"===d?"":""})]}),t.jsxs("div",{className:"flex border rounded-md",children:[t.jsx(g,{variant:"grid"===e?"default":"ghost",size:"sm",onClick:()=>n("grid"),children:t.jsx(Qe,{className:"h-4 w-4"})}),t.jsx(g,{variant:"list"===e?"default":"ghost",size:"sm",onClick:()=>n("list"),children:t.jsx(Ke,{className:"h-4 w-4"})})]})]})})}),i.size>0&&t.jsx(m,{children:t.jsx(p,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-sm text-gray-600",children:[i.size," document",i.size>1?"s":""," selected"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(g,{variant:"destructive",size:"sm",onClick:async()=>{0!==i.size&&(await $.mutateAsync(Array.from(i)),c(new Set))},disabled:M,children:[t.jsx(ve,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),t.jsx(g,{variant:"outline",size:"sm",onClick:()=>c(new Set),children:"Clear Selection"})]})]})})}),z?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{children:"Loading documents..."})}):E?t.jsx("div",{className:"text-center py-8 text-red-600",children:t.jsxs("p",{children:["Error loading documents: ",E.message]})}):0===B.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:F?"No documents found matching your search.":"No documents uploaded yet."}),!F&&t.jsx(g,{className:"mt-4",onClick:()=>S(!0),children:"Upload Your First Document"})]}):t.jsxs("div",{className:"grid"===e?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-2",children:["list"===e&&t.jsxs("div",{className:"flex items-center space-x-3 p-3 border-b",children:[t.jsx(X,{checked:i.size===B.length,onCheckedChange:()=>{i.size===B.length?c(new Set):c(new Set(B.map(e=>e.id)))}}),t.jsx("span",{className:"text-sm font-medium",children:"Select All"})]}),B.map(s=>s&&s.id?t.jsx(DocumentCard,{document:s,viewMode:e,isSelected:i.has(s.id),onToggleSelection:()=>(e=>{const s=new Set(i);s.has(e)?s.delete(e):s.add(e),c(s)})(s.id),onDownload:()=>{return e=s.id,void R.mutate({documentId:e});var e},onDelete:()=>{return e=s.id,void O.mutate(e);var e},getStatusIcon:getStatusIcon,getStatusColor:getStatusColor},s.id):(console.warn("Invalid document found:",s),null)).filter(Boolean)]})]})},DocumentCard=({document:e,viewMode:s,isSelected:a,onToggleSelection:r,onDownload:n,onDelete:i,getStatusIcon:c,getStatusColor:l})=>{if(!e)return console.warn("DocumentCard received null/undefined document"),null;const o={id:e.id||"",filename:e.filename||"Unknown File",document_type:e.document_type||"other",file_size:e.file_size||0,created_at:e.created_at||(new Date).toISOString(),processing_status:e.processing_status||"pending"};return"list"===s?t.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50",children:[t.jsx(X,{checked:a,onCheckedChange:r}),t.jsx(me,{className:"h-5 w-5 text-gray-400"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-medium truncate",children:o.filename}),t.jsxs("p",{className:"text-sm text-gray-500",children:[w[o.document_type]||"Unknown"," ",(o.file_size/1024/1024).toFixed(2)," MB ",Je(new Date(o.created_at),{addSuffix:!0})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(U,{className:l(o.processing_status),children:[c(o.processing_status),t.jsx("span",{className:"ml-1",children:_[o.processing_status]||"Unknown"})]}),t.jsxs(T,{children:[t.jsx(z,{asChild:!0,children:t.jsx(g,{variant:"ghost",size:"sm",children:t.jsx(Ye,{className:"h-4 w-4"})})}),t.jsxs(E,{children:[t.jsxs(F,{onClick:n,children:[t.jsx(we,{className:"h-4 w-4 mr-2"}),"Download"]}),t.jsx(te,{}),t.jsxs(F,{onClick:i,className:"text-red-600",children:[t.jsx(ve,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}):t.jsx(m,{className:"cursor-pointer transition-colors "+(a?"ring-2 ring-blue-500":""),children:t.jsxs(p,{className:"p-4",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsx(X,{checked:a,onCheckedChange:r}),t.jsxs(T,{children:[t.jsx(z,{asChild:!0,children:t.jsx(g,{variant:"ghost",size:"sm",children:t.jsx(Ye,{className:"h-4 w-4"})})}),t.jsxs(E,{children:[t.jsxs(F,{onClick:n,children:[t.jsx(we,{className:"h-4 w-4 mr-2"}),"Download"]}),t.jsx(te,{}),t.jsxs(F,{onClick:i,className:"text-red-600",children:[t.jsx(ve,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),t.jsxs("div",{className:"text-center mb-4",children:[t.jsx(me,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),t.jsx("h3",{className:"font-medium truncate",title:o.filename,children:o.filename})]}),t.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Type:"}),t.jsx("span",{children:w[o.document_type]||"Unknown"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Size:"}),t.jsxs("span",{children:[(o.file_size/1024/1024).toFixed(2)," MB"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Uploaded:"}),t.jsx("span",{children:Je(new Date(o.created_at),{addSuffix:!0})})]})]}),t.jsx("div",{className:"mt-3",children:t.jsxs(U,{className:`w-full justify-center ${l(o.processing_status)}`,children:[c(o.processing_status),t.jsx("span",{className:"ml-1",children:_[o.processing_status]||"Unknown"})]})})]})})},DatabaseTest=()=>{const[e,a]=s.useState([]),[n,i]=s.useState(!1),runTests=async()=>{i(!0);const e=[];try{const{data:s,error:t}=await r.from("profiles").select("count").limit(1);e.push({name:"Supabase Connection",status:t?"error":"success",message:t?t.message:"Connected successfully",details:{data:s,error:t}})}catch(n){e.push({name:"Supabase Connection",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:s,error:t}=await r.from("uploaded_documents").select("id, filename, processing_status").limit(5);e.push({name:"uploaded_documents Table",status:t?"error":"success",message:t?t.message:`Found ${s?.length||0} documents`,details:{data:s,error:t}})}catch(n){e.push({name:"uploaded_documents Table",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:{user:s},error:t}=await r.auth.getUser();e.push({name:"Authentication",status:t?"error":"success",message:t?t.message:s?`Logged in as ${s.email}`:"Not logged in",details:{user:s,error:t}})}catch(n){e.push({name:"Authentication",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:s,error:t}=await r.storage.listBuckets(),a=s?.find(e=>"documents"===e.name);e.push({name:"Storage Bucket",status:t?"error":a?"success":"error",message:t?t.message:a?"Documents bucket exists":"Documents bucket not found",details:{buckets:s,error:t}})}catch(n){e.push({name:"Storage Bucket",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}const s={VITE_SUPABASE_URL:"https://kvlaydeyqidlfpfutbmp.supabase.co",VITE_SUPABASE_ANON_KEY:"***",VITE_APP_URL:"https://craftchatbot.com"},t=Object.entries(s).filter(([e,s])=>!s);e.push({name:"Environment Variables",status:t.length>0?"error":"success",message:t.length>0?`Missing: ${t.map(([e])=>e).join(", ")}`:"All required variables present",details:s}),a(e),i(!1)};s.useEffect(()=>{runTests()},[]);const getStatusIcon=e=>{switch(e){case"success":return t.jsx(xe,{className:"h-5 w-5 text-green-500"});case"error":return t.jsx(He,{className:"h-5 w-5 text-red-500"});case"pending":return t.jsx(ue,{className:"h-5 w-5 text-yellow-500"})}};return t.jsxs(m,{className:"max-w-4xl mx-auto",children:[t.jsx(x,{children:t.jsxs(u,{className:"flex items-center justify-between",children:["Database Connection Test",t.jsxs(g,{onClick:runTests,disabled:n,size:"sm",children:[t.jsx(Se,{className:"h-4 w-4 mr-2 "+(n?"animate-spin":"")}),n?"Running...":"Run Tests"]})]})}),t.jsx(p,{children:t.jsx("div",{className:"space-y-4",children:e.map((e,s)=>t.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg",children:[getStatusIcon(e.status),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-medium",children:e.name}),t.jsx("p",{className:"text-sm text-gray-600",children:e.message}),!1]})]},s))})})]})},UploadDiagnostics=()=>{const[e,a]=s.useState([]),[n,i]=s.useState(!1),{user:l,profile:o}=c(),getStatusColor=e=>{switch(e){case"success":return"bg-green-100 text-green-800";case"warning":return"bg-yellow-100 text-yellow-800";case"error":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return t.jsxs(m,{className:"w-full max-w-4xl mx-auto",children:[t.jsxs(x,{children:[t.jsx(u,{children:"Upload Diagnostics"}),t.jsx(g,{onClick:async()=>{i(!0);const e=[];try{const{data:{session:s},error:t}=await r.auth.getSession();e.push({category:"Authentication",name:"User Session",status:s?.user?"success":"error",message:s?.user?`Authenticated as ${s.user.email}`:"No active session",details:{user:s?.user,error:t},fix:s?.user?void 0:"Please sign in to upload documents"})}catch(s){e.push({category:"Authentication",name:"User Session",status:"error",message:`Session check failed: ${s instanceof Error?s.message:"Unknown error"}`,details:s,fix:"Check authentication configuration"})}e.push({category:"User",name:"Profile Data",status:o?"success":"warning",message:o?`Profile loaded: ${o.subscription_tier} tier`:"Profile not loaded",details:o,fix:o?void 0:"Profile may still be loading or missing"});try{const{data:s,error:t}=await r.storage.from("documents").list("",{limit:1});e.push({category:"Storage",name:"Documents Bucket",status:t?"error":"success",message:t?`Bucket access failed: ${t.message}`:"Bucket accessible",details:{data:s,error:t},fix:t?"Check storage bucket permissions and RLS policies":void 0})}catch(s){e.push({category:"Storage",name:"Documents Bucket",status:"error",message:`Storage check failed: ${s instanceof Error?s.message:"Unknown error"}`,details:s})}try{const{data:s,error:t}=await r.from("uploaded_documents").select("count").limit(1);e.push({category:"Database",name:"Documents Table",status:t?"error":"success",message:t?`Table access failed: ${t.message}`:"Table accessible",details:{data:s,error:t},fix:t?"Check RLS policies for uploaded_documents table":void 0})}catch(s){e.push({category:"Database",name:"Documents Table",status:"error",message:`Database check failed: ${s instanceof Error?s.message:"Unknown error"}`,details:s})}if(l)try{const s=new File(["test content"],"test.txt",{type:"text/plain"}),t=`${l.id}/test-${Date.now()}.txt`,{error:a}=await r.storage.from("documents").upload(t,s);a||await r.storage.from("documents").remove([t]),e.push({category:"Upload",name:"Test File Upload",status:a?"error":"success",message:a?`Upload failed: ${a.message}`:"Upload successful",details:a,fix:a?"Check storage permissions and file size limits":void 0})}catch(s){e.push({category:"Upload",name:"Test File Upload",status:"error",message:`Upload test failed: ${s instanceof Error?s.message:"Unknown error"}`,details:s})}else e.push({category:"Upload",name:"Test File Upload",status:"warning",message:"Skipped - no authenticated user",fix:"Sign in to test file upload"});a(e),i(!1)},disabled:n,children:n?"Running Diagnostics...":"Run Upload Diagnostics"})]}),t.jsx(p,{children:e.length>0&&t.jsx("div",{className:"space-y-4",children:e.map((e,s)=>t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:e.category}),t.jsx("span",{className:"text-gray-600",children:""}),t.jsx("span",{children:e.name})]}),t.jsx(U,{className:getStatusColor(e.status),children:e.status})]}),t.jsx("p",{className:"text-sm text-gray-700 mb-2",children:e.message}),e.fix&&t.jsxs("p",{className:"text-sm text-blue-600 bg-blue-50 p-2 rounded",children:[" ",e.fix]}),e.details&&t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer",children:"View Details"}),t.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded mt-1 overflow-auto",children:JSON.stringify(e.details,null,2)})]})]},s))})})]})},Documents=()=>{const{profile:e,forceRefreshProfile:a}=ae(),r=re(),[n,i]=s.useState(null),[c,l]=s.useState([]),[o,d]=s.useState(!1),[j,f]=s.useState(0),[y,N]=s.useState("overview"),w=s.useCallback(e=>{i(e)},[]),v=s.useCallback(()=>{i(null)},[]),b=s.useCallback(e=>{f(e=>e+1)},[]),S=s.useCallback(e=>{l(e)},[]),D=s.useCallback(e=>{d(e)},[]);return t.jsx(ne,{children:t.jsx(ie,{children:t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx("header",{className:"bg-white shadow",children:t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"flex justify-between items-center py-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(g,{variant:"outline",size:"sm",onClick:()=>r("/"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Go to Homepage",children:[t.jsx(Ge,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Home"})]}),t.jsxs(g,{variant:"outline",size:"sm",onClick:()=>r("/dashboard"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Back to Dashboard",children:[t.jsx(Xe,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})]}),t.jsxs("div",{className:"hidden md:block",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Document Management"}),t.jsx("p",{className:"text-gray-600",children:"Upload, process, and manage your legal documents with AI"})]}),t.jsx("div",{className:"md:hidden",children:t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Documents"})})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Subscription"}),t.jsx("p",{className:"font-medium capitalize",children:e?.subscription_tier||"Free"}),t.jsxs("p",{className:"text-xs text-gray-400",children:["Debug: ",JSON.stringify({tier:e?.subscription_tier,email:e?.email})]})]}),t.jsxs(g,{variant:"outline",size:"sm",onClick:async()=>{try{await a(),console.log("Profile refreshed successfully")}catch(e){console.error("Failed to refresh profile:",e)}},className:"flex items-center space-x-1",title:"Refresh subscription status",children:[t.jsx(Be,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]})]})]})})}),t.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:t.jsx("div",{className:"px-4 py-6 sm:px-0",children:n?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs(g,{onClick:v,variant:"outline",size:"sm",children:[t.jsx(he,{className:"h-4 w-4 mr-2"}),"Close Viewer"]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Document Viewer"}),t.jsxs("p",{className:"text-gray-600",children:["Viewing: ",n.filename]})]})]})}),t.jsx(DocumentViewer,{documentId:n.id,onClose:v,className:"w-full"})]}):t.jsxs(P,{value:y,onValueChange:N,className:"space-y-6",children:[t.jsxs(A,{className:"grid w-full grid-cols-6",children:[t.jsxs(I,{value:"overview",className:"flex items-center space-x-2",children:[t.jsx(We,{className:"h-4 w-4"}),t.jsx("span",{children:"Overview"})]}),t.jsxs(I,{value:"upload",className:"flex items-center space-x-2",children:[t.jsx(de,{className:"h-4 w-4"}),t.jsx("span",{children:"Upload"})]}),t.jsxs(I,{value:"search",className:"flex items-center space-x-2",children:[t.jsx(ye,{className:"h-4 w-4"}),t.jsx("span",{children:"Search"})]}),t.jsxs(I,{value:"manage",className:"flex items-center space-x-2",children:[t.jsx(Ke,{className:"h-4 w-4"}),t.jsx("span",{children:"Manage"})]}),t.jsxs(I,{value:"enhanced",className:"flex items-center space-x-2",children:[t.jsx(Be,{className:"h-4 w-4"}),t.jsx("span",{children:"Enhanced"})]}),t.jsxs(I,{value:"debug",className:"flex items-center space-x-2",children:[t.jsx(ue,{className:"h-4 w-4"}),t.jsx("span",{children:"Debug"})]})]}),t.jsxs(O,{value:"overview",className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsx(DocumentStatusTracker,{onDocumentSelect:w,refreshTrigger:j})}),t.jsx("div",{children:t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"text-lg flex items-center",children:[t.jsx(de,{className:"h-5 w-5 mr-2"}),"Quick Upload"]}),t.jsx(h,{children:"Upload documents for AI processing"})]}),t.jsx(p,{children:t.jsx(DocumentUploadWrapper,{onUploadComplete:b,maxFiles:3})})]})})]}),t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"text-lg flex items-center",children:[t.jsx(me,{className:"h-5 w-5 mr-2"}),"Recent Documents"]}),t.jsx(h,{children:"Your most recently uploaded documents"})]}),t.jsx(p,{children:t.jsx(DocumentList,{onDocumentSelect:w,refreshTrigger:j})})]})]}),t.jsx(O,{value:"upload",className:"space-y-6",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsx(DocumentUploadWrapper,{onUploadComplete:b,maxFiles:10})}),t.jsx("div",{children:t.jsx(DocumentStatusTracker,{onDocumentSelect:w,refreshTrigger:j})})]})}),t.jsx(O,{value:"search",className:"space-y-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(DocumentSearch,{onResults:S,onLoading:D}),t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"text-lg flex items-center",children:[t.jsx(ye,{className:"h-5 w-5 mr-2"}),"Search Results",o&&t.jsx("div",{className:"ml-2 h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"})]}),t.jsx(h,{children:c.length>0?`Found ${c.length} document${1===c.length?"":"s"}`:"Enter search criteria to find documents"})]}),t.jsx(p,{children:t.jsx(DocumentList,{onDocumentSelect:w,refreshTrigger:j})})]})]})}),t.jsx(O,{value:"manage",className:"space-y-6",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[t.jsx("div",{className:"lg:col-span-3",children:t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"text-lg flex items-center",children:[t.jsx(Ke,{className:"h-5 w-5 mr-2"}),"All Documents"]}),t.jsx(h,{children:"Manage all your uploaded documents"})]}),t.jsx(p,{children:t.jsx(DocumentList,{onDocumentSelect:w,refreshTrigger:j})})]})}),t.jsx("div",{children:t.jsx(DocumentStatusTracker,{onDocumentSelect:w,refreshTrigger:j})})]})}),t.jsx(O,{value:"enhanced",className:"space-y-6",children:t.jsx(ie,{children:t.jsx(DocumentManagementDashboard,{})})}),t.jsx(O,{value:"debug",className:"space-y-6",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs(m,{children:[t.jsxs(x,{children:[t.jsxs(u,{className:"text-lg flex items-center",children:[t.jsx(ue,{className:"h-5 w-5 mr-2"}),"Document Loading Debug"]}),t.jsx(h,{children:"Authentication and API connectivity status"})]}),t.jsx(p,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium mb-2",children:"Current Status:"}),t.jsxs("div",{className:"text-sm space-y-1",children:[t.jsxs("div",{children:["Authentication: ",t.jsx("span",{className:"font-mono",children:e?"Authenticated":"Not authenticated"})]}),t.jsxs("div",{children:["User ID: ",t.jsx("span",{className:"font-mono",children:e?.id||"N/A"})]}),t.jsxs("div",{children:["Email: ",t.jsx("span",{className:"font-mono",children:e?.email||"N/A"})]}),t.jsxs("div",{children:["Subscription: ",t.jsx("span",{className:"font-mono",children:e?.subscription_tier||"N/A"})]})]})]}),t.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium mb-2",children:"Troubleshooting:"}),t.jsxs("div",{className:"text-sm space-y-1",children:[t.jsx("div",{children:" Check browser console for detailed error messages"}),t.jsx("div",{children:" Verify Supabase connection in Production Diagnostics below"}),t.jsx("div",{children:" Try uploading a test document to verify the upload process"}),t.jsx("div",{children:" Check if RLS policies are correctly configured"})]})]})]})})]}),t.jsx(UploadDiagnostics,{}),t.jsx(ce,{}),t.jsx(le,{}),t.jsx(DatabaseTest,{})]})})]})})})]})})})};export{Documents as default};
