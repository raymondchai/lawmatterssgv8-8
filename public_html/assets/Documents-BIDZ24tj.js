const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdfWorker-Bf4Y5Jto.js","./supabase-Br4R_luN.js","./react-vendor-92YuBQvb.js","./index-B9IfD0Z0.js","./_commonjs-dynamic-modules-DT2jeOaC.js","./index-BheJWwZO.js","./index-Dsh4Xwa-.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,__publicField=(t,a,r)=>((t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r)(t,"symbol"!=typeof a?a+"":a,r);import{a as t,R as a,c as r}from"./react-vendor-92YuBQvb.js";import{c as n,a6 as s,a7 as l,a8 as c,a9 as i,aa as o,z as u,a0 as m,a1 as d,ab as p,A as f,a3 as h,Z as g,a5 as y,a4 as b,B as E,ac as v,ad as x,ae as w,af as N,ag as _,ah as S,ai as k,aj as I,V as C,ak as A,al as D,am as O,an as z,ao as F,ap as T,I as j,r as R,aq as L,K as U,p as P,D as M,i as W,k as B,l as q,Q as $,G as K,O as V,ar as H,as as G,W as Q,X as Z,Y,$ as J,at as X,J as ee,au as te,av as ae,S as re,M as ne,aw as se,ax as le,P as ce,ay as ie,az as oe,aA as ue,N as me,aB as de,aC as pe,aD as fe,aE as he,H as ge,aF as ye,E as be,s as Ee,aG as ve,aH as xe,aI as we,aJ as Ne,aK as _e,aL as Se,aM as ke,aN as Ie,aO as Ce,aP as Ae,aQ as De,aR as Oe,aS as ze,aT as Fe,aU as Te,aV as je,_ as Re,aW as Le,aX as Ue,aY as Pe,aZ as Me,a_ as We,a$ as Be,b0 as qe,b1 as $e,b2 as Ke,b3 as Ve,b4 as He,b5 as Ge,b6 as Qe,b7 as Ze}from"./index-BheJWwZO.js";import{_ as Ye}from"./supabase-Br4R_luN.js";import{analyzeDocument as Je,generateEmbedding as Xe,summarizeDocument as et,extractEntities as tt}from"./openai-xAxfXVJU.js";import{E as at,b as rt,Z as nt,d as st,H as lt,R as ct}from"./useAnnotations-BERDoJuc.js";import{c as it,t as ot,s as ut}from"./search-B8XQUNfL.js";import{E as mt}from"./ellipsis-D4UsWNyN.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=n("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]),pt=t.createContext(null),ft={didCatch:!1,error:null};class ErrorBoundary extends t.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=ft}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var t,a,r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];null===(t=(a=this.props).onReset)||void 0===t||t.call(a,{args:n,reason:"imperative-api"}),this.setState(ft)}}componentDidCatch(e,t){var a,r;null===(a=(r=this.props).onError)||void 0===a||a.call(r,e,t)}componentDidUpdate(e,t){const{didCatch:a}=this.state,{resetKeys:r}=this.props;var n,s;a&&null!==t.error&&function hasArrayChanged(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,a)=>!Object.is(e,t[a]))}(e.resetKeys,r)&&(null===(n=(s=this.props).onReset)||void 0===n||n.call(s,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(ft))}render(){const{children:e,fallbackRender:a,FallbackComponent:r,fallback:n}=this.props,{didCatch:s,error:l}=this.state;let c=e;if(s){const e={error:l,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof a)c=a(e);else if(r)c=t.createElement(r,e);else{if(void 0===n)throw l;c=n}}return t.createElement(pt.Provider,{value:{didCatch:s,error:l,resetErrorBoundary:this.resetErrorBoundary}},c)}}async function extractTextFromDocument(e,t){const a=e.type.toLowerCase(),r=e.name.toLowerCase();if("application/pdf"===a||r.endsWith(".pdf"))return async function extractTextFromPDF(e,t){const a=Date.now();try{t?.({status:"initializing",progress:0,message:"Loading PDF..."});const{getPdfJs:n}=await Ye(async()=>{const{getPdfJs:e}=await import("./pdfWorker-Bf4Y5Jto.js");return{getPdfJs:e}},__vite__mapDeps([0,1,2]),import.meta.url),s=await n();if(!s)throw new Error("PDF.js failed to load. Please refresh the page and try again.");t?.({status:"initializing",progress:5,message:"Reading PDF file..."});const l=await e.arrayBuffer();if(!l||0===l.byteLength)throw new Error("PDF file appears to be empty or corrupted");t?.({status:"initializing",progress:10,message:"Parsing PDF document..."});const c=await s.getDocument({data:l,verbosity:0,isEvalSupported:!1,disableFontFace:!0,useSystemFonts:!1}).promise,i=c.numPages;if(0===i)throw new Error("PDF document contains no pages");if(i>100)throw new Error(`PDF document has too many pages (${i}). Maximum supported is 100 pages.`);const o=[];let u="",m=0;for(let e=1;e<=i;e++)try{t?.({status:"processing",progress:15+(e-1)/i*80,currentPage:e,totalPages:i,message:`Processing page ${e} of ${i}...`});const a=await c.getPage(e),r=(await a.getTextContent()).items.map(e=>"object"==typeof e&&null!==e?e.str||e.text||"":String(e||"")).filter(e=>e.trim().length>0).join(" ").trim();o.push({pageNumber:e,text:r,confidence:.95}),u+=r+"\n",m++}catch(r){console.warn(`Failed to process page ${e}:`,r),o.push({pageNumber:e,text:`[Page ${e} could not be processed]`,confidence:0})}if(0===m)throw new Error("Failed to process any pages from the PDF document");const d=Date.now()-a;return t?.({status:"completed",progress:100,message:"PDF processing completed"}),{text:u.trim(),confidence:.95,pages:o,metadata:{processingTime:d,fileSize:e.size,pageCount:i}}}catch(n){console.error("Error extracting text from PDF:",n);let e="Failed to extract text from PDF";throw n instanceof Error&&(e=n.message.includes("Invalid PDF")?"The uploaded file is not a valid PDF document":n.message.includes("Password")?"This PDF is password protected. Please upload an unlocked PDF":n.message.includes("corrupted")?"The PDF file appears to be corrupted. Please try uploading again":n.message.includes("too many pages")?n.message:n.message.includes("PDF.js failed to load")?"PDF processing library failed to load. Please refresh the page and try again":n.message.includes("empty")?"The PDF file appears to be empty":`PDF processing failed: ${n.message}`),t?.({status:"error",progress:0,message:e}),new Error(e)}}(e,t);if(a.startsWith("image/")||r.endsWith(".jpg")||r.endsWith(".jpeg")||r.endsWith(".png")||r.endsWith(".gif")||r.endsWith(".bmp")||r.endsWith(".tiff"))return async function extractTextFromImage(e,t){const a=Date.now();try{t?.({status:"initializing",progress:0,message:"Initializing OCR..."});const r=await Ye(()=>import("./index-B9IfD0Z0.js").then(e=>e.i),__vite__mapDeps([3,2,4]),import.meta.url),n=await r.recognize(e,"eng",{logger:e=>{"recognizing text"===e.status&&t?.({status:"processing",progress:100*e.progress,message:`OCR processing: ${Math.round(100*e.progress)}%`})}}),s=Date.now()-a;return t?.({status:"completed",progress:100,message:"OCR processing completed"}),{text:n.data.text,confidence:n.data.confidence/100,pages:[{pageNumber:1,text:n.data.text,confidence:n.data.confidence/100}],metadata:{processingTime:s,fileSize:e.size,pageCount:1}}}catch(r){throw console.error("Error performing OCR:",r),t?.({status:"error",progress:0,message:"OCR processing failed"}),new Error("Failed to perform OCR on image")}}(e,t);if("text/plain"===a||r.endsWith(".txt")){const a=Date.now();t?.({status:"processing",progress:50,message:"Reading text file..."});const r=await e.text(),n=Date.now()-a;return t?.({status:"completed",progress:100,message:"Text file processed"}),{text:r,confidence:1,pages:[{pageNumber:1,text:r,confidence:1}],metadata:{processingTime:n,fileSize:e.size,pageCount:1}}}throw new Error(`Unsupported file type: ${a}`)}function validateOCRQuality(e){const{text:t,confidence:a}=e,r=[];a<.7&&r.push("Low confidence detected. Consider rescanning with higher resolution.");const n=[/[0O]{3,}/,/[1Il]{3,}/,/\s{5,}/,/[^\w\s.,;:!?()-]{3,}/].some(e=>e.test(t));n&&r.push("Potential OCR errors detected. Review the extracted text carefully."),t.length<50&&r.push("Very little text extracted. Ensure the document contains readable text.");let s=a;return n&&(s-=.2),t.length<50&&(s-=.3),s=Math.max(0,Math.min(1,s)),{isGoodQuality:s>=.7,suggestions:r,qualityScore:s}}function cleanExtractedText(e){return e.replace(/\s+/g," ").replace(/[^\w\s.,;:!?()"-]/g,"").replace(/0/g,"O").replace(/1/g,"I").replace(/\n+/g,"\n").trim()}async function processDocument(e,t,a){try{const{usageTrackingService:n}=await Ye(async()=>{const{usageTrackingService:e}=await import("./index-BheJWwZO.js").then(e=>e.bx);return{usageTrackingService:e}},__vite__mapDeps([5,2,1,6]),import.meta.url),l=await n.checkUsageLimit("ai_query");if(!l.allowed)throw new Error(`AI processing limit exceeded. You have used ${l.current}/${l.limit} AI queries this month. Please upgrade your plan to continue.`);a?.({stage:"ocr",progress:0,message:"Starting text extraction..."});const c=await extractTextFromDocument(e,e=>{a?.({stage:"ocr",progress:.4*e.progress,message:e.message||"Extracting text..."})}),i=validateOCRQuality(c),o=cleanExtractedText(c.text),{error:u}=await s.from("uploaded_documents").update({ocr_text:o,ocr_quality_score:i.qualityScore,processing_status:"processing",updated_at:(new Date).toISOString()}).eq("id",t);if(u)throw new Error(`Failed to update OCR results: ${u.message}`);a?.({stage:"analysis",progress:40,message:"Analyzing document content..."});const m=await Je(o);await n.incrementUsage("ai_query",t,{operation:"document_analysis",text_length:o.length,document_type:e.type});const{error:d}=await s.from("uploaded_documents").update({document_structure:{analysis:m,ocrQuality:i,metadata:c.metadata},updated_at:(new Date).toISOString()}).eq("id",t);if(d)throw new Error(`Failed to update analysis results: ${d.message}`);let p;if(a?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),o.length>50)try{const e=function splitTextIntoChunks(e,t=1e3){const a=[],r=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let n="";for(const s of r){const e=s.trim();n.length+e.length+1<=t?n+=(n?". ":"")+e:(n&&a.push(n+"."),n=e)}n&&a.push(n+".");if(0===a.length){const r=e.split(/\s+/);let n="";for(const e of r)n.length+e.length+1<=t?n+=(n?" ":"")+e:(n&&a.push(n),n=e);n&&a.push(n)}return a.filter(e=>e.trim().length>0)}(o,1e3);for(let r=0;r<e.length;r++){const n=e[r],l=await Xe(n),{data:c,error:i}=await s.from("document_embeddings").insert({document_id:t,chunk_text:n,chunk_index:r,embedding:l.embedding,metadata:{usage:l.usage,chunkLength:n.length,totalChunks:e.length}}).select("id").single();i?console.error("Failed to store embedding:",i):0===r&&(p=c.id);const o=70+(r+1)/e.length*20;a?.({stage:"embedding",progress:o,message:`Processing chunk ${r+1} of ${e.length}...`})}}catch(r){console.error("Embedding generation failed:",r)}a?.({stage:"completed",progress:95,message:"Finalizing document processing..."});const{data:f,error:h}=await s.from("uploaded_documents").update({processing_status:"completed",updated_at:(new Date).toISOString()}).eq("id",t).select().single();if(h)throw new Error(`Failed to finalize document: ${h.message}`);return a?.({stage:"completed",progress:100,message:"Document processing completed successfully!"}),{document:f,ocrResult:c,analysis:m,embeddingId:p}}catch(n){throw console.error("Document processing failed:",n),await s.from("uploaded_documents").update({processing_status:"failed",updated_at:(new Date).toISOString()}).eq("id",t),a?.({stage:"error",progress:0,message:"Document processing failed",error:n instanceof Error?n.message:"Unknown error"}),n}}new class WebSocketService{constructor(){__publicField(this,"ws",null),__publicField(this,"reconnectAttempts",0),__publicField(this,"maxReconnectAttempts",5),__publicField(this,"reconnectDelay",1e3),__publicField(this,"handlers",new Map),__publicField(this,"isConnecting",!1),__publicField(this,"userId",null),console.log("WebSocket service initialized but connections disabled in production")}setupAuthListener(){s.auth.onAuthStateChange((e,t)=>{"SIGNED_IN"===e&&t?.user?(this.userId=t.user.id,this.connect()):"SIGNED_OUT"===e&&(this.userId=null,this.disconnect())})}async connect(){console.log("WebSocket connection skipped - disabled in production")}getWebSocketUrl(){return"https://kvlaydeyqidlfpfutbmp.supabase.co".replace("https://","wss://")+"/realtime/v1/websocket"}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return void console.error("Max reconnection attempts reached");const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts);this.reconnectAttempts++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${e}ms`),setTimeout(()=>{this.connect()},e)}disconnect(){this.ws&&(this.ws.close(1e3,"User disconnected"),this.ws=null),this.isConnecting=!1,this.reconnectAttempts=0}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("WebSocket not connected, cannot send message:",e)}handleMessage(e){(this.handlers.get(e.type)||[]).forEach(t=>{try{t(e)}catch(a){console.error("Error in WebSocket message handler:",a)}});(this.handlers.get("all")||[]).forEach(t=>{try{t(e)}catch(a){console.error("Error in WebSocket all-events handler:",a)}})}subscribe(e,t){return this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),()=>{const a=this.handlers.get(e);if(a){const e=a.indexOf(t);e>-1&&a.splice(e,1)}}}sendDocumentProcessingUpdate(e){this.send({type:"document_processing",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0,documentId:e.documentId})}sendAIQueryUpdate(e){this.send({type:"ai_query",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}sendSystemNotification(e){this.send({type:"system_notification",payload:e,timestamp:(new Date).toISOString(),userId:this.userId||void 0})}get isConnected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}get connectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"unknown"}}};const ht=new class DisabledWebSocketService{async connect(){}disconnect(){}subscribe(e,t){return()=>{}}sendDocumentProcessingUpdate(e){}sendAIQueryUpdate(e){}sendSystemNotification(e){}get isConnected(){return!1}get connectionState(){return"disabled"}};const DocumentUpload=({onUploadComplete:e,maxFiles:r=5})=>{const[n,s]=t.useState([]),[T,j]=t.useState(!1),[R,L]=t.useState(!1),{profile:U,loading:P}=l(),{simulateDocumentProcessing:M}=function useRealTimeSimulation(){return{simulateDocumentProcessing:t.useCallback(e=>{},[]),simulateAIQuery:t.useCallback(e=>{},[]),simulateSystemNotification:t.useCallback(e=>{ht.sendSystemNotification({id:`notification_${Date.now()}`,...e})},[])}}(),W=t.useCallback(e=>{U||P||c.warning("Profile not fully loaded. Upload will proceed with default settings."),L(!0);(async()=>{try{if(U){const{usageTrackingService:e}=await Ye(async()=>{const{usageTrackingService:e}=await import("./index-BheJWwZO.js").then(e=>e.bx);return{usageTrackingService:e}},__vite__mapDeps([5,2,1,6]),import.meta.url),t=e.checkUsageLimit("document_upload"),a=new Promise((e,t)=>setTimeout(()=>t(new Error("Usage check timeout")),5e3)),r=await Promise.race([t,a]);if(!r.allowed)return c.error(`Upload limit reached. You have used ${r.current}/${r.limit} document uploads this month. Please upgrade your plan to continue.`),void L(!1);r.percentage>=80&&c.warning(`You have used ${r.current}/${r.limit} document uploads this month (${Math.round(r.percentage)}%).`)}else c.warning("Profile not loaded. Upload will proceed with default free tier limits.")}catch(t){console.error("Error checking usage limits:",t),c.warning("Unable to verify upload limits. Upload will proceed but may be subject to restrictions.")}L(!1),B(e)})()},[U]),B=t.useCallback(e=>{const t=U?.subscription_tier?i.maxSize[U.subscription_tier]:i.maxSize.free,a=e.filter(e=>!(e.size>t)||(c.error(`File ${e.name} is too large. Maximum size is ${Math.round(t/1024/1024)}MB`),!1)).map(e=>({file:e,id:crypto.randomUUID(),progress:0,status:"pending"}));s(e=>[...e,...a].slice(0,r))},[U,r]),{getRootProps:q,getInputProps:$,isDragActive:K}=o({onDrop:W,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:r,disabled:T||R||P}),V=n.some(e=>"pending"===e.status&&e.documentType);return a.createElement(u,{className:"w-full"},a.createElement(m,null,a.createElement(d,null,"Upload Documents"),a.createElement(p,null,"Upload your legal documents for AI-powered analysis and processing")),a.createElement(f,{className:"space-y-4"},a.createElement("div",{...q(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${K?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${T||R||P||!U?"opacity-50 cursor-not-allowed":""}`},a.createElement("input",{...$()}),a.createElement(h,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),P?a.createElement("div",null,a.createElement("p",{className:"text-gray-600 mb-2"},"Loading user profile..."),a.createElement("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})):R?a.createElement("div",null,a.createElement("p",{className:"text-gray-600 mb-2"},"Checking upload limits..."),a.createElement("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})):K?a.createElement("p",{className:"text-blue-600"},"Drop the files here..."):a.createElement("div",null,a.createElement("p",{className:"text-gray-600 mb-2"},"Drag & drop files here, or click to select files"),a.createElement("p",{className:"text-sm text-gray-500"},"Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((U?.subscription_tier?i.maxSize[U.subscription_tier]:i.maxSize.free)/1024/1024),"MB"))),n.length>0&&a.createElement("div",{className:"space-y-3"},n.map(e=>a.createElement("div",{key:e.id,className:"border rounded-lg p-4"},a.createElement("div",{className:"flex items-center justify-between mb-2"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(g,{className:"h-4 w-4 text-gray-500"}),a.createElement("span",{className:"text-sm font-medium"},e.file.name),a.createElement("span",{className:"text-xs text-gray-500"},"(",Math.round(e.file.size/1024)," KB)")),a.createElement("div",{className:"flex items-center space-x-2"},"completed"===e.status&&a.createElement(y,{className:"h-4 w-4 text-green-500"}),"error"===e.status&&a.createElement(b,{className:"h-4 w-4 text-red-500"}),"pending"===e.status&&a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>{return t=e.id,void s(e=>e.filter(e=>e.id!==t));var t}},a.createElement(v,{className:"h-4 w-4"})))),"pending"===e.status&&a.createElement("div",{className:"mb-2"},a.createElement(x,{value:e.documentType||"",onValueChange:t=>{return a=e.id,r=t,void s(e=>e.map(e=>e.id===a?{...e,documentType:r}:e));var a,r}},a.createElement(w,{className:"w-full"},a.createElement(N,{placeholder:"Select document type"})),a.createElement(_,null,Object.entries(S).map(([e,t])=>a.createElement(k,{key:e,value:e},t))))),("uploading"===e.status||"processing"===e.status)&&a.createElement("div",{className:"space-y-2"},a.createElement("div",{className:"flex justify-between text-sm"},a.createElement("span",null,e.processingMessage||"Processing..."),a.createElement("span",null,Math.round(e.progress),"%")),a.createElement(I,{value:e.progress,className:"w-full"}),e.processingStage&&a.createElement("div",{className:"flex items-center space-x-2 text-xs text-gray-500"},"ocr"===e.processingStage&&a.createElement(C,{className:"h-3 w-3"}),"analysis"===e.processingStage&&a.createElement(A,{className:"h-3 w-3"}),"embedding"===e.processingStage&&a.createElement(D,{className:"h-3 w-3"}),a.createElement("span",{className:"capitalize"},e.processingStage," processing"))),"error"===e.status&&e.error&&a.createElement(O,{variant:"destructive"},a.createElement(z,null,e.error))))),n.length>0&&a.createElement(E,{onClick:async()=>{if(0!==n.length){j(!0);for(const r of n)if("pending"===r.status&&r.documentType)try{s(e=>e.map(e=>e.id===r.id?{...e,status:"uploading",progress:0,processingMessage:"Uploading file..."}:e));const a=await F.uploadDocument(r.file,r.documentType);try{const{usageTrackingService:e}=await Ye(async()=>{const{usageTrackingService:e}=await import("./index-BheJWwZO.js").then(e=>e.bx);return{usageTrackingService:e}},__vite__mapDeps([5,2,1,6]),import.meta.url);await e.incrementUsage("document_upload",a.id,{filename:r.file.name,file_size:r.file.size,document_type:r.documentType})}catch(t){console.warn("Usage tracking increment failed:",t)}s(e=>e.map(e=>e.id===r.id?{...e,status:"processing",progress:20,documentId:a.id,processingMessage:"Starting AI processing..."}:e)),ht.sendDocumentProcessingUpdate({documentId:a.id,status:"processing",progress:20,message:"Starting AI processing..."}),await processDocument(r.file,a.id,e=>{s(t=>t.map(t=>t.id===r.id?{...t,progress:20+.8*e.progress,processingStage:e.stage,processingMessage:e.message}:t)),ht.sendDocumentProcessingUpdate({documentId:a.id,status:"processing",progress:20+.8*e.progress,message:e.message,stage:e.stage})}),s(e=>e.map(e=>e.id===r.id?{...e,status:"completed",progress:100,processingMessage:"Processing completed!"}:e)),ht.sendDocumentProcessingUpdate({documentId:a.id,status:"completed",progress:100,message:"Document processing completed successfully!"}),c.success(`${r.file.name} uploaded and processed successfully`),e&&e(a.id)}catch(a){console.error("Upload/processing error:",a);let e=a.message||"Upload or processing failed";a.message?.includes("Upload limit exceeded")?e="You have reached your monthly upload limit. Please upgrade your plan to continue.":a.message?.includes("File size exceeds")?e="File is too large for your subscription tier. Please upgrade or use a smaller file.":a.message?.includes("PDF processing failed")?e="Failed to process PDF. Please ensure the file is not corrupted or password-protected.":a.message?.includes("Failed to extract text")&&(e="Could not extract text from the document. Please try a different file or contact support."),s(t=>t.map(t=>t.id===r.id?{...t,status:"error",error:e,processingMessage:"Failed"}:t));const t=n.find(e=>e.id===r.id);t?.documentId&&ht.sendDocumentProcessingUpdate({documentId:t.documentId,status:"failed",progress:0,message:"Document processing failed",error:e}),c.error(`Failed to process ${r.file.name}: ${e}`)}j(!1)}},disabled:!V||T,className:"w-full"},T?"Uploading...":`Upload ${n.filter(e=>"pending"===e.status).length} Files`)))},DocumentUploadFallback=({onUploadComplete:e,maxFiles:r=5})=>{const[n,s]=t.useState([]),[l,i]=t.useState(!1);return a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"flex items-center"},a.createElement(h,{className:"h-5 w-5 mr-2"}),"Document Upload (Fallback Mode)"),a.createElement(p,null,"Basic file upload functionality")),a.createElement(f,{className:"space-y-4"},a.createElement(O,null,a.createElement(b,{className:"h-4 w-4"}),a.createElement(z,null,"Advanced upload features are temporarily unavailable. Using basic upload mode.")),a.createElement("div",{className:"space-y-2"},a.createElement("label",{htmlFor:"file-input",className:"block text-sm font-medium"},"Select Files"),a.createElement("input",{id:"file-input",type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt",onChange:e=>{const t=Array.from(e.target.files||[]).filter(e=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(e.type)?!(e.size>10485760)||(c.error(`${e.name} is too large (max 10MB)`),!1):(c.error(`${e.name} is not a supported file type`),!1));s(e=>[...e,...t].slice(0,r))},disabled:l,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),a.createElement("p",{className:"text-xs text-gray-500"},"Supports PDF, DOC, DOCX, TXT files up to 10MB each")),n.length>0&&a.createElement("div",{className:"space-y-2"},a.createElement("h4",{className:"text-sm font-medium"},"Selected Files:"),n.map((e,t)=>a.createElement("div",{key:t,className:"flex items-center justify-between p-2 border rounded"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(g,{className:"h-4 w-4 text-gray-500"}),a.createElement("span",{className:"text-sm"},e.name),a.createElement("span",{className:"text-xs text-gray-500"},"(",Math.round(e.size/1024)," KB)")),a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>(e=>{s(t=>t.filter((t,a)=>a!==e))})(t),disabled:l},"Remove")))),a.createElement(E,{onClick:async()=>{if(0!==n.length){i(!0);try{for(const t of n)await new Promise(e=>setTimeout(e,1e3)),console.log("Uploading file:",t.name),e&&e(`mock-id-${Date.now()}`);c.success(`Successfully uploaded ${n.length} file(s)`),s([])}catch(t){console.error("Upload error:",t),c.error("Upload failed. Please try again.")}finally{i(!1)}}else c.error("Please select files to upload")},disabled:0===n.length||l,className:"w-full"},l?a.createElement(a.Fragment,null,a.createElement("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Uploading..."):a.createElement(a.Fragment,null,a.createElement(h,{className:"h-4 w-4 mr-2"}),"Upload ",n.length," File(s)"))))},UploadLoadingFallback=()=>a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"flex items-center"},a.createElement(h,{className:"h-5 w-5 mr-2"}),"Document Upload"),a.createElement(p,null,"Loading upload interface...")),a.createElement(f,{className:"flex items-center justify-center py-8"},a.createElement("div",{className:"text-center"},a.createElement("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),a.createElement("p",{className:"text-sm text-gray-600"},"Initializing upload component...")))),UploadErrorFallback=({error:e,resetErrorBoundary:t})=>a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"flex items-center text-red-600"},a.createElement(b,{className:"h-5 w-5 mr-2"}),"Upload Error"),a.createElement(p,null,"The upload component encountered an error")),a.createElement(f,{className:"space-y-4"},a.createElement(O,{variant:"destructive"},a.createElement(b,{className:"h-4 w-4"}),a.createElement(z,null,e.message||"An unexpected error occurred while loading the upload component.")),a.createElement("div",{className:"flex space-x-2"},a.createElement("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"},"Try Again")),a.createElement("details",{className:"text-xs text-gray-500"},a.createElement("summary",{className:"cursor-pointer"},"Technical Details"),a.createElement("pre",{className:"mt-2 p-2 bg-gray-100 rounded overflow-auto"},e.stack)))),DocumentUploadWrapper=e=>a.createElement(ErrorBoundary,{FallbackComponent:UploadErrorFallback,onError:(e,t)=>{console.error("DocumentUpload Error:",e,t),"undefined"!=typeof window&&window.gtag&&window.gtag("event","exception",{description:e.message,fatal:!1})},onReset:()=>{console.log("Resetting DocumentUpload component")}},a.createElement(t.Suspense,{fallback:a.createElement(UploadLoadingFallback,null)},a.createElement(DocumentUploadWithFallback,{...e}))),DocumentUploadWithFallback=e=>{const[t,r]=a.useState(!0),[n,s]=a.useState(!1);return a.useEffect(()=>{s(!1)},[e]),n||!t?a.createElement(DocumentUploadFallback,{...e}):a.createElement(ErrorBoundary,{FallbackComponent:()=>(s(!0),a.createElement(DocumentUploadFallback,{...e})),onError:e=>{console.error("Main DocumentUpload failed, switching to fallback:",e),r(!1),s(!0)}},a.createElement(DocumentUpload,{...e}))},DocumentList=({onDocumentSelect:e,refreshTrigger:r})=>{const[n,s]=t.useState([]),[l,i]=t.useState(!0),[o,h]=t.useState(""),[v,I]=t.useState("all"),[A,D]=t.useState("all");t.useEffect(()=>{loadDocuments()},[r]);const loadDocuments=async()=>{try{i(!0);const e=await F.getDocuments();s(e)}catch(e){console.error("Error loading documents:",e),c.error("Failed to load documents")}finally{i(!1)}},handleSearch=async()=>{if(o.trim())try{i(!0);const e=await F.searchDocuments(o);s(e)}catch(e){console.error("Error searching documents:",e),c.error("Failed to search documents")}finally{i(!1)}else loadDocuments()},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},O=n.filter(e=>{const t="all"===v||e.processing_status===v,a="all"===A||e.document_type===A;return t&&a});return l&&0===n.length?a.createElement(u,null,a.createElement(f,{className:"flex items-center justify-center py-8"},a.createElement(T,{className:"h-8 w-8 animate-spin"}))):a.createElement(u,null,a.createElement(m,null,a.createElement(d,null,"Documents"),a.createElement(p,null,"Manage and view your uploaded documents")),a.createElement(f,{className:"space-y-4"},a.createElement("div",{className:"flex flex-col sm:flex-row gap-4"},a.createElement("div",{className:"flex-1 flex gap-2"},a.createElement(j,{placeholder:"Search documents...",value:o,onChange:e=>h(e.target.value),onKeyPress:e=>"Enter"===e.key&&handleSearch()}),a.createElement(E,{onClick:handleSearch,variant:"outline"},a.createElement(R,{className:"h-4 w-4"}))),a.createElement("div",{className:"flex gap-2"},a.createElement(x,{value:v,onValueChange:I},a.createElement(w,{className:"w-32"},a.createElement(N,null)),a.createElement(_,null,a.createElement(k,{value:"all"},"All Status"),Object.entries(L).map(([e,t])=>a.createElement(k,{key:e,value:e},t)))),a.createElement(x,{value:A,onValueChange:D},a.createElement(w,{className:"w-32"},a.createElement(N,null)),a.createElement(_,null,a.createElement(k,{value:"all"},"All Types"),Object.entries(S).map(([e,t])=>a.createElement(k,{key:e,value:e},t)))))),0===O.length?a.createElement("div",{className:"text-center py-8"},a.createElement(g,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"No documents found"),a.createElement("p",{className:"text-gray-500"},0===n.length?"Upload your first document to get started":"Try adjusting your search or filters")):a.createElement("div",{className:"space-y-3"},O.map(t=>a.createElement("div",{key:t.id,className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",{className:"flex items-center space-x-3 flex-1"},a.createElement(g,{className:"h-8 w-8 text-gray-400"}),a.createElement("div",{className:"flex-1 min-w-0"},a.createElement("h4",{className:"text-sm font-medium text-gray-900 truncate"},t.filename),a.createElement("div",{className:"flex items-center space-x-4 mt-1"},a.createElement("span",{className:"text-xs text-gray-500"},S[t.document_type]),a.createElement("span",{className:"text-xs text-gray-500"},Math.round(t.file_size/1024)," KB"),a.createElement("span",{className:"text-xs text-gray-500"},U(new Date(t.created_at),{addSuffix:!0}))))),a.createElement("div",{className:"flex items-center space-x-3"},a.createElement("div",{className:"flex items-center space-x-2"},(e=>{switch(e){case"pending":return a.createElement(V,{className:"h-4 w-4 text-yellow-500"});case"processing":return a.createElement(T,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return a.createElement(y,{className:"h-4 w-4 text-green-500"});case"failed":return a.createElement(b,{className:"h-4 w-4 text-red-500"});default:return a.createElement(g,{className:"h-4 w-4 text-gray-500"})}})(t.processing_status),a.createElement(P,{className:getStatusColor(t.processing_status)},L[t.processing_status])),a.createElement(M,null,a.createElement(W,{asChild:!0},a.createElement(E,{variant:"ghost",size:"sm"},a.createElement(at,{className:"h-4 w-4"}))),a.createElement(B,{align:"end"},a.createElement(q,{onClick:()=>e?.(t)},a.createElement(C,{className:"mr-2 h-4 w-4"}),"View"),a.createElement(q,{onClick:()=>window.open(t.file_url,"_blank")},a.createElement($,{className:"mr-2 h-4 w-4"}),"Download"),a.createElement(q,{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this document?"))try{await F.deleteDocument(e),s(t=>t.filter(t=>t.id!==e)),c.success("Document deleted successfully")}catch(t){console.error("Error deleting document:",t),c.error("Failed to delete document")}})(t.id),className:"text-red-600"},a.createElement(K,{className:"mr-2 h-4 w-4"}),"Delete"))))))))))},DocumentAnalysisComponent=({document:e,className:r=""})=>{const[n,s]=t.useState(null),[l,i]=t.useState(""),[o,h]=t.useState(null),[b,v]=t.useState(!1),[x,w]=t.useState(0),[N,_]=t.useState("overview");t.useEffect(()=>{if(e.document_structure&&"object"==typeof e.document_structure){const t=e.document_structure.analysis;t&&s(t)}},[e]);const performAnalysis=async()=>{if(e.ocr_text){v(!0),w(0);try{w(20);const t=await Je(e.ocr_text);s(t),w(50);const a=await et(e.ocr_text,800);i(a),w(80);const r=await tt(e.ocr_text);h(r),w(100),c.success("Document analysis completed successfully")}catch(t){console.error("Analysis error:",t),c.error("Failed to analyze document: "+t.message)}finally{v(!1)}}else c.error("No text content available for analysis")};return a.createElement(u,{className:r},a.createElement(m,null,a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",null,a.createElement(d,{className:"flex items-center space-x-2"},a.createElement(A,{className:"h-5 w-5 text-purple-600"}),a.createElement("span",null,"AI Document Analysis")),a.createElement(p,null,"AI-powered analysis of ",e.filename)),a.createElement("div",{className:"flex space-x-2"},(n||l||o)&&a.createElement(E,{variant:"outline",size:"sm",onClick:()=>{const t={document:{filename:e.filename,type:e.document_type,uploadDate:e.created_at},analysis:n,summary:l,entities:o,generatedAt:(new Date).toISOString()},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),s=e.createElement("a");s.href=r,s.download=`${e.filename}_analysis.json`,e.body.appendChild(s),s.click(),e.body.removeChild(s),URL.revokeObjectURL(r)}},a.createElement($,{className:"h-4 w-4 mr-2"}),"Export"),a.createElement(E,{onClick:performAnalysis,disabled:b||!e.ocr_text,size:"sm"},b?a.createElement(a.Fragment,null,a.createElement(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."):a.createElement(a.Fragment,null,a.createElement(H,{className:"h-4 w-4 mr-2"}),n?"Re-analyze":"Analyze"))))),a.createElement(f,{className:"space-y-4"},!e.ocr_text&&a.createElement(O,null,a.createElement(G,{className:"h-4 w-4"}),a.createElement(z,null,"No text content available. Please ensure the document has been processed with OCR.")),b&&a.createElement("div",{className:"space-y-2"},a.createElement("div",{className:"flex justify-between text-sm"},a.createElement("span",null,"Analyzing document..."),a.createElement("span",null,x,"%")),a.createElement(I,{value:x,className:"w-full"})),(n||l||o)&&a.createElement(Q,{value:N,onValueChange:_},a.createElement(Z,{className:"grid w-full grid-cols-4"},a.createElement(Y,{value:"overview"},"Overview"),a.createElement(Y,{value:"summary"},"Summary"),a.createElement(Y,{value:"entities"},"Entities"),a.createElement(Y,{value:"insights"},"Insights")),a.createElement(J,{value:"overview",className:"space-y-4"},n&&a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm"},"Document Classification")),a.createElement(f,null,a.createElement("div",{className:"flex items-center justify-between"},a.createElement(P,{variant:"secondary"},n.documentType),a.createElement("div",{className:"text-sm "+(S=n.confidence,S>=.8?"text-green-600":S>=.6?"text-yellow-600":"text-red-600")},(e=>e>=.8?"High":e>=.6?"Medium":"Low")(n.confidence)," confidence")))),a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm"},"Key Entities")),a.createElement(f,null,a.createElement("div",{className:"text-sm text-gray-600"},n.keyEntities.length>0?a.createElement("div",{className:"flex flex-wrap gap-1"},n.keyEntities.slice(0,3).map((e,t)=>a.createElement(P,{key:t,variant:"outline",className:"text-xs"},e)),n.keyEntities.length>3&&a.createElement(P,{variant:"outline",className:"text-xs"},"+",n.keyEntities.length-3," more")):"No key entities identified")))),n&&a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm"},"Executive Summary")),a.createElement(f,null,a.createElement("p",{className:"text-sm text-gray-700"},n.summary)))),a.createElement(J,{value:"summary",className:"space-y-4"},l?a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm"},"Document Summary")),a.createElement(f,null,a.createElement("div",{className:"prose prose-sm max-w-none"},a.createElement("p",{className:"text-sm text-gray-700 whitespace-pre-wrap"},l)))):a.createElement("div",{className:"text-center text-gray-500 py-8"},a.createElement(g,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.createElement("p",null,'No summary available. Click "Analyze" to generate one.'))),a.createElement(J,{value:"entities",className:"space-y-4"},o?a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm flex items-center space-x-2"},a.createElement(X,{className:"h-4 w-4"}),a.createElement("span",null,"People"))),a.createElement(f,null,o.people.length>0?a.createElement("div",{className:"space-y-1"},o.people.map((e,t)=>a.createElement(P,{key:t,variant:"outline",className:"text-xs"},e))):a.createElement("p",{className:"text-sm text-gray-500"},"None identified"))),a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm flex items-center space-x-2"},a.createElement(g,{className:"h-4 w-4"}),a.createElement("span",null,"Organizations"))),a.createElement(f,null,o.organizations.length>0?a.createElement("div",{className:"space-y-1"},o.organizations.map((e,t)=>a.createElement(P,{key:t,variant:"outline",className:"text-xs"},e))):a.createElement("p",{className:"text-sm text-gray-500"},"None identified"))),a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm flex items-center space-x-2"},a.createElement(ee,{className:"h-4 w-4"}),a.createElement("span",null,"Dates"))),a.createElement(f,null,o.dates.length>0?a.createElement("div",{className:"space-y-1"},o.dates.map((e,t)=>a.createElement(P,{key:t,variant:"outline",className:"text-xs"},e))):a.createElement("p",{className:"text-sm text-gray-500"},"None identified"))),a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm flex items-center space-x-2"},a.createElement(te,{className:"h-4 w-4"}),a.createElement("span",null,"Amounts"))),a.createElement(f,null,o.amounts.length>0?a.createElement("div",{className:"space-y-1"},o.amounts.map((e,t)=>a.createElement(P,{key:t,variant:"outline",className:"text-xs"},e))):a.createElement("p",{className:"text-sm text-gray-500"},"None identified"))),a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm flex items-center space-x-2"},a.createElement(ae,{className:"h-4 w-4"}),a.createElement("span",null,"Locations"))),a.createElement(f,null,o.locations.length>0?a.createElement("div",{className:"space-y-1"},o.locations.map((e,t)=>a.createElement(P,{key:t,variant:"outline",className:"text-xs"},e))):a.createElement("p",{className:"text-sm text-gray-500"},"None identified")))):a.createElement("div",{className:"text-center text-gray-500 py-8"},a.createElement(X,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.createElement("p",null,'No entities extracted. Click "Analyze" to extract entities.'))),a.createElement(J,{value:"insights",className:"space-y-4"},n&&a.createElement(a.Fragment,null,a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm"},"Legal Implications")),a.createElement(f,null,n.legalImplications.length>0?a.createElement("ul",{className:"space-y-2"},n.legalImplications.map((e,t)=>a.createElement("li",{key:t,className:"flex items-start space-x-2"},a.createElement(G,{className:"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"}),a.createElement("span",{className:"text-sm text-gray-700"},e)))):a.createElement("p",{className:"text-sm text-gray-500"},"No legal implications identified"))),a.createElement(u,null,a.createElement(m,{className:"pb-3"},a.createElement(d,{className:"text-sm"},"Recommended Actions")),a.createElement(f,null,n.recommendedActions.length>0?a.createElement("ul",{className:"space-y-2"},n.recommendedActions.map((e,t)=>a.createElement("li",{key:t,className:"flex items-start space-x-2"},a.createElement(y,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),a.createElement("span",{className:"text-sm text-gray-700"},e)))):a.createElement("p",{className:"text-sm text-gray-500"},"No specific actions recommended")))))),!n&&!l&&!o&&!b&&e.ocr_text&&a.createElement("div",{className:"text-center text-gray-500 py-8"},a.createElement(A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),a.createElement("p",{className:"mb-4"},"Ready to analyze this document with AI"),a.createElement(E,{onClick:performAnalysis},a.createElement(A,{className:"h-4 w-4 mr-2"}),"Start Analysis"))));var S},gt=[{name:"Yellow",value:"#FFEB3B",bg:"rgba(255, 235, 59, 0.3)"},{name:"Green",value:"#4CAF50",bg:"rgba(76, 175, 80, 0.3)"},{name:"Blue",value:"#2196F3",bg:"rgba(33, 150, 243, 0.3)"},{name:"Red",value:"#F44336",bg:"rgba(244, 67, 54, 0.3)"},{name:"Purple",value:"#9C27B0",bg:"rgba(156, 39, 176, 0.3)"},{name:"Orange",value:"#FF9800",bg:"rgba(255, 152, 0, 0.3)"}],EnhancedPDFViewer=({documentUrl:e,documentId:r,className:n="",onAnnotationChange:s})=>{const[i,o]=t.useState(100),[m,d]=t.useState(0),[p,h]=t.useState(!1),[g,y]=t.useState("select"),[b,v]=t.useState(gt[0]),[x,w]=t.useState(!0),[N,_]=t.useState(!1),[S,k]=t.useState(null),[I,A]=t.useState(null),[D,O]=t.useState(null),[z,F]=t.useState(""),T=t.useRef(null),j=t.useRef(null),{annotations:R,isLoading:L,createAnnotation:M,updateAnnotation:W,deleteAnnotation:B}=rt(r),{user:q}=l();t.useEffect(()=>{s?.(R)},[R,s]);const $=t.useCallback(e=>{if("select"===g)return;const t=T.current?.getBoundingClientRect();if(!t)return;const a=e.clientX-t.left,r=e.clientY-t.top;"highlight"===g?(_(!0),k({x:a,y:r}),A({x:a,y:r,width:0,height:0})):"note"!==g&&"sticky"!==g||handleCreateAnnotation(a,r)},[g]),V=t.useCallback(e=>{if(!N||!S||"highlight"!==g)return;const t=T.current?.getBoundingClientRect();if(!t)return;const a=e.clientX-t.left,r=e.clientY-t.top;A({x:Math.min(S.x,a),y:Math.min(S.y,r),width:Math.abs(a-S.x),height:Math.abs(r-S.y)})},[N,S,g]),H=t.useCallback(()=>{N&&I&&"highlight"===g&&I.width>10&&I.height>10&&handleCreateHighlight(I),_(!1),k(null),A(null)},[N,I,g]),handleCreateAnnotation=async(e,t)=>{if(!q)return void c.error("Please log in to create annotations");const a=await M({type:g,page_number:1,position:{x:e,y:t},content:"",color:b.value});a&&(O(a.id),F(""))},handleCreateHighlight=async e=>{q?await M({type:"highlight",page_number:1,position:e,content:"Highlighted text",color:b.value}):c.error("Please log in to create highlights")},G=p?"fixed inset-0 z-50 bg-white":n;return a.createElement(u,{className:G},a.createElement("div",{className:"border-b p-4"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement("div",{className:"flex items-center space-x-1 border rounded-md"},a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>{o(e=>Math.max(e-25,25))}},a.createElement(nt,{className:"h-4 w-4"})),a.createElement("span",{className:"px-2 text-sm font-medium"},i,"%"),a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>{o(e=>Math.min(e+25,300))}},a.createElement(st,{className:"h-4 w-4"}))),a.createElement(re,{orientation:"vertical",className:"h-6"}),a.createElement("div",{className:"flex items-center space-x-1"},a.createElement(E,{variant:"select"===g?"default":"ghost",size:"sm",onClick:()=>y("select")},"Select"),a.createElement(E,{variant:"highlight"===g?"default":"ghost",size:"sm",onClick:()=>y("highlight")},a.createElement(lt,{className:"h-4 w-4"})),a.createElement(E,{variant:"note"===g?"default":"ghost",size:"sm",onClick:()=>y("note")},a.createElement(ne,{className:"h-4 w-4"})),a.createElement(E,{variant:"sticky"===g?"default":"ghost",size:"sm",onClick:()=>y("sticky")},a.createElement(dt,{className:"h-4 w-4"}))),a.createElement(re,{orientation:"vertical",className:"h-6"}),a.createElement(se,null,a.createElement(le,{asChild:!0},a.createElement(E,{variant:"ghost",size:"sm"},a.createElement(ce,{className:"h-4 w-4 mr-2"}),a.createElement("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:b.value}}))),a.createElement(ie,{className:"w-48"},a.createElement("div",{className:"grid grid-cols-3 gap-2"},gt.map(e=>a.createElement(E,{key:e.value,variant:"ghost",size:"sm",className:"h-8 w-8 p-0",style:{backgroundColor:e.value},onClick:()=>v(e)})))))),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>w(!x)},x?a.createElement(C,{className:"h-4 w-4"}):a.createElement(oe,{className:"h-4 w-4"})),a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>{d(e=>(e+90)%360)}},a.createElement(ct,{className:"h-4 w-4"})),a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>{h(e=>!e)}},p?a.createElement(ue,{className:"h-4 w-4"}):a.createElement(me,{className:"h-4 w-4"})),a.createElement(de,{documentId:r,showUserPresence:!0,className:"ml-auto"})))),a.createElement(f,{className:"p-0 relative"},a.createElement("div",{ref:T,className:"relative overflow-auto",style:{height:p?"calc(100vh - 120px)":"600px"},onMouseDown:$,onMouseMove:V,onMouseUp:H},a.createElement("div",{className:"relative",style:{transform:`scale(${i/100}) rotate(${m}deg)`,transformOrigin:"top left",cursor:"select"===g?"default":"crosshair"}},a.createElement("iframe",{ref:j,src:`${e}#toolbar=0&navpanes=0&scrollbar=0`,className:"w-full h-[800px] border-0",title:"PDF Document"}),x&&a.createElement("div",{className:"absolute inset-0 pointer-events-none"},R.map(e=>a.createElement("div",{key:e.id,className:"absolute pointer-events-auto",style:{left:e.position.x,top:e.position.y,width:e.position.width,height:e.position.height,backgroundColor:"highlight"===e.type?gt.find(t=>t.value===e.color)?.bg:"transparent"}},"highlight"!==e.type&&a.createElement(se,null,a.createElement(le,{asChild:!0},a.createElement(E,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-full",style:{backgroundColor:e.color}},"note"===e.type?a.createElement(ne,{className:"h-3 w-3"}):a.createElement(dt,{className:"h-3 w-3"}))),a.createElement(ie,{className:"w-80"},a.createElement("div",{className:"space-y-3"},a.createElement("div",{className:"flex items-start justify-between"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(pe,{className:"h-6 w-6"},a.createElement(fe,{src:e.user?.avatar_url}),a.createElement(he,{className:"text-xs"},e.user?.first_name?.[0],e.user?.last_name?.[0])),a.createElement("div",{className:"flex flex-col"},a.createElement("span",{className:"text-sm font-medium"},e.user?.first_name," ",e.user?.last_name),a.createElement("span",{className:"text-xs text-gray-500"},U(new Date(e.created_at),{addSuffix:!0})))),a.createElement("div",{className:"flex items-center space-x-1"},a.createElement(P,{variant:"outline",className:"text-xs"},e.type),a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>(async e=>{await B(e)})(e.id)},a.createElement(K,{className:"h-4 w-4"})))),D===e.id?a.createElement("div",{className:"space-y-2"},a.createElement(ge,{value:z,onChange:e=>F(e.target.value),placeholder:"Enter annotation content...",className:"min-h-[80px]"}),a.createElement("div",{className:"flex space-x-2"},a.createElement(E,{size:"sm",onClick:()=>(async(e,t)=>{await W(e,{content:t})&&(O(null),F(""))})(e.id,z)},a.createElement(ye,{className:"h-4 w-4 mr-1"}),"Save"),a.createElement(E,{variant:"outline",size:"sm",onClick:()=>O(null)},"Cancel"))):a.createElement("div",{className:"space-y-2"},a.createElement("p",{className:"text-sm"},e.content||"No content"),a.createElement(E,{variant:"outline",size:"sm",onClick:()=>{O(e.id),F(e.content)}},"Edit"))))))),I&&N&&a.createElement("div",{className:"absolute border-2 border-blue-500 bg-blue-200 bg-opacity-30 pointer-events-none",style:{left:I.x,top:I.y,width:I.width,height:I.height}}))))))},DocumentViewer=({documentId:e,onClose:r,className:n=""})=>{const[s,l]=t.useState(null),[i,o]=t.useState(!0),[h,y]=t.useState(null),[x,w]=t.useState(!1),[N,_]=t.useState("viewer");t.useEffect(()=>{loadDocument()},[e]);const loadDocument=async()=>{try{o(!0),y(null);const t=await F.getDocument(e);l(t)}catch(t){console.error("Error loading document:",t),y(t.message||"Failed to load document"),c.error("Failed to load document")}finally{o(!1)}},handleDownload=()=>{s&&window.open(s.file_url,"_blank")};if(i)return a.createElement(u,{className:n},a.createElement(f,{className:"flex items-center justify-center py-8"},a.createElement("div",{className:"flex flex-col items-center space-y-4"},a.createElement(T,{className:"h-8 w-8 animate-spin"}),a.createElement("p",{className:"text-sm text-gray-600"},"Loading document..."))));if(h||!s)return a.createElement(u,{className:n},a.createElement(f,{className:"flex items-center justify-center py-8"},a.createElement("div",{className:"flex flex-col items-center space-y-4"},a.createElement(b,{className:"h-8 w-8 text-red-500"}),a.createElement("p",{className:"text-sm text-red-600"},h||"Document not found"),a.createElement(E,{onClick:loadDocument,variant:"outline",size:"sm"},"Try Again"))));const k=x?"fixed inset-0 z-50 bg-white":`${n}`;return a.createElement(u,{className:k},a.createElement(m,{className:"pb-4"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",{className:"flex-1 min-w-0"},a.createElement(d,{className:"text-lg font-semibold truncate"},s.filename),a.createElement(p,{className:"flex items-center space-x-4 mt-1"},a.createElement("span",null,S[s.document_type]),a.createElement("span",null,Math.round(s.file_size/1024)," KB"),a.createElement("span",null,U(new Date(s.created_at),{addSuffix:!0})))),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement("div",{className:"flex items-center space-x-2"},(e=>{switch(e){case"processing":return a.createElement(T,{className:"h-4 w-4 animate-spin"});case"failed":return a.createElement(b,{className:"h-4 w-4"});default:return a.createElement(g,{className:"h-4 w-4"})}})(s.processing_status),a.createElement(P,{className:(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(s.processing_status)},L[s.processing_status])),r&&a.createElement(E,{onClick:r,variant:"ghost",size:"sm"},a.createElement(v,{className:"h-4 w-4"}))))),a.createElement(re,null),a.createElement("div",{className:"flex items-center justify-between p-4 border-b"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(E,{onClick:()=>{setZoom(e=>Math.max(e-25,50))},variant:"outline",size:"sm"},a.createElement(ZoomOut,{className:"h-4 w-4"})),a.createElement("span",{className:"text-sm font-medium min-w-[60px] text-center"},zoom,"%"),a.createElement(E,{onClick:()=>{setZoom(e=>Math.min(e+25,200))},variant:"outline",size:"sm"},a.createElement(ZoomIn,{className:"h-4 w-4"})),a.createElement(E,{onClick:()=>{setRotation(e=>(e+90)%360)},variant:"outline",size:"sm"},a.createElement(RotateCw,{className:"h-4 w-4"}))),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(E,{onClick:handleDownload,variant:"outline",size:"sm"},a.createElement($,{className:"h-4 w-4 mr-2"}),"Download"),a.createElement(E,{onClick:async()=>{if(s)try{await navigator.share({title:s.filename,url:s.file_url})}catch(e){await navigator.clipboard.writeText(s.file_url),c.success("Document URL copied to clipboard")}},variant:"outline",size:"sm"},a.createElement(be,{className:"h-4 w-4 mr-2"}),"Share"),a.createElement(E,{onClick:()=>{w(!x)},variant:"outline",size:"sm"},a.createElement(me,{className:"h-4 w-4"})))),a.createElement(f,{className:"p-0 flex-1"},a.createElement(Q,{value:N,onValueChange:_},a.createElement("div",{className:"border-b px-4"},a.createElement(Z,{className:"grid w-full grid-cols-3"},a.createElement(Y,{value:"viewer",className:"flex items-center space-x-2"},a.createElement(C,{className:"h-4 w-4"}),a.createElement("span",null,"Document")),a.createElement(Y,{value:"text",className:"flex items-center space-x-2"},a.createElement(g,{className:"h-4 w-4"}),a.createElement("span",null,"Text")),a.createElement(Y,{value:"analysis",className:"flex items-center space-x-2"},a.createElement(A,{className:"h-4 w-4"}),a.createElement("span",null,"AI Analysis")))),a.createElement(J,{value:"viewer",className:"mt-0"},a.createElement("div",{className:"p-4"},s.file_url.toLowerCase().endsWith(".pdf")?a.createElement(EnhancedPDFViewer,{documentUrl:s.file_url,documentId:s.id,className:"w-full",onAnnotationChange:e=>{console.log("Annotations updated:",e)}}):a.createElement("div",{className:"text-center py-8"},a.createElement(g,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),a.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"Preview not available"),a.createElement("p",{className:"text-gray-500 mb-4"},"This file type cannot be previewed in the browser."),a.createElement(E,{onClick:handleDownload},a.createElement($,{className:"mr-2 h-4 w-4"}),"Download to view")))),a.createElement(J,{value:"text",className:"mt-0"},a.createElement(Ee,{className:x?"h-[calc(100vh-250px)]":"h-[550px]"},a.createElement("div",{className:"p-4"},s.ocr_text?a.createElement("div",{className:"space-y-4"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("h4",{className:"text-sm font-medium text-gray-900"},"Extracted Text"),s.ocr_quality_score&&a.createElement(P,{variant:"outline"},"Quality: ",Math.round(100*s.ocr_quality_score),"%")),a.createElement("div",{className:"p-4 bg-gray-50 rounded-lg"},a.createElement("p",{className:"text-sm text-gray-700 whitespace-pre-wrap"},s.ocr_text))):a.createElement("div",{className:"text-center py-8"},a.createElement(g,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),a.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"No text extracted"),a.createElement("p",{className:"text-gray-500"},"Text extraction may still be in progress or the document may not contain readable text."))))),a.createElement(J,{value:"analysis",className:"mt-0"},a.createElement(Ee,{className:x?"h-[calc(100vh-250px)]":"h-[550px]"},a.createElement("div",{className:"p-4"},a.createElement(DocumentAnalysisComponent,{document:s})))))))};var yt,bt,Et={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */yt=Et,bt=Et.exports,function(){var e,t="Expected a function",a="__lodash_hash_undefined__",r="__lodash_placeholder__",n=16,s=32,l=64,c=128,i=256,o=1/0,u=9007199254740991,m=NaN,d=4294967295,p=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",n],["flip",512],["partial",s],["partialRight",l],["rearg",i]],f="[object Arguments]",h="[object Array]",g="[object Boolean]",y="[object Date]",b="[object Error]",E="[object Function]",v="[object GeneratorFunction]",x="[object Map]",w="[object Number]",N="[object Object]",_="[object Promise]",S="[object RegExp]",k="[object Set]",I="[object String]",C="[object Symbol]",A="[object WeakMap]",D="[object ArrayBuffer]",O="[object DataView]",z="[object Float32Array]",F="[object Float64Array]",T="[object Int8Array]",j="[object Int16Array]",R="[object Int32Array]",L="[object Uint8Array]",U="[object Uint8ClampedArray]",P="[object Uint16Array]",M="[object Uint32Array]",W=/\b__p \+= '';/g,B=/\b(__p \+=) '' \+/g,q=/(__e\(.*?\)|\b__t\)) \+\n'';/g,$=/&(?:amp|lt|gt|quot|#39);/g,K=/[&<>"']/g,V=RegExp($.source),H=RegExp(K.source),G=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,Z=/<%=([\s\S]+?)%>/g,Y=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/,X=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ee=/[\\^$.*+?()[\]{}|]/g,te=RegExp(ee.source),ae=/^\s+/,re=/\s/,ne=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,se=/\{\n\/\* \[wrapped with (.+)\] \*/,le=/,? & /,ce=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ie=/[()=,{}\[\]\/\s]/,oe=/\\(\\)?/g,ue=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,me=/\w*$/,de=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,fe=/^\[object .+?Constructor\]$/,he=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,be=/($^)/,Ee=/['\n\r\u2028\u2029\\]/g,ve="\\ud800-\\udfff",xe="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",we="\\u2700-\\u27bf",Ne="a-z\\xdf-\\xf6\\xf8-\\xff",_e="A-Z\\xc0-\\xd6\\xd8-\\xde",Se="\\ufe0e\\ufe0f",ke="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ie="['’]",Ce="["+ve+"]",Ae="["+ke+"]",De="["+xe+"]",Oe="\\d+",ze="["+we+"]",Fe="["+Ne+"]",Te="[^"+ve+ke+Oe+we+Ne+_e+"]",je="\\ud83c[\\udffb-\\udfff]",Re="[^"+ve+"]",Le="(?:\\ud83c[\\udde6-\\uddff]){2}",Ue="[\\ud800-\\udbff][\\udc00-\\udfff]",Pe="["+_e+"]",Me="\\u200d",We="(?:"+Fe+"|"+Te+")",Be="(?:"+Pe+"|"+Te+")",qe="(?:['’](?:d|ll|m|re|s|t|ve))?",$e="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ke="(?:"+De+"|"+je+")?",Ve="["+Se+"]?",He=Ve+Ke+"(?:"+Me+"(?:"+[Re,Le,Ue].join("|")+")"+Ve+Ke+")*",Ge="(?:"+[ze,Le,Ue].join("|")+")"+He,Qe="(?:"+[Re+De+"?",De,Le,Ue,Ce].join("|")+")",Ze=RegExp(Ie,"g"),Ye=RegExp(De,"g"),Je=RegExp(je+"(?="+je+")|"+Qe+He,"g"),Xe=RegExp([Pe+"?"+Fe+"+"+qe+"(?="+[Ae,Pe,"$"].join("|")+")",Be+"+"+$e+"(?="+[Ae,Pe+We,"$"].join("|")+")",Pe+"?"+We+"+"+qe,Pe+"+"+$e,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Oe,Ge].join("|"),"g"),et=RegExp("["+Me+ve+xe+Se+"]"),tt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,at=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rt=-1,nt={};nt[z]=nt[F]=nt[T]=nt[j]=nt[R]=nt[L]=nt[U]=nt[P]=nt[M]=!0,nt[f]=nt[h]=nt[D]=nt[g]=nt[O]=nt[y]=nt[b]=nt[E]=nt[x]=nt[w]=nt[N]=nt[S]=nt[k]=nt[I]=nt[A]=!1;var st={};st[f]=st[h]=st[D]=st[O]=st[g]=st[y]=st[z]=st[F]=st[T]=st[j]=st[R]=st[x]=st[w]=st[N]=st[S]=st[k]=st[I]=st[C]=st[L]=st[U]=st[P]=st[M]=!0,st[b]=st[E]=st[A]=!1;var lt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ct=parseFloat,it=parseInt,ot="object"==typeof globalThis&&globalThis&&globalThis.Object===Object&&globalThis,ut="object"==typeof self&&self&&self.Object===Object&&self,mt=ot||ut||Function("return this")(),dt=bt&&!bt.nodeType&&bt,pt=dt&&yt&&!yt.nodeType&&yt,ft=pt&&pt.exports===dt,ht=ft&&ot.process,gt=function(){try{var e=pt&&pt.require&&pt.require("util").types;return e||ht&&ht.binding&&ht.binding("util")}catch(t){}}(),Et=gt&&gt.isArrayBuffer,vt=gt&&gt.isDate,xt=gt&&gt.isMap,wt=gt&&gt.isRegExp,Nt=gt&&gt.isSet,_t=gt&&gt.isTypedArray;function apply(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}function arrayAggregator(e,t,a,r){for(var n=-1,s=null==e?0:e.length;++n<s;){var l=e[n];t(r,l,a(l),e)}return r}function arrayEach(e,t){for(var a=-1,r=null==e?0:e.length;++a<r&&!1!==t(e[a],a,e););return e}function arrayEachRight(e,t){for(var a=null==e?0:e.length;a--&&!1!==t(e[a],a,e););return e}function arrayEvery(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(!t(e[a],a,e))return!1;return!0}function arrayFilter(e,t){for(var a=-1,r=null==e?0:e.length,n=0,s=[];++a<r;){var l=e[a];t(l,a,e)&&(s[n++]=l)}return s}function arrayIncludes(e,t){return!(null==e||!e.length)&&baseIndexOf(e,t,0)>-1}function arrayIncludesWith(e,t,a){for(var r=-1,n=null==e?0:e.length;++r<n;)if(a(t,e[r]))return!0;return!1}function arrayMap(e,t){for(var a=-1,r=null==e?0:e.length,n=Array(r);++a<r;)n[a]=t(e[a],a,e);return n}function arrayPush(e,t){for(var a=-1,r=t.length,n=e.length;++a<r;)e[n+a]=t[a];return e}function arrayReduce(e,t,a,r){var n=-1,s=null==e?0:e.length;for(r&&s&&(a=e[++n]);++n<s;)a=t(a,e[n],n,e);return a}function arrayReduceRight(e,t,a,r){var n=null==e?0:e.length;for(r&&n&&(a=e[--n]);n--;)a=t(a,e[n],n,e);return a}function arraySome(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(t(e[a],a,e))return!0;return!1}var St=baseProperty("length");function baseFindKey(e,t,a){var r;return a(e,function(e,a,n){if(t(e,a,n))return r=a,!1}),r}function baseFindIndex(e,t,a,r){for(var n=e.length,s=a+(r?1:-1);r?s--:++s<n;)if(t(e[s],s,e))return s;return-1}function baseIndexOf(e,t,a){return t==t?function strictIndexOf(e,t,a){for(var r=a-1,n=e.length;++r<n;)if(e[r]===t)return r;return-1}(e,t,a):baseFindIndex(e,baseIsNaN,a)}function baseIndexOfWith(e,t,a,r){for(var n=a-1,s=e.length;++n<s;)if(r(e[n],t))return n;return-1}function baseIsNaN(e){return e!=e}function baseMean(e,t){var a=null==e?0:e.length;return a?baseSum(e,t)/a:m}function baseProperty(t){return function(a){return null==a?e:a[t]}}function basePropertyOf(t){return function(a){return null==t?e:t[a]}}function baseReduce(e,t,a,r,n){return n(e,function(e,n,s){a=r?(r=!1,e):t(a,e,n,s)}),a}function baseSum(t,a){for(var r,n=-1,s=t.length;++n<s;){var l=a(t[n]);l!==e&&(r=r===e?l:r+l)}return r}function baseTimes(e,t){for(var a=-1,r=Array(e);++a<e;)r[a]=t(a);return r}function baseTrim(e){return e?e.slice(0,trimmedEndIndex(e)+1).replace(ae,""):e}function baseUnary(e){return function(t){return e(t)}}function baseValues(e,t){return arrayMap(t,function(t){return e[t]})}function cacheHas(e,t){return e.has(t)}function charsStartIndex(e,t){for(var a=-1,r=e.length;++a<r&&baseIndexOf(t,e[a],0)>-1;);return a}function charsEndIndex(e,t){for(var a=e.length;a--&&baseIndexOf(t,e[a],0)>-1;);return a}var kt=basePropertyOf({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),It=basePropertyOf({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function escapeStringChar(e){return"\\"+lt[e]}function hasUnicode(e){return et.test(e)}function mapToArray(e){var t=-1,a=Array(e.size);return e.forEach(function(e,r){a[++t]=[r,e]}),a}function overArg(e,t){return function(a){return e(t(a))}}function replaceHolders(e,t){for(var a=-1,n=e.length,s=0,l=[];++a<n;){var c=e[a];c!==t&&c!==r||(e[a]=r,l[s++]=a)}return l}function setToArray(e){var t=-1,a=Array(e.size);return e.forEach(function(e){a[++t]=e}),a}function stringSize(e){return hasUnicode(e)?function unicodeSize(e){for(var t=Je.lastIndex=0;Je.test(e);)++t;return t}(e):St(e)}function stringToArray(e){return hasUnicode(e)?function unicodeToArray(e){return e.match(Je)||[]}(e):function asciiToArray(e){return e.split("")}(e)}function trimmedEndIndex(e){for(var t=e.length;t--&&re.test(e.charAt(t)););return t}var Ct=basePropertyOf({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),At=function runInContext2(re){var ve,xe=(re=null==re?mt:At.defaults(mt.Object(),re,At.pick(mt,at))).Array,we=re.Date,Ne=re.Error,_e=re.Function,Se=re.Math,ke=re.Object,Ie=re.RegExp,Ce=re.String,Ae=re.TypeError,De=xe.prototype,Oe=_e.prototype,ze=ke.prototype,Fe=re["__core-js_shared__"],Te=Oe.toString,je=ze.hasOwnProperty,Re=0,Le=(ve=/[^.]+$/.exec(Fe&&Fe.keys&&Fe.keys.IE_PROTO||""))?"Symbol(src)_1."+ve:"",Ue=ze.toString,Pe=Te.call(ke),Me=mt._,We=Ie("^"+Te.call(je).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Be=ft?re.Buffer:e,qe=re.Symbol,$e=re.Uint8Array,Ke=Be?Be.allocUnsafe:e,Ve=overArg(ke.getPrototypeOf,ke),He=ke.create,Ge=ze.propertyIsEnumerable,Qe=De.splice,Je=qe?qe.isConcatSpreadable:e,et=qe?qe.iterator:e,lt=qe?qe.toStringTag:e,ot=function(){try{var e=getNative(ke,"defineProperty");return e({},"",{}),e}catch(t){}}(),ut=re.clearTimeout!==mt.clearTimeout&&re.clearTimeout,dt=we&&we.now!==mt.Date.now&&we.now,pt=re.setTimeout!==mt.setTimeout&&re.setTimeout,ht=Se.ceil,gt=Se.floor,yt=ke.getOwnPropertySymbols,bt=Be?Be.isBuffer:e,St=re.isFinite,Dt=De.join,Ot=overArg(ke.keys,ke),zt=Se.max,Ft=Se.min,Tt=we.now,jt=re.parseInt,Rt=Se.random,Lt=De.reverse,Ut=getNative(re,"DataView"),Pt=getNative(re,"Map"),Mt=getNative(re,"Promise"),Wt=getNative(re,"Set"),Bt=getNative(re,"WeakMap"),qt=getNative(ke,"create"),$t=Bt&&new Bt,Kt={},Vt=toSource(Ut),Ht=toSource(Pt),Gt=toSource(Mt),Qt=toSource(Wt),Zt=toSource(Bt),Yt=qe?qe.prototype:e,Jt=Yt?Yt.valueOf:e,Xt=Yt?Yt.toString:e;function lodash2(e){if(isObjectLike(e)&&!rr(e)&&!(e instanceof LazyWrapper)){if(e instanceof LodashWrapper)return e;if(je.call(e,"__wrapped__"))return wrapperClone(e)}return new LodashWrapper(e)}var ea=function(){function object(){}return function(t){if(!isObject(t))return{};if(He)return He(t);object.prototype=t;var a=new object;return object.prototype=e,a}}();function baseLodash(){}function LodashWrapper(t,a){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=e}function LazyWrapper(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=d,this.__views__=[]}function Hash(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function ListCache(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function MapCache(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function SetCache(e){var t=-1,a=null==e?0:e.length;for(this.__data__=new MapCache;++t<a;)this.add(e[t])}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function arrayLikeKeys(e,t){var a=rr(e),r=!a&&ar(e),n=!a&&!r&&sr(e),s=!a&&!r&&!n&&ur(e),l=a||r||n||s,c=l?baseTimes(e.length,Ce):[],i=c.length;for(var o in e)!t&&!je.call(e,o)||l&&("length"==o||n&&("offset"==o||"parent"==o)||s&&("buffer"==o||"byteLength"==o||"byteOffset"==o)||isIndex(o,i))||c.push(o);return c}function arraySample(t){var a=t.length;return a?t[baseRandom(0,a-1)]:e}function arraySampleSize(e,t){return shuffleSelf(copyArray(e),baseClamp(t,0,e.length))}function arrayShuffle(e){return shuffleSelf(copyArray(e))}function assignMergeValue(t,a,r){(r!==e&&!eq(t[a],r)||r===e&&!(a in t))&&baseAssignValue(t,a,r)}function assignValue(t,a,r){var n=t[a];je.call(t,a)&&eq(n,r)&&(r!==e||a in t)||baseAssignValue(t,a,r)}function assocIndexOf(e,t){for(var a=e.length;a--;)if(eq(e[a][0],t))return a;return-1}function baseAggregator(e,t,a,r){return ta(e,function(e,n,s){t(r,e,a(e),s)}),r}function baseAssign(e,t){return e&&copyObject(t,keys(t),e)}function baseAssignValue(e,t,a){"__proto__"==t&&ot?ot(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}function baseAt(t,a){for(var r=-1,n=a.length,s=xe(n),l=null==t;++r<n;)s[r]=l?e:get(t,a[r]);return s}function baseClamp(t,a,r){return t==t&&(r!==e&&(t=t<=r?t:r),a!==e&&(t=t>=a?t:a)),t}function baseClone(t,a,r,n,s,l){var c,i=1&a,o=2&a,u=4&a;if(r&&(c=s?r(t,n,s,l):r(t)),c!==e)return c;if(!isObject(t))return t;var m=rr(t);if(m){if(c=function initCloneArray(e){var t=e.length,a=new e.constructor(t);return t&&"string"==typeof e[0]&&je.call(e,"index")&&(a.index=e.index,a.input=e.input),a}(t),!i)return copyArray(t,c)}else{var d=pa(t),p=d==E||d==v;if(sr(t))return cloneBuffer(t,i);if(d==N||d==f||p&&!s){if(c=o||p?{}:initCloneObject(t),!i)return o?function copySymbolsIn(e,t){return copyObject(e,da(e),t)}(t,function baseAssignIn(e,t){return e&&copyObject(t,keysIn(t),e)}(c,t)):function copySymbols(e,t){return copyObject(e,ma(e),t)}(t,baseAssign(c,t))}else{if(!st[d])return s?t:{};c=function initCloneByTag(e,t,a){var r=e.constructor;switch(t){case D:return cloneArrayBuffer(e);case g:case y:return new r(+e);case O:return function cloneDataView(e,t){var a=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}(e,a);case z:case F:case T:case j:case R:case L:case U:case P:case M:return cloneTypedArray(e,a);case x:return new r;case w:case I:return new r(e);case S:return function cloneRegExp(e){var t=new e.constructor(e.source,me.exec(e));return t.lastIndex=e.lastIndex,t}(e);case k:return new r;case C:return function cloneSymbol(e){return Jt?ke(Jt.call(e)):{}}(e)}}(t,d,i)}}l||(l=new Stack);var h=l.get(t);if(h)return h;l.set(t,c),or(t)?t.forEach(function(e){c.add(baseClone(e,a,r,e,t,l))}):cr(t)&&t.forEach(function(e,n){c.set(n,baseClone(e,a,r,n,t,l))});var b=m?e:(u?o?getAllKeysIn:getAllKeys:o?keysIn:keys)(t);return arrayEach(b||t,function(e,n){b&&(e=t[n=e]),assignValue(c,n,baseClone(e,a,r,n,t,l))}),c}function baseConformsTo(t,a,r){var n=r.length;if(null==t)return!n;for(t=ke(t);n--;){var s=r[n],l=a[s],c=t[s];if(c===e&&!(s in t)||!l(c))return!1}return!0}function baseDelay(a,r,n){if("function"!=typeof a)throw new Ae(t);return ga(function(){a.apply(e,n)},r)}function baseDifference(e,t,a,r){var n=-1,s=arrayIncludes,l=!0,c=e.length,i=[],o=t.length;if(!c)return i;a&&(t=arrayMap(t,baseUnary(a))),r?(s=arrayIncludesWith,l=!1):t.length>=200&&(s=cacheHas,l=!1,t=new SetCache(t));e:for(;++n<c;){var u=e[n],m=null==a?u:a(u);if(u=r||0!==u?u:0,l&&m==m){for(var d=o;d--;)if(t[d]===m)continue e;i.push(u)}else s(t,m,r)||i.push(u)}return i}lodash2.templateSettings={escape:G,evaluate:Q,interpolate:Z,variable:"",imports:{_:lodash2}},lodash2.prototype=baseLodash.prototype,lodash2.prototype.constructor=lodash2,LodashWrapper.prototype=ea(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=ea(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=function hashClear(){this.__data__=qt?qt(null):{},this.size=0},Hash.prototype.delete=function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Hash.prototype.get=function hashGet(t){var r=this.__data__;if(qt){var n=r[t];return n===a?e:n}return je.call(r,t)?r[t]:e},Hash.prototype.has=function hashHas(t){var a=this.__data__;return qt?a[t]!==e:je.call(a,t)},Hash.prototype.set=function hashSet(t,r){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=qt&&r===e?a:r,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[],this.size=0},ListCache.prototype.delete=function listCacheDelete(e){var t=this.__data__,a=assocIndexOf(t,e);return!(a<0||(a==t.length-1?t.pop():Qe.call(t,a,1),--this.size,0))},ListCache.prototype.get=function listCacheGet(t){var a=this.__data__,r=assocIndexOf(a,t);return r<0?e:a[r][1]},ListCache.prototype.has=function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1},ListCache.prototype.set=function listCacheSet(e,t){var a=this.__data__,r=assocIndexOf(a,e);return r<0?(++this.size,a.push([e,t])):a[r][1]=t,this},MapCache.prototype.clear=function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Pt||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t},MapCache.prototype.get=function mapCacheGet(e){return getMapData(this,e).get(e)},MapCache.prototype.has=function mapCacheHas(e){return getMapData(this,e).has(e)},MapCache.prototype.set=function mapCacheSet(e,t){var a=getMapData(this,e),r=a.size;return a.set(e,t),this.size+=a.size==r?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function setCacheAdd(e){return this.__data__.set(e,a),this},SetCache.prototype.has=function setCacheHas(e){return this.__data__.has(e)},Stack.prototype.clear=function stackClear(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function stackDelete(e){var t=this.__data__,a=t.delete(e);return this.size=t.size,a},Stack.prototype.get=function stackGet(e){return this.__data__.get(e)},Stack.prototype.has=function stackHas(e){return this.__data__.has(e)},Stack.prototype.set=function stackSet(e,t){var a=this.__data__;if(a instanceof ListCache){var r=a.__data__;if(!Pt||r.length<199)return r.push([e,t]),this.size=++a.size,this;a=this.__data__=new MapCache(r)}return a.set(e,t),this.size=a.size,this};var ta=createBaseEach(baseForOwn),aa=createBaseEach(baseForOwnRight,!0);function baseEvery(e,t){var a=!0;return ta(e,function(e,r,n){return a=!!t(e,r,n)}),a}function baseExtremum(t,a,r){for(var n=-1,s=t.length;++n<s;){var l=t[n],c=a(l);if(null!=c&&(i===e?c==c&&!isSymbol(c):r(c,i)))var i=c,o=l}return o}function baseFilter(e,t){var a=[];return ta(e,function(e,r,n){t(e,r,n)&&a.push(e)}),a}function baseFlatten(e,t,a,r,n){var s=-1,l=e.length;for(a||(a=isFlattenable),n||(n=[]);++s<l;){var c=e[s];t>0&&a(c)?t>1?baseFlatten(c,t-1,a,r,n):arrayPush(n,c):r||(n[n.length]=c)}return n}var ra=createBaseFor(),na=createBaseFor(!0);function baseForOwn(e,t){return e&&ra(e,t,keys)}function baseForOwnRight(e,t){return e&&na(e,t,keys)}function baseFunctions(e,t){return arrayFilter(t,function(t){return isFunction(e[t])})}function baseGet(t,a){for(var r=0,n=(a=castPath(a,t)).length;null!=t&&r<n;)t=t[toKey(a[r++])];return r&&r==n?t:e}function baseGetAllKeys(e,t,a){var r=t(e);return rr(e)?r:arrayPush(r,a(e))}function baseGetTag(t){return null==t?t===e?"[object Undefined]":"[object Null]":lt&&lt in ke(t)?function getRawTag(t){var a=je.call(t,lt),r=t[lt];try{t[lt]=e;var n=!0}catch(l){}var s=Ue.call(t);return n&&(a?t[lt]=r:delete t[lt]),s}(t):function objectToString(e){return Ue.call(e)}(t)}function baseGt(e,t){return e>t}function baseHas(e,t){return null!=e&&je.call(e,t)}function baseHasIn(e,t){return null!=e&&t in ke(e)}function baseIntersection(t,a,r){for(var n=r?arrayIncludesWith:arrayIncludes,s=t[0].length,l=t.length,c=l,i=xe(l),o=1/0,u=[];c--;){var m=t[c];c&&a&&(m=arrayMap(m,baseUnary(a))),o=Ft(m.length,o),i[c]=!r&&(a||s>=120&&m.length>=120)?new SetCache(c&&m):e}m=t[0];var d=-1,p=i[0];e:for(;++d<s&&u.length<o;){var f=m[d],h=a?a(f):f;if(f=r||0!==f?f:0,!(p?cacheHas(p,h):n(u,h,r))){for(c=l;--c;){var g=i[c];if(!(g?cacheHas(g,h):n(t[c],h,r)))continue e}p&&p.push(h),u.push(f)}}return u}function baseInvoke(t,a,r){var n=null==(t=parent(t,a=castPath(a,t)))?t:t[toKey(last(a))];return null==n?e:apply(n,t,r)}function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==f}function baseIsEqual(t,a,r,n,s){return t===a||(null==t||null==a||!isObjectLike(t)&&!isObjectLike(a)?t!=t&&a!=a:function baseIsEqualDeep(t,a,r,n,s,l){var c=rr(t),i=rr(a),o=c?h:pa(t),u=i?h:pa(a),m=(o=o==f?N:o)==N,d=(u=u==f?N:u)==N,p=o==u;if(p&&sr(t)){if(!sr(a))return!1;c=!0,m=!1}if(p&&!m)return l||(l=new Stack),c||ur(t)?equalArrays(t,a,r,n,s,l):function equalByTag(e,t,a,r,n,s,l){switch(a){case O:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case D:return!(e.byteLength!=t.byteLength||!s(new $e(e),new $e(t)));case g:case y:case w:return eq(+e,+t);case b:return e.name==t.name&&e.message==t.message;case S:case I:return e==t+"";case x:var c=mapToArray;case k:var i=1&r;if(c||(c=setToArray),e.size!=t.size&&!i)return!1;var o=l.get(e);if(o)return o==t;r|=2,l.set(e,t);var u=equalArrays(c(e),c(t),r,n,s,l);return l.delete(e),u;case C:if(Jt)return Jt.call(e)==Jt.call(t)}return!1}(t,a,o,r,n,s,l);if(!(1&r)){var E=m&&je.call(t,"__wrapped__"),v=d&&je.call(a,"__wrapped__");if(E||v){var _=E?t.value():t,A=v?a.value():a;return l||(l=new Stack),s(_,A,r,n,l)}}return!!p&&(l||(l=new Stack),function equalObjects(t,a,r,n,s,l){var c=1&r,i=getAllKeys(t),o=i.length,u=getAllKeys(a),m=u.length;if(o!=m&&!c)return!1;for(var d=o;d--;){var p=i[d];if(!(c?p in a:je.call(a,p)))return!1}var f=l.get(t),h=l.get(a);if(f&&h)return f==a&&h==t;var g=!0;l.set(t,a),l.set(a,t);for(var y=c;++d<o;){var b=t[p=i[d]],E=a[p];if(n)var v=c?n(E,b,p,a,t,l):n(b,E,p,t,a,l);if(!(v===e?b===E||s(b,E,r,n,l):v)){g=!1;break}y||(y="constructor"==p)}if(g&&!y){var x=t.constructor,w=a.constructor;x==w||!("constructor"in t)||!("constructor"in a)||"function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w||(g=!1)}return l.delete(t),l.delete(a),g}(t,a,r,n,s,l))}(t,a,r,n,baseIsEqual,s))}function baseIsMatch(t,a,r,n){var s=r.length,l=s,c=!n;if(null==t)return!l;for(t=ke(t);s--;){var i=r[s];if(c&&i[2]?i[1]!==t[i[0]]:!(i[0]in t))return!1}for(;++s<l;){var o=(i=r[s])[0],u=t[o],m=i[1];if(c&&i[2]){if(u===e&&!(o in t))return!1}else{var d=new Stack;if(n)var p=n(u,m,o,t,a,d);if(!(p===e?baseIsEqual(m,u,3,n,d):p))return!1}}return!0}function baseIsNative(e){return!(!isObject(e)||function isMasked(e){return!!Le&&Le in e}(e))&&(isFunction(e)?We:fe).test(toSource(e))}function baseIteratee(e){return"function"==typeof e?e:null==e?identity:"object"==typeof e?rr(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}function baseKeys(e){if(!isPrototype(e))return Ot(e);var t=[];for(var a in ke(e))je.call(e,a)&&"constructor"!=a&&t.push(a);return t}function baseKeysIn(e){if(!isObject(e))return function nativeKeysIn(e){var t=[];if(null!=e)for(var a in ke(e))t.push(a);return t}(e);var t=isPrototype(e),a=[];for(var r in e)("constructor"!=r||!t&&je.call(e,r))&&a.push(r);return a}function baseLt(e,t){return e<t}function baseMap(e,t){var a=-1,r=isArrayLike(e)?xe(e.length):[];return ta(e,function(e,n,s){r[++a]=t(e,n,s)}),r}function baseMatches(e){var t=getMatchData(e);return 1==t.length&&t[0][2]?matchesStrictComparable(t[0][0],t[0][1]):function(a){return a===e||baseIsMatch(a,e,t)}}function baseMatchesProperty(t,a){return isKey(t)&&isStrictComparable(a)?matchesStrictComparable(toKey(t),a):function(r){var n=get(r,t);return n===e&&n===a?hasIn(r,t):baseIsEqual(a,n,3)}}function baseMerge(t,a,r,n,s){t!==a&&ra(a,function(l,c){if(s||(s=new Stack),isObject(l))!function baseMergeDeep(t,a,r,n,s,l,c){var i=safeGet(t,r),o=safeGet(a,r),u=c.get(o);if(u)assignMergeValue(t,r,u);else{var m=l?l(i,o,r+"",t,a,c):e,d=m===e;if(d){var p=rr(o),f=!p&&sr(o),h=!p&&!f&&ur(o);m=o,p||f||h?rr(i)?m=i:isArrayLikeObject(i)?m=copyArray(i):f?(d=!1,m=cloneBuffer(o,!0)):h?(d=!1,m=cloneTypedArray(o,!0)):m=[]:isPlainObject(o)||ar(o)?(m=i,ar(i)?m=toPlainObject(i):isObject(i)&&!isFunction(i)||(m=initCloneObject(o))):d=!1}d&&(c.set(o,m),s(m,o,n,l,c),c.delete(o)),assignMergeValue(t,r,m)}}(t,a,c,r,baseMerge,n,s);else{var i=n?n(safeGet(t,c),l,c+"",t,a,s):e;i===e&&(i=l),assignMergeValue(t,c,i)}},keysIn)}function baseNth(t,a){var r=t.length;if(r)return isIndex(a+=a<0?r:0,r)?t[a]:e}function baseOrderBy(e,t,a){t=t.length?arrayMap(t,function(e){return rr(e)?function(t){return baseGet(t,1===e.length?e[0]:e)}:e}):[identity];var r=-1;return t=arrayMap(t,baseUnary(getIteratee())),function baseSortBy(e,t){var a=e.length;for(e.sort(t);a--;)e[a]=e[a].value;return e}(baseMap(e,function(e,a,n){return{criteria:arrayMap(t,function(t){return t(e)}),index:++r,value:e}}),function(e,t){return function compareMultiple(e,t,a){for(var r=-1,n=e.criteria,s=t.criteria,l=n.length,c=a.length;++r<l;){var i=compareAscending(n[r],s[r]);if(i)return r>=c?i:i*("desc"==a[r]?-1:1)}return e.index-t.index}(e,t,a)})}function basePickBy(e,t,a){for(var r=-1,n=t.length,s={};++r<n;){var l=t[r],c=baseGet(e,l);a(c,l)&&baseSet(s,castPath(l,e),c)}return s}function basePullAll(e,t,a,r){var n=r?baseIndexOfWith:baseIndexOf,s=-1,l=t.length,c=e;for(e===t&&(t=copyArray(t)),a&&(c=arrayMap(e,baseUnary(a)));++s<l;)for(var i=0,o=t[s],u=a?a(o):o;(i=n(c,u,i,r))>-1;)c!==e&&Qe.call(c,i,1),Qe.call(e,i,1);return e}function basePullAt(e,t){for(var a=e?t.length:0,r=a-1;a--;){var n=t[a];if(a==r||n!==s){var s=n;isIndex(n)?Qe.call(e,n,1):baseUnset(e,n)}}return e}function baseRandom(e,t){return e+gt(Rt()*(t-e+1))}function baseRepeat(e,t){var a="";if(!e||t<1||t>u)return a;do{t%2&&(a+=e),(t=gt(t/2))&&(e+=e)}while(t);return a}function baseRest(e,t){return ya(overRest(e,t,identity),e+"")}function baseSample(e){return arraySample(values(e))}function baseSampleSize(e,t){var a=values(e);return shuffleSelf(a,baseClamp(t,0,a.length))}function baseSet(t,a,r,n){if(!isObject(t))return t;for(var s=-1,l=(a=castPath(a,t)).length,c=l-1,i=t;null!=i&&++s<l;){var o=toKey(a[s]),u=r;if("__proto__"===o||"constructor"===o||"prototype"===o)return t;if(s!=c){var m=i[o];(u=n?n(m,o,i):e)===e&&(u=isObject(m)?m:isIndex(a[s+1])?[]:{})}assignValue(i,o,u),i=i[o]}return t}var sa=$t?function(e,t){return $t.set(e,t),e}:identity,la=ot?function(e,t){return ot(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity;function baseShuffle(e){return shuffleSelf(values(e))}function baseSlice(e,t,a){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(a=a>n?n:a)<0&&(a+=n),n=t>a?0:a-t>>>0,t>>>=0;for(var s=xe(n);++r<n;)s[r]=e[r+t];return s}function baseSome(e,t){var a;return ta(e,function(e,r,n){return!(a=t(e,r,n))}),!!a}function baseSortedIndex(e,t,a){var r=0,n=null==e?r:e.length;if("number"==typeof t&&t==t&&n<=2147483647){for(;r<n;){var s=r+n>>>1,l=e[s];null!==l&&!isSymbol(l)&&(a?l<=t:l<t)?r=s+1:n=s}return n}return baseSortedIndexBy(e,t,identity,a)}function baseSortedIndexBy(t,a,r,n){var s=0,l=null==t?0:t.length;if(0===l)return 0;for(var c=(a=r(a))!=a,i=null===a,o=isSymbol(a),u=a===e;s<l;){var m=gt((s+l)/2),d=r(t[m]),p=d!==e,f=null===d,h=d==d,g=isSymbol(d);if(c)var y=n||h;else y=u?h&&(n||p):i?h&&p&&(n||!f):o?h&&p&&!f&&(n||!g):!f&&!g&&(n?d<=a:d<a);y?s=m+1:l=m}return Ft(l,4294967294)}function baseSortedUniq(e,t){for(var a=-1,r=e.length,n=0,s=[];++a<r;){var l=e[a],c=t?t(l):l;if(!a||!eq(c,i)){var i=c;s[n++]=0===l?0:l}}return s}function baseToNumber(e){return"number"==typeof e?e:isSymbol(e)?m:+e}function baseToString(e){if("string"==typeof e)return e;if(rr(e))return arrayMap(e,baseToString)+"";if(isSymbol(e))return Xt?Xt.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function baseUniq(e,t,a){var r=-1,n=arrayIncludes,s=e.length,l=!0,c=[],i=c;if(a)l=!1,n=arrayIncludesWith;else if(s>=200){var o=t?null:oa(e);if(o)return setToArray(o);l=!1,n=cacheHas,i=new SetCache}else i=t?[]:c;e:for(;++r<s;){var u=e[r],m=t?t(u):u;if(u=a||0!==u?u:0,l&&m==m){for(var d=i.length;d--;)if(i[d]===m)continue e;t&&i.push(m),c.push(u)}else n(i,m,a)||(i!==c&&i.push(m),c.push(u))}return c}function baseUnset(e,t){return null==(e=parent(e,t=castPath(t,e)))||delete e[toKey(last(t))]}function baseUpdate(e,t,a,r){return baseSet(e,t,a(baseGet(e,t)),r)}function baseWhile(e,t,a,r){for(var n=e.length,s=r?n:-1;(r?s--:++s<n)&&t(e[s],s,e););return a?baseSlice(e,r?0:s,r?s+1:n):baseSlice(e,r?s+1:0,r?n:s)}function baseWrapperValue(e,t){var a=e;return a instanceof LazyWrapper&&(a=a.value()),arrayReduce(t,function(e,t){return t.func.apply(t.thisArg,arrayPush([e],t.args))},a)}function baseXor(e,t,a){var r=e.length;if(r<2)return r?baseUniq(e[0]):[];for(var n=-1,s=xe(r);++n<r;)for(var l=e[n],c=-1;++c<r;)c!=n&&(s[n]=baseDifference(s[n]||l,e[c],t,a));return baseUniq(baseFlatten(s,1),t,a)}function baseZipObject(t,a,r){for(var n=-1,s=t.length,l=a.length,c={};++n<s;){var i=n<l?a[n]:e;r(c,t[n],i)}return c}function castArrayLikeObject(e){return isArrayLikeObject(e)?e:[]}function castFunction(e){return"function"==typeof e?e:identity}function castPath(e,t){return rr(e)?e:isKey(e,t)?[e]:ba(toString(e))}var ca=baseRest;function castSlice(t,a,r){var n=t.length;return r=r===e?n:r,!a&&r>=n?t:baseSlice(t,a,r)}var ia=ut||function(e){return mt.clearTimeout(e)};function cloneBuffer(e,t){if(t)return e.slice();var a=e.length,r=Ke?Ke(a):new e.constructor(a);return e.copy(r),r}function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new $e(t).set(new $e(e)),t}function cloneTypedArray(e,t){var a=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function compareAscending(t,a){if(t!==a){var r=t!==e,n=null===t,s=t==t,l=isSymbol(t),c=a!==e,i=null===a,o=a==a,u=isSymbol(a);if(!i&&!u&&!l&&t>a||l&&c&&o&&!i&&!u||n&&c&&o||!r&&o||!s)return 1;if(!n&&!l&&!u&&t<a||u&&r&&s&&!n&&!l||i&&r&&s||!c&&s||!o)return-1}return 0}function composeArgs(e,t,a,r){for(var n=-1,s=e.length,l=a.length,c=-1,i=t.length,o=zt(s-l,0),u=xe(i+o),m=!r;++c<i;)u[c]=t[c];for(;++n<l;)(m||n<s)&&(u[a[n]]=e[n]);for(;o--;)u[c++]=e[n++];return u}function composeArgsRight(e,t,a,r){for(var n=-1,s=e.length,l=-1,c=a.length,i=-1,o=t.length,u=zt(s-c,0),m=xe(u+o),d=!r;++n<u;)m[n]=e[n];for(var p=n;++i<o;)m[p+i]=t[i];for(;++l<c;)(d||n<s)&&(m[p+a[l]]=e[n++]);return m}function copyArray(e,t){var a=-1,r=e.length;for(t||(t=xe(r));++a<r;)t[a]=e[a];return t}function copyObject(t,a,r,n){var s=!r;r||(r={});for(var l=-1,c=a.length;++l<c;){var i=a[l],o=n?n(r[i],t[i],i,r,t):e;o===e&&(o=t[i]),s?baseAssignValue(r,i,o):assignValue(r,i,o)}return r}function createAggregator(e,t){return function(a,r){var n=rr(a)?arrayAggregator:baseAggregator,s=t?t():{};return n(a,e,getIteratee(r,2),s)}}function createAssigner(t){return baseRest(function(a,r){var n=-1,s=r.length,l=s>1?r[s-1]:e,c=s>2?r[2]:e;for(l=t.length>3&&"function"==typeof l?(s--,l):e,c&&isIterateeCall(r[0],r[1],c)&&(l=s<3?e:l,s=1),a=ke(a);++n<s;){var i=r[n];i&&t(a,i,n,l)}return a})}function createBaseEach(e,t){return function(a,r){if(null==a)return a;if(!isArrayLike(a))return e(a,r);for(var n=a.length,s=t?n:-1,l=ke(a);(t?s--:++s<n)&&!1!==r(l[s],s,l););return a}}function createBaseFor(e){return function(t,a,r){for(var n=-1,s=ke(t),l=r(t),c=l.length;c--;){var i=l[e?c:++n];if(!1===a(s[i],i,s))break}return t}}function createCaseFirst(t){return function(a){var r=hasUnicode(a=toString(a))?stringToArray(a):e,n=r?r[0]:a.charAt(0),s=r?castSlice(r,1).join(""):a.slice(1);return n[t]()+s}}function createCompounder(e){return function(t){return arrayReduce(words(deburr(t).replace(Ze,"")),e,"")}}function createCtor(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var a=ea(e.prototype),r=e.apply(a,t);return isObject(r)?r:a}}function createFind(t){return function(a,r,n){var s=ke(a);if(!isArrayLike(a)){var l=getIteratee(r,3);a=keys(a),r=function(e){return l(s[e],e,s)}}var c=t(a,r,n);return c>-1?s[l?a[c]:c]:e}}function createFlow(a){return flatRest(function(r){var n=r.length,s=n,l=LodashWrapper.prototype.thru;for(a&&r.reverse();s--;){var c=r[s];if("function"!=typeof c)throw new Ae(t);if(l&&!i&&"wrapper"==getFuncName(c))var i=new LodashWrapper([],!0)}for(s=i?s:n;++s<n;){var o=getFuncName(c=r[s]),u="wrapper"==o?ua(c):e;i=u&&isLaziable(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?i[getFuncName(u[0])].apply(i,u[3]):1==c.length&&isLaziable(c)?i[o]():i.thru(c)}return function(){var e=arguments,t=e[0];if(i&&1==e.length&&rr(t))return i.plant(t).value();for(var a=0,s=n?r[a].apply(this,e):t;++a<n;)s=r[a].call(this,s);return s}})}function createHybrid(t,a,r,n,s,l,i,o,u,m){var d=a&c,p=1&a,f=2&a,h=24&a,g=512&a,y=f?e:createCtor(t);return function wrapper(){for(var c=arguments.length,b=xe(c),E=c;E--;)b[E]=arguments[E];if(h)var v=getHolder(wrapper),x=function countHolders(e,t){for(var a=e.length,r=0;a--;)e[a]===t&&++r;return r}(b,v);if(n&&(b=composeArgs(b,n,s,h)),l&&(b=composeArgsRight(b,l,i,h)),c-=x,h&&c<m){var w=replaceHolders(b,v);return createRecurry(t,a,createHybrid,wrapper.placeholder,r,b,w,o,u,m-c)}var N=p?r:this,_=f?N[t]:t;return c=b.length,o?b=function reorder(t,a){for(var r=t.length,n=Ft(a.length,r),s=copyArray(t);n--;){var l=a[n];t[n]=isIndex(l,r)?s[l]:e}return t}(b,o):g&&c>1&&b.reverse(),d&&u<c&&(b.length=u),this&&this!==mt&&this instanceof wrapper&&(_=y||createCtor(_)),_.apply(N,b)}}function createInverter(e,t){return function(a,r){return function baseInverter(e,t,a,r){return baseForOwn(e,function(e,n,s){t(r,a(e),n,s)}),r}(a,e,t(r),{})}}function createMathOperation(t,a){return function(r,n){var s;if(r===e&&n===e)return a;if(r!==e&&(s=r),n!==e){if(s===e)return n;"string"==typeof r||"string"==typeof n?(r=baseToString(r),n=baseToString(n)):(r=baseToNumber(r),n=baseToNumber(n)),s=t(r,n)}return s}}function createOver(e){return flatRest(function(t){return t=arrayMap(t,baseUnary(getIteratee())),baseRest(function(a){var r=this;return e(t,function(e){return apply(e,r,a)})})})}function createPadding(t,a){var r=(a=a===e?" ":baseToString(a)).length;if(r<2)return r?baseRepeat(a,t):a;var n=baseRepeat(a,ht(t/stringSize(a)));return hasUnicode(a)?castSlice(stringToArray(n),0,t).join(""):n.slice(0,t)}function createRange(t){return function(a,r,n){return n&&"number"!=typeof n&&isIterateeCall(a,r,n)&&(r=n=e),a=toFinite(a),r===e?(r=a,a=0):r=toFinite(r),function baseRange(e,t,a,r){for(var n=-1,s=zt(ht((t-e)/(a||1)),0),l=xe(s);s--;)l[r?s:++n]=e,e+=a;return l}(a,r,n=n===e?a<r?1:-1:toFinite(n),t)}}function createRelationalOperation(e){return function(t,a){return"string"==typeof t&&"string"==typeof a||(t=toNumber(t),a=toNumber(a)),e(t,a)}}function createRecurry(t,a,r,n,c,i,o,u,m,d){var p=8&a;a|=p?s:l,4&(a&=~(p?l:s))||(a&=-4);var f=[t,a,c,p?i:e,p?o:e,p?e:i,p?e:o,u,m,d],h=r.apply(e,f);return isLaziable(t)&&ha(h,f),h.placeholder=n,setWrapToString(h,t,a)}function createRound(e){var t=Se[e];return function(e,a){if(e=toNumber(e),(a=null==a?0:Ft(toInteger(a),292))&&St(e)){var r=(toString(e)+"e").split("e");return+((r=(toString(t(r[0]+"e"+(+r[1]+a)))+"e").split("e"))[0]+"e"+(+r[1]-a))}return t(e)}}var oa=Wt&&1/setToArray(new Wt([,-0]))[1]==o?function(e){return new Wt(e)}:noop;function createToPairs(e){return function(t){var a=pa(t);return a==x?mapToArray(t):a==k?function setToPairs(e){var t=-1,a=Array(e.size);return e.forEach(function(e){a[++t]=[e,e]}),a}(t):function baseToPairs(e,t){return arrayMap(t,function(t){return[t,e[t]]})}(t,e(t))}}function createWrap(a,o,u,m,d,p,f,h){var g=2&o;if(!g&&"function"!=typeof a)throw new Ae(t);var y=m?m.length:0;if(y||(o&=-97,m=d=e),f=f===e?f:zt(toInteger(f),0),h=h===e?h:toInteger(h),y-=d?d.length:0,o&l){var b=m,E=d;m=d=e}var v=g?e:ua(a),x=[a,o,u,m,d,b,E,p,f,h];if(v&&function mergeData(e,t){var a=e[1],n=t[1],s=a|n,l=s<131,o=n==c&&8==a||n==c&&a==i&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==a;if(!l&&!o)return e;1&n&&(e[2]=t[2],s|=1&a?0:4);var u=t[3];if(u){var m=e[3];e[3]=m?composeArgs(m,u,t[4]):u,e[4]=m?replaceHolders(e[3],r):t[4]}return(u=t[5])&&(m=e[5],e[5]=m?composeArgsRight(m,u,t[6]):u,e[6]=m?replaceHolders(e[5],r):t[6]),(u=t[7])&&(e[7]=u),n&c&&(e[8]=null==e[8]?t[8]:Ft(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=s,e}(x,v),a=x[0],o=x[1],u=x[2],m=x[3],d=x[4],!(h=x[9]=x[9]===e?g?0:a.length:zt(x[9]-y,0))&&24&o&&(o&=-25),o&&1!=o)w=8==o||o==n?function createCurry(t,a,r){var n=createCtor(t);return function wrapper(){for(var s=arguments.length,l=xe(s),c=s,i=getHolder(wrapper);c--;)l[c]=arguments[c];var o=s<3&&l[0]!==i&&l[s-1]!==i?[]:replaceHolders(l,i);return(s-=o.length)<r?createRecurry(t,a,createHybrid,wrapper.placeholder,e,l,o,e,e,r-s):apply(this&&this!==mt&&this instanceof wrapper?n:t,this,l)}}(a,o,h):o!=s&&33!=o||d.length?createHybrid.apply(e,x):function createPartial(e,t,a,r){var n=1&t,s=createCtor(e);return function wrapper(){for(var t=-1,l=arguments.length,c=-1,i=r.length,o=xe(i+l),u=this&&this!==mt&&this instanceof wrapper?s:e;++c<i;)o[c]=r[c];for(;l--;)o[c++]=arguments[++t];return apply(u,n?a:this,o)}}(a,o,u,m);else var w=function createBind(e,t,a){var r=1&t,n=createCtor(e);return function wrapper(){return(this&&this!==mt&&this instanceof wrapper?n:e).apply(r?a:this,arguments)}}(a,o,u);return setWrapToString((v?sa:ha)(w,x),a,o)}function customDefaultsAssignIn(t,a,r,n){return t===e||eq(t,ze[r])&&!je.call(n,r)?a:t}function customDefaultsMerge(t,a,r,n,s,l){return isObject(t)&&isObject(a)&&(l.set(a,t),baseMerge(t,a,e,customDefaultsMerge,l),l.delete(a)),t}function customOmitClone(t){return isPlainObject(t)?e:t}function equalArrays(t,a,r,n,s,l){var c=1&r,i=t.length,o=a.length;if(i!=o&&!(c&&o>i))return!1;var u=l.get(t),m=l.get(a);if(u&&m)return u==a&&m==t;var d=-1,p=!0,f=2&r?new SetCache:e;for(l.set(t,a),l.set(a,t);++d<i;){var h=t[d],g=a[d];if(n)var y=c?n(g,h,d,a,t,l):n(h,g,d,t,a,l);if(y!==e){if(y)continue;p=!1;break}if(f){if(!arraySome(a,function(e,t){if(!cacheHas(f,t)&&(h===e||s(h,e,r,n,l)))return f.push(t)})){p=!1;break}}else if(h!==g&&!s(h,g,r,n,l)){p=!1;break}}return l.delete(t),l.delete(a),p}function flatRest(t){return ya(overRest(t,e,flatten),t+"")}function getAllKeys(e){return baseGetAllKeys(e,keys,ma)}function getAllKeysIn(e){return baseGetAllKeys(e,keysIn,da)}var ua=$t?function(e){return $t.get(e)}:noop;function getFuncName(e){for(var t=e.name+"",a=Kt[t],r=je.call(Kt,t)?a.length:0;r--;){var n=a[r],s=n.func;if(null==s||s==e)return n.name}return t}function getHolder(e){return(je.call(lodash2,"placeholder")?lodash2:e).placeholder}function getIteratee(){var e=lodash2.iteratee||iteratee;return e=e===iteratee?baseIteratee:e,arguments.length?e(arguments[0],arguments[1]):e}function getMapData(e,t){var a=e.__data__;return function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?a["string"==typeof t?"string":"hash"]:a.map}function getMatchData(e){for(var t=keys(e),a=t.length;a--;){var r=t[a],n=e[r];t[a]=[r,n,isStrictComparable(n)]}return t}function getNative(t,a){var r=function getValue(t,a){return null==t?e:t[a]}(t,a);return baseIsNative(r)?r:e}var ma=yt?function(e){return null==e?[]:(e=ke(e),arrayFilter(yt(e),function(t){return Ge.call(e,t)}))}:stubArray,da=yt?function(e){for(var t=[];e;)arrayPush(t,ma(e)),e=Ve(e);return t}:stubArray,pa=baseGetTag;function hasPath(e,t,a){for(var r=-1,n=(t=castPath(t,e)).length,s=!1;++r<n;){var l=toKey(t[r]);if(!(s=null!=e&&a(e,l)))break;e=e[l]}return s||++r!=n?s:!!(n=null==e?0:e.length)&&isLength(n)&&isIndex(l,n)&&(rr(e)||ar(e))}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:ea(Ve(e))}function isFlattenable(e){return rr(e)||ar(e)||!!(Je&&e&&e[Je])}function isIndex(e,t){var a=typeof e;return!!(t=null==t?u:t)&&("number"==a||"symbol"!=a&&ge.test(e))&&e>-1&&e%1==0&&e<t}function isIterateeCall(e,t,a){if(!isObject(a))return!1;var r=typeof t;return!!("number"==r?isArrayLike(a)&&isIndex(t,a.length):"string"==r&&t in a)&&eq(a[t],e)}function isKey(e,t){if(rr(e))return!1;var a=typeof e;return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=e&&!isSymbol(e))||J.test(e)||!Y.test(e)||null!=t&&e in ke(t)}function isLaziable(e){var t=getFuncName(e),a=lodash2[t];if("function"!=typeof a||!(t in LazyWrapper.prototype))return!1;if(e===a)return!0;var r=ua(a);return!!r&&e===r[0]}(Ut&&pa(new Ut(new ArrayBuffer(1)))!=O||Pt&&pa(new Pt)!=x||Mt&&pa(Mt.resolve())!=_||Wt&&pa(new Wt)!=k||Bt&&pa(new Bt)!=A)&&(pa=function(t){var a=baseGetTag(t),r=a==N?t.constructor:e,n=r?toSource(r):"";if(n)switch(n){case Vt:return O;case Ht:return x;case Gt:return _;case Qt:return k;case Zt:return A}return a});var fa=Fe?isFunction:stubFalse;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ze)}function isStrictComparable(e){return e==e&&!isObject(e)}function matchesStrictComparable(t,a){return function(r){return null!=r&&r[t]===a&&(a!==e||t in ke(r))}}function overRest(t,a,r){return a=zt(a===e?t.length-1:a,0),function(){for(var e=arguments,n=-1,s=zt(e.length-a,0),l=xe(s);++n<s;)l[n]=e[a+n];n=-1;for(var c=xe(a+1);++n<a;)c[n]=e[n];return c[a]=r(l),apply(t,this,c)}}function parent(e,t){return t.length<2?e:baseGet(e,baseSlice(t,0,-1))}function safeGet(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var ha=shortOut(sa),ga=pt||function(e,t){return mt.setTimeout(e,t)},ya=shortOut(la);function setWrapToString(e,t,a){var r=t+"";return ya(e,function insertWrapDetails(e,t){var a=t.length;if(!a)return e;var r=a-1;return t[r]=(a>1?"& ":"")+t[r],t=t.join(a>2?", ":" "),e.replace(ne,"{\n/* [wrapped with "+t+"] */\n")}(r,function updateWrapDetails(e,t){return arrayEach(p,function(a){var r="_."+a[0];t&a[1]&&!arrayIncludes(e,r)&&e.push(r)}),e.sort()}(function getWrapDetails(e){var t=e.match(se);return t?t[1].split(le):[]}(r),a)))}function shortOut(t){var a=0,r=0;return function(){var n=Tt(),s=16-(n-r);if(r=n,s>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(e,arguments)}}function shuffleSelf(t,a){var r=-1,n=t.length,s=n-1;for(a=a===e?n:a;++r<a;){var l=baseRandom(r,s),c=t[l];t[l]=t[r],t[r]=c}return t.length=a,t}var ba=function memoizeCapped(e){var t=memoize(e,function(e){return 500===a.size&&a.clear(),e}),a=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(X,function(e,a,r,n){t.push(r?n.replace(oe,"$1"):a||e)}),t});function toKey(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function toSource(e){if(null!=e){try{return Te.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function wrapperClone(e){if(e instanceof LazyWrapper)return e.clone();var t=new LodashWrapper(e.__wrapped__,e.__chain__);return t.__actions__=copyArray(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ea=baseRest(function(e,t){return isArrayLikeObject(e)?baseDifference(e,baseFlatten(t,1,isArrayLikeObject,!0)):[]}),va=baseRest(function(t,a){var r=last(a);return isArrayLikeObject(r)&&(r=e),isArrayLikeObject(t)?baseDifference(t,baseFlatten(a,1,isArrayLikeObject,!0),getIteratee(r,2)):[]}),xa=baseRest(function(t,a){var r=last(a);return isArrayLikeObject(r)&&(r=e),isArrayLikeObject(t)?baseDifference(t,baseFlatten(a,1,isArrayLikeObject,!0),e,r):[]});function findIndex(e,t,a){var r=null==e?0:e.length;if(!r)return-1;var n=null==a?0:toInteger(a);return n<0&&(n=zt(r+n,0)),baseFindIndex(e,getIteratee(t,3),n)}function findLastIndex(t,a,r){var n=null==t?0:t.length;if(!n)return-1;var s=n-1;return r!==e&&(s=toInteger(r),s=r<0?zt(n+s,0):Ft(s,n-1)),baseFindIndex(t,getIteratee(a,3),s,!0)}function flatten(e){return null!=e&&e.length?baseFlatten(e,1):[]}function head(t){return t&&t.length?t[0]:e}var wa=baseRest(function(e){var t=arrayMap(e,castArrayLikeObject);return t.length&&t[0]===e[0]?baseIntersection(t):[]}),Na=baseRest(function(t){var a=last(t),r=arrayMap(t,castArrayLikeObject);return a===last(r)?a=e:r.pop(),r.length&&r[0]===t[0]?baseIntersection(r,getIteratee(a,2)):[]}),_a=baseRest(function(t){var a=last(t),r=arrayMap(t,castArrayLikeObject);return(a="function"==typeof a?a:e)&&r.pop(),r.length&&r[0]===t[0]?baseIntersection(r,e,a):[]});function last(t){var a=null==t?0:t.length;return a?t[a-1]:e}var Sa=baseRest(pullAll);function pullAll(e,t){return e&&e.length&&t&&t.length?basePullAll(e,t):e}var ka=flatRest(function(e,t){var a=null==e?0:e.length,r=baseAt(e,t);return basePullAt(e,arrayMap(t,function(e){return isIndex(e,a)?+e:e}).sort(compareAscending)),r});function reverse(e){return null==e?e:Lt.call(e)}var Ia=baseRest(function(e){return baseUniq(baseFlatten(e,1,isArrayLikeObject,!0))}),Ca=baseRest(function(t){var a=last(t);return isArrayLikeObject(a)&&(a=e),baseUniq(baseFlatten(t,1,isArrayLikeObject,!0),getIteratee(a,2))}),Aa=baseRest(function(t){var a=last(t);return a="function"==typeof a?a:e,baseUniq(baseFlatten(t,1,isArrayLikeObject,!0),e,a)});function unzip(e){if(!e||!e.length)return[];var t=0;return e=arrayFilter(e,function(e){if(isArrayLikeObject(e))return t=zt(e.length,t),!0}),baseTimes(t,function(t){return arrayMap(e,baseProperty(t))})}function unzipWith(t,a){if(!t||!t.length)return[];var r=unzip(t);return null==a?r:arrayMap(r,function(t){return apply(a,e,t)})}var Da=baseRest(function(e,t){return isArrayLikeObject(e)?baseDifference(e,t):[]}),Oa=baseRest(function(e){return baseXor(arrayFilter(e,isArrayLikeObject))}),za=baseRest(function(t){var a=last(t);return isArrayLikeObject(a)&&(a=e),baseXor(arrayFilter(t,isArrayLikeObject),getIteratee(a,2))}),Fa=baseRest(function(t){var a=last(t);return a="function"==typeof a?a:e,baseXor(arrayFilter(t,isArrayLikeObject),e,a)}),Ta=baseRest(unzip),ja=baseRest(function(t){var a=t.length,r=a>1?t[a-1]:e;return r="function"==typeof r?(t.pop(),r):e,unzipWith(t,r)});function chain(e){var t=lodash2(e);return t.__chain__=!0,t}function thru(e,t){return t(e)}var Ra=flatRest(function(t){var a=t.length,r=a?t[0]:0,n=this.__wrapped__,interceptor=function(e){return baseAt(e,t)};return!(a>1||this.__actions__.length)&&n instanceof LazyWrapper&&isIndex(r)?((n=n.slice(r,+r+(a?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:e}),new LodashWrapper(n,this.__chain__).thru(function(t){return a&&!t.length&&t.push(e),t})):this.thru(interceptor)}),La=createAggregator(function(e,t,a){je.call(e,a)?++e[a]:baseAssignValue(e,a,1)}),Ua=createFind(findIndex),Pa=createFind(findLastIndex);function forEach(e,t){return(rr(e)?arrayEach:ta)(e,getIteratee(t,3))}function forEachRight(e,t){return(rr(e)?arrayEachRight:aa)(e,getIteratee(t,3))}var Ma=createAggregator(function(e,t,a){je.call(e,a)?e[a].push(t):baseAssignValue(e,a,[t])}),Wa=baseRest(function(e,t,a){var r=-1,n="function"==typeof t,s=isArrayLike(e)?xe(e.length):[];return ta(e,function(e){s[++r]=n?apply(t,e,a):baseInvoke(e,t,a)}),s}),Ba=createAggregator(function(e,t,a){baseAssignValue(e,a,t)});function map(e,t){return(rr(e)?arrayMap:baseMap)(e,getIteratee(t,3))}var qa=createAggregator(function(e,t,a){e[a?0:1].push(t)},function(){return[[],[]]}),$a=baseRest(function(e,t){if(null==e)return[];var a=t.length;return a>1&&isIterateeCall(e,t[0],t[1])?t=[]:a>2&&isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),baseOrderBy(e,baseFlatten(t,1),[])}),Ka=dt||function(){return mt.Date.now()};function ary(t,a,r){return a=r?e:a,a=t&&null==a?t.length:a,createWrap(t,c,e,e,e,e,a)}function before(a,r){var n;if("function"!=typeof r)throw new Ae(t);return a=toInteger(a),function(){return--a>0&&(n=r.apply(this,arguments)),a<=1&&(r=e),n}}var Va=baseRest(function(e,t,a){var r=1;if(a.length){var n=replaceHolders(a,getHolder(Va));r|=s}return createWrap(e,r,t,a,n)}),Ha=baseRest(function(e,t,a){var r=3;if(a.length){var n=replaceHolders(a,getHolder(Ha));r|=s}return createWrap(t,r,e,a,n)});function debounce(a,r,n){var s,l,c,i,o,u,m=0,d=!1,p=!1,f=!0;if("function"!=typeof a)throw new Ae(t);function invokeFunc(t){var r=s,n=l;return s=l=e,m=t,i=a.apply(n,r)}function shouldInvoke(t){var a=t-u;return u===e||a>=r||a<0||p&&t-m>=c}function timerExpired(){var e=Ka();if(shouldInvoke(e))return trailingEdge(e);o=ga(timerExpired,function remainingWait(e){var t=r-(e-u);return p?Ft(t,c-(e-m)):t}(e))}function trailingEdge(t){return o=e,f&&s?invokeFunc(t):(s=l=e,i)}function debounced(){var t=Ka(),a=shouldInvoke(t);if(s=arguments,l=this,u=t,a){if(o===e)return function leadingEdge(e){return m=e,o=ga(timerExpired,r),d?invokeFunc(e):i}(u);if(p)return ia(o),o=ga(timerExpired,r),invokeFunc(u)}return o===e&&(o=ga(timerExpired,r)),i}return r=toNumber(r)||0,isObject(n)&&(d=!!n.leading,c=(p="maxWait"in n)?zt(toNumber(n.maxWait)||0,r):c,f="trailing"in n?!!n.trailing:f),debounced.cancel=function cancel(){o!==e&&ia(o),m=0,s=u=l=o=e},debounced.flush=function flush(){return o===e?i:trailingEdge(Ka())},debounced}var Ga=baseRest(function(e,t){return baseDelay(e,1,t)}),Qa=baseRest(function(e,t,a){return baseDelay(e,toNumber(t)||0,a)});function memoize(e,a){if("function"!=typeof e||null!=a&&"function"!=typeof a)throw new Ae(t);var memoized=function(){var t=arguments,r=a?a.apply(this,t):t[0],n=memoized.cache;if(n.has(r))return n.get(r);var s=e.apply(this,t);return memoized.cache=n.set(r,s)||n,s};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(e){if("function"!=typeof e)throw new Ae(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}memoize.Cache=MapCache;var Za=ca(function(e,t){var a=(t=1==t.length&&rr(t[0])?arrayMap(t[0],baseUnary(getIteratee())):arrayMap(baseFlatten(t,1),baseUnary(getIteratee()))).length;return baseRest(function(r){for(var n=-1,s=Ft(r.length,a);++n<s;)r[n]=t[n].call(this,r[n]);return apply(e,this,r)})}),Ya=baseRest(function(t,a){var r=replaceHolders(a,getHolder(Ya));return createWrap(t,s,e,a,r)}),Ja=baseRest(function(t,a){var r=replaceHolders(a,getHolder(Ja));return createWrap(t,l,e,a,r)}),Xa=flatRest(function(t,a){return createWrap(t,i,e,e,e,a)});function eq(e,t){return e===t||e!=e&&t!=t}var er=createRelationalOperation(baseGt),tr=createRelationalOperation(function(e,t){return e>=t}),ar=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&je.call(e,"callee")&&!Ge.call(e,"callee")},rr=xe.isArray,nr=Et?baseUnary(Et):function baseIsArrayBuffer(e){return isObjectLike(e)&&baseGetTag(e)==D};function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}var sr=bt||stubFalse,lr=vt?baseUnary(vt):function baseIsDate(e){return isObjectLike(e)&&baseGetTag(e)==y};function isError(e){if(!isObjectLike(e))return!1;var t=baseGetTag(e);return t==b||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!isPlainObject(e)}function isFunction(e){if(!isObject(e))return!1;var t=baseGetTag(e);return t==E||t==v||"[object AsyncFunction]"==t||"[object Proxy]"==t}function isInteger(e){return"number"==typeof e&&e==toInteger(e)}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function isObjectLike(e){return null!=e&&"object"==typeof e}var cr=xt?baseUnary(xt):function baseIsMap(e){return isObjectLike(e)&&pa(e)==x};function isNumber(e){return"number"==typeof e||isObjectLike(e)&&baseGetTag(e)==w}function isPlainObject(e){if(!isObjectLike(e)||baseGetTag(e)!=N)return!1;var t=Ve(e);if(null===t)return!0;var a=je.call(t,"constructor")&&t.constructor;return"function"==typeof a&&a instanceof a&&Te.call(a)==Pe}var ir=wt?baseUnary(wt):function baseIsRegExp(e){return isObjectLike(e)&&baseGetTag(e)==S},or=Nt?baseUnary(Nt):function baseIsSet(e){return isObjectLike(e)&&pa(e)==k};function isString(e){return"string"==typeof e||!rr(e)&&isObjectLike(e)&&baseGetTag(e)==I}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&baseGetTag(e)==C}var ur=_t?baseUnary(_t):function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!nt[baseGetTag(e)]},mr=createRelationalOperation(baseLt),dr=createRelationalOperation(function(e,t){return e<=t});function toArray(e){if(!e)return[];if(isArrayLike(e))return isString(e)?stringToArray(e):copyArray(e);if(et&&e[et])return function iteratorToArray(e){for(var t,a=[];!(t=e.next()).done;)a.push(t.value);return a}(e[et]());var t=pa(e);return(t==x?mapToArray:t==k?setToArray:values)(e)}function toFinite(e){return e?(e=toNumber(e))===o||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function toInteger(e){var t=toFinite(e),a=t%1;return t==t?a?t-a:t:0}function toLength(e){return e?baseClamp(toInteger(e),0,d):0}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return m;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=baseTrim(e);var a=pe.test(e);return a||he.test(e)?it(e.slice(2),a?2:8):de.test(e)?m:+e}function toPlainObject(e){return copyObject(e,keysIn(e))}function toString(e){return null==e?"":baseToString(e)}var pr=createAssigner(function(e,t){if(isPrototype(t)||isArrayLike(t))copyObject(t,keys(t),e);else for(var a in t)je.call(t,a)&&assignValue(e,a,t[a])}),fr=createAssigner(function(e,t){copyObject(t,keysIn(t),e)}),hr=createAssigner(function(e,t,a,r){copyObject(t,keysIn(t),e,r)}),gr=createAssigner(function(e,t,a,r){copyObject(t,keys(t),e,r)}),yr=flatRest(baseAt),br=baseRest(function(t,a){t=ke(t);var r=-1,n=a.length,s=n>2?a[2]:e;for(s&&isIterateeCall(a[0],a[1],s)&&(n=1);++r<n;)for(var l=a[r],c=keysIn(l),i=-1,o=c.length;++i<o;){var u=c[i],m=t[u];(m===e||eq(m,ze[u])&&!je.call(t,u))&&(t[u]=l[u])}return t}),Er=baseRest(function(t){return t.push(e,customDefaultsMerge),apply(_r,e,t)});function get(t,a,r){var n=null==t?e:baseGet(t,a);return n===e?r:n}function hasIn(e,t){return null!=e&&hasPath(e,t,baseHasIn)}var vr=createInverter(function(e,t,a){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),e[t]=a},constant(identity)),xr=createInverter(function(e,t,a){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),je.call(e,t)?e[t].push(a):e[t]=[a]},getIteratee),wr=baseRest(baseInvoke);function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var Nr=createAssigner(function(e,t,a){baseMerge(e,t,a)}),_r=createAssigner(function(e,t,a,r){baseMerge(e,t,a,r)}),Sr=flatRest(function(e,t){var a={};if(null==e)return a;var r=!1;t=arrayMap(t,function(t){return t=castPath(t,e),r||(r=t.length>1),t}),copyObject(e,getAllKeysIn(e),a),r&&(a=baseClone(a,7,customOmitClone));for(var n=t.length;n--;)baseUnset(a,t[n]);return a}),kr=flatRest(function(e,t){return null==e?{}:function basePick(e,t){return basePickBy(e,t,function(t,a){return hasIn(e,a)})}(e,t)});function pickBy(e,t){if(null==e)return{};var a=arrayMap(getAllKeysIn(e),function(e){return[e]});return t=getIteratee(t),basePickBy(e,a,function(e,a){return t(e,a[0])})}var Ir=createToPairs(keys),Cr=createToPairs(keysIn);function values(e){return null==e?[]:baseValues(e,keys(e))}var Ar=createCompounder(function(e,t,a){return t=t.toLowerCase(),e+(a?capitalize(t):t)});function capitalize(e){return Rr(toString(e).toLowerCase())}function deburr(e){return(e=toString(e))&&e.replace(ye,kt).replace(Ye,"")}var Dr=createCompounder(function(e,t,a){return e+(a?"-":"")+t.toLowerCase()}),Or=createCompounder(function(e,t,a){return e+(a?" ":"")+t.toLowerCase()}),zr=createCaseFirst("toLowerCase"),Fr=createCompounder(function(e,t,a){return e+(a?"_":"")+t.toLowerCase()}),Tr=createCompounder(function(e,t,a){return e+(a?" ":"")+Rr(t)}),jr=createCompounder(function(e,t,a){return e+(a?" ":"")+t.toUpperCase()}),Rr=createCaseFirst("toUpperCase");function words(t,a,r){return t=toString(t),(a=r?e:a)===e?function hasUnicodeWord(e){return tt.test(e)}(t)?function unicodeWords(e){return e.match(Xe)||[]}(t):function asciiWords(e){return e.match(ce)||[]}(t):t.match(a)||[]}var Lr=baseRest(function(t,a){try{return apply(t,e,a)}catch(r){return isError(r)?r:new Ne(r)}}),Ur=flatRest(function(e,t){return arrayEach(t,function(t){t=toKey(t),baseAssignValue(e,t,Va(e[t],e))}),e});function constant(e){return function(){return e}}var Pr=createFlow(),Mr=createFlow(!0);function identity(e){return e}function iteratee(e){return baseIteratee("function"==typeof e?e:baseClone(e,1))}var Wr=baseRest(function(e,t){return function(a){return baseInvoke(a,e,t)}}),Br=baseRest(function(e,t){return function(a){return baseInvoke(e,a,t)}});function mixin(e,t,a){var r=keys(t),n=baseFunctions(t,r);null!=a||isObject(t)&&(n.length||!r.length)||(a=t,t=e,e=this,n=baseFunctions(t,keys(t)));var s=!(isObject(a)&&"chain"in a&&!a.chain),l=isFunction(e);return arrayEach(n,function(a){var r=t[a];e[a]=r,l&&(e.prototype[a]=function(){var t=this.__chain__;if(s||t){var a=e(this.__wrapped__);return(a.__actions__=copyArray(this.__actions__)).push({func:r,args:arguments,thisArg:e}),a.__chain__=t,a}return r.apply(e,arrayPush([this.value()],arguments))})}),e}function noop(){}var qr=createOver(arrayMap),$r=createOver(arrayEvery),Kr=createOver(arraySome);function property(e){return isKey(e)?baseProperty(toKey(e)):function basePropertyDeep(e){return function(t){return baseGet(t,e)}}(e)}var Vr=createRange(),Hr=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}var Gr,Qr=createMathOperation(function(e,t){return e+t},0),Zr=createRound("ceil"),Yr=createMathOperation(function(e,t){return e/t},1),Jr=createRound("floor"),Xr=createMathOperation(function(e,t){return e*t},1),en=createRound("round"),tn=createMathOperation(function(e,t){return e-t},0);return lodash2.after=function after(e,a){if("function"!=typeof a)throw new Ae(t);return e=toInteger(e),function(){if(--e<1)return a.apply(this,arguments)}},lodash2.ary=ary,lodash2.assign=pr,lodash2.assignIn=fr,lodash2.assignInWith=hr,lodash2.assignWith=gr,lodash2.at=yr,lodash2.before=before,lodash2.bind=Va,lodash2.bindAll=Ur,lodash2.bindKey=Ha,lodash2.castArray=function castArray(){if(!arguments.length)return[];var e=arguments[0];return rr(e)?e:[e]},lodash2.chain=chain,lodash2.chunk=function chunk(t,a,r){a=(r?isIterateeCall(t,a,r):a===e)?1:zt(toInteger(a),0);var n=null==t?0:t.length;if(!n||a<1)return[];for(var s=0,l=0,c=xe(ht(n/a));s<n;)c[l++]=baseSlice(t,s,s+=a);return c},lodash2.compact=function compact(e){for(var t=-1,a=null==e?0:e.length,r=0,n=[];++t<a;){var s=e[t];s&&(n[r++]=s)}return n},lodash2.concat=function concat(){var e=arguments.length;if(!e)return[];for(var t=xe(e-1),a=arguments[0],r=e;r--;)t[r-1]=arguments[r];return arrayPush(rr(a)?copyArray(a):[a],baseFlatten(t,1))},lodash2.cond=function cond(e){var a=null==e?0:e.length,r=getIteratee();return e=a?arrayMap(e,function(e){if("function"!=typeof e[1])throw new Ae(t);return[r(e[0]),e[1]]}):[],baseRest(function(t){for(var r=-1;++r<a;){var n=e[r];if(apply(n[0],this,t))return apply(n[1],this,t)}})},lodash2.conforms=function conforms(e){return function baseConforms(e){var t=keys(e);return function(a){return baseConformsTo(a,e,t)}}(baseClone(e,1))},lodash2.constant=constant,lodash2.countBy=La,lodash2.create=function create(e,t){var a=ea(e);return null==t?a:baseAssign(a,t)},lodash2.curry=function curry(t,a,r){var n=createWrap(t,8,e,e,e,e,e,a=r?e:a);return n.placeholder=curry.placeholder,n},lodash2.curryRight=function curryRight(t,a,r){var s=createWrap(t,n,e,e,e,e,e,a=r?e:a);return s.placeholder=curryRight.placeholder,s},lodash2.debounce=debounce,lodash2.defaults=br,lodash2.defaultsDeep=Er,lodash2.defer=Ga,lodash2.delay=Qa,lodash2.difference=Ea,lodash2.differenceBy=va,lodash2.differenceWith=xa,lodash2.drop=function drop(t,a,r){var n=null==t?0:t.length;return n?baseSlice(t,(a=r||a===e?1:toInteger(a))<0?0:a,n):[]},lodash2.dropRight=function dropRight(t,a,r){var n=null==t?0:t.length;return n?baseSlice(t,0,(a=n-(a=r||a===e?1:toInteger(a)))<0?0:a):[]},lodash2.dropRightWhile=function dropRightWhile(e,t){return e&&e.length?baseWhile(e,getIteratee(t,3),!0,!0):[]},lodash2.dropWhile=function dropWhile(e,t){return e&&e.length?baseWhile(e,getIteratee(t,3),!0):[]},lodash2.fill=function fill(t,a,r,n){var s=null==t?0:t.length;return s?(r&&"number"!=typeof r&&isIterateeCall(t,a,r)&&(r=0,n=s),function baseFill(t,a,r,n){var s=t.length;for((r=toInteger(r))<0&&(r=-r>s?0:s+r),(n=n===e||n>s?s:toInteger(n))<0&&(n+=s),n=r>n?0:toLength(n);r<n;)t[r++]=a;return t}(t,a,r,n)):[]},lodash2.filter=function filter(e,t){return(rr(e)?arrayFilter:baseFilter)(e,getIteratee(t,3))},lodash2.flatMap=function flatMap(e,t){return baseFlatten(map(e,t),1)},lodash2.flatMapDeep=function flatMapDeep(e,t){return baseFlatten(map(e,t),o)},lodash2.flatMapDepth=function flatMapDepth(t,a,r){return r=r===e?1:toInteger(r),baseFlatten(map(t,a),r)},lodash2.flatten=flatten,lodash2.flattenDeep=function flattenDeep(e){return null!=e&&e.length?baseFlatten(e,o):[]},lodash2.flattenDepth=function flattenDepth(t,a){return null!=t&&t.length?baseFlatten(t,a=a===e?1:toInteger(a)):[]},lodash2.flip=function flip(e){return createWrap(e,512)},lodash2.flow=Pr,lodash2.flowRight=Mr,lodash2.fromPairs=function fromPairs(e){for(var t=-1,a=null==e?0:e.length,r={};++t<a;){var n=e[t];r[n[0]]=n[1]}return r},lodash2.functions=function functions(e){return null==e?[]:baseFunctions(e,keys(e))},lodash2.functionsIn=function functionsIn(e){return null==e?[]:baseFunctions(e,keysIn(e))},lodash2.groupBy=Ma,lodash2.initial=function initial(e){return null!=e&&e.length?baseSlice(e,0,-1):[]},lodash2.intersection=wa,lodash2.intersectionBy=Na,lodash2.intersectionWith=_a,lodash2.invert=vr,lodash2.invertBy=xr,lodash2.invokeMap=Wa,lodash2.iteratee=iteratee,lodash2.keyBy=Ba,lodash2.keys=keys,lodash2.keysIn=keysIn,lodash2.map=map,lodash2.mapKeys=function mapKeys(e,t){var a={};return t=getIteratee(t,3),baseForOwn(e,function(e,r,n){baseAssignValue(a,t(e,r,n),e)}),a},lodash2.mapValues=function mapValues(e,t){var a={};return t=getIteratee(t,3),baseForOwn(e,function(e,r,n){baseAssignValue(a,r,t(e,r,n))}),a},lodash2.matches=function matches(e){return baseMatches(baseClone(e,1))},lodash2.matchesProperty=function matchesProperty(e,t){return baseMatchesProperty(e,baseClone(t,1))},lodash2.memoize=memoize,lodash2.merge=Nr,lodash2.mergeWith=_r,lodash2.method=Wr,lodash2.methodOf=Br,lodash2.mixin=mixin,lodash2.negate=negate,lodash2.nthArg=function nthArg(e){return e=toInteger(e),baseRest(function(t){return baseNth(t,e)})},lodash2.omit=Sr,lodash2.omitBy=function omitBy(e,t){return pickBy(e,negate(getIteratee(t)))},lodash2.once=function once(e){return before(2,e)},lodash2.orderBy=function orderBy(t,a,r,n){return null==t?[]:(rr(a)||(a=null==a?[]:[a]),rr(r=n?e:r)||(r=null==r?[]:[r]),baseOrderBy(t,a,r))},lodash2.over=qr,lodash2.overArgs=Za,lodash2.overEvery=$r,lodash2.overSome=Kr,lodash2.partial=Ya,lodash2.partialRight=Ja,lodash2.partition=qa,lodash2.pick=kr,lodash2.pickBy=pickBy,lodash2.property=property,lodash2.propertyOf=function propertyOf(t){return function(a){return null==t?e:baseGet(t,a)}},lodash2.pull=Sa,lodash2.pullAll=pullAll,lodash2.pullAllBy=function pullAllBy(e,t,a){return e&&e.length&&t&&t.length?basePullAll(e,t,getIteratee(a,2)):e},lodash2.pullAllWith=function pullAllWith(t,a,r){return t&&t.length&&a&&a.length?basePullAll(t,a,e,r):t},lodash2.pullAt=ka,lodash2.range=Vr,lodash2.rangeRight=Hr,lodash2.rearg=Xa,lodash2.reject=function reject(e,t){return(rr(e)?arrayFilter:baseFilter)(e,negate(getIteratee(t,3)))},lodash2.remove=function remove(e,t){var a=[];if(!e||!e.length)return a;var r=-1,n=[],s=e.length;for(t=getIteratee(t,3);++r<s;){var l=e[r];t(l,r,e)&&(a.push(l),n.push(r))}return basePullAt(e,n),a},lodash2.rest=function rest(a,r){if("function"!=typeof a)throw new Ae(t);return baseRest(a,r=r===e?r:toInteger(r))},lodash2.reverse=reverse,lodash2.sampleSize=function sampleSize(t,a,r){return a=(r?isIterateeCall(t,a,r):a===e)?1:toInteger(a),(rr(t)?arraySampleSize:baseSampleSize)(t,a)},lodash2.set=function set(e,t,a){return null==e?e:baseSet(e,t,a)},lodash2.setWith=function setWith(t,a,r,n){return n="function"==typeof n?n:e,null==t?t:baseSet(t,a,r,n)},lodash2.shuffle=function shuffle(e){return(rr(e)?arrayShuffle:baseShuffle)(e)},lodash2.slice=function slice(t,a,r){var n=null==t?0:t.length;return n?(r&&"number"!=typeof r&&isIterateeCall(t,a,r)?(a=0,r=n):(a=null==a?0:toInteger(a),r=r===e?n:toInteger(r)),baseSlice(t,a,r)):[]},lodash2.sortBy=$a,lodash2.sortedUniq=function sortedUniq(e){return e&&e.length?baseSortedUniq(e):[]},lodash2.sortedUniqBy=function sortedUniqBy(e,t){return e&&e.length?baseSortedUniq(e,getIteratee(t,2)):[]},lodash2.split=function split(t,a,r){return r&&"number"!=typeof r&&isIterateeCall(t,a,r)&&(a=r=e),(r=r===e?d:r>>>0)?(t=toString(t))&&("string"==typeof a||null!=a&&!ir(a))&&!(a=baseToString(a))&&hasUnicode(t)?castSlice(stringToArray(t),0,r):t.split(a,r):[]},lodash2.spread=function spread(e,a){if("function"!=typeof e)throw new Ae(t);return a=null==a?0:zt(toInteger(a),0),baseRest(function(t){var r=t[a],n=castSlice(t,0,a);return r&&arrayPush(n,r),apply(e,this,n)})},lodash2.tail=function tail(e){var t=null==e?0:e.length;return t?baseSlice(e,1,t):[]},lodash2.take=function take(t,a,r){return t&&t.length?baseSlice(t,0,(a=r||a===e?1:toInteger(a))<0?0:a):[]},lodash2.takeRight=function takeRight(t,a,r){var n=null==t?0:t.length;return n?baseSlice(t,(a=n-(a=r||a===e?1:toInteger(a)))<0?0:a,n):[]},lodash2.takeRightWhile=function takeRightWhile(e,t){return e&&e.length?baseWhile(e,getIteratee(t,3),!1,!0):[]},lodash2.takeWhile=function takeWhile(e,t){return e&&e.length?baseWhile(e,getIteratee(t,3)):[]},lodash2.tap=function tap(e,t){return t(e),e},lodash2.throttle=function throttle(e,a,r){var n=!0,s=!0;if("function"!=typeof e)throw new Ae(t);return isObject(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),debounce(e,a,{leading:n,maxWait:a,trailing:s})},lodash2.thru=thru,lodash2.toArray=toArray,lodash2.toPairs=Ir,lodash2.toPairsIn=Cr,lodash2.toPath=function toPath(e){return rr(e)?arrayMap(e,toKey):isSymbol(e)?[e]:copyArray(ba(toString(e)))},lodash2.toPlainObject=toPlainObject,lodash2.transform=function transform(e,t,a){var r=rr(e),n=r||sr(e)||ur(e);if(t=getIteratee(t,4),null==a){var s=e&&e.constructor;a=n?r?new s:[]:isObject(e)&&isFunction(s)?ea(Ve(e)):{}}return(n?arrayEach:baseForOwn)(e,function(e,r,n){return t(a,e,r,n)}),a},lodash2.unary=function unary(e){return ary(e,1)},lodash2.union=Ia,lodash2.unionBy=Ca,lodash2.unionWith=Aa,lodash2.uniq=function uniq(e){return e&&e.length?baseUniq(e):[]},lodash2.uniqBy=function uniqBy(e,t){return e&&e.length?baseUniq(e,getIteratee(t,2)):[]},lodash2.uniqWith=function uniqWith(t,a){return a="function"==typeof a?a:e,t&&t.length?baseUniq(t,e,a):[]},lodash2.unset=function unset(e,t){return null==e||baseUnset(e,t)},lodash2.unzip=unzip,lodash2.unzipWith=unzipWith,lodash2.update=function update(e,t,a){return null==e?e:baseUpdate(e,t,castFunction(a))},lodash2.updateWith=function updateWith(t,a,r,n){return n="function"==typeof n?n:e,null==t?t:baseUpdate(t,a,castFunction(r),n)},lodash2.values=values,lodash2.valuesIn=function valuesIn(e){return null==e?[]:baseValues(e,keysIn(e))},lodash2.without=Da,lodash2.words=words,lodash2.wrap=function wrap(e,t){return Ya(castFunction(t),e)},lodash2.xor=Oa,lodash2.xorBy=za,lodash2.xorWith=Fa,lodash2.zip=Ta,lodash2.zipObject=function zipObject(e,t){return baseZipObject(e||[],t||[],assignValue)},lodash2.zipObjectDeep=function zipObjectDeep(e,t){return baseZipObject(e||[],t||[],baseSet)},lodash2.zipWith=ja,lodash2.entries=Ir,lodash2.entriesIn=Cr,lodash2.extend=fr,lodash2.extendWith=hr,mixin(lodash2,lodash2),lodash2.add=Qr,lodash2.attempt=Lr,lodash2.camelCase=Ar,lodash2.capitalize=capitalize,lodash2.ceil=Zr,lodash2.clamp=function clamp(t,a,r){return r===e&&(r=a,a=e),r!==e&&(r=(r=toNumber(r))==r?r:0),a!==e&&(a=(a=toNumber(a))==a?a:0),baseClamp(toNumber(t),a,r)},lodash2.clone=function clone(e){return baseClone(e,4)},lodash2.cloneDeep=function cloneDeep(e){return baseClone(e,5)},lodash2.cloneDeepWith=function cloneDeepWith(t,a){return baseClone(t,5,a="function"==typeof a?a:e)},lodash2.cloneWith=function cloneWith(t,a){return baseClone(t,4,a="function"==typeof a?a:e)},lodash2.conformsTo=function conformsTo(e,t){return null==t||baseConformsTo(e,t,keys(t))},lodash2.deburr=deburr,lodash2.defaultTo=function defaultTo(e,t){return null==e||e!=e?t:e},lodash2.divide=Yr,lodash2.endsWith=function endsWith(t,a,r){t=toString(t),a=baseToString(a);var n=t.length,s=r=r===e?n:baseClamp(toInteger(r),0,n);return(r-=a.length)>=0&&t.slice(r,s)==a},lodash2.eq=eq,lodash2.escape=function escape(e){return(e=toString(e))&&H.test(e)?e.replace(K,It):e},lodash2.escapeRegExp=function escapeRegExp(e){return(e=toString(e))&&te.test(e)?e.replace(ee,"\\$&"):e},lodash2.every=function every(t,a,r){var n=rr(t)?arrayEvery:baseEvery;return r&&isIterateeCall(t,a,r)&&(a=e),n(t,getIteratee(a,3))},lodash2.find=Ua,lodash2.findIndex=findIndex,lodash2.findKey=function findKey(e,t){return baseFindKey(e,getIteratee(t,3),baseForOwn)},lodash2.findLast=Pa,lodash2.findLastIndex=findLastIndex,lodash2.findLastKey=function findLastKey(e,t){return baseFindKey(e,getIteratee(t,3),baseForOwnRight)},lodash2.floor=Jr,lodash2.forEach=forEach,lodash2.forEachRight=forEachRight,lodash2.forIn=function forIn(e,t){return null==e?e:ra(e,getIteratee(t,3),keysIn)},lodash2.forInRight=function forInRight(e,t){return null==e?e:na(e,getIteratee(t,3),keysIn)},lodash2.forOwn=function forOwn(e,t){return e&&baseForOwn(e,getIteratee(t,3))},lodash2.forOwnRight=function forOwnRight(e,t){return e&&baseForOwnRight(e,getIteratee(t,3))},lodash2.get=get,lodash2.gt=er,lodash2.gte=tr,lodash2.has=function has(e,t){return null!=e&&hasPath(e,t,baseHas)},lodash2.hasIn=hasIn,lodash2.head=head,lodash2.identity=identity,lodash2.includes=function includes(e,t,a,r){e=isArrayLike(e)?e:values(e),a=a&&!r?toInteger(a):0;var n=e.length;return a<0&&(a=zt(n+a,0)),isString(e)?a<=n&&e.indexOf(t,a)>-1:!!n&&baseIndexOf(e,t,a)>-1},lodash2.indexOf=function indexOf(e,t,a){var r=null==e?0:e.length;if(!r)return-1;var n=null==a?0:toInteger(a);return n<0&&(n=zt(r+n,0)),baseIndexOf(e,t,n)},lodash2.inRange=function inRange(t,a,r){return a=toFinite(a),r===e?(r=a,a=0):r=toFinite(r),function baseInRange(e,t,a){return e>=Ft(t,a)&&e<zt(t,a)}(t=toNumber(t),a,r)},lodash2.invoke=wr,lodash2.isArguments=ar,lodash2.isArray=rr,lodash2.isArrayBuffer=nr,lodash2.isArrayLike=isArrayLike,lodash2.isArrayLikeObject=isArrayLikeObject,lodash2.isBoolean=function isBoolean(e){return!0===e||!1===e||isObjectLike(e)&&baseGetTag(e)==g},lodash2.isBuffer=sr,lodash2.isDate=lr,lodash2.isElement=function isElement(e){return isObjectLike(e)&&1===e.nodeType&&!isPlainObject(e)},lodash2.isEmpty=function isEmpty(e){if(null==e)return!0;if(isArrayLike(e)&&(rr(e)||"string"==typeof e||"function"==typeof e.splice||sr(e)||ur(e)||ar(e)))return!e.length;var t=pa(e);if(t==x||t==k)return!e.size;if(isPrototype(e))return!baseKeys(e).length;for(var a in e)if(je.call(e,a))return!1;return!0},lodash2.isEqual=function isEqual(e,t){return baseIsEqual(e,t)},lodash2.isEqualWith=function isEqualWith(t,a,r){var n=(r="function"==typeof r?r:e)?r(t,a):e;return n===e?baseIsEqual(t,a,e,r):!!n},lodash2.isError=isError,lodash2.isFinite=function isFinite(e){return"number"==typeof e&&St(e)},lodash2.isFunction=isFunction,lodash2.isInteger=isInteger,lodash2.isLength=isLength,lodash2.isMap=cr,lodash2.isMatch=function isMatch(e,t){return e===t||baseIsMatch(e,t,getMatchData(t))},lodash2.isMatchWith=function isMatchWith(t,a,r){return r="function"==typeof r?r:e,baseIsMatch(t,a,getMatchData(a),r)},lodash2.isNaN=function isNaN(e){return isNumber(e)&&e!=+e},lodash2.isNative=function isNative(e){if(fa(e))throw new Ne("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return baseIsNative(e)},lodash2.isNil=function isNil(e){return null==e},lodash2.isNull=function isNull(e){return null===e},lodash2.isNumber=isNumber,lodash2.isObject=isObject,lodash2.isObjectLike=isObjectLike,lodash2.isPlainObject=isPlainObject,lodash2.isRegExp=ir,lodash2.isSafeInteger=function isSafeInteger(e){return isInteger(e)&&e>=-9007199254740991&&e<=u},lodash2.isSet=or,lodash2.isString=isString,lodash2.isSymbol=isSymbol,lodash2.isTypedArray=ur,lodash2.isUndefined=function isUndefined(t){return t===e},lodash2.isWeakMap=function isWeakMap(e){return isObjectLike(e)&&pa(e)==A},lodash2.isWeakSet=function isWeakSet(e){return isObjectLike(e)&&"[object WeakSet]"==baseGetTag(e)},lodash2.join=function join(e,t){return null==e?"":Dt.call(e,t)},lodash2.kebabCase=Dr,lodash2.last=last,lodash2.lastIndexOf=function lastIndexOf(t,a,r){var n=null==t?0:t.length;if(!n)return-1;var s=n;return r!==e&&(s=(s=toInteger(r))<0?zt(n+s,0):Ft(s,n-1)),a==a?function strictLastIndexOf(e,t,a){for(var r=a+1;r--;)if(e[r]===t)return r;return r}(t,a,s):baseFindIndex(t,baseIsNaN,s,!0)},lodash2.lowerCase=Or,lodash2.lowerFirst=zr,lodash2.lt=mr,lodash2.lte=dr,lodash2.max=function max(t){return t&&t.length?baseExtremum(t,identity,baseGt):e},lodash2.maxBy=function maxBy(t,a){return t&&t.length?baseExtremum(t,getIteratee(a,2),baseGt):e},lodash2.mean=function mean(e){return baseMean(e,identity)},lodash2.meanBy=function meanBy(e,t){return baseMean(e,getIteratee(t,2))},lodash2.min=function min(t){return t&&t.length?baseExtremum(t,identity,baseLt):e},lodash2.minBy=function minBy(t,a){return t&&t.length?baseExtremum(t,getIteratee(a,2),baseLt):e},lodash2.stubArray=stubArray,lodash2.stubFalse=stubFalse,lodash2.stubObject=function stubObject(){return{}},lodash2.stubString=function stubString(){return""},lodash2.stubTrue=function stubTrue(){return!0},lodash2.multiply=Xr,lodash2.nth=function nth(t,a){return t&&t.length?baseNth(t,toInteger(a)):e},lodash2.noConflict=function noConflict(){return mt._===this&&(mt._=Me),this},lodash2.noop=noop,lodash2.now=Ka,lodash2.pad=function pad(e,t,a){e=toString(e);var r=(t=toInteger(t))?stringSize(e):0;if(!t||r>=t)return e;var n=(t-r)/2;return createPadding(gt(n),a)+e+createPadding(ht(n),a)},lodash2.padEnd=function padEnd(e,t,a){e=toString(e);var r=(t=toInteger(t))?stringSize(e):0;return t&&r<t?e+createPadding(t-r,a):e},lodash2.padStart=function padStart(e,t,a){e=toString(e);var r=(t=toInteger(t))?stringSize(e):0;return t&&r<t?createPadding(t-r,a)+e:e},lodash2.parseInt=function parseInt2(e,t,a){return a||null==t?t=0:t&&(t=+t),jt(toString(e).replace(ae,""),t||0)},lodash2.random=function random(t,a,r){if(r&&"boolean"!=typeof r&&isIterateeCall(t,a,r)&&(a=r=e),r===e&&("boolean"==typeof a?(r=a,a=e):"boolean"==typeof t&&(r=t,t=e)),t===e&&a===e?(t=0,a=1):(t=toFinite(t),a===e?(a=t,t=0):a=toFinite(a)),t>a){var n=t;t=a,a=n}if(r||t%1||a%1){var s=Rt();return Ft(t+s*(a-t+ct("1e-"+((s+"").length-1))),a)}return baseRandom(t,a)},lodash2.reduce=function reduce(e,t,a){var r=rr(e)?arrayReduce:baseReduce,n=arguments.length<3;return r(e,getIteratee(t,4),a,n,ta)},lodash2.reduceRight=function reduceRight(e,t,a){var r=rr(e)?arrayReduceRight:baseReduce,n=arguments.length<3;return r(e,getIteratee(t,4),a,n,aa)},lodash2.repeat=function repeat(t,a,r){return a=(r?isIterateeCall(t,a,r):a===e)?1:toInteger(a),baseRepeat(toString(t),a)},lodash2.replace=function replace(){var e=arguments,t=toString(e[0]);return e.length<3?t:t.replace(e[1],e[2])},lodash2.result=function result(t,a,r){var n=-1,s=(a=castPath(a,t)).length;for(s||(s=1,t=e);++n<s;){var l=null==t?e:t[toKey(a[n])];l===e&&(n=s,l=r),t=isFunction(l)?l.call(t):l}return t},lodash2.round=en,lodash2.runInContext=runInContext2,lodash2.sample=function sample(e){return(rr(e)?arraySample:baseSample)(e)},lodash2.size=function size(e){if(null==e)return 0;if(isArrayLike(e))return isString(e)?stringSize(e):e.length;var t=pa(e);return t==x||t==k?e.size:baseKeys(e).length},lodash2.snakeCase=Fr,lodash2.some=function some(t,a,r){var n=rr(t)?arraySome:baseSome;return r&&isIterateeCall(t,a,r)&&(a=e),n(t,getIteratee(a,3))},lodash2.sortedIndex=function sortedIndex(e,t){return baseSortedIndex(e,t)},lodash2.sortedIndexBy=function sortedIndexBy(e,t,a){return baseSortedIndexBy(e,t,getIteratee(a,2))},lodash2.sortedIndexOf=function sortedIndexOf(e,t){var a=null==e?0:e.length;if(a){var r=baseSortedIndex(e,t);if(r<a&&eq(e[r],t))return r}return-1},lodash2.sortedLastIndex=function sortedLastIndex(e,t){return baseSortedIndex(e,t,!0)},lodash2.sortedLastIndexBy=function sortedLastIndexBy(e,t,a){return baseSortedIndexBy(e,t,getIteratee(a,2),!0)},lodash2.sortedLastIndexOf=function sortedLastIndexOf(e,t){if(null!=e&&e.length){var a=baseSortedIndex(e,t,!0)-1;if(eq(e[a],t))return a}return-1},lodash2.startCase=Tr,lodash2.startsWith=function startsWith(e,t,a){return e=toString(e),a=null==a?0:baseClamp(toInteger(a),0,e.length),t=baseToString(t),e.slice(a,a+t.length)==t},lodash2.subtract=tn,lodash2.sum=function sum(e){return e&&e.length?baseSum(e,identity):0},lodash2.sumBy=function sumBy(e,t){return e&&e.length?baseSum(e,getIteratee(t,2)):0},lodash2.template=function template(t,a,r){var n=lodash2.templateSettings;r&&isIterateeCall(t,a,r)&&(a=e),t=toString(t),a=hr({},a,n,customDefaultsAssignIn);var s,l,c=hr({},a.imports,n.imports,customDefaultsAssignIn),i=keys(c),o=baseValues(c,i),u=0,m=a.interpolate||be,d="__p += '",p=Ie((a.escape||be).source+"|"+m.source+"|"+(m===Z?ue:be).source+"|"+(a.evaluate||be).source+"|$","g"),f="//# sourceURL="+(je.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rt+"]")+"\n";t.replace(p,function(e,a,r,n,c,i){return r||(r=n),d+=t.slice(u,i).replace(Ee,escapeStringChar),a&&(s=!0,d+="' +\n__e("+a+") +\n'"),c&&(l=!0,d+="';\n"+c+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=i+e.length,e}),d+="';\n";var h=je.call(a,"variable")&&a.variable;if(h){if(ie.test(h))throw new Ne("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(l?d.replace(W,""):d).replace(B,"$1").replace(q,"$1;"),d="function("+(h||"obj")+") {\n"+(h?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Lr(function(){return _e(i,f+"return "+d).apply(e,o)});if(g.source=d,isError(g))throw g;return g},lodash2.times=function times(e,t){if((e=toInteger(e))<1||e>u)return[];var a=d,r=Ft(e,d);t=getIteratee(t),e-=d;for(var n=baseTimes(r,t);++a<e;)t(a);return n},lodash2.toFinite=toFinite,lodash2.toInteger=toInteger,lodash2.toLength=toLength,lodash2.toLower=function toLower(e){return toString(e).toLowerCase()},lodash2.toNumber=toNumber,lodash2.toSafeInteger=function toSafeInteger(e){return e?baseClamp(toInteger(e),-9007199254740991,u):0===e?e:0},lodash2.toString=toString,lodash2.toUpper=function toUpper(e){return toString(e).toUpperCase()},lodash2.trim=function trim(t,a,r){if((t=toString(t))&&(r||a===e))return baseTrim(t);if(!t||!(a=baseToString(a)))return t;var n=stringToArray(t),s=stringToArray(a);return castSlice(n,charsStartIndex(n,s),charsEndIndex(n,s)+1).join("")},lodash2.trimEnd=function trimEnd(t,a,r){if((t=toString(t))&&(r||a===e))return t.slice(0,trimmedEndIndex(t)+1);if(!t||!(a=baseToString(a)))return t;var n=stringToArray(t);return castSlice(n,0,charsEndIndex(n,stringToArray(a))+1).join("")},lodash2.trimStart=function trimStart(t,a,r){if((t=toString(t))&&(r||a===e))return t.replace(ae,"");if(!t||!(a=baseToString(a)))return t;var n=stringToArray(t);return castSlice(n,charsStartIndex(n,stringToArray(a))).join("")},lodash2.truncate=function truncate(t,a){var r=30,n="...";if(isObject(a)){var s="separator"in a?a.separator:s;r="length"in a?toInteger(a.length):r,n="omission"in a?baseToString(a.omission):n}var l=(t=toString(t)).length;if(hasUnicode(t)){var c=stringToArray(t);l=c.length}if(r>=l)return t;var i=r-stringSize(n);if(i<1)return n;var o=c?castSlice(c,0,i).join(""):t.slice(0,i);if(s===e)return o+n;if(c&&(i+=o.length-i),ir(s)){if(t.slice(i).search(s)){var u,m=o;for(s.global||(s=Ie(s.source,toString(me.exec(s))+"g")),s.lastIndex=0;u=s.exec(m);)var d=u.index;o=o.slice(0,d===e?i:d)}}else if(t.indexOf(baseToString(s),i)!=i){var p=o.lastIndexOf(s);p>-1&&(o=o.slice(0,p))}return o+n},lodash2.unescape=function unescape(e){return(e=toString(e))&&V.test(e)?e.replace($,Ct):e},lodash2.uniqueId=function uniqueId(e){var t=++Re;return toString(e)+t},lodash2.upperCase=jr,lodash2.upperFirst=Rr,lodash2.each=forEach,lodash2.eachRight=forEachRight,lodash2.first=head,mixin(lodash2,(Gr={},baseForOwn(lodash2,function(e,t){je.call(lodash2.prototype,t)||(Gr[t]=e)}),Gr),{chain:!1}),lodash2.VERSION="4.17.21",arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){lodash2[e].placeholder=lodash2}),arrayEach(["drop","take"],function(t,a){LazyWrapper.prototype[t]=function(r){r=r===e?1:zt(toInteger(r),0);var n=this.__filtered__&&!a?new LazyWrapper(this):this.clone();return n.__filtered__?n.__takeCount__=Ft(r,n.__takeCount__):n.__views__.push({size:Ft(r,d),type:t+(n.__dir__<0?"Right":"")}),n},LazyWrapper.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),arrayEach(["filter","map","takeWhile"],function(e,t){var a=t+1,r=1==a||3==a;LazyWrapper.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:getIteratee(e,3),type:a}),t.__filtered__=t.__filtered__||r,t}}),arrayEach(["head","last"],function(e,t){var a="take"+(t?"Right":"");LazyWrapper.prototype[e]=function(){return this[a](1).value()[0]}}),arrayEach(["initial","tail"],function(e,t){var a="drop"+(t?"":"Right");LazyWrapper.prototype[e]=function(){return this.__filtered__?new LazyWrapper(this):this[a](1)}}),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(e){return this.filter(e).head()},LazyWrapper.prototype.findLast=function(e){return this.reverse().find(e)},LazyWrapper.prototype.invokeMap=baseRest(function(e,t){return"function"==typeof e?new LazyWrapper(this):this.map(function(a){return baseInvoke(a,e,t)})}),LazyWrapper.prototype.reject=function(e){return this.filter(negate(getIteratee(e)))},LazyWrapper.prototype.slice=function(t,a){t=toInteger(t);var r=this;return r.__filtered__&&(t>0||a<0)?new LazyWrapper(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),a!==e&&(r=(a=toInteger(a))<0?r.dropRight(-a):r.take(a-t)),r)},LazyWrapper.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(d)},baseForOwn(LazyWrapper.prototype,function(t,a){var r=/^(?:filter|find|map|reject)|While$/.test(a),n=/^(?:head|last)$/.test(a),s=lodash2[n?"take"+("last"==a?"Right":""):a],l=n||/^find/.test(a);s&&(lodash2.prototype[a]=function(){var a=this.__wrapped__,c=n?[1]:arguments,i=a instanceof LazyWrapper,o=c[0],u=i||rr(a),interceptor=function(e){var t=s.apply(lodash2,arrayPush([e],c));return n&&m?t[0]:t};u&&r&&"function"==typeof o&&1!=o.length&&(i=u=!1);var m=this.__chain__,d=!!this.__actions__.length,p=l&&!m,f=i&&!d;if(!l&&u){a=f?a:new LazyWrapper(this);var h=t.apply(a,c);return h.__actions__.push({func:thru,args:[interceptor],thisArg:e}),new LodashWrapper(h,m)}return p&&f?t.apply(this,c):(h=this.thru(interceptor),p?n?h.value()[0]:h.value():h)})}),arrayEach(["pop","push","shift","sort","splice","unshift"],function(e){var t=De[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);lodash2.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var n=this.value();return t.apply(rr(n)?n:[],e)}return this[a](function(a){return t.apply(rr(a)?a:[],e)})}}),baseForOwn(LazyWrapper.prototype,function(e,t){var a=lodash2[t];if(a){var r=a.name+"";je.call(Kt,r)||(Kt[r]=[]),Kt[r].push({name:t,func:a})}}),Kt[createHybrid(e,2).name]=[{name:"wrapper",func:e}],LazyWrapper.prototype.clone=function lazyClone(){var e=new LazyWrapper(this.__wrapped__);return e.__actions__=copyArray(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=copyArray(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=copyArray(this.__views__),e},LazyWrapper.prototype.reverse=function lazyReverse(){if(this.__filtered__){var e=new LazyWrapper(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},LazyWrapper.prototype.value=function lazyValue(){var e=this.__wrapped__.value(),t=this.__dir__,a=rr(e),r=t<0,n=a?e.length:0,s=function getView(e,t,a){for(var r=-1,n=a.length;++r<n;){var s=a[r],l=s.size;switch(s.type){case"drop":e+=l;break;case"dropRight":t-=l;break;case"take":t=Ft(t,e+l);break;case"takeRight":e=zt(e,t-l)}}return{start:e,end:t}}(0,n,this.__views__),l=s.start,c=s.end,i=c-l,o=r?c:l-1,u=this.__iteratees__,m=u.length,d=0,p=Ft(i,this.__takeCount__);if(!a||!r&&n==i&&p==i)return baseWrapperValue(e,this.__actions__);var f=[];e:for(;i--&&d<p;){for(var h=-1,g=e[o+=t];++h<m;){var y=u[h],b=y.iteratee,E=y.type,v=b(g);if(2==E)g=v;else if(!v){if(1==E)continue e;break e}}f[d++]=g}return f},lodash2.prototype.at=Ra,lodash2.prototype.chain=function wrapperChain(){return chain(this)},lodash2.prototype.commit=function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)},lodash2.prototype.next=function wrapperNext(){this.__values__===e&&(this.__values__=toArray(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},lodash2.prototype.plant=function wrapperPlant(t){for(var a,r=this;r instanceof baseLodash;){var n=wrapperClone(r);n.__index__=0,n.__values__=e,a?s.__wrapped__=n:a=n;var s=n;r=r.__wrapped__}return s.__wrapped__=t,a},lodash2.prototype.reverse=function wrapperReverse(){var t=this.__wrapped__;if(t instanceof LazyWrapper){var a=t;return this.__actions__.length&&(a=new LazyWrapper(this)),(a=a.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:e}),new LodashWrapper(a,this.__chain__)}return this.thru(reverse)},lodash2.prototype.toJSON=lodash2.prototype.valueOf=lodash2.prototype.value=function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)},lodash2.prototype.first=lodash2.prototype.head,et&&(lodash2.prototype[et]=function wrapperToIterator(){return this}),lodash2}();pt?((pt.exports=At)._=At,dt._=At):mt._=At}.call(r);var vt=Et.exports;const xt=ve({query:xe().optional(),searchType:we(["combined","semantic","text"]).default("combined"),documentType:xe().optional(),status:xe().optional(),dateFrom:xe().optional(),dateTo:xe().optional(),minSize:Ne().optional(),maxSize:Ne().optional(),hasOcr:_e().optional()}),DocumentSearch=({onResults:e,onLoading:r,className:n=""})=>{const[s,i]=t.useState(!1),[o,h]=t.useState(!1),[g,y]=t.useState([]),[b,I]=t.useState([]),{user:C}=l(),{register:A,handleSubmit:D,watch:O,setValue:z,reset:U,formState:{errors:M}}=Se({resolver:Ae(xt),defaultValues:{hasOcr:!1}}),W=O("query"),B=t.useCallback(vt.debounce(async t=>{if(t.query?.trim()||hasActiveFilters(t))await performSearch(t);else try{h(!0),r?.(!0);const t=await F.getDocuments();e(t)}catch(a){console.error("Error loading documents:",a),c.error("Failed to load documents")}finally{h(!1),r?.(!1)}},500),[e,r]);t.useEffect(()=>{const e=O(e=>{B(e)});return()=>e.unsubscribe()},[O,B]);const hasActiveFilters=e=>!!(e.documentType||e.status||e.dateFrom||e.dateTo||e.minSize||e.maxSize||e.hasOcr),performSearch=async t=>{if(C)try{h(!0),r?.(!0);let a=[];if(t.query?.trim()){const e=[t.query,...b.filter(e=>e!==t.query)].slice(0,5);I(e),localStorage.setItem("documentSearchHistory",JSON.stringify(e));switch(t.searchType||"combined"){case"semantic":a=(await ut({query:t.query,userId:C.id,maxResults:20})).map(e=>e.document).filter(Boolean);break;case"text":a=await ot({query:t.query,userId:C.id,documentType:t.documentType,dateRange:t.dateFrom&&t.dateTo?{start:new Date(t.dateFrom),end:new Date(t.dateTo)}:void 0});break;default:a=(await it(t.query,C.id,{documentType:t.documentType,dateRange:t.dateFrom&&t.dateTo?{start:new Date(t.dateFrom),end:new Date(t.dateTo)}:void 0,maxResults:20})).textResults}}else a=await F.getDocuments();a=applyFilters(a,t),e(a),updateActiveFilters(t)}catch(a){console.error("Search error:",a),c.error("Search failed. Please try again.")}finally{h(!1),r?.(!1)}else c.error("Please log in to search documents")},applyFilters=(e,t)=>e.filter(e=>{if(t.documentType&&e.document_type!==t.documentType)return!1;if(t.status&&e.processing_status!==t.status)return!1;if(t.dateFrom){if(new Date(e.created_at)<new Date(t.dateFrom))return!1}if(t.dateTo){const a=new Date(e.created_at),r=new Date(t.dateTo);if(r.setHours(23,59,59,999),a>r)return!1}const a=e.file_size/1024;return!(t.minSize&&a<t.minSize)&&(!(t.maxSize&&a>t.maxSize)&&!(t.hasOcr&&!e.ocr_text))}),updateActiveFilters=e=>{const t=[];e.documentType&&t.push(`Type: ${S[e.documentType]}`),e.status&&t.push(`Status: ${L[e.status]}`),e.dateFrom&&t.push(`From: ${new Date(e.dateFrom).toLocaleDateString()}`),e.dateTo&&t.push(`To: ${new Date(e.dateTo).toLocaleDateString()}`),e.minSize&&t.push(`Min: ${e.minSize}KB`),e.maxSize&&t.push(`Max: ${e.maxSize}KB`),e.hasOcr&&t.push("Has OCR text"),y(t)},clearFilters=()=>{U(),y([]),i(!1)};return t.useEffect(()=>{const e=localStorage.getItem("documentSearchHistory");if(e)try{I(JSON.parse(e))}catch(t){console.error("Error loading search history:",t)}},[]),a.createElement(u,{className:n},a.createElement(m,{className:"pb-4"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",null,a.createElement(d,{className:"text-lg"},"Search Documents"),a.createElement(p,null,"Find documents by name, content, or metadata")),a.createElement(E,{variant:"outline",size:"sm",onClick:()=>i(!s)},a.createElement(ke,{className:"h-4 w-4 mr-2"}),"Filters"))),a.createElement(f,{className:"space-y-4"},a.createElement("div",{className:"space-y-3"},a.createElement("div",{className:"relative"},a.createElement(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.createElement(j,{...A("query"),placeholder:"Search by filename or content...",className:"pl-10 pr-10"}),o&&a.createElement(T,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 animate-spin text-gray-400"})),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(Ie,{className:"text-xs text-gray-500"},"Search type:"),a.createElement(x,{onValueChange:e=>z("searchType",e)},a.createElement(w,{className:"w-32 h-8"},a.createElement(N,{placeholder:"Combined"})),a.createElement(_,null,a.createElement(k,{value:"combined"},"Combined"),a.createElement(k,{value:"semantic"},"AI Semantic"),a.createElement(k,{value:"text"},"Text Only"))))),b.length>0&&!W&&a.createElement("div",{className:"flex flex-wrap gap-2"},a.createElement("span",{className:"text-xs text-gray-500"},"Recent:"),b.map((e,t)=>a.createElement(E,{key:t,variant:"outline",size:"sm",className:"h-6 text-xs",onClick:()=>z("query",e)},e))),g.length>0&&a.createElement("div",{className:"flex flex-wrap gap-2 items-center"},a.createElement("span",{className:"text-xs text-gray-500"},"Active filters:"),g.map((e,t)=>a.createElement(P,{key:t,variant:"secondary",className:"text-xs"},e,a.createElement(E,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 ml-1",onClick:()=>{clearFilters()}},a.createElement(v,{className:"h-3 w-3"})))),a.createElement(E,{variant:"ghost",size:"sm",className:"text-xs",onClick:clearFilters},"Clear all")),s&&a.createElement(a.Fragment,null,a.createElement(re,null),a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},a.createElement("div",{className:"space-y-2"},a.createElement(Ie,{htmlFor:"documentType"},"Document Type"),a.createElement(x,{onValueChange:e=>z("documentType",e)},a.createElement(w,null,a.createElement(N,{placeholder:"Any type"})),a.createElement(_,null,a.createElement(k,{value:""},"Any type"),Object.entries(S).map(([e,t])=>a.createElement(k,{key:e,value:e},t))))),a.createElement("div",{className:"space-y-2"},a.createElement(Ie,{htmlFor:"status"},"Processing Status"),a.createElement(x,{onValueChange:e=>z("status",e)},a.createElement(w,null,a.createElement(N,{placeholder:"Any status"})),a.createElement(_,null,a.createElement(k,{value:""},"Any status"),Object.entries(L).map(([e,t])=>a.createElement(k,{key:e,value:e},t))))),a.createElement("div",{className:"space-y-2"},a.createElement(Ie,{htmlFor:"dateFrom"},"Date From"),a.createElement(j,{...A("dateFrom"),type:"date",className:"w-full"})),a.createElement("div",{className:"space-y-2"},a.createElement(Ie,{htmlFor:"dateTo"},"Date To"),a.createElement(j,{...A("dateTo"),type:"date",className:"w-full"})),a.createElement("div",{className:"space-y-2"},a.createElement(Ie,null,"File Size (KB)"),a.createElement("div",{className:"flex space-x-2"},a.createElement(j,{...A("minSize",{valueAsNumber:!0}),type:"number",placeholder:"Min",className:"w-full"}),a.createElement(j,{...A("maxSize",{valueAsNumber:!0}),type:"number",placeholder:"Max",className:"w-full"}))),a.createElement("div",{className:"space-y-2"},a.createElement(Ie,null,"Content Options"),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(Ce,{...A("hasOcr"),onCheckedChange:e=>z("hasOcr",!!e)}),a.createElement(Ie,{className:"text-sm"},"Has extracted text")))))))},DocumentStatusTracker=({onDocumentSelect:e,refreshTrigger:r,className:n=""})=>{const[l,i]=t.useState([]),[o,h]=t.useState({total:0,pending:0,processing:0,completed:0,failed:0}),[v,x]=t.useState(!0),[w,N]=t.useState(!0);t.useEffect(()=>{loadDocuments()},[r]),t.useEffect(()=>{let e;return w&&(e=setInterval(()=>{(o.processing>0||o.pending>0)&&loadDocuments()},3e4)),()=>{e&&clearInterval(e)}},[w,o.processing,o.pending]);const loadDocuments=async()=>{try{x(!0),console.log("DocumentStatusTracker: Starting to load documents...");const{data:{user:e},error:t}=await s.auth.getUser();if(t)throw console.error("DocumentStatusTracker: Auth error:",t),new Error("Authentication failed");if(!e)throw console.error("DocumentStatusTracker: No authenticated user"),new Error("User not authenticated");console.log("DocumentStatusTracker: User authenticated:",e.email);const a=await F.getDocuments();console.log("DocumentStatusTracker: Loaded documents:",a.length);const r=a.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());i(r),calculateStats(r)}catch(e){console.error("DocumentStatusTracker: Error loading documents:",e),c.error(`Failed to load document status: ${e.message}`)}finally{x(!1)}},calculateStats=e=>{const t=e.reduce((e,t)=>{switch(e.total++,t.processing_status){case"pending":e.pending++;break;case"processing":e.processing++;break;case"completed":e.completed++;break;case"failed":e.failed++}return e},{total:0,pending:0,processing:0,completed:0,failed:0});h(t)},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},getActiveDocuments=()=>l.filter(e=>"pending"===e.processing_status||"processing"===e.processing_status).slice(0,5),getRecentCompletedDocuments=()=>l.filter(e=>"completed"===e.processing_status).slice(0,3),getFailedDocuments=()=>l.filter(e=>"failed"===e.processing_status);return v&&0===l.length?a.createElement(u,{className:n},a.createElement(f,{className:"flex items-center justify-center py-8"},a.createElement(T,{className:"h-8 w-8 animate-spin"}))):a.createElement(u,{className:n},a.createElement(m,{className:"pb-4"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",null,a.createElement(d,{className:"text-lg"},"Processing Status"),a.createElement(p,null,"Real-time document processing status and progress")),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(E,{variant:"outline",size:"sm",onClick:()=>N(!w),className:w?"bg-green-50":""},a.createElement(H,{className:"h-4 w-4 mr-2 "+(w?"animate-spin":"")}),"Auto-refresh"),a.createElement(E,{onClick:loadDocuments,variant:"outline",size:"sm"},a.createElement(H,{className:"h-4 w-4"}))))),a.createElement(f,{className:"space-y-6"},a.createElement("div",{className:"space-y-3"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("h4",{className:"text-sm font-medium"},"Overall Progress"),a.createElement("span",{className:"text-sm text-gray-500"},o.completed," of ",o.total," completed")),a.createElement(I,{value:0===o.total?0:Math.round(o.completed/o.total*100),className:"w-full"}),a.createElement("div",{className:"grid grid-cols-4 gap-4 text-center"},a.createElement("div",{className:"space-y-1"},a.createElement("div",{className:"text-2xl font-bold text-yellow-600"},o.pending),a.createElement("div",{className:"text-xs text-gray-500"},"Pending")),a.createElement("div",{className:"space-y-1"},a.createElement("div",{className:"text-2xl font-bold text-blue-600"},o.processing),a.createElement("div",{className:"text-xs text-gray-500"},"Processing")),a.createElement("div",{className:"space-y-1"},a.createElement("div",{className:"text-2xl font-bold text-green-600"},o.completed),a.createElement("div",{className:"text-xs text-gray-500"},"Completed")),a.createElement("div",{className:"space-y-1"},a.createElement("div",{className:"text-2xl font-bold text-red-600"},o.failed),a.createElement("div",{className:"text-xs text-gray-500"},"Failed")))),getActiveDocuments().length>0&&a.createElement("div",{className:"space-y-3"},a.createElement("h4",{className:"text-sm font-medium flex items-center"},a.createElement(De,{className:"h-4 w-4 mr-2"}),"Currently Processing"),a.createElement("div",{className:"space-y-2"},getActiveDocuments().map(t=>a.createElement("div",{key:t.id,className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors"},a.createElement("div",{className:"flex items-center space-x-3 flex-1 min-w-0"},(e=>{switch(e){case"pending":return a.createElement(V,{className:"h-4 w-4 text-yellow-500"});case"processing":return a.createElement(T,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return a.createElement(y,{className:"h-4 w-4 text-green-500"});case"failed":return a.createElement(b,{className:"h-4 w-4 text-red-500"});default:return a.createElement(g,{className:"h-4 w-4 text-gray-500"})}})(t.processing_status),a.createElement("div",{className:"flex-1 min-w-0"},a.createElement("p",{className:"text-sm font-medium truncate"},t.filename),a.createElement("p",{className:"text-xs text-gray-500"},U(new Date(t.created_at),{addSuffix:!0})))),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(P,{className:getStatusColor(t.processing_status)},L[t.processing_status]),e&&a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>e(t)},a.createElement(C,{className:"h-4 w-4"}))))))),getRecentCompletedDocuments().length>0&&a.createElement("div",{className:"space-y-3"},a.createElement("h4",{className:"text-sm font-medium flex items-center"},a.createElement(y,{className:"h-4 w-4 mr-2 text-green-500"}),"Recently Completed"),a.createElement("div",{className:"space-y-2"},getRecentCompletedDocuments().map(t=>a.createElement("div",{key:t.id,className:"flex items-center justify-between p-2 border rounded-lg bg-green-50"},a.createElement("div",{className:"flex items-center space-x-3 flex-1 min-w-0"},a.createElement(y,{className:"h-4 w-4 text-green-500"}),a.createElement("div",{className:"flex-1 min-w-0"},a.createElement("p",{className:"text-sm font-medium truncate"},t.filename),a.createElement("p",{className:"text-xs text-gray-500"},"Completed ",U(new Date(t.updated_at),{addSuffix:!0})))),e&&a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>e(t)},a.createElement(C,{className:"h-4 w-4"})))))),getFailedDocuments().length>0&&a.createElement("div",{className:"space-y-3"},a.createElement("h4",{className:"text-sm font-medium flex items-center text-red-600"},a.createElement(b,{className:"h-4 w-4 mr-2"}),"Failed Processing (",getFailedDocuments().length,")"),a.createElement("div",{className:"space-y-2"},getFailedDocuments().slice(0,3).map(t=>a.createElement("div",{key:t.id,className:"flex items-center justify-between p-2 border rounded-lg bg-red-50"},a.createElement("div",{className:"flex items-center space-x-3 flex-1 min-w-0"},a.createElement(b,{className:"h-4 w-4 text-red-500"}),a.createElement("div",{className:"flex-1 min-w-0"},a.createElement("p",{className:"text-sm font-medium truncate"},t.filename),a.createElement("p",{className:"text-xs text-red-600"},"Processing failed"))),e&&a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>e(t)},a.createElement(C,{className:"h-4 w-4"})))))),0===o.total&&a.createElement("div",{className:"text-center py-8"},a.createElement(g,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.createElement("h3",{className:"text-lg font-medium text-gray-900 mb-2"},"No documents yet"),a.createElement("p",{className:"text-gray-500"},"Upload your first document to start tracking processing status"))))};const wt=new class EnhancedDocumentProcessor{constructor(){__publicField(this,"retryAttempts",3),__publicField(this,"retryDelay",1e3)}async processDocument(e,t,a={},r){const n=Date.now();try{let s,l;r?.({stage:"initializing",progress:0,message:"Initializing document processing..."}),await this.checkUsageLimits(),await this.updateDocumentStatus(t,"processing");let c=[];a.skipOCR||(s=await this.performOCR(e,r)),!a.skipAnalysis&&s&&(l=await this.performAnalysis(s.text,t,a.customAnalysisPrompt,r)),!a.skipEmbedding&&s&&(c=await this.generateEmbeddings(s.text,t,a.chunkSize,r)),r?.({stage:"finalizing",progress:95,message:"Finalizing document processing..."});const i=await this.finalizeProcessing(t,s,l,c),o=Date.now()-n;return r?.({stage:"completed",progress:100,message:"Document processing completed successfully!",details:{processingTime:o,ocrQuality:s?.qualityScore||0,textLength:s?.text.length||0,embeddingChunks:c.length}}),{document:i,ocrResult:s,analysis:l,embeddingIds:c,processingTime:o,qualityMetrics:{ocrQuality:s?.qualityScore||0,textLength:s?.text.length||0,embeddingChunks:c.length}}}catch(s){const e=Date.now()-n;throw await this.updateDocumentStatus(t,"failed"),r?.({stage:"error",progress:0,message:"Document processing failed",error:s instanceof Error?s.message:"Unknown error",details:{processingTime:e}}),s}}async checkUsageLimits(){const e=await Oe.checkUsageLimit("ai_query");if(!e.allowed)throw new Error(`AI processing limit exceeded. You have used ${e.current}/${e.limit} AI queries this month. Please upgrade your plan to continue.`)}async performOCR(e,t){return t?.({stage:"ocr",progress:10,message:"Extracting text from document..."}),await this.withRetry(async()=>{const a=await extractTextFromDocument(e,e=>{t?.({stage:"ocr",progress:10+.3*e.progress,message:e.message||"Extracting text..."})}),r=validateOCRQuality(a),n=cleanExtractedText(a.text);return{...a,text:n,qualityScore:r.qualityScore}},"OCR processing")}async performAnalysis(e,t,a,r){return r?.({stage:"analysis",progress:40,message:"Analyzing document content with AI..."}),await this.withRetry(async()=>{const r=await Je(e);return await Oe.incrementUsage("ai_query",t,{operation:"document_analysis",text_length:e.length,custom_prompt:!!a}),r},"AI analysis")}async generateEmbeddings(e,t,a=1e3,r){return r?.({stage:"embedding",progress:70,message:"Generating embeddings for search..."}),await this.withRetry(async()=>{const n=this.splitTextIntoChunks(e,a),l=[];for(let e=0;e<n.length;e++){const a=n[e],c=await Xe(a),{data:i,error:o}=await s.from("document_embeddings").insert({document_id:t,chunk_text:a,chunk_index:e,embedding:c,metadata:{chunk_size:a.length,total_chunks:n.length}}).select("id").single();if(o)throw o;l.push(i.id);const u=70+(e+1)/n.length*20;r?.({stage:"embedding",progress:u,message:`Generated embedding ${e+1}/${n.length}...`})}return l},"Embedding generation")}async finalizeProcessing(e,t,a,r){const{data:n,error:l}=await s.from("uploaded_documents").update({processing_status:"completed",ocr_text:t?.text,ocr_quality_score:t?.qualityScore,document_structure:{analysis:a,ocrQuality:t?.qualityScore,embeddingCount:r?.length||0,processedAt:(new Date).toISOString()},updated_at:(new Date).toISOString()}).eq("id",e).select().single();if(l)throw l;return n}async updateDocumentStatus(e,t){const{error:a}=await s.from("uploaded_documents").update({processing_status:t,updated_at:(new Date).toISOString()}).eq("id",e);if(a)throw a}async withRetry(e,t){let a;for(let n=1;n<=this.retryAttempts;n++)try{return await e()}catch(r){if(a=r instanceof Error?r:new Error("Unknown error"),n===this.retryAttempts)throw new Error(`${t} failed after ${this.retryAttempts} attempts: ${a.message}`);await new Promise(e=>setTimeout(e,this.retryDelay*n))}throw a}splitTextIntoChunks(e,t=1e3){const a=[],r=e.split(/[.!?]+/).filter(e=>e.trim().length>0);let n="";for(const s of r){const e=s.trim();n.length+e.length+1<=t?n+=(n?". ":"")+e:(n&&a.push(n+"."),n=e)}return n&&a.push(n+"."),a}};function useUsageLimit(e){return ze({queryKey:["usage-limit",e],queryFn:()=>Oe.checkUsageLimit(e),staleTime:6e4,refetchOnWindowFocus:!1})}const EnhancedDocumentUpload=({onUploadComplete:e,maxFiles:r=5,allowedTypes:n=["pdf","doc","docx","txt"]})=>{const{profile:s}=l(),{uploadAndProcessDocument:c,uploadState:O,resetUploadState:z,isActive:T}=function useDocumentUpload(){const[e,a]=t.useState({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null}),r=Fe(),{toast:n}=Te();return{uploadAndProcessDocument:t.useCallback(async(e,t,s={})=>{try{a({isUploading:!0,isProcessing:!1,progress:0,status:null,error:null});const l=await F.uploadDocument(e,t);a(e=>({...e,isUploading:!1,isProcessing:!0,progress:10}));const c=await wt.processDocument(e,l.id,s,e=>{a(t=>({...t,progress:e.progress,status:e,error:e.error||null}))});return a(e=>({...e,isProcessing:!1,progress:100,error:null})),r.invalidateQueries({queryKey:["documents"]}),r.invalidateQueries({queryKey:["document",l.id]}),n({title:"Document Processed",description:`${e.name} has been successfully uploaded and processed.`}),c}catch(l){const e=l instanceof Error?l.message:"Upload failed";throw a(t=>({...t,isUploading:!1,isProcessing:!1,error:e})),n({title:"Upload Failed",description:e,variant:"destructive"}),l}},[r,n]),uploadState:e,resetUploadState:t.useCallback(()=>{a({isUploading:!1,isProcessing:!1,progress:0,status:null,error:null})},[]),isActive:e.isUploading||e.isProcessing}}(),{canUploadDocuments:j,canUseAI:R,documentUsage:L}=function useFeatureAvailability(){const{data:e}=useUsageLimit("ai_query"),{data:t}=useUsageLimit("document_upload"),{data:a}=useUsageLimit("custom_document");return{canUseAI:e?.allowed??!1,canUploadDocuments:t?.allowed??!1,canDownloadCustomDocuments:a?.allowed??!1,aiUsage:e,documentUsage:t,customDocUsage:a,getUsagePercentage:e=>e&&-1!==e.limit&&e.limit>0?e.current/e.limit*100:0,isNearLimit:(e,t=80)=>!(!e||-1===e.limit)&&(e.limit>0?e.current/e.limit*100:0)>=t}}(),[U,M]=t.useState([]),[W,B]=t.useState(!1),[q,$]=t.useState({skipOCR:!1,skipAnalysis:!1,skipEmbedding:!1,chunkSize:1e3,retryAttempts:3}),K=t.useCallback(async e=>{if(!j)return void toast.warning("Upload not available. Please check your subscription or try again later.");const t=s?.subscription_tier?i.maxSize[s.subscription_tier]:i.maxSize.free,a=e.filter(e=>!(e.size>t)).map(e=>({file:e,id:crypto.randomUUID(),documentType:"other",options:{...q}}));M(e=>[...e,...a].slice(0,r))},[s,r,j,q]),{getRootProps:H,getInputProps:G,isDragActive:Q}=o({onDrop:K,accept:{"application/pdf":[".pdf"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"text/plain":[".txt"]},maxFiles:r,disabled:T||!j});return a.createElement(u,{className:"w-full"},a.createElement(m,null,a.createElement(d,{className:"flex items-center justify-between"},a.createElement("span",null,"Enhanced Document Upload"),a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>B(!W)},a.createElement(Re,{className:"h-4 w-4 mr-2"}),"Advanced")),a.createElement(p,null,"Upload and process your legal documents with AI-powered analysis"),L&&a.createElement("div",{className:"flex items-center space-x-4 text-sm text-gray-600"},a.createElement("span",null,"Usage: ",L.current,"/",-1===L.limit?"∞":L.limit," uploads"),L.limit>0&&a.createElement(I,{value:L.percentage,className:"w-24 h-2"}))),a.createElement(f,{className:"space-y-6"},W&&a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"text-lg"},"Processing Options")),a.createElement(f,{className:"space-y-4"},a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(Le,{id:"skip-ocr",checked:!q.skipOCR,onCheckedChange:e=>$(t=>({...t,skipOCR:!e}))}),a.createElement(Ie,{htmlFor:"skip-ocr"},"Text Extraction")),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(Le,{id:"skip-analysis",checked:!q.skipAnalysis,onCheckedChange:e=>$(t=>({...t,skipAnalysis:!e})),disabled:!R}),a.createElement(Ie,{htmlFor:"skip-analysis"},"AI Analysis")),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(Le,{id:"skip-embedding",checked:!q.skipEmbedding,onCheckedChange:e=>$(t=>({...t,skipEmbedding:!e})),disabled:!R}),a.createElement(Ie,{htmlFor:"skip-embedding"},"Search Indexing"))),void 0!==q.customAnalysisPrompt&&a.createElement("div",null,a.createElement(Ie,{htmlFor:"custom-prompt"},"Custom Analysis Prompt"),a.createElement(ge,{id:"custom-prompt",placeholder:"Enter custom instructions for AI analysis...",value:q.customAnalysisPrompt||"",onChange:e=>$(t=>({...t,customAnalysisPrompt:e.target.value}))})))),a.createElement("div",{...H(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${Q?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${T||!j?"opacity-50 cursor-not-allowed":""}`},a.createElement("input",{...G()}),a.createElement(h,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),Q?a.createElement("p",{className:"text-blue-600"},"Drop the files here..."):a.createElement("div",null,a.createElement("p",{className:"text-gray-600 mb-2"},j?"Drag & drop files here, or click to select":"Upload limit reached for your subscription tier"),a.createElement("p",{className:"text-sm text-gray-500"},"Supports PDF, DOC, DOCX, TXT files up to"," ",Math.round((s?.subscription_tier?i.maxSize[s.subscription_tier]:i.maxSize.free)/1024/1024),"MB"))),U.length>0&&a.createElement("div",{className:"space-y-3"},a.createElement("h4",{className:"font-medium"},"Files to Upload"),U.map(e=>a.createElement("div",{key:e.id,className:"flex items-center space-x-3 p-3 border rounded-lg"},a.createElement(g,{className:"h-5 w-5 text-gray-400"}),a.createElement("div",{className:"flex-1 min-w-0"},a.createElement("p",{className:"text-sm font-medium truncate"},e.file.name),a.createElement("p",{className:"text-xs text-gray-500"},(e.file.size/1024/1024).toFixed(2)," MB")),a.createElement(x,{value:e.documentType,onValueChange:t=>{return a=e.id,r=t,void M(e=>e.map(e=>e.id===a?{...e,documentType:r}:e));var a,r}},a.createElement(w,{className:"w-32"},a.createElement(N,null)),a.createElement(_,null,Object.entries(S).map(([e,t])=>a.createElement(k,{key:e,value:e},t)))),a.createElement(E,{variant:"ghost",size:"sm",onClick:()=>{return t=e.id,void M(e=>e.filter(e=>e.id!==t));var t},disabled:T},a.createElement(v,{className:"h-4 w-4"}))))),T&&O.status&&a.createElement(u,null,a.createElement(f,{className:"pt-6"},a.createElement("div",{className:"space-y-3"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement("div",{className:(e=>{switch(e){case"completed":return"text-green-600";case"error":return"text-red-600";case"analysis":return"text-blue-600";case"embedding":return"text-purple-600";default:return"text-gray-600"}})(O.status.stage)},(e=>{switch(e){case"ocr":return a.createElement(C,{className:"h-4 w-4"});case"analysis":return a.createElement(A,{className:"h-4 w-4"});case"embedding":return a.createElement(D,{className:"h-4 w-4"});case"completed":return a.createElement(y,{className:"h-4 w-4"});case"error":return a.createElement(b,{className:"h-4 w-4"});default:return a.createElement(V,{className:"h-4 w-4"})}})(O.status.stage)),a.createElement("span",{className:"font-medium capitalize"},O.status.stage.replace("_"," "))),a.createElement(P,{variant:"outline"},Math.round(O.progress),"%")),a.createElement(I,{value:O.progress,className:"w-full"}),a.createElement("p",{className:"text-sm text-gray-600"},O.status.message),O.status.details&&a.createElement("div",{className:"text-xs text-gray-500 space-y-1"},O.status.details.ocrQuality&&a.createElement("p",null,"OCR Quality: ",Math.round(100*O.status.details.ocrQuality),"%"),O.status.details.textLength&&a.createElement("p",null,"Text Length: ",O.status.details.textLength.toLocaleString()," characters"),O.status.details.embeddingChunks&&a.createElement("p",null,"Embedding Chunks: ",O.status.details.embeddingChunks)),O.error&&a.createElement("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded"},O.error)))),U.length>0&&!T&&a.createElement(E,{onClick:async()=>{for(const a of U)try{const t=await c(a.file,a.documentType,a.options);e&&e(t.document.id)}catch(t){console.error("Upload failed:",t)}M([]),z()},className:"w-full",disabled:!j},a.createElement(h,{className:"h-4 w-4 mr-2"}),"Upload and Process ",U.length," File",U.length>1?"s":"")))},DocumentManagementDashboard=()=>{const[e,r]=t.useState("grid"),[n,l]=t.useState(new Set),[c,i]=t.useState("created_at"),[o,m]=t.useState("desc"),[d,p]=t.useState({status:"all",type:"all",dateRange:"all"}),[v,I]=t.useState(!1),[C,A]=t.useState(null),{data:D=[],isLoading:O,error:z}=function useDocuments(){return ze({queryKey:["documents"],queryFn:()=>F.getDocuments(),staleTime:3e5})}(),{searchQuery:T,setSearchQuery:U,searchResults:P,isSearching:M}=function useDocumentSearch(){const[e,a]=t.useState(""),r=ze({queryKey:["documents","search",e],queryFn:async()=>{if(!e||e.length<3)return[];try{return await F.searchDocuments(e)}catch(z){return console.error("Search error:",z),[]}},enabled:e.length>2,staleTime:12e4});return{searchQuery:e,setSearchQuery:a,searchResults:r.data||[],isSearching:r.isLoading,searchError:r.error}}(),W=function useDocumentDeletion(){const e=Fe(),{toast:t}=Te();return je({mutationFn:e=>F.deleteDocument(e),onSuccess:(a,r)=>{e.removeQueries({queryKey:["document",r]}),e.invalidateQueries({queryKey:["documents"]}),t({title:"Document Deleted",description:"The document has been successfully deleted."})},onError:e=>{t({title:"Deletion Failed",description:e instanceof Error?e.message:"Failed to delete document",variant:"destructive"})}})}(),B=function useDocumentDownload(){const{toast:e}=Te();return je({mutationFn:({documentId:e,trackUsage:t=!0})=>F.downloadDocument(e,t),onSuccess:t=>{const a=URL.createObjectURL(t.data),r=document.createElement("a");r.href=a,r.download=t.filename,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),e({title:"Download Started",description:`Downloading ${t.filename}...`})},onError:t=>{e({title:"Download Failed",description:t instanceof Error?t.message:"Failed to download document",variant:"destructive"})}})}(),{bulkDelete:q,isBulkDeleting:$}=function useBulkDocumentOperations(){const e=Fe(),{toast:t}=Te(),a=je({mutationFn:async e=>{const t=await Promise.allSettled(e.map(e=>F.deleteDocument(e))),a=t.filter(e=>"rejected"===e.status).length;return{succeeded:t.filter(e=>"fulfilled"===e.status).length,failed:a,total:e.length}},onSuccess:a=>{e.invalidateQueries({queryKey:["documents"]}),a.failed>0?t({title:"Bulk Delete Completed",description:`${a.succeeded} documents deleted, ${a.failed} failed.`,variant:"destructive"}):t({title:"Bulk Delete Completed",description:`Successfully deleted ${a.succeeded} documents.`})},onError:e=>{t({title:"Bulk Delete Failed",description:e instanceof Error?e.message:"Failed to delete documents",variant:"destructive"})}});return{bulkDelete:a,isBulkDeleting:a.isPending}}(),{data:H,error:G}=function useDocumentStats(){return ze({queryKey:["documents","stats"],queryFn:async()=>{try{const e=await F.getDocuments(),t=await F.getDocumentUsage();return{total:e.length,byStatus:e.reduce((e,t)=>(e[t.processing_status]=(e[t.processing_status]||0)+1,e),{}),byType:e.reduce((e,t)=>(e[t.document_type]=(e[t.document_type]||0)+1,e),{}),totalSize:e.reduce((e,t)=>e+t.file_size,0),usage:t}}catch(z){return console.error("Error fetching document stats:",z),{total:0,byStatus:{},byType:{},totalSize:0,usage:null}}},staleTime:6e5})}();a.useEffect(()=>{z&&console.error("Documents loading error:",z),G&&console.error("Stats loading error:",G)},[z,G]),a.useEffect(()=>{(async()=>{try{const{data:{user:e},error:t}=await s.auth.getUser();console.log("Current user:",e),console.log("Auth error:",t);let a=null;if(e){const{data:e,error:t}=await s.from("uploaded_documents").select("count").limit(1);console.log("Direct API test:",{data:e,error:t}),a={data:e,error:t}}A({user:e?{id:e.id,email:e.email}:null,authError:t,apiTestResult:a,timestamp:(new Date).toISOString()})}catch(e){console.error("Debug auth error:",e),A({error:e instanceof Error?e.message:"Unknown error",timestamp:(new Date).toISOString()})}})()},[]);const Q=t.useMemo(()=>{try{let e=T.length>2?P:D;if(!Array.isArray(e))return console.warn("Documents result is not an array:",e),[];if("all"!==d.status&&(e=e.filter(e=>e?.processing_status===d.status)),"all"!==d.type&&(e=e.filter(e=>e?.document_type===d.type)),"all"!==d.dateRange){const t=new Date,a=new Date;switch(d.dateRange){case"today":a.setHours(0,0,0,0);break;case"week":a.setDate(t.getDate()-7);break;case"month":a.setMonth(t.getMonth()-1)}e=e.filter(e=>e?.created_at&&new Date(e.created_at)>=a)}return e.sort((e,t)=>{if(!e||!t)return 0;let a=e[c],r=t[c];return"created_at"===c?(a=new Date(a).getTime(),r=new Date(r).getTime()):"file_size"===c?(a=Number(a)||0,r=Number(r)||0):(a=String(a||"").toLowerCase(),r=String(r||"").toLowerCase()),"asc"===o?a<r?-1:a>r?1:0:a>r?-1:a<r?1:0}),e}catch(e){return console.error("Error filtering documents:",e),[]}},[D,P,T,d,c,o]),getStatusIcon=e=>{switch(e){case"completed":return a.createElement(y,{className:"h-4 w-4 text-green-500"});case"processing":return a.createElement(V,{className:"h-4 w-4 text-blue-500"});case"failed":return a.createElement(b,{className:"h-4 w-4 text-red-500"});default:return a.createElement(V,{className:"h-4 w-4 text-gray-500"})}},getStatusColor=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return v?a.createElement("div",{className:"space-y-6"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("h2",{className:"text-2xl font-bold"},"Upload Documents"),a.createElement(E,{variant:"outline",onClick:()=>I(!1)},"Back to Dashboard")),a.createElement(EnhancedDocumentUpload,{onUploadComplete:()=>I(!1)})):a.createElement("div",{className:"space-y-6"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",null,a.createElement("h2",{className:"text-2xl font-bold"},"Document Management"),a.createElement("p",{className:"text-gray-600"},"Manage and organize your legal documents")),a.createElement(E,{onClick:()=>I(!0)},a.createElement(h,{className:"h-4 w-4 mr-2"}),"Upload Documents")),H&&a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4"},a.createElement(u,null,a.createElement(f,{className:"p-4"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(g,{className:"h-5 w-5 text-blue-500"}),a.createElement("div",null,a.createElement("p",{className:"text-sm text-gray-600"},"Total Documents"),a.createElement("p",{className:"text-2xl font-bold"},H.total))))),a.createElement(u,null,a.createElement(f,{className:"p-4"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(y,{className:"h-5 w-5 text-green-500"}),a.createElement("div",null,a.createElement("p",{className:"text-sm text-gray-600"},"Processed"),a.createElement("p",{className:"text-2xl font-bold"},H.byStatus.completed||0))))),a.createElement(u,null,a.createElement(f,{className:"p-4"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(V,{className:"h-5 w-5 text-blue-500"}),a.createElement("div",null,a.createElement("p",{className:"text-sm text-gray-600"},"Processing"),a.createElement("p",{className:"text-2xl font-bold"},H.byStatus.processing||0))))),a.createElement(u,null,a.createElement(f,{className:"p-4"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(Ue,{className:"h-5 w-5 text-purple-500"}),a.createElement("div",null,a.createElement("p",{className:"text-sm text-gray-600"},"Total Size"),a.createElement("p",{className:"text-2xl font-bold"},(H.totalSize/1024/1024).toFixed(1),"MB")))))),a.createElement(u,null,a.createElement(f,{className:"p-4"},a.createElement("div",{className:"flex flex-col md:flex-row gap-4"},a.createElement("div",{className:"flex-1"},a.createElement("div",{className:"relative"},a.createElement(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.createElement(j,{placeholder:"Search documents...",value:T,onChange:e=>U(e.target.value),className:"pl-10"}))),a.createElement("div",{className:"flex gap-2"},a.createElement(x,{value:d.status,onValueChange:e=>p(t=>({...t,status:e}))},a.createElement(w,{className:"w-32"},a.createElement(N,{placeholder:"Status"})),a.createElement(_,null,a.createElement(k,{value:"all"},"All Status"),Object.entries(L).map(([e,t])=>a.createElement(k,{key:e,value:e},t)))),a.createElement(x,{value:d.type,onValueChange:e=>p(t=>({...t,type:e}))},a.createElement(w,{className:"w-32"},a.createElement(N,{placeholder:"Type"})),a.createElement(_,null,a.createElement(k,{value:"all"},"All Types"),Object.entries(S).map(([e,t])=>a.createElement(k,{key:e,value:e},t)))),a.createElement(x,{value:c,onValueChange:e=>i(e)},a.createElement(w,{className:"w-32"},a.createElement(N,{placeholder:"Sort by"})),a.createElement(_,null,a.createElement(k,{value:"created_at"},"Date"),a.createElement(k,{value:"filename"},"Name"),a.createElement(k,{value:"file_size"},"Size"),a.createElement(k,{value:"processing_status"},"Status"))),a.createElement(E,{variant:"outline",size:"sm",onClick:()=>m("asc"===o?"desc":"asc")},"asc"===o?"↑":"↓")),a.createElement("div",{className:"flex border rounded-md"},a.createElement(E,{variant:"grid"===e?"default":"ghost",size:"sm",onClick:()=>r("grid")},a.createElement(Pe,{className:"h-4 w-4"})),a.createElement(E,{variant:"list"===e?"default":"ghost",size:"sm",onClick:()=>r("list")},a.createElement(Me,{className:"h-4 w-4"})))))),n.size>0&&a.createElement(u,null,a.createElement(f,{className:"p-4"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("span",{className:"text-sm text-gray-600"},n.size," document",n.size>1?"s":""," selected"),a.createElement("div",{className:"flex gap-2"},a.createElement(E,{variant:"destructive",size:"sm",onClick:async()=>{0!==n.size&&(await q.mutateAsync(Array.from(n)),l(new Set))},disabled:$},a.createElement(K,{className:"h-4 w-4 mr-2"}),"Delete Selected"),a.createElement(E,{variant:"outline",size:"sm",onClick:()=>l(new Set)},"Clear Selection"))))),O?a.createElement("div",{className:"text-center py-8"},a.createElement("p",null,"Loading documents...")):z?a.createElement("div",{className:"text-center py-8 text-red-600"},a.createElement("p",null,"Error loading documents: ",z.message)):0===Q.length?a.createElement("div",{className:"text-center py-8"},a.createElement(g,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.createElement("p",{className:"text-gray-600"},T?"No documents found matching your search.":"No documents uploaded yet."),!T&&a.createElement(E,{className:"mt-4",onClick:()=>I(!0)},"Upload Your First Document")):a.createElement("div",{className:"grid"===e?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-2"},"list"===e&&a.createElement("div",{className:"flex items-center space-x-3 p-3 border-b"},a.createElement(Ce,{checked:n.size===Q.length,onCheckedChange:()=>{n.size===Q.length?l(new Set):l(new Set(Q.map(e=>e.id)))}}),a.createElement("span",{className:"text-sm font-medium"},"Select All")),Q.map(t=>t&&t.id?a.createElement(DocumentCard,{key:t.id,document:t,viewMode:e,isSelected:n.has(t.id),onToggleSelection:()=>(e=>{const t=new Set(n);t.has(e)?t.delete(e):t.add(e),l(t)})(t.id),onDownload:()=>{return e=t.id,void B.mutate({documentId:e});var e},onDelete:()=>{return e=t.id,void W.mutate(e);var e},getStatusIcon:getStatusIcon,getStatusColor:getStatusColor}):(console.warn("Invalid document found:",t),null)).filter(Boolean)))},DocumentCard=({document:e,viewMode:t,isSelected:r,onToggleSelection:n,onDownload:s,onDelete:l,getStatusIcon:c,getStatusColor:i})=>{if(!e)return console.warn("DocumentCard received null/undefined document"),null;const o={id:e.id||"",filename:e.filename||"Unknown File",document_type:e.document_type||"other",file_size:e.file_size||0,created_at:e.created_at||(new Date).toISOString(),processing_status:e.processing_status||"pending"};return"list"===t?a.createElement("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50"},a.createElement(Ce,{checked:r,onCheckedChange:n}),a.createElement(g,{className:"h-5 w-5 text-gray-400"}),a.createElement("div",{className:"flex-1 min-w-0"},a.createElement("p",{className:"font-medium truncate"},o.filename),a.createElement("p",{className:"text-sm text-gray-500"},S[o.document_type]||"Unknown"," •",(o.file_size/1024/1024).toFixed(2)," MB •",U(new Date(o.created_at),{addSuffix:!0}))),a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(P,{className:i(o.processing_status)},c(o.processing_status),a.createElement("span",{className:"ml-1"},L[o.processing_status]||"Unknown")),a.createElement(M,null,a.createElement(W,{asChild:!0},a.createElement(E,{variant:"ghost",size:"sm"},a.createElement(mt,{className:"h-4 w-4"}))),a.createElement(B,null,a.createElement(q,{onClick:s},a.createElement($,{className:"h-4 w-4 mr-2"}),"Download"),a.createElement(We,null),a.createElement(q,{onClick:l,className:"text-red-600"},a.createElement(K,{className:"h-4 w-4 mr-2"}),"Delete"))))):a.createElement(u,{className:"cursor-pointer transition-colors "+(r?"ring-2 ring-blue-500":"")},a.createElement(f,{className:"p-4"},a.createElement("div",{className:"flex items-start justify-between mb-3"},a.createElement(Ce,{checked:r,onCheckedChange:n}),a.createElement(M,null,a.createElement(W,{asChild:!0},a.createElement(E,{variant:"ghost",size:"sm"},a.createElement(mt,{className:"h-4 w-4"}))),a.createElement(B,null,a.createElement(q,{onClick:s},a.createElement($,{className:"h-4 w-4 mr-2"}),"Download"),a.createElement(We,null),a.createElement(q,{onClick:l,className:"text-red-600"},a.createElement(K,{className:"h-4 w-4 mr-2"}),"Delete")))),a.createElement("div",{className:"text-center mb-4"},a.createElement(g,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),a.createElement("h3",{className:"font-medium truncate",title:o.filename},o.filename)),a.createElement("div",{className:"space-y-2 text-sm text-gray-600"},a.createElement("div",{className:"flex justify-between"},a.createElement("span",null,"Type:"),a.createElement("span",null,S[o.document_type]||"Unknown")),a.createElement("div",{className:"flex justify-between"},a.createElement("span",null,"Size:"),a.createElement("span",null,(o.file_size/1024/1024).toFixed(2)," MB")),a.createElement("div",{className:"flex justify-between"},a.createElement("span",null,"Uploaded:"),a.createElement("span",null,U(new Date(o.created_at),{addSuffix:!0})))),a.createElement("div",{className:"mt-3"},a.createElement(P,{className:`w-full justify-center ${i(o.processing_status)}`},c(o.processing_status),a.createElement("span",{className:"ml-1"},L[o.processing_status]||"Unknown")))))},DatabaseTest=()=>{const[e,r]=t.useState([]),[n,l]=t.useState(!1),runTests=async()=>{l(!0);const e=[];try{const{data:t,error:a}=await s.from("profiles").select("count").limit(1);e.push({name:"Supabase Connection",status:a?"error":"success",message:a?a.message:"Connected successfully",details:{data:t,error:a}})}catch(n){e.push({name:"Supabase Connection",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:t,error:a}=await s.from("uploaded_documents").select("id, filename, processing_status").limit(5);e.push({name:"uploaded_documents Table",status:a?"error":"success",message:a?a.message:`Found ${t?.length||0} documents`,details:{data:t,error:a}})}catch(n){e.push({name:"uploaded_documents Table",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:{user:t},error:a}=await s.auth.getUser();e.push({name:"Authentication",status:a?"error":"success",message:a?a.message:t?`Logged in as ${t.email}`:"Not logged in",details:{user:t,error:a}})}catch(n){e.push({name:"Authentication",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}try{const{data:t,error:a}=await s.storage.listBuckets(),r=t?.find(e=>"documents"===e.name);e.push({name:"Storage Bucket",status:a?"error":r?"success":"error",message:a?a.message:r?"Documents bucket exists":"Documents bucket not found",details:{buckets:t,error:a}})}catch(n){e.push({name:"Storage Bucket",status:"error",message:n instanceof Error?n.message:"Unknown error",details:n})}const t={VITE_SUPABASE_URL:"https://kvlaydeyqidlfpfutbmp.supabase.co",VITE_SUPABASE_ANON_KEY:"***",VITE_APP_URL:"https://craftchatbot.com"},a=Object.entries(t).filter(([e,t])=>!t);e.push({name:"Environment Variables",status:a.length>0?"error":"success",message:a.length>0?`Missing: ${a.map(([e])=>e).join(", ")}`:"All required variables present",details:t}),r(e),l(!1)};t.useEffect(()=>{runTests()},[]);return a.createElement(u,{className:"max-w-4xl mx-auto"},a.createElement(m,null,a.createElement(d,{className:"flex items-center justify-between"},"Database Connection Test",a.createElement(E,{onClick:runTests,disabled:n,size:"sm"},a.createElement(H,{className:"h-4 w-4 mr-2 "+(n?"animate-spin":"")}),n?"Running...":"Run Tests"))),a.createElement(f,null,a.createElement("div",{className:"space-y-4"},e.map((e,t)=>a.createElement("div",{key:t,className:"flex items-start space-x-3 p-3 border rounded-lg"},(e=>{switch(e){case"success":return a.createElement(y,{className:"h-5 w-5 text-green-500"});case"error":return a.createElement(Be,{className:"h-5 w-5 text-red-500"});case"pending":return a.createElement(b,{className:"h-5 w-5 text-yellow-500"})}})(e.status),a.createElement("div",{className:"flex-1"},a.createElement("h4",{className:"font-medium"},e.name),a.createElement("p",{className:"text-sm text-gray-600"},e.message),!1))))))},UploadDiagnostics=()=>{const[e,r]=t.useState([]),[n,c]=t.useState(!1),{user:i,profile:o}=l(),getStatusColor=e=>{switch(e){case"success":return"bg-green-100 text-green-800";case"warning":return"bg-yellow-100 text-yellow-800";case"error":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return a.createElement(u,{className:"w-full max-w-4xl mx-auto"},a.createElement(m,null,a.createElement(d,null,"Upload Diagnostics"),a.createElement(E,{onClick:async()=>{c(!0);const e=[];try{const{data:{session:t},error:a}=await s.auth.getSession();e.push({category:"Authentication",name:"User Session",status:t?.user?"success":"error",message:t?.user?`Authenticated as ${t.user.email}`:"No active session",details:{user:t?.user,error:a},fix:t?.user?void 0:"Please sign in to upload documents"})}catch(t){e.push({category:"Authentication",name:"User Session",status:"error",message:`Session check failed: ${t instanceof Error?t.message:"Unknown error"}`,details:t,fix:"Check authentication configuration"})}e.push({category:"User",name:"Profile Data",status:o?"success":"warning",message:o?`Profile loaded: ${o.subscription_tier} tier`:"Profile not loaded",details:o,fix:o?void 0:"Profile may still be loading or missing"});try{const{data:t,error:a}=await s.storage.from("documents").list("",{limit:1});e.push({category:"Storage",name:"Documents Bucket",status:a?"error":"success",message:a?`Bucket access failed: ${a.message}`:"Bucket accessible",details:{data:t,error:a},fix:a?"Check storage bucket permissions and RLS policies":void 0})}catch(t){e.push({category:"Storage",name:"Documents Bucket",status:"error",message:`Storage check failed: ${t instanceof Error?t.message:"Unknown error"}`,details:t})}try{const{data:t,error:a}=await s.from("uploaded_documents").select("count").limit(1);e.push({category:"Database",name:"Documents Table",status:a?"error":"success",message:a?`Table access failed: ${a.message}`:"Table accessible",details:{data:t,error:a},fix:a?"Check RLS policies for uploaded_documents table":void 0})}catch(t){e.push({category:"Database",name:"Documents Table",status:"error",message:`Database check failed: ${t instanceof Error?t.message:"Unknown error"}`,details:t})}if(i)try{const t=new File(["test content"],"test.txt",{type:"text/plain"}),a=`${i.id}/test-${Date.now()}.txt`,{error:r}=await s.storage.from("documents").upload(a,t);r||await s.storage.from("documents").remove([a]),e.push({category:"Upload",name:"Test File Upload",status:r?"error":"success",message:r?`Upload failed: ${r.message}`:"Upload successful",details:r,fix:r?"Check storage permissions and file size limits":void 0})}catch(t){e.push({category:"Upload",name:"Test File Upload",status:"error",message:`Upload test failed: ${t instanceof Error?t.message:"Unknown error"}`,details:t})}else e.push({category:"Upload",name:"Test File Upload",status:"warning",message:"Skipped - no authenticated user",fix:"Sign in to test file upload"});r(e),c(!1)},disabled:n},n?"Running Diagnostics...":"Run Upload Diagnostics")),a.createElement(f,null,e.length>0&&a.createElement("div",{className:"space-y-4"},e.map((e,t)=>a.createElement("div",{key:t,className:"border rounded-lg p-4"},a.createElement("div",{className:"flex items-center justify-between mb-2"},a.createElement("div",{className:"flex items-center gap-2"},a.createElement("span",{className:"font-medium"},e.category),a.createElement("span",{className:"text-gray-600"},"•"),a.createElement("span",null,e.name)),a.createElement(P,{className:getStatusColor(e.status)},e.status)),a.createElement("p",{className:"text-sm text-gray-700 mb-2"},e.message),e.fix&&a.createElement("p",{className:"text-sm text-blue-600 bg-blue-50 p-2 rounded"},"💡 ",e.fix),e.details&&a.createElement("details",{className:"mt-2"},a.createElement("summary",{className:"text-sm text-gray-500 cursor-pointer"},"View Details"),a.createElement("pre",{className:"text-xs bg-gray-100 p-2 rounded mt-1 overflow-auto"},JSON.stringify(e.details,null,2))))))))},Documents=()=>{const{profile:e,forceRefreshProfile:r}=qe(),n=$e(),[s,l]=t.useState(null),[c,i]=t.useState([]),[o,y]=t.useState(!1),[x,w]=t.useState(0),[N,_]=t.useState("overview"),S=t.useCallback(e=>{l(e)},[]),k=t.useCallback(()=>{l(null)},[]),I=t.useCallback(e=>{w(e=>e+1)},[]),C=t.useCallback(e=>{i(e)},[]),A=t.useCallback(e=>{y(e)},[]);return a.createElement(Ke,null,a.createElement(Ve,null,a.createElement("div",{className:"min-h-screen bg-gray-50"},a.createElement("header",{className:"bg-white shadow"},a.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},a.createElement("div",{className:"flex justify-between items-center py-6"},a.createElement("div",{className:"flex items-center space-x-4"},a.createElement("div",{className:"flex items-center space-x-2"},a.createElement(E,{variant:"outline",size:"sm",onClick:()=>n("/"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Go to Homepage"},a.createElement(He,{className:"h-4 w-4"}),a.createElement("span",{className:"hidden sm:inline"},"Home")),a.createElement(E,{variant:"outline",size:"sm",onClick:()=>n("/dashboard"),className:"flex items-center space-x-1 px-2 sm:px-3",title:"Back to Dashboard"},a.createElement(Ge,{className:"h-4 w-4"}),a.createElement("span",{className:"hidden sm:inline"},"Dashboard"))),a.createElement("div",{className:"hidden md:block"},a.createElement("h1",{className:"text-3xl font-bold text-gray-900"},"Document Management"),a.createElement("p",{className:"text-gray-600"},"Upload, process, and manage your legal documents with AI")),a.createElement("div",{className:"md:hidden"},a.createElement("h1",{className:"text-xl font-bold text-gray-900"},"Documents"))),a.createElement("div",{className:"flex items-center space-x-4"},a.createElement("div",{className:"text-right"},a.createElement("p",{className:"text-sm text-gray-500"},"Subscription"),a.createElement("p",{className:"font-medium capitalize"},e?.subscription_tier||"Free"),a.createElement("p",{className:"text-xs text-gray-400"},"Debug: ",JSON.stringify({tier:e?.subscription_tier,email:e?.email}))),a.createElement(E,{variant:"outline",size:"sm",onClick:async()=>{try{await r(),console.log("Profile refreshed successfully")}catch(e){console.error("Failed to refresh profile:",e)}},className:"flex items-center space-x-1",title:"Refresh subscription status"},a.createElement(De,{className:"h-4 w-4"}),a.createElement("span",{className:"hidden sm:inline"},"Refresh")))))),a.createElement("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},a.createElement("div",{className:"px-4 py-6 sm:px-0"},s?a.createElement("div",{className:"space-y-6"},a.createElement("div",{className:"flex items-center justify-between"},a.createElement("div",{className:"flex items-center space-x-4"},a.createElement(E,{onClick:k,variant:"outline",size:"sm"},a.createElement(v,{className:"h-4 w-4 mr-2"}),"Close Viewer"),a.createElement("div",null,a.createElement("h2",{className:"text-xl font-semibold"},"Document Viewer"),a.createElement("p",{className:"text-gray-600"},"Viewing: ",s.filename)))),a.createElement(DocumentViewer,{documentId:s.id,onClose:k,className:"w-full"})):a.createElement(Q,{value:N,onValueChange:_,className:"space-y-6"},a.createElement(Z,{className:"grid w-full grid-cols-6"},a.createElement(Y,{value:"overview",className:"flex items-center space-x-2"},a.createElement(Ue,{className:"h-4 w-4"}),a.createElement("span",null,"Overview")),a.createElement(Y,{value:"upload",className:"flex items-center space-x-2"},a.createElement(h,{className:"h-4 w-4"}),a.createElement("span",null,"Upload")),a.createElement(Y,{value:"search",className:"flex items-center space-x-2"},a.createElement(R,{className:"h-4 w-4"}),a.createElement("span",null,"Search")),a.createElement(Y,{value:"manage",className:"flex items-center space-x-2"},a.createElement(Me,{className:"h-4 w-4"}),a.createElement("span",null,"Manage")),a.createElement(Y,{value:"enhanced",className:"flex items-center space-x-2"},a.createElement(De,{className:"h-4 w-4"}),a.createElement("span",null,"Enhanced")),a.createElement(Y,{value:"debug",className:"flex items-center space-x-2"},a.createElement(b,{className:"h-4 w-4"}),a.createElement("span",null,"Debug"))),a.createElement(J,{value:"overview",className:"space-y-6"},a.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6"},a.createElement("div",{className:"lg:col-span-2"},a.createElement(DocumentStatusTracker,{onDocumentSelect:S,refreshTrigger:x})),a.createElement("div",null,a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"text-lg flex items-center"},a.createElement(h,{className:"h-5 w-5 mr-2"}),"Quick Upload"),a.createElement(p,null,"Upload documents for AI processing")),a.createElement(f,null,a.createElement(DocumentUploadWrapper,{onUploadComplete:I,maxFiles:3}))))),a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"text-lg flex items-center"},a.createElement(g,{className:"h-5 w-5 mr-2"}),"Recent Documents"),a.createElement(p,null,"Your most recently uploaded documents")),a.createElement(f,null,a.createElement(DocumentList,{onDocumentSelect:S,refreshTrigger:x})))),a.createElement(J,{value:"upload",className:"space-y-6"},a.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6"},a.createElement("div",{className:"lg:col-span-2"},a.createElement(DocumentUploadWrapper,{onUploadComplete:I,maxFiles:10})),a.createElement("div",null,a.createElement(DocumentStatusTracker,{onDocumentSelect:S,refreshTrigger:x})))),a.createElement(J,{value:"search",className:"space-y-6"},a.createElement("div",{className:"space-y-6"},a.createElement(DocumentSearch,{onResults:C,onLoading:A}),a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"text-lg flex items-center"},a.createElement(R,{className:"h-5 w-5 mr-2"}),"Search Results",o&&a.createElement("div",{className:"ml-2 h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"})),a.createElement(p,null,c.length>0?`Found ${c.length} document${1===c.length?"":"s"}`:"Enter search criteria to find documents")),a.createElement(f,null,a.createElement(DocumentList,{onDocumentSelect:S,refreshTrigger:x}))))),a.createElement(J,{value:"manage",className:"space-y-6"},a.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6"},a.createElement("div",{className:"lg:col-span-3"},a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"text-lg flex items-center"},a.createElement(Me,{className:"h-5 w-5 mr-2"}),"All Documents"),a.createElement(p,null,"Manage all your uploaded documents")),a.createElement(f,null,a.createElement(DocumentList,{onDocumentSelect:S,refreshTrigger:x})))),a.createElement("div",null,a.createElement(DocumentStatusTracker,{onDocumentSelect:S,refreshTrigger:x})))),a.createElement(J,{value:"enhanced",className:"space-y-6"},a.createElement(Ve,null,a.createElement(DocumentManagementDashboard,null))),a.createElement(J,{value:"debug",className:"space-y-6"},a.createElement("div",{className:"space-y-6"},a.createElement(u,null,a.createElement(m,null,a.createElement(d,{className:"text-lg flex items-center"},a.createElement(b,{className:"h-5 w-5 mr-2"}),"Document Loading Debug"),a.createElement(p,null,"Authentication and API connectivity status")),a.createElement(f,null,a.createElement("div",{className:"space-y-4"},a.createElement("div",{className:"p-4 bg-gray-50 rounded-lg"},a.createElement("h4",{className:"font-medium mb-2"},"Current Status:"),a.createElement("div",{className:"text-sm space-y-1"},a.createElement("div",null,"Authentication: ",a.createElement("span",{className:"font-mono"},e?"Authenticated":"Not authenticated")),a.createElement("div",null,"User ID: ",a.createElement("span",{className:"font-mono"},e?.id||"N/A")),a.createElement("div",null,"Email: ",a.createElement("span",{className:"font-mono"},e?.email||"N/A")),a.createElement("div",null,"Subscription: ",a.createElement("span",{className:"font-mono"},e?.subscription_tier||"N/A")))),a.createElement("div",{className:"p-4 bg-blue-50 rounded-lg"},a.createElement("h4",{className:"font-medium mb-2"},"Troubleshooting:"),a.createElement("div",{className:"text-sm space-y-1"},a.createElement("div",null,"• Check browser console for detailed error messages"),a.createElement("div",null,"• Verify Supabase connection in Production Diagnostics below"),a.createElement("div",null,"• Try uploading a test document to verify the upload process"),a.createElement("div",null,"• Check if RLS policies are correctly configured")))))),a.createElement(UploadDiagnostics,null),a.createElement(Qe,null),a.createElement(Ze,null),a.createElement(DatabaseTest,null)))))))))};export{Documents as default};
