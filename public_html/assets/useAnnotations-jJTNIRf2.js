import{c as e,a6 as t,aT as n,aS as a,aV as o,a8 as s}from"./index-DpUelwut.js";import{a as r}from"./react-vendor-92YuBQvb.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i=e("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),c=e("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]),l=e("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),u=e("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),d=e("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=new class AnnotationsApi{async getDocumentAnnotations(e){const{data:n,error:a}=await t.from("document_annotations").select("*").eq("document_id",e).order("created_at",{ascending:!0});if(a)throw new Error(`Failed to fetch annotations: ${a.message}`);return n||[]}async createAnnotation(e){const{data:n}=await t.auth.getUser();if(!n.user)throw new Error("User not authenticated");const{data:a,error:o}=await t.from("document_annotations").insert({...e,user_id:n.user.id,is_resolved:!1}).select().single();if(o)throw new Error(`Failed to create annotation: ${o.message}`);return a}async updateAnnotation(e,n){const{data:a,error:o}=await t.from("document_annotations").update(n).eq("id",e).select().single();if(o)throw new Error(`Failed to update annotation: ${o.message}`);return a}async deleteAnnotation(e){const{error:n}=await t.from("document_annotations").delete().eq("id",e);if(n)throw new Error(`Failed to delete annotation: ${n.message}`)}subscribeToAnnotations(e,t){return console.log("Skipping annotations real-time subscription - disabled in production"),{unsubscribe:()=>console.log("Mock unsubscribe called")}}async getDocumentCollaborators(e){const{data:n,error:a}=await t.from("annotation_collaborators").select("\n        *,\n        user:profiles!annotation_collaborators_user_id_fkey(id, email, first_name, last_name),\n        invited_by_user:profiles!annotation_collaborators_invited_by_fkey(id, email, first_name, last_name)\n      ").eq("document_id",e);if(a)throw new Error(`Failed to fetch collaborators: ${a.message}`);return n||[]}async inviteCollaborator(e){const{data:n,error:a}=await t.from("profiles").select("id").eq("email",e.email).single();if(a||!n)throw new Error("User not found with this email address");const{data:o,error:s}=await t.from("annotation_collaborators").insert({document_id:e.document_id,user_id:n.id,permission_level:e.permission_level,invited_by:(await t.auth.getUser()).data.user?.id}).select().single();if(s)throw new Error(`Failed to invite collaborator: ${s.message}`);return o}async removeCollaborator(e){const{error:n}=await t.from("annotation_collaborators").delete().eq("id",e);if(n)throw new Error(`Failed to remove collaborator: ${n.message}`)}async updateCollaboratorPermission(e,n){const{data:a,error:o}=await t.from("annotation_collaborators").update({permission_level:n}).eq("id",e).select().single();if(o)throw new Error(`Failed to update permission: ${o.message}`);return a}async createReply(e){const{data:n}=await t.auth.getUser();if(!n.user)throw new Error("User not authenticated");const{data:a,error:o}=await t.from("annotation_replies").insert({...e,user_id:n.user.id}).select("\n        *,\n        user:profiles!annotation_replies_user_id_fkey(id, email, first_name, last_name)\n      ").single();if(o)throw new Error(`Failed to create reply: ${o.message}`);return a}};function useDocumentAnnotations(e,t){const i=n(),{data:c=[],isLoading:l,error:u,refetch:d}=a({queryKey:["annotations",e,t],queryFn:()=>m.getDocumentAnnotations(e,t),enabled:!!e,staleTime:3e4}),y=o({mutationFn:m.createAnnotation,onSuccess:n=>{i.setQueryData(["annotations",e,t],(e=[])=>[...e,n]),s.success("Annotation created successfully")},onError:e=>{s.error(`Failed to create annotation: ${e.message}`)}}),g=o({mutationFn:({id:e,data:t})=>m.updateAnnotation(e,t),onSuccess:n=>{i.setQueryData(["annotations",e,t],(e=[])=>e.map(e=>e.id===n.id?n:e)),s.success("Annotation updated successfully")},onError:e=>{s.error(`Failed to update annotation: ${e.message}`)}}),f=o({mutationFn:m.deleteAnnotation,onSuccess:(n,a)=>{i.setQueryData(["annotations",e,t],(e=[])=>e.filter(e=>e.id!==a)),s.success("Annotation deleted successfully")},onError:e=>{s.error(`Failed to delete annotation: ${e.message}`)}});return{annotations:c,isLoading:l,error:u,refetch:d,createAnnotation:r.useCallback(e=>y.mutateAsync(e),[y]),updateAnnotation:r.useCallback((e,t)=>g.mutateAsync({id:e,data:t}),[g]),deleteAnnotation:r.useCallback(e=>f.mutateAsync(e),[f]),isCreating:y.isPending,isUpdating:g.isPending,isDeleting:f.isPending}}function useAnnotationComments(e){const t=n(),a=o({mutationFn:m.addComment,onSuccess:n=>{t.setQueriesData({queryKey:["annotations"]},(t=[])=>t.map(t=>t.id===e?{...t,comments:[...t.comments||[],n]}:t)),s.success("Comment added successfully")},onError:e=>{s.error(`Failed to add comment: ${e.message}`)}}),i=o({mutationFn:({id:e,content:t})=>m.updateComment(e,t),onSuccess:n=>{t.setQueriesData({queryKey:["annotations"]},(t=[])=>t.map(t=>t.id===e?{...t,comments:t.comments?.map(e=>e.id===n.id?n:e)||[]}:t)),s.success("Comment updated successfully")},onError:e=>{s.error(`Failed to update comment: ${e.message}`)}}),c=o({mutationFn:m.deleteComment,onSuccess:(n,a)=>{t.setQueriesData({queryKey:["annotations"]},(t=[])=>t.map(t=>t.id===e?{...t,comments:t.comments?.filter(e=>e.id!==a)||[]}:t)),s.success("Comment deleted successfully")},onError:e=>{s.error(`Failed to delete comment: ${e.message}`)}});return{addComment:r.useCallback(e=>a.mutateAsync(e),[a]),updateComment:r.useCallback((e,t)=>i.mutateAsync({id:e,content:t}),[i]),deleteComment:r.useCallback(e=>c.mutateAsync(e),[c]),isAddingComment:a.isPending,isUpdatingComment:i.isPending,isDeletingComment:c.isPending}}function useAnnotationSharing(){const e=n(),t=o({mutationFn:m.shareAnnotation,onSuccess:t=>{e.setQueriesData({queryKey:["annotations"]},(e=[])=>e.map(e=>e.id===t.annotationId?{...e,shares:[...e.shares||[],t]}:e)),s.success("Annotation shared successfully")},onError:e=>{s.error(`Failed to share annotation: ${e.message}`)}}),a=o({mutationFn:m.removeShare,onSuccess:(t,n)=>{e.setQueriesData({queryKey:["annotations"]},(e=[])=>e.map(e=>({...e,shares:e.shares?.filter(e=>e.id!==n)||[]}))),s.success("Share removed successfully")},onError:e=>{s.error(`Failed to remove share: ${e.message}`)}});return{shareAnnotation:r.useCallback(e=>t.mutateAsync(e),[t]),removeShare:r.useCallback(e=>a.mutateAsync(e),[a]),isSharing:t.isPending,isRemoving:a.isPending}}function useAnnotationState(){const[e,t]=r.useState({annotation:null,isEditing:!1}),[n,a]=r.useState({type:"highlight",color:"yellow",isActive:!1}),[o,s]=r.useState({isDrawing:!1,currentPath:"",strokeWidth:2,color:"red"});return{selectedAnnotation:e,activeTool:n,drawingState:o,selectAnnotation:r.useCallback((e,n=!1)=>{t({annotation:e,isEditing:n})},[]),activateTool:r.useCallback((e,t="yellow")=>{a({type:e,color:t,isActive:!0})},[]),deactivateTool:r.useCallback(()=>{a(e=>({...e,isActive:!1}))},[]),startDrawing:r.useCallback((e="red",t=2)=>{s({isDrawing:!0,currentPath:"",strokeWidth:t,color:e})},[]),updateDrawingPath:r.useCallback(e=>{s(t=>({...t,currentPath:e}))},[]),stopDrawing:r.useCallback(()=>{s(e=>({...e,isDrawing:!1}))},[])}}export{i as E,c as H,l as R,d as Z,useAnnotationSharing as a,useDocumentAnnotations as b,useAnnotationState as c,u as d,useAnnotationComments as u};
