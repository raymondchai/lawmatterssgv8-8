import{r as e,j as a}from"./react-vendor-C9QDz5CC-1751185796186.js";import{b as t,s,e as r,d as n,u as l}from"./forms-CAQG-wcR-1751185796186.js";import{v as i,C as c,t as o,u as m,y as d,n as p,Z as u,z as g,A as h,E as x,G as y,K as j,I as f,o as v,_ as b,B as w,L as N,M as T,$ as A,J as S}from"./index-DTNQ23Y--1751185796186.js";import{chatWithAI as F}from"./openai-__QAh3XI-1751185796186.js";import{c2 as C,aT as P,aM as $,bE as q,F as _,r as k,K as R,aP as U}from"./ui-components-CF1SvaKX-1751185796186.js";const E={async getPublicTemplates(){const{data:e,error:a}=await i.from("templates").select("*").eq("is_public",!0).order("created_at",{ascending:!1});if(a)throw a;return e},async getUserTemplates(){const{data:e,error:a}=await i.from("templates").select("*").order("created_at",{ascending:!1});if(a)throw a;return e},async getTemplatesByCategory(e){const{data:a,error:t}=await i.from("templates").select("*").eq("category",e).eq("is_public",!0).order("created_at",{ascending:!1});if(t)throw t;return a},async getTemplate(e){const{data:a,error:t}=await i.from("templates").select("*").eq("id",e).single();if(t)throw t;return a},async createTemplate(e){const a=await i.auth.getUser();if(!a.data.user)throw new Error("User not authenticated");const{data:t,error:s}=await i.from("templates").insert({...e,created_by:a.data.user.id}).select().single();if(s)throw s;return t},async updateTemplate(e,a){const{data:t,error:s}=await i.from("templates").update(a).eq("id",e).select().single();if(s)throw s;return t},async deleteTemplate(e){const{error:a}=await i.from("templates").delete().eq("id",e);if(a)throw a},async searchTemplates(e){const{data:a,error:t}=await i.from("templates").select("*").or(`name.ilike.%${e}%,description.ilike.%${e}%,category.ilike.%${e}%`).eq("is_public",!0).order("created_at",{ascending:!1});if(t)throw t;return a},exportTemplate(e,a="txt"){let t,s;switch(a){case"json":t=JSON.stringify(e,null,2),s="application/json";break;case"docx":t=e.content,s="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;default:t=e.content,s="text/plain"}return new Blob([t],{type:s})},downloadTemplate(e,a="txt"){const t=this.exportTemplate(e,a),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`${e.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.${a}`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)},async createTemplateVersion(e,a,t){const s=await this.getTemplate(e),r={name:`${s.name} v${Date.now()}`,description:a.description||s.description,category:a.category||s.category,content:a.content||s.content,variables:a.variables||s.variables,is_public:a.is_public??s.is_public};return this.createTemplate(r)}};async function generateTemplate(e){const a=function buildTemplatePrompt(e){const{type:a,parties:t,terms:s,customRequirements:r,language:n="english",jurisdiction:l="singapore"}=e;let i=`Generate a professional legal ${a} template for ${"singapore"===l?"Singapore":"international"} use. `;i+="simplified"===n?"Use clear, simple language that non-lawyers can understand. ":"Use standard legal terminology and formal language. ";i+="\n\nTemplate Requirements:\n",i+=`- Document Type: ${a}\n`,(t.party1||t.party2)&&(i+="- Parties:\n",t.party1&&(i+=`  - First Party: Use variable {{party1_name}} for ${t.party1}\n`),t.party2&&(i+=`  - Second Party: Use variable {{party2_name}} for ${t.party2}\n`));Object.keys(s).length>0&&(i+="- Key Terms:\n",Object.entries(s).forEach(([e,a])=>{a&&(i+=`  - ${e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}: Use variable {{${e}}} for ${a}\n`)}));r&&(i+=`- Additional Requirements: ${r}\n`);return i+="\nInstructions:\n",i+="1. Create a complete, legally sound template\n",i+="2. Use variables in double curly braces {{variable_name}} for customizable fields\n",i+="3. Include all necessary legal clauses and provisions\n",i+="4. Ensure compliance with Singapore law (if applicable)\n",i+="5. Add appropriate signature blocks and date fields\n",i+="6. Include clear section headings and numbering\n\n",i+="Format your response as JSON with the following structure:\n",i+="{\n",i+='  "name": "Template name",\n',i+='  "description": "Brief description of the template",\n',i+='  "category": "Template category (contracts, employment, corporate, etc.)",\n',i+='  "content": "Full template content with variables",\n',i+='  "variables": ["list", "of", "variable", "names"]\n',i+="}\n\n",i+="Respond with valid JSON only, no additional text.",i}(e);try{const t=await F(a,[],[]),s=function parseTemplateResponse(e,a){try{const t=JSON.parse(e);return{name:t.name||`${a.type} Template`,content:t.content||e,variables:t.variables||extractVariablesFromContent(t.content||e),category:t.category||categorizeTemplate(a.type),description:t.description||`AI-generated ${a.type} template`}}catch(t){return console.warn("Failed to parse JSON response, using raw content"),{name:`${a.type} Template`,content:e,variables:extractVariablesFromContent(e),category:categorizeTemplate(a.type),description:`AI-generated ${a.type} template`}}}(t.message,e);return{...s,confidence:t.confidence}}catch(t){throw console.error("Template generation failed:",t),new Error("Failed to generate template")}}function extractVariablesFromContent(e){const a=e.match(/\{\{([^}]+)\}\}/g)||[];return[...new Set(a.map(e=>e.replace(/[{}]/g,"").trim()))]}function categorizeTemplate(e){return{contract:"contracts",agreement:"contracts","employment contract":"employment","service agreement":"contracts",nda:"contracts","non-disclosure agreement":"contracts","lease agreement":"real-estate","rental agreement":"real-estate","purchase agreement":"real-estate","partnership agreement":"corporate","shareholder agreement":"corporate","articles of incorporation":"corporate","trademark application":"intellectual-property","copyright notice":"intellectual-property","privacy policy":"compliance","terms of service":"compliance",will:"personal","power of attorney":"personal"}[e.toLowerCase()]||"other"}const V=t({type:s().min(1,"Template type is required"),party1:s().optional(),party2:s().optional(),duration:s().optional(),amount:s().optional(),jurisdiction:r(["singapore","international"]).default("singapore"),language:r(["english","simplified"]).default("english"),customRequirements:s().optional(),saveAsPublic:n().default(!1)}),G=[{value:"service agreement",label:"Service Agreement"},{value:"employment contract",label:"Employment Contract"},{value:"non-disclosure agreement",label:"Non-Disclosure Agreement (NDA)"},{value:"consulting agreement",label:"Consulting Agreement"},{value:"partnership agreement",label:"Partnership Agreement"},{value:"lease agreement",label:"Lease Agreement"},{value:"purchase agreement",label:"Purchase Agreement"},{value:"terms of service",label:"Terms of Service"},{value:"privacy policy",label:"Privacy Policy"},{value:"shareholder agreement",label:"Shareholder Agreement"},{value:"licensing agreement",label:"Licensing Agreement"},{value:"distribution agreement",label:"Distribution Agreement"}],TemplateGenerator=({onTemplateGenerated:t,className:s=""})=>{const[r,n]=e.useState(!1),[i,F]=e.useState(null),[I,L]=e.useState(!1),{register:D,handleSubmit:O,watch:z,setValue:J,formState:{errors:B}}=l({resolver:A(V),defaultValues:{jurisdiction:"singapore",language:"english",saveAsPublic:!1}}),M=z("type");return a.jsxs("div",{className:`space-y-6 ${s}`,children:[a.jsx(c,{children:a.jsxs(o,{children:[a.jsxs(m,{className:"flex items-center space-x-2",children:[a.jsx(C,{className:"h-5 w-5 text-purple-600"}),a.jsx("span",{children:"AI Template Generator"})]}),a.jsx(d,{children:"Generate custom legal templates using AI. Fill in the details below to create a professional legal document."})]})}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs(c,{children:[a.jsxs(o,{children:[a.jsx(m,{className:"text-lg",children:"Template Details"}),a.jsx(d,{children:"Provide information about the template you want to generate"})]}),a.jsx(p,{children:a.jsxs("form",{onSubmit:O(async e=>{n(!0);try{const a={type:e.type,parties:{party1:e.party1,party2:e.party2},terms:{duration:e.duration,amount:e.amount,jurisdiction:e.jurisdiction},customRequirements:e.customRequirements,language:e.language,jurisdiction:e.jurisdiction},s=await generateTemplate(a);F(s),L(!0),t?.(s),S.success("Template generated successfully!")}catch(a){console.error("Template generation failed:",a),S.error("Failed to generate template: "+a.message)}finally{n(!1)}}),className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"type",children:"Template Type *"}),a.jsxs(g,{onValueChange:e=>J("type",e),children:[a.jsx(h,{children:a.jsx(x,{placeholder:"Select template type"})}),a.jsx(y,{children:G.map(e=>a.jsx(j,{value:e.value,children:e.label},e.value))})]}),B.type&&a.jsx("p",{className:"text-red-500 text-sm",children:B.type.message}),M&&a.jsx("p",{className:"text-sm text-gray-600",children:(K=M,{"service agreement":"A contract for providing services between two parties","employment contract":"An agreement between employer and employee","non-disclosure agreement":"A confidentiality agreement to protect sensitive information","consulting agreement":"A contract for consulting services","partnership agreement":"An agreement between business partners","lease agreement":"A rental agreement for property","purchase agreement":"A contract for buying/selling goods or property","terms of service":"Terms and conditions for using a service or platform","privacy policy":"A policy explaining how personal data is collected and used","shareholder agreement":"An agreement between company shareholders"}[K]||"A legal document template")})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"party1",children:"First Party"}),a.jsx(f,{...D("party1"),placeholder:"e.g., Service Provider, Employer"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"party2",children:"Second Party"}),a.jsx(f,{...D("party2"),placeholder:"e.g., Client, Employee"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"duration",children:"Duration/Term"}),a.jsx(f,{...D("duration"),placeholder:"e.g., 12 months, 2 years"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"amount",children:"Amount/Value"}),a.jsx(f,{...D("amount"),placeholder:"e.g., $5,000, SGD 10,000"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"jurisdiction",children:"Jurisdiction"}),a.jsxs(g,{onValueChange:e=>J("jurisdiction",e),children:[a.jsx(h,{children:a.jsx(x,{placeholder:"Select jurisdiction"})}),a.jsxs(y,{children:[a.jsx(j,{value:"singapore",children:"Singapore"}),a.jsx(j,{value:"international",children:"International"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"language",children:"Language Style"}),a.jsxs(g,{onValueChange:e=>J("language",e),children:[a.jsx(h,{children:a.jsx(x,{placeholder:"Select language style"})}),a.jsxs(y,{children:[a.jsx(j,{value:"english",children:"Standard Legal"}),a.jsx(j,{value:"simplified",children:"Plain English"})]})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(u,{htmlFor:"customRequirements",children:"Additional Requirements"}),a.jsx(v,{...D("customRequirements"),placeholder:"Describe any specific clauses, terms, or requirements you need...",rows:3})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(b,{id:"saveAsPublic",onCheckedChange:e=>J("saveAsPublic",!!e)}),a.jsx(u,{htmlFor:"saveAsPublic",className:"text-sm",children:"Make this template public for other users"})]}),a.jsx(w,{type:"submit",disabled:r,className:"w-full",children:r?a.jsxs(a.Fragment,{children:[a.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating Template..."]}):a.jsxs(a.Fragment,{children:[a.jsx(C,{className:"mr-2 h-4 w-4"}),"Generate Template"]})})]})})]}),a.jsxs(c,{children:[a.jsx(o,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(m,{className:"text-lg",children:"Generated Template"}),a.jsx(d,{children:"Preview and save your AI-generated template"})]}),i&&a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(w,{variant:"outline",size:"sm",onClick:()=>L(!I),children:[a.jsx($,{className:"h-4 w-4 mr-2"}),I?"Hide":"Show"," Preview"]}),a.jsxs(w,{size:"sm",onClick:async()=>{if(i)try{const e=z("saveAsPublic");await async function saveGeneratedTemplate(e,a=!1){try{const t={name:e.name,description:e.description,category:e.category,content:e.content,variables:e.variables,is_public:a};return await E.createTemplate(t)}catch(t){throw console.error("Failed to save generated template:",t),new Error("Failed to save template")}}(i,e),S.success("Template saved successfully!")}catch(e){console.error("Failed to save template:",e),S.error("Failed to save template: "+e.message)}},children:[a.jsx(q,{className:"h-4 w-4 mr-2"}),"Save"]})]})]})}),a.jsx(p,{children:i?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(k,{className:"h-5 w-5 text-green-600"}),a.jsx("h4",{className:"font-medium text-green-900",children:i.name})]}),a.jsx("p",{className:"text-sm text-green-700 mb-2",children:i.description}),a.jsxs("div",{className:"flex items-center space-x-4 text-xs text-green-600",children:[a.jsxs("span",{children:["Category: ",i.category]}),a.jsxs("span",{children:["Variables: ",i.variables.length]}),a.jsxs("span",{children:["Confidence: ",Math.round(100*i.confidence),"%"]})]})]}),i.variables.length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"font-medium text-sm mb-2",children:"Template Variables:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:i.variables.map((e,t)=>a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:e},t))})]}),I&&a.jsxs("div",{children:[a.jsx("h5",{className:"font-medium text-sm mb-2",children:"Template Content:"}),a.jsx("div",{className:"max-h-64 overflow-y-auto p-3 bg-gray-50 rounded border text-sm",children:a.jsx("pre",{className:"whitespace-pre-wrap font-mono",children:i.content})})]}),i.confidence<.7&&a.jsxs(N,{children:[a.jsx(R,{className:"h-4 w-4"}),a.jsx(T,{children:"This template was generated with lower confidence. Please review carefully and consider consulting a legal professional."})]})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(_,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No template generated yet"}),a.jsx("p",{className:"text-gray-500",children:'Fill in the form and click "Generate Template" to create your custom legal document.'})]})})]})]}),a.jsxs(c,{children:[a.jsx(o,{children:a.jsxs(m,{className:"text-sm flex items-center space-x-2",children:[a.jsx(U,{className:"h-4 w-4"}),a.jsx("span",{children:"Tips for Better Templates"})]})}),a.jsx(p,{children:a.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[a.jsx("li",{children:"• Be specific about the type of agreement you need"}),a.jsx("li",{children:'• Provide clear party descriptions (e.g., "Software Company" vs "Company A")'}),a.jsx("li",{children:"• Include specific terms like duration, amounts, and key obligations"}),a.jsx("li",{children:"• Mention any special requirements or unique clauses needed"}),a.jsx("li",{children:"• Choose the appropriate jurisdiction for your use case"}),a.jsx("li",{children:'• Use "Plain English" style for simpler, more readable templates'})]})})]})]});var K};export{TemplateGenerator as T,E as t};
